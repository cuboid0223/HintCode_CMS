(function(b,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("react"),require("react-fast-compare"),require("firebase/auth"),require("firebase/storage"),require("firebase/app"),require("firebase/app-check"),require("@firecms/core"),require("firebase/firestore"),require("js-search"),require("firebase/database"),require("react/jsx-runtime"),require("@firecms/ui"),require("@firecms/schema_inference")):typeof define=="function"&&define.amd?define(["exports","react","react-fast-compare","firebase/auth","firebase/storage","firebase/app","firebase/app-check","@firecms/core","firebase/firestore","js-search","firebase/database","react/jsx-runtime","@firecms/ui","@firecms/schema_inference"],l):(b=typeof globalThis<"u"?globalThis:b||self,l(b["FireCMS Firebase"]={},b.React,b.equal,b.auth,b.storage,b.app,b.appCheck,b.core,b.firestore,b.JsSearch,b.database,b.jsxRuntime,b.ui,b.schema_inference))})(this,function(b,l,Oe,O,q,ee,de,F,d,Ie,P,r,I,te){"use strict";function je(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const Ne=je(Ie),fe=({loading:e,firebaseApp:t,signInOptions:n,onSignOut:o,defineRolesFor:i})=>{const[u,c]=l.useState(void 0),[h,C]=l.useState(),[a,s]=l.useState(),[f,w]=l.useState(!0),[p,g]=l.useState(!0),[m,S]=l.useState(!1),[D,k]=l.useState(),[T,E]=l.useState(),[j,M]=l.useState(),x=l.useRef(t?O.getAuth(t):null),A=l.useCallback(async(y,v)=>{console.log("Updating user",y),!e&&(c(y),g(!1),v&&w(!1))},[e]),U=l.useCallback(async y=>{if(i&&y){const v=await i(y);Oe(v,T)||E(v)}},[i,T]);l.useEffect(()=>{U&&u&&U(u)},[U,u]),l.useEffect(()=>{if(t)try{const y=O.getAuth(t);return x.current=y,C(void 0),A(y.currentUser,!1),O.onAuthStateChanged(y,async v=>{console.log("User state changed",v),await A(v,!0)},v=>s(v))}catch(y){return C(y),w(!1),()=>{}}},[t,A]),l.useEffect(()=>{!e&&x.current&&A(x.current.currentUser,!1)},[e,A]);const N=l.useCallback(y=>n?.find(v=>{if(v===null)throw Error("useFirebaseAuthController");if(typeof v=="object"&&v.provider===y)return v}),[n]),J=l.useCallback(()=>{const y=new O.GoogleAuthProvider,v=N("google.com");v?.scopes&&v.scopes.forEach($=>y.addScope($)),v?.customParameters?y.setCustomParameters(v.customParameters):y.setCustomParameters({prompt:"select_account"});const L=x.current;if(!L)throw Error("No auth");O.signInWithPopup(L,y).catch(s)},[N]),z=l.useCallback(async()=>{if(!u)throw Error("No client user is logged in");return u.getIdToken()},[u]),Z=l.useCallback((y,v)=>{const L=x.current;if(!L)throw Error("No auth");g(!0),O.signInWithEmailAndPassword(L,y,v).catch(s).then(()=>g(!1))},[]),se=l.useCallback((y,v)=>{const L=x.current;if(!L)throw Error("No auth");g(!0),O.createUserWithEmailAndPassword(L,y,v).catch(s).then(()=>g(!1))},[]),De=l.useCallback(y=>{const v=x.current;if(!v)throw Error("No auth");return g(!0),O.fetchSignInMethodsForEmail(v,y).then(L=>(g(!1),L))},[]),Le=l.useCallback(()=>{const y=x.current;if(!y)throw Error("No auth");O.signOut(y).then(v=>{c(null),E(void 0),s(null),o&&o()}),S(!1)},[o]),_=l.useCallback((y,v)=>{g(!0),O.signInWithPopup(y,v).catch(s).then(()=>g(!1))},[]),ie=l.useCallback(()=>{const y=x.current;if(!y)throw Error("No auth");g(!0),O.signInAnonymously(y).catch(s).then(()=>g(!1))},[]),Y=l.useCallback((y,v)=>{const L=x.current;if(!L)throw Error("No auth");return g(!0),O.signInWithPhoneNumber(L,y,v).catch(s).then($=>{g(!1),k($??void 0)})},[]),X=l.useCallback(()=>{const y=new O.OAuthProvider("apple.com"),v=N("apple.com");v?.scopes&&v.scopes.forEach($=>y.addScope($)),v?.customParameters&&y.setCustomParameters(v.customParameters);const L=x.current;if(!L)throw Error("No auth");_(L,y)},[_,N]),ce=l.useCallback(()=>{const y=new O.FacebookAuthProvider,v=N("facebook.com");v?.scopes&&v.scopes.forEach($=>y.addScope($)),v?.customParameters&&y.setCustomParameters(v.customParameters);const L=x.current;if(!L)throw Error("No auth");_(L,y)},[_,N]),le=l.useCallback(()=>{const y=new O.GithubAuthProvider,v=N("github.com");v?.scopes&&v.scopes.forEach($=>y.addScope($)),v?.customParameters&&y.setCustomParameters(v.customParameters);const L=x.current;if(!L)throw Error("No auth");_(L,y)},[_,N]),ae=l.useCallback(()=>{const y=new O.OAuthProvider("microsoft.com"),v=N("microsoft.com");v?.scopes&&v.scopes.forEach($=>y.addScope($)),v?.customParameters&&y.setCustomParameters(v.customParameters);const L=x.current;if(!L)throw Error("No auth");_(L,y)},[_,N]),ue=l.useCallback(()=>{const y=new O.TwitterAuthProvider,v=N("twitter.com");v?.customParameters&&y.setCustomParameters(v.customParameters);const L=x.current;if(!L)throw Error("No auth");_(L,y)},[_,N]),V=l.useCallback(()=>{S(!0),c(null),E(void 0)},[]);return{user:u?{...u,roles:T,firebaseUser:u}:null,roles:T,setUser:A,setRoles:E,authProviderError:a,authLoading:p,initialLoading:e||f,signOut:Le,getAuthToken:z,googleLogin:J,skipLogin:V,loginSkipped:m,emailPasswordLogin:Z,createUserWithEmailAndPassword:se,fetchSignInMethodsForEmail:De,anonymousLogin:ie,phoneLogin:Y,appleLogin:X,facebookLogin:ce,githubLogin:le,microsoftLogin:ae,twitterLogin:ue,confirmationResult:D,extra:j,setExtra:M}};function he({firebaseApp:e,bucketUrl:t}){const n={};return{uploadFile({file:o,fileName:i,path:u,metadata:c,bucket:h}){if(!e)throw Error("useFirebaseStorageSource Firebase not initialised");const C=h??t,a=q.getStorage(e,C);if(!a)throw Error("useFirebaseStorageSource Firebase not initialised");const s=i??o.name;return console.debug("Uploading file",s,o,u,c),q.uploadBytes(q.ref(a,`${u}/${s}`),o,c).then(f=>({path:f.ref.fullPath}))},async getFile(o,i){try{if(!e)throw Error("useFirebaseStorageSource Firebase not initialised");const u=i??t,c=q.getStorage(e,u);if(!c)throw Error("useFirebaseStorageSource Firebase not initialised");const h=q.ref(c,o),C=await q.getDownloadURL(h),s=await(await fetch(C)).blob();return new File([s],o)}catch(u){if(u?.code==="storage/object-not-found")return null;throw u}},async getDownloadURL(o,i){if(!e)throw Error("useFirebaseStorageSource Firebase not initialised");const u=i??t,c=q.getStorage(e,u);if(!c)throw Error("useFirebaseStorageSource Firebase not initialised");if(n[o])return n[o];try{const h=q.ref(c,o),[C,a]=await Promise.all([q.getDownloadURL(h),q.getMetadata(h)]),s={url:C,metadata:a};return n[o]=s,s}catch(h){if(h?.code==="storage/object-not-found")return{url:null,fileNotFound:!0};throw h}}}}const xe=`It seems like the provided Firebase config is not correct. If you 
are using the credentials provided automatically by Firebase 
Hosting, make sure you link your Firebase app to Firebase Hosting. 
`;function ge({firebaseConfig:e,fromUrl:t,onFirebaseInit:n,name:o,authDomain:i}){const[u,c]=l.useState(),[h,C]=l.useState(!1),[a,s]=l.useState(),f=l.useCallback(w=>{try{const p=o??"[DEFAULT]",m=ee.getApps().find(D=>D.name===p);m&&ee.deleteApp(m);const S=ee.initializeApp(w,p);s(void 0),C(!1),c(S)}catch(p){console.error("Error initialising Firebase",p),s(xe+`
`+(p.message??JSON.stringify(p)))}},[o]);return l.useEffect(()=>{n&&e&&u&&n(e,u)},[u]),l.useEffect(()=>{C(!0);function w(p){fetch(p).then(async g=>{if(console.debug("Firebase init response",g.status),g&&g.status<300){const m=await g.json();i&&(m.authDomain=i),f(m)}}).catch(g=>{C(!1),s("Could not load Firebase configuration from Firebase hosting. If the app is not deployed in Firebase hosting, you need to specify the configuration manually"+g.toString())})}e?f(e):t?w(t):process.env.NODE_ENV==="production"?w("/__/firebase/init.json"):(C(!1),s("You need to deploy the app to Firebase hosting or specify a Firebase configuration object"))},[]),{firebaseApp:u,firebaseConfigLoading:h,configError:a}}function pe({firebaseApp:e,options:t}){t?.debugToken&&Object.assign(window,{FIREBASE_APPCHECK_DEBUG_TOKEN:t?.debugToken});const[n,o]=l.useState(!1),[i,u]=l.useState(void 0),[c,h]=l.useState(),C=l.useCallback(async a=>{try{const s=await de.getToken(a,t?.forceRefresh);console.debug("App Check token:",s),s?(u(!0),console.debug("App Check success.")):(h("App Check failed."),u(!1))}catch(s){console.error(s),h(s.message)}},[t?.forceRefresh]);return l.useEffect(()=>{if(!t||!e||i!==void 0)return;o(!0);const{provider:a,isTokenAutoRefreshEnabled:s}=t,f=de.initializeAppCheck(e,{provider:a,isTokenAutoRefreshEnabled:s});C(f).then(()=>{o(!1)})},[i,e,t,C]),{loading:n,appCheckVerified:i,error:c}}function _e(e,t){return t?[...t.map(F.stripCollectionPath),F.stripCollectionPath(e)].join(F.COLLECTION_PATH_SEPARATOR):F.stripCollectionPath(e)}function W(e){return Array.isArray(e)?e.map(t=>W(t)):typeof e=="object"?Object.entries(e).map(([t,n])=>({[t]:W(n)})).reduce((t,n)=>({...t,...n}),{}):e===void 0?d.deleteField():e}const Me=e=>{const t=e.map(o=>{const i=o.id,u=we(o);return{[i]:u}}).reduce((o,i)=>({...o,...i}),{});return Object.keys(t).sort((o,i)=>i.split(F.COLLECTION_PATH_SEPARATOR).length-o.split(F.COLLECTION_PATH_SEPARATOR).length).forEach(o=>{const i=t[o];if(o.includes(F.COLLECTION_PATH_SEPARATOR)){const u=o.split(F.COLLECTION_PATH_SEPARATOR).slice(0,-1).join(F.COLLECTION_PATH_SEPARATOR),c=t[u];c&&(c.subcollections=[...c.subcollections??[],i]),delete t[o]}}),Object.values(t)},we=e=>{const t=e.data();if(!t)throw Error("Entity collection has not been persisted correctly");const n=t.propertiesOrder,o=t.properties??{};F.makePropertiesEditable(o);const i=F.sortProperties(o,n);return{...t,properties:i,id:t.id??t.alias??t.path}};function $e(e,t){const{properties:n,...o}=e,i=n?qe(n,t):void 0,u=i?W(F.removeFunctions(i)):void 0;let c={};return o&&(c={...o}),u&&(c.properties=u),(o.propertiesOrder||u)&&(c.propertiesOrder=He(o.propertiesOrder??Object.keys(u))),delete c.permissions,c.entityViews&&(c.entityViews=c.entityViews.filter(h=>typeof h=="string")),delete c.editable,delete c.additionalFields,delete c.callbacks,delete c.Actions,delete c.entityActions,delete c.selectionController,delete c.subcollections,delete c.exportable,c}function qe(e,t){const n={};return Object.entries(e).forEach(([o,i])=>{if(typeof i=="object"){const u=i.propertyConfig?t[i.propertyConfig]:void 0;let c;u?.property?c=F.removePropsIfExisting(i,u?.property):c=i,n[o]={...c}}}),n}function He(e){return[...new Set(e)]}async function Ve(e,t,n,o){console.debug("getFirestoreDataInPath",t,o);const i=d.getFirestore(e);if(n){let u,c=0;const h=n;h.push(t);let C=h[0];for(;C;){if(u)u=(await Promise.all(u.map(async a=>{const s=d.query(d.collection(i,a.ref.path,C),d.limit(5));return(await d.getDocs(s)).docs}))).flat();else{const a=d.query(d.collection(i,C),d.limit(5));u=(await d.getDocs(a)).docs}c++,C=c<h.length?h[c]:void 0}return u?u.map(a=>a.data()):[]}else{const u=d.query(d.collection(i,t),d.limit(o));return d.getDocs(u).then(c=>c.docs.map(h=>h.data()))}}function Ae(e,t){return console.debug("Performing Algolia query",e,t),e.search(t).then(({hits:n})=>n.map(o=>o.objectID)).catch(n=>(console.error(n),[]))}function Ue({isPathSupported:e,search:t}){return n=>({init:i=>Promise.resolve(e(i.path)),search:t})}const ye="https://api-drplyi3b6q-ey.a.run.app";async function Be({host:e=ye,firebaseToken:t,projectId:n,collectionPath:o,query:i}){return console.debug("Performing Pinecone query",o,i),(await(await fetch((e??ye)+`/projects/${n}/search/${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${t}`},body:JSON.stringify({query:i})})).json()).data.ids}function ze({isPathSupported:e,search:t}){return n=>({init:i=>Promise.resolve(e(i.path)),search:t})}const Ge=100,re=({firebaseApp:e})=>{let t;const n={},o={},i=h=>{o[h]&&(o[h](),delete o[h])};return{init:({path:h,collection:C})=>(console.debug("Init local search controller",h,C),t&&h!==t&&i(t),t=h,new Promise((a,s)=>{if(!n[h]&&C){console.debug("Init local search controller",h),n[h]=Je(C);const f=d.getFirestore(e),w=d.collection(f,h);console.log("Listening to collection",h,w),o[h]=d.onSnapshot(d.query(w),{next:p=>{const g=p.docs.map(m=>({id:m.id,...m.data()}));console.log("Added docs to index",h,g.length),n[h].addDocuments(g),a(!0)},error:p=>{console.error("Error initializing local search controller",h),console.error(p),s(p)}})}})),search:async({searchString:h,path:C})=>{const a=n[C];if(!a)throw new Error(`Index not found for path ${C}`);return(await a.search(h)).splice(0,Ge).map(f=>f.id)}}};function Je(e){const t=new Ne.Search("id");return t.addIndex("id"),Object.entries(e.properties).forEach(([n,o])=>{t.addIndex(n)}),t}function ve({firebaseApp:e,textSearchControllerBuilder:t,firestoreIndexesBuilder:n,localTextSearchEnabled:o}){const i=l.useRef();l.useEffect(()=>{!i.current&&e&&(t||o)&&!i.current&&(i.current=Ke({firebaseApp:e,textSearchControllerBuilder:t,localTextSearchEnabled:o??!1}))},[e,o,t]);const u=l.useCallback((a,s,f,w,p,g,m=!1)=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const S=d.getFirestore(e),D=m?d.collectionGroup(S,a):d.collection(S,a),k=[];return s&&Object.entries(s).filter(([T,E])=>!!E).forEach(([T,E])=>{const[j,M]=E;k.push(d.where(T,j,B(M,S)))}),f&&w&&k.push(d.orderBy(f,w)),p&&k.push(d.startAfter(p)),g&&k.push(d.limit(g)),d.query(D,...k)},[e]),c=l.useCallback((a,s)=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const f=d.getFirestore(e);return d.getDoc(d.doc(f,a,s)).then(w=>{if(w.exists())return K(w)})},[e]),h=l.useCallback(({path:a,entityId:s,collection:f,onUpdate:w,onError:p})=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const g=d.getFirestore(e);return d.onSnapshot(d.doc(g,a,s),{next:m=>{w(K(m))},error:p})},[e]),C=l.useCallback(({path:a,searchString:s,onUpdate:f})=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const w=i.current;if(!w)throw Error("Trying to make text search without specifying a FirestoreTextSearchController");let p=[];const m=O.getAuth(e).currentUser;if(!m)throw Error("No current user");const S=w.search({path:a,searchString:s,currentUser:m});if(!S)throw Error("The current path is not supported by the specified FirestoreTextSearchController");return S.then(D=>{D.length===0&&(p=[],f([]));const k=[],T=new Set;p=D.map(E=>h({path:a,entityId:E,onUpdate:j=>{j.values?T.has(j.id)||(T.add(j.id),k.push(j),f(k)):(T.delete(j.id),f([...k.filter(M=>M.id!==E)]))}}))}),()=>{p.forEach(D=>D())}},[e,h]);return{setDateToMidnight:Ye,delegateToCMSModel:G,cmsToDelegateModel:a=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");return B(a,d.getFirestore(e))},currentTime:We,initTextSearchController:l.useCallback(async a=>i.current?i.current.init(a):!1,[]),fetchCollection:l.useCallback(async({path:a,filter:s,limit:f,startAfter:w,searchString:p,orderBy:g,order:m,isCollectionGroup:S})=>{console.debug("Fetching collection",{path:a,limit:f,filter:s,startAfter:w,orderBy:g,order:m,isCollectionGroup:S});const D=u(a,s,g,m,w,f,S);return(await d.getDocs(D)).docs.map(T=>K(T))},[u]),listenCollection:l.useCallback(({path:a,filter:s,limit:f,startAfter:w,searchString:p,orderBy:g,order:m,onUpdate:S,onError:D,isCollectionGroup:k,collection:T})=>{if(console.debug("Listening collection",{path:a,searchString:p,isCollectionGroup:k,limit:f,filter:s,startAfter:w,orderBy:g,order:m}),!e)throw Error("useFirestoreDelegate Firebase not initialised");const E=u(a,s,g,m,w,f,k);return p?C({path:a,searchString:p,onUpdate:S}):d.onSnapshot(E,{next:j=>{p||S(j.docs.map(M=>K(M)))},error:D})},[u,e,C]),fetchEntity:l.useCallback(({path:a,entityId:s})=>c(a,s),[c]),listenEntity:h,saveEntity:l.useCallback(({path:a,entityId:s,values:f,status:w})=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const p=d.getFirestore(e),g=d.collection(p,a);console.debug("Saving entity",{path:a,entityId:s,values:f});let m;return s?m=d.doc(g,s):m=d.doc(g),d.setDoc(m,f,{merge:!0}).then(()=>({id:m.id,path:a,values:f})).catch(S=>{throw console.error("Error saving entity",S),S})},[e]),deleteEntity:l.useCallback(({entity:a})=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const s=d.getFirestore(e);return d.deleteDoc(d.doc(s,a.path,a.id))},[e]),checkUniqueField:l.useCallback(async(a,s,f,w)=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const p=d.getFirestore(e);if(console.debug("Check unique field entity",a,s,f,w),f==null)return Promise.resolve(!0);const g=d.query(d.collection(p,a),d.where(s,"==",B(f,p)));return(await d.getDocs(g)).docs.filter(S=>S.id!==w).length===0},[e]),generateEntityId:l.useCallback(a=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const s=d.getFirestore(e);return d.doc(d.collection(s,a)).id},[e]),countEntities:l.useCallback(async({path:a,filter:s,order:f,orderBy:w,isCollectionGroup:p})=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");const g=u(a,s,w,f,void 0,void 0,p);return(await d.getCountFromServer(g)).data().count},[e]),isFilterCombinationValid:l.useCallback(({path:a,collection:s,filterValues:f,sortBy:w})=>{if(!e)throw Error("useFirestoreDelegate Firebase not initialised");if(n===void 0)return!0;const p=n?.({path:a,collection:s}),g=w?w[0]:void 0,m=w?w[1]:void 0,S=Object.values(f),D=Object.keys(f),k=D.length;return!g&&S.every(T=>T[0]==="==")||k===1&&(!g||g===D[0])?!0:!p&&k>1?!1:!!p&&p.filter(T=>!g||g in T).find(T=>Object.entries(f).every(([E,j])=>T[E]!==void 0&&(!m||T[E]===m)))!==void 0},[e])}}const K=e=>{const t=G(e.data());return{id:e.id,path:Ce(e.ref.path),values:t}};function G(e){if(e==null)return null;if(!d.deleteField().isEqual(e)){if(d.serverTimestamp().isEqual(e))return null;if(e instanceof d.Timestamp||typeof e.toDate=="function"&&e.toDate()instanceof Date)return e.toDate();if(e instanceof Date)return e;if(!(typeof e=="object"&&"__type__"in e&&e.__type__==="__vector__")){if(e instanceof d.GeoPoint)return new F.GeoPoint(e.latitude,e.longitude);if(e instanceof d.DocumentReference)return new F.EntityReference(e.id,Ce(e.path));if(Array.isArray(e))return e.map(G).filter(t=>t!==void 0);if(typeof e=="object"){const t={};for(const n of Object.keys(e)){const o=G(e[n]);o!==void 0&&(t[n]=o)}return t}return e}}}function Ce(e){let t=e.lastIndexOf("/");return t=t===-1?e.length:t,e.substring(0,t)}function Ye(e){if(!e||!(e instanceof d.Timestamp))return e;const t=e.toDate();return t.setHours(0,0,0,0),d.Timestamp.fromDate(t)}function B(e,t){return e===void 0?d.deleteField():e===null?null:Array.isArray(e)?e.filter(n=>n!==void 0).map(n=>B(n,t)):e.isEntityReference&&e.isEntityReference()?d.doc(t,e.path,e.id):e instanceof F.GeoPoint?new d.GeoPoint(e.latitude,e.longitude):e instanceof Date?d.Timestamp.fromDate(e):e&&typeof e=="object"&&"__type__"in e&&e.__type__==="__vector__"?void 0:e&&typeof e=="object"?Object.entries(e).map(([n,o])=>{const i=B(o,t);return i!==void 0?{[n]:i}:{}}).reduce((n,o)=>({...n,...o}),{}):e}function We(){return d.serverTimestamp()}function Ke({textSearchControllerBuilder:e,firebaseApp:t,localTextSearchEnabled:n}){if(!e&&n)return re({firebaseApp:t});if(!n&&e)return e({firebaseApp:t});if(!e&&!n)return;const o=re({firebaseApp:t}),i=e({firebaseApp:t});return{init:async u=>await i.init(u)?!0:o.init(u),search:u=>i.search(u)??o.search(u)}}function Qe({firebaseApp:e}){const t=l.useCallback(async({path:s,filter:f,limit:w,startAfter:p,orderBy:g,order:m,searchString:S})=>{if(!e)throw new Error("Firebase app not provided");const D=P.getDatabase(e);let k=P.query(P.ref(D,s));p!==void 0&&(k=P.query(k,P.orderByKey(),P.startAt(p))),w!==void 0&&(k=P.query(k,P.limitToFirst(w)));const T=await P.get(k);return T.exists()?Object.entries(T.val()).map(([E,j])=>({id:E,path:s,values:j})):[]},[e]),n=l.useCallback(({path:s,onUpdate:f})=>{if(!e)throw new Error("Firebase app not provided");const w=P.getDatabase(e),p=P.ref(w,s),g=P.onValue(p,m=>{if(m.exists()){const S=Object.entries(m.val()).map(([D,k])=>({id:D,path:s,values:k}));f(S)}else f([])});return()=>g()},[e]),o=l.useCallback(async({path:s,entityId:f})=>{if(!e)throw new Error("Firebase app not provided");const w=P.getDatabase(e),p=await P.get(P.ref(w,`${s}/${f}`));if(p.exists())return{id:f,path:s,values:p.val()}},[e]),i=l.useCallback(({path:s,entityId:f,onUpdate:w,onError:p})=>{if(!e)throw new Error("Firebase app not provided");const g=P.getDatabase(e),m=P.ref(g,`${s}/${f}`),S=P.onValue(m,D=>{D.exists()?w({id:f,path:s,values:D.val()}):p?.(new Error("Entity does not exist"))});return()=>S()},[e]),u=l.useCallback(async({path:s,entityId:f,values:w})=>{if(!e)throw new Error("Firebase app not provided");const p=P.getDatabase(e),g=f??P.push(P.ref(p,s)).key;if(!g)throw new Error("Could not generate a new id");return await P.set(P.ref(p,`${s}/${g}`),w),{id:g,path:s,values:w}},[e]),c=l.useCallback(async({entity:s})=>{if(!e)throw new Error("Firebase app not provided");const f=P.getDatabase(e);await P.remove(P.ref(f,`${s.path}/${s.id}`))},[e]),h=l.useCallback(async(s,f,w,p)=>{if(!e)throw new Error("Firebase app not provided");const g=P.getDatabase(e),m=P.query(P.ref(g,s),P.orderByChild(f),P.startAt(w),P.limitToFirst(1)),S=await P.get(m);if(!S.exists())return!0;const[D,k]=Object.entries(S.val())[0];return!!(k&&typeof k=="object"&&k[f]===w&&D===p)},[e]),C=l.useCallback(s=>{if(!e)throw new Error("Firebase app not provided");const f=P.getDatabase(e);return P.push(P.ref(f,s)).key},[e]),a=l.useCallback(({path:s,filter:f,sortBy:w})=>!1,[]);return{fetchCollection:t,listenCollection:n,fetchEntity:o,listenEntity:i,saveEntity:u,deleteEntity:c,checkUniqueField:h,generateEntityId:C,isFilterCombinationValid:a,cmsToDelegateModel:s=>{if(!e)throw new Error("Firebase app not provided");const f=P.getDatabase(e);return Q(s,f)},currentTime:()=>new Date,delegateToCMSModel:oe,setDateToMidnight:Ze}}function Ze(e){const t=new Date(e);return t.setHours(0,0,0,0),t}function oe(e){if(e==null)return null;if(Array.isArray(e))return e.map(oe).filter(t=>t!==void 0);if(typeof e=="object"){const t={};for(const n of Object.keys(e)){const o=oe(e[n]);o!==void 0&&(t[n]=o)}return t}return e}function Q(e,t){return e===void 0||e===null?null:Array.isArray(e)?e.filter(n=>n!==void 0).map(n=>Q(n,t)):e.isEntityReference&&e.isEntityReference()?P.ref(t,`${e.path}/${e.id}`):e instanceof Date?e.toISOString():e&&typeof e=="object"?Object.entries(e).map(([n,o])=>{const i=Q(o,t);return i!==void 0?{[n]:i}:{}}).reduce((n,o)=>({...n,...o}),{}):e}const ne="recaptcha-container";function me(){return l.useEffect(()=>{if(!window||window?.recaptchaVerifier)return;const e=O.getAuth();window.recaptchaVerifier=new O.RecaptchaVerifier(e,ne,{size:"invisible"})},[]),null}const Xe=e=>r.jsx(r.Fragment,{children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:32,height:32,children:[r.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJb",x1:"29.401",x2:"29.401",y1:"4.064",y2:"106.734",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[r.jsx("stop",{offset:"0",stopColor:"#ff5840"}),r.jsx("stop",{offset:".007",stopColor:"#ff5840"}),r.jsx("stop",{offset:".989",stopColor:"#fa528c"}),r.jsx("stop",{offset:"1",stopColor:"#fa528c"})]}),r.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJb)",d:"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z"}),r.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJc",x1:"12.148",x2:"12.148",y1:".872",y2:"47.812",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[r.jsx("stop",{offset:"0",stopColor:"#feaa53"}),r.jsx("stop",{offset:".612",stopColor:"#ffcd49"}),r.jsx("stop",{offset:"1",stopColor:"#ffde44"})]}),r.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJc)",d:"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z"}),r.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJd",x1:"29.76",x2:"29.76",y1:"32.149",y2:"-6.939",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[r.jsx("stop",{offset:"0",stopColor:"#42d778"}),r.jsx("stop",{offset:".428",stopColor:"#3dca76"}),r.jsx("stop",{offset:"1",stopColor:"#34b171"})]}),r.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJd)",d:"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z"}),r.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJe",x1:"46",x2:"46",y1:"3.638",y2:"35.593",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[r.jsx("stop",{offset:"0",stopColor:"#155cde"}),r.jsx("stop",{offset:".278",stopColor:"#1f7fe5"}),r.jsx("stop",{offset:".569",stopColor:"#279ceb"}),r.jsx("stop",{offset:".82",stopColor:"#2cafef"}),r.jsx("stop",{offset:"1",stopColor:"#2eb5f0"})]}),r.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJe)",d:`M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15
        c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z`})]})}),Re=e=>r.jsx("svg",{width:32,height:32,viewBox:"0 0 56 56",style:{transform:"scale(2.8)"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("g",{stroke:e==="light"?"#424245":"white",strokeWidth:"0.5",fillRule:"evenodd",children:r.jsx("path",{d:"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z",fill:e==="light"?"#424245":"white",fillRule:"nonzero"})})}),et=e=>r.jsx("svg",{fill:e==="light"?"#1c1e21":"white",role:"img",viewBox:"0 0 24 24",width:28,height:28,xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),tt=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 90 90",children:r.jsx("g",{children:r.jsx("path",{d:"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z",fill:e==="light"?"#39569c":"white"})})}),rt=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 480 480",children:r.jsx("g",{children:r.jsx("path",{d:"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z",fill:e==="light"?"#00a2ed":"white"})})}),ot=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 24 24",children:r.jsx("path",{fill:e==="light"?"#00acee":"white",d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})});function be({allowSkipLogin:e,logo:t,signInOptions:n,firebaseApp:o,authController:i,noUserComponent:u,disableSignupScreen:c=!1,disabled:h=!1,additionalComponent:C,notAllowedError:a}){const s=F.useModeController(),[f,w]=l.useState(!1),[p,g]=l.useState(!1),m=n.map(E=>typeof E=="object"?E.provider:E),S=l.useCallback(()=>{const E=O.getAuth(o),j=new O.RecaptchaVerifier(E,"recaptcha",{size:"invisible"}),M=O.getMultiFactorResolver(E,i.authProviderError);if(M.hints[0].factorId===O.PhoneMultiFactorGenerator.FACTOR_ID){const x={multiFactorHint:M.hints[0],session:M.session};new O.PhoneAuthProvider(E).verifyPhoneNumber(x,j).then(function(U){const N=String(window.prompt("Please enter the verification code that was sent to your mobile device.")),J=O.PhoneAuthProvider.credential(U,N),z=O.PhoneMultiFactorGenerator.assertion(J);return M.resolveSignIn(z)})}else console.warn("Unsupported second factor.")},[i.authProviderError]);function D(){let E;if(i.user!=null)return E;const j=["auth/popup-closed-by-user","auth/cancelled-popup-request"];return i.authProviderError&&(i.authProviderError.code==="auth/operation-not-allowed"||i.authProviderError.code==="auth/configuration-not-found"?E=r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"p-4",children:r.jsx(F.ErrorView,{title:"Firebase Auth not enabled",error:"You need to enable Firebase Auth and the corresponding login provider in your Firebase project"})}),o&&r.jsx("div",{className:"p-4",children:r.jsx("a",{href:`https://console.firebase.google.com/project/${o.options.projectId}/authentication/providers`,rel:"noopener noreferrer",target:"_blank",children:r.jsx(I.Button,{variant:"text",color:"error",children:"Open Firebase configuration"})})})]}):i.authProviderError.code==="auth/invalid-api-key"?E=r.jsx("div",{className:"p-4",children:r.jsx(F.ErrorView,{title:"Invalid API key",error:"auth/invalid-api-key: Check that your Firebase config is set correctly in your `firebase_config.ts` file"})}):j.includes(i.authProviderError.code)||(i.authProviderError.code==="auth/multi-factor-auth-required"&&S(),E=r.jsx("div",{className:"p-4",children:r.jsx(F.ErrorView,{error:i.authProviderError})}))),E}let k;t?k=r.jsx("img",{src:t,style:{height:"100%",width:"100%",objectFit:"contain"},alt:"Logo"}):k=r.jsx(F.FireCMSLogo,{});let T;return a&&(typeof a=="string"?T=a:a instanceof Error?T=a.message:T="It looks like you don't have access to the CMS, based on the specified Authenticator configuration"),r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen min-w-full p-4",children:[r.jsx("div",{id:"recaptcha"}),r.jsxs("div",{className:"flex flex-col items-center w-full max-w-[500px]",children:[r.jsx("div",{className:"p-1 w-64 h-64 m-4",children:k}),T&&r.jsx("div",{className:"p-8",children:r.jsx(F.ErrorView,{error:T})}),D(),!f&&!p&&r.jsxs("div",{className:"my-4 w-full",children:[Ee(i,m,s.mode,h),m.includes("password")&&r.jsx(H,{disabled:h,text:"Email/password",icon:r.jsx(I.EmailIcon,{size:28}),onClick:()=>w(!0)}),m.includes("phone")&&r.jsx(H,{disabled:h,text:"Phone number",icon:r.jsx(I.PhoneIcon,{size:28}),onClick:()=>g(!0)}),m.includes("anonymous")&&r.jsx(H,{disabled:h,text:"Log in anonymously",icon:r.jsx(I.PersonOutlineIcon,{size:28}),onClick:i.anonymousLogin}),e&&r.jsx(I.Button,{className:"m-1 mb-4",variant:"text",disabled:h,onClick:i.skipLogin,children:"Skip login"})]}),f&&r.jsx(st,{authController:i,onClose:()=>w(!1),mode:s.mode,noUserComponent:u,disableSignupScreen:c}),p&&r.jsx(nt,{authController:i,onClose:()=>g(!1)}),!f&&!p&&C]})]})}function H({icon:e,onClick:t,text:n,disabled:o}){return r.jsx("div",{className:"m-1 w-full",children:r.jsx(I.Button,{className:"w-full",variant:"outlined",disabled:o,onClick:t,children:r.jsxs("div",{className:"p-1 flex h-8 items-center justify-items-center",children:[r.jsx("div",{className:"flex flex-col w-8 items-center justify-items-center",children:e}),r.jsx("div",{className:"flex-grow pl-2 text-center",children:n})]})})})}function nt({onClose:e,authController:t}){me();const[n,o]=l.useState(),[i,u]=l.useState(),[c,h]=l.useState(!1),C=async a=>{a.preventDefault(),i&&t.confirmationResult?(h(!1),t.confirmationResult.confirm(i).catch(s=>{s.code==="auth/invalid-verification-code"&&h(!0)})):n&&t.phoneLogin(n,window.recaptchaVerifier)};return r.jsxs("form",{onSubmit:C,children:[c&&r.jsx("div",{className:"p-8",children:r.jsx(F.ErrorView,{error:"Invalid confirmation code"})}),r.jsx("div",{id:ne}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx(I.IconButton,{onClick:e,children:r.jsx(I.ArrowBackIcon,{className:"w-5 h-5"})}),r.jsx("div",{className:"p-1 flex",children:r.jsx(I.Typography,{align:"center",variant:"subtitle2",children:"Please enter your phone number"})}),r.jsx(I.TextField,{placeholder:"",value:n??"",disabled:!!(n&&(t.authLoading||t.confirmationResult)),type:"phone",onChange:a=>o(a.target.value)}),!!(n&&t.confirmationResult)&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mt-2 p-1 flex",children:r.jsx(I.Typography,{align:"center",variant:"subtitle2",children:"Please enter the confirmation code"})}),r.jsx(I.TextField,{placeholder:"",value:i??"",type:"text",onChange:a=>u(a.target.value)})]}),r.jsxs("div",{className:"flex justify-end items-center w-full",children:[t.authLoading&&r.jsx(I.CircularProgress,{className:"p-1",size:"small"}),r.jsx(I.Button,{type:"submit",children:"Ok"})]})]})]})}function st({onClose:e,authController:t,mode:n,noUserComponent:o,disableSignupScreen:i}){const u=l.useRef(null),[c,h]=l.useState("email"),[C,a]=l.useState(),[s,f]=l.useState(),[w,p]=l.useState();l.useEffect(()=>{(c==="password"||c==="registration")&&u.current&&u.current.focus()},[c]),l.useEffect(()=>{if(!document)return;const E=j=>{j.keyCode===27&&e()};return document.addEventListener("keydown",E,!1),()=>{document.removeEventListener("keydown",E,!1)}},[e]);function g(){C&&(t.fetchSignInMethodsForEmail(C).then(E=>{p(E.filter(j=>j!=="password"))}),h("password"))}function m(){C&&s&&t.emailPasswordLogin(C,s)}function S(){C&&s&&t.createUserWithEmailAndPassword(C,s)}const D=()=>{c==="email"?e():c==="password"||c==="registration"?h("email"):p(void 0)},k=E=>{E.preventDefault(),c==="email"?g():c==="password"?m():c==="registration"&&S()},T=c==="registration"?"Please enter your email and password to create an account":c==="password"?"Please enter your password":"Please enter your email";return r.jsx("form",{className:"w-full",onSubmit:k,children:r.jsxs("div",{className:"max-w-[480px] w-full flex flex-col gap-4",children:[r.jsx(I.IconButton,{onClick:D,children:r.jsx(I.ArrowBackIcon,{className:"w-5 h-5"})}),r.jsx("div",{children:c==="registration"&&o}),r.jsx(I.Typography,{className:`${c==="registration"&&i?"hidden":"flex"}`,variant:"subtitle2",children:T}),(c==="email"||c==="registration")&&r.jsx(I.TextField,{placeholder:"Email",autoFocus:!0,value:C??"",disabled:t.authLoading,type:"email",onChange:E=>a(E.target.value)}),r.jsx("div",{className:`${c==="password"||c==="registration"&&!i?"block":"hidden"}`,children:r.jsx(I.TextField,{placeholder:"Password",value:s??"",disabled:t.authLoading,inputRef:u,type:"password",onChange:E=>f(E.target.value)})}),r.jsxs("div",{className:`${c==="registration"&&i?"hidden":"flex"} justify-end items-center w-full flex gap-2`,children:[t.authLoading&&r.jsx(I.CircularProgress,{className:"p-1",size:"small"}),c==="email"&&r.jsx(I.Button,{variant:"outlined",onClick:()=>h("registration"),children:"New user"}),r.jsx(I.Button,{type:"submit",children:c==="registration"?"Create account":"Login"})]}),w&&w.length>0&&r.jsxs("div",{className:"flex flex-col gap-4 p-4",children:[r.jsxs("div",{children:[r.jsx(I.Typography,{variant:"subtitle2",children:"You already have an account"}),r.jsxs(I.Typography,{variant:"body2",children:["You can use one of these methods to login with ",C]})]}),r.jsx("div",{children:w&&Ee(t,w,n,!1)})]})]})})}function Ee(e,t,n,o){return r.jsxs(r.Fragment,{children:[t.includes("google.com")&&r.jsx(H,{disabled:o,text:"Sign in with Google",icon:Xe(),onClick:e.googleLogin}),t.includes("microsoft.com")&&r.jsx(H,{disabled:o,text:"Sign in with Microsoft",icon:rt(n),onClick:e.microsoftLogin}),t.includes("apple.com")&&r.jsx(H,{disabled:o,text:"Sign in with Apple",icon:Re(n),onClick:e.appleLogin}),t.includes("github.com")&&r.jsx(H,{disabled:o,text:"Sign in with Github",icon:et(n),onClick:e.githubLogin}),t.includes("facebook.com")&&r.jsx(H,{disabled:o,text:"Sign in with Facebook",icon:tt(n),onClick:e.facebookLogin}),t.includes("twitter.com")&&r.jsx(H,{disabled:o,text:"Sign in with Twitter",icon:ot(n),onClick:e.twitterLogin})]})}const Fe=[O.GoogleAuthProvider.PROVIDER_ID];function it({name:e,logo:t,logoDark:n,toolbarExtraWidget:o,authenticator:i,collections:u,views:c,adminViews:h,textSearchControllerBuilder:C,allowSkipLogin:a,signInOptions:s=Fe,firebaseConfig:f,onFirebaseInit:w,appCheckOptions:p,dateTimeFormat:g,locale:m,basePath:S,baseCollectionPath:D,onAnalyticsEvent:k,propertyConfigs:T,plugins:E,autoOpenDrawer:j,firestoreIndexesBuilder:M,components:x,localTextSearchEnabled:A=!1}){F.useBrowserTitleAndIcon(e,t);const U=(T??[]).map(V=>({[V.key]:V})).reduce((V,R)=>({...V,...R}),{}),{firebaseApp:N,firebaseConfigLoading:J,configError:z}=ge({onFirebaseInit:w,firebaseConfig:f}),Z=F.useBuildModeController(),{loading:se,appCheckVerified:De,error:Le}=pe({firebaseApp:N,options:p}),_=fe({firebaseApp:N,signInOptions:s}),ie=F.useBuildLocalConfigurationPersistence(),Y=ve({firebaseApp:N,textSearchControllerBuilder:C,firestoreIndexesBuilder:M,localTextSearchEnabled:A}),X=he({firebaseApp:N}),{authLoading:ce,canAccessMainView:le,notAllowedError:ae}=F.useValidateAuthenticator({authController:_,authenticator:i,dataSourceDelegate:Y,storageSource:X}),ue=F.useBuildNavigationController({collections:u,views:c,basePath:S,baseCollectionPath:D,authController:_,adminViews:h,dataSourceDelegate:Y});return J||!N||se?r.jsx(r.Fragment,{children:r.jsx(F.CircularProgressCenter,{})}):z?r.jsx(I.CenteredView,{children:z}):r.jsx(F.SnackbarProvider,{children:r.jsx(F.ModeControllerProvider,{value:Z,children:r.jsx(F.FireCMS,{authController:_,navigationController:ue,userConfigPersistence:ie,dateTimeFormat:g,dataSourceDelegate:Y,storageSource:X,entityLinkBuilder:({entity:V})=>`https://console.firebase.google.com/project/${N.options.projectId}/firestore/data/${V.path}/${V.id}`,locale:m,onAnalyticsEvent:k,plugins:E,propertyConfigs:U,children:({context:V,loading:R})=>{let y;if(R||ce)y=r.jsx(F.CircularProgressCenter,{size:"large"});else{const v=Z.mode==="dark"&&n?n:t;if(le)y=r.jsxs(F.Scaffold,{name:e,logo:v,fireCMSAppBarProps:{endAdornment:o},autoOpenDrawer:j,children:[r.jsx(F.NavigationRoutes,{HomePage:x?.HomePage}),r.jsx(F.SideDialogs,{})]});else{const L=x?.LoginView??be;y=r.jsx(L,{logo:v,allowSkipLogin:a,signInOptions:s??Fe,firebaseApp:N,authController:_,notAllowedError:ae})}}return y}})})})}async function Pe(e,t,n=!1,o,i=100){if(o&&(o??[])?.length>0){const[h,...C]=o,a=await d.getDocs(d.query(d.collection(e,h),d.limit(5)));return Promise.all(a.docs.map(s=>Pe(e,s.ref.path+"/"+t,n,C,Math.max(Math.ceil(i/5),5)))).then(s=>s.flat())}const u=d.query(n?d.collectionGroup(e,t):d.collection(e,t),d.limit(i)),c=await d.getDocs(u);return console.debug("Got documents",n,u,c.docs),c.docs}async function Se(e,t,n,o){console.debug("Building schema for collection",t,o);const i=F.removeInitialAndTrailingSlashes(t),c=(await Pe(e,i,n,o)).map(h=>h.data()).filter(Boolean);return ke(t,c)}async function ke(e,t){const n=F.removeInitialAndTrailingSlashes(e),o=await te.buildEntityPropertiesFromData(t,Te),i=te.buildPropertiesOrder(o),u=n.includes("/")?n.split("/").slice(-1)[0]:n;return{path:n,name:F.unslugify(u),properties:o,propertiesOrder:i}}async function ct(e){return te.buildEntityPropertiesFromData(e,Te)}function Te(e){return typeof e=="number"?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":e instanceof d.Timestamp?"date":e instanceof F.GeoPoint?"geopoint":e instanceof d.DocumentReference?"reference":"map"}const lt=e=>{if(e)return(t,n,o)=>{const i=d.getFirestore(e);return Se(i,t,n,o)}};b.FireCMSFirebaseApp=it,b.FirebaseLoginView=be,b.LoginButton=H,b.RECAPTCHA_CONTAINER_ID=ne,b.buildAlgoliaSearchController=Ue,b.buildCollectionId=_e,b.buildCollectionInference=lt,b.buildPineconeSearchController=ze,b.cmsToFirestoreModel=B,b.cmsToRTDBModel=Q,b.docToCollection=we,b.docsToCollectionTree=Me,b.firestoreToCMSModel=G,b.getFirestoreDataInPath=Ve,b.getInferredEntityCollection=Se,b.getInferredEntityCollectionFromData=ke,b.getPropertiesFromData=ct,b.localSearchControllerBuilder=re,b.performAlgoliaTextSearch=Ae,b.performPineconeTextSearch=Be,b.prepareCollectionForPersistence=$e,b.setUndefinedToDelete=W,b.useAppCheck=pe,b.useFirebaseAuthController=fe,b.useFirebaseRTDBDelegate=Qe,b.useFirebaseStorageSource=he,b.useFirestoreDelegate=ve,b.useInitialiseFirebase=ge,b.useRecaptcha=me,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
