{"version":3,"file":"index.umd.js","sources":["../src/hooks/useFirebaseAuthController.ts","../src/hooks/useFirebaseStorageSource.ts","../src/hooks/useInitialiseFirebase.ts","../src/hooks/useAppCheck.ts","../src/utils/collections_firestore.ts","../src/utils/database.ts","../src/utils/algolia.ts","../src/utils/pinecone.ts","../src/utils/local_text_search_controller.ts","../src/hooks/useFirestoreDelegate.ts","../src/hooks/useFirebaseRealTimeDBDelegate.ts","../src/hooks/useRecaptcha.tsx","../src/components/social_icons.tsx","../src/components/FirebaseLoginView.tsx","../src/components/FireCMSFirebaseApp.tsx","../src/collection_editor/schema_inference/firestore.ts","../src/collection_editor/schema_inference/inference.ts","../src/collection_editor/infer_collection.ts"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from \"react\";\nimport equal from \"react-fast-compare\"\n\nimport {\n    ApplicationVerifier,\n    Auth,\n    ConfirmationResult,\n    createUserWithEmailAndPassword as createUserWithEmailAndPasswordFirebase,\n    FacebookAuthProvider,\n    fetchSignInMethodsForEmail as fetchSignInMethodsForEmailFirebase,\n    getAuth,\n    GithubAuthProvider,\n    GoogleAuthProvider,\n    OAuthProvider,\n    onAuthStateChanged,\n    signInAnonymously,\n    signInWithEmailAndPassword,\n    signInWithPhoneNumber,\n    signInWithPopup,\n    signOut,\n    TwitterAuthProvider,\n    User as FirebaseUser\n} from \"firebase/auth\";\nimport { FirebaseApp } from \"firebase/app\";\nimport { FirebaseAuthController, FirebaseSignInOption, FirebaseSignInProvider } from \"../types\";\nimport { Role, User } from \"@firecms/core\";\n\nexport interface FirebaseAuthControllerProps {\n    loading?: boolean;\n    firebaseApp?: FirebaseApp;\n    signInOptions?: Array<FirebaseSignInProvider | FirebaseSignInOption>;\n    onSignOut?: () => void;\n    defineRolesFor?: (user: User) => Promise<Role[] | undefined> | Role[] | undefined;\n}\n\n/**\n * Use this hook to build an {@link AuthController} based on Firebase Auth\n * @group Firebase\n */\nexport const useFirebaseAuthController = <ExtraData>({\n                                                         loading,\n                                                         firebaseApp,\n                                                         signInOptions,\n                                                         onSignOut: onSignOutProp,\n                                                         defineRolesFor\n                                                     }: FirebaseAuthControllerProps): FirebaseAuthController<ExtraData> => {\n\n    const [loggedUser, setLoggedUser] = useState<FirebaseUser | null | undefined>(undefined); // logged user, anonymous or logged out\n    const [authError, setAuthError] = useState<any>();\n    const [authProviderError, setAuthProviderError] = useState<any>();\n    const [initialLoading, setInitialLoading] = useState<boolean>(true);\n    const [authLoading, setAuthLoading] = useState(true);\n    const [loginSkipped, setLoginSkipped] = useState<boolean>(false);\n    const [confirmationResult, setConfirmationResult] = useState<undefined | ConfirmationResult>();\n    const [roles, setRoles] = useState<Role[] | undefined>();\n    const [extra, setExtra] = useState<any>();\n\n    const authRef = useRef(firebaseApp ? getAuth(firebaseApp) : null);\n\n    const updateUser = useCallback(async (user: FirebaseUser | null, initialize?: boolean) => {\n        console.log(\"Updating user\", user);\n        if (loading) return;\n        // if (defineRolesFor && user) {\n        //     const userRoles = await defineRolesFor(user);\n        //     setRoles(userRoles);\n        // }\n        setLoggedUser(user);\n        setAuthLoading(false);\n        if (initialize) {\n            setInitialLoading(false);\n        }\n    }, [loading]);\n\n    const updateRoles = useCallback(async (user: FirebaseUser | null) => {\n        if (defineRolesFor && user) {\n            const userRoles = await defineRolesFor(user);\n            if (!equal(userRoles, roles)) {\n                setRoles(userRoles);\n            }\n        }\n    }, [defineRolesFor, roles]);\n\n    useEffect(() => {\n        if (updateRoles && loggedUser) {\n            updateRoles(loggedUser);\n        }\n    }, [updateRoles, loggedUser]);\n\n    useEffect(() => {\n        if (!firebaseApp) return;\n        try {\n            const auth = getAuth(firebaseApp);\n            authRef.current = auth;\n            setAuthError(undefined);\n            updateUser(auth.currentUser, false)\n            return onAuthStateChanged(\n                auth,\n                async (user) => {\n                    console.log(\"User state changed\", user);\n                    await updateUser(user, true);\n                },\n                error => setAuthProviderError(error)\n            );\n        } catch (e) {\n            setAuthError(e);\n            setInitialLoading(false);\n            return () => {\n            };\n        }\n    }, [firebaseApp, updateUser]);\n\n    useEffect(() => {\n        if (!loading && authRef.current) {\n            updateUser(authRef.current.currentUser, false);\n        }\n    }, [loading, updateUser]);\n\n    const getProviderOptions = useCallback((providerId: FirebaseSignInProvider): FirebaseSignInOption | undefined => {\n        return signInOptions?.find((option) => {\n            if (option === null) throw Error(\"useFirebaseAuthController\");\n            if (typeof option === \"object\" && option.provider === providerId)\n                return option as FirebaseSignInOption;\n            return undefined;\n        }) as FirebaseSignInOption | undefined;\n    }, [signInOptions]);\n\n    const googleLogin = useCallback(() => {\n        const provider = new GoogleAuthProvider();\n        const options = getProviderOptions(\"google.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters) {\n            provider.setCustomParameters(options.customParameters);\n        } else {\n            provider.setCustomParameters({\n                prompt: \"select_account\"\n            });\n        }\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        signInWithPopup(auth, provider).catch(setAuthProviderError);\n    }, [getProviderOptions]);\n\n    const getAuthToken = useCallback(async (): Promise<string> => {\n        if (!loggedUser)\n            throw Error(\"No client user is logged in\");\n        return loggedUser.getIdToken();\n    }, [loggedUser]);\n\n    const emailPasswordLogin = useCallback((email: string, password: string) => {\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        setAuthLoading(true);\n        signInWithEmailAndPassword(auth, email, password)\n            .catch(setAuthProviderError)\n            .then(() => setAuthLoading(false));\n    }, []);\n\n    const createUserWithEmailAndPassword = useCallback((email: string, password: string) => {\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        setAuthLoading(true);\n        createUserWithEmailAndPasswordFirebase(auth, email, password)\n            .catch(setAuthProviderError)\n            .then(() => setAuthLoading(false));\n    }, []);\n\n    const fetchSignInMethodsForEmail = useCallback((email: string): Promise<string[]> => {\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        setAuthLoading(true);\n        return fetchSignInMethodsForEmailFirebase(auth, email)\n            .then((res) => {\n                setAuthLoading(false);\n                return res;\n            });\n    }, []);\n\n    const onSignOut = useCallback(() => {\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        signOut(auth)\n            .then(_ => {\n                setLoggedUser(null);\n                setRoles(undefined);\n                setAuthProviderError(null);\n                onSignOutProp && onSignOutProp();\n            });\n        setLoginSkipped(false);\n    }, [onSignOutProp]);\n\n    const doOauthLogin = useCallback((auth: Auth, provider: OAuthProvider | FacebookAuthProvider | GithubAuthProvider | TwitterAuthProvider) => {\n        setAuthLoading(true);\n        signInWithPopup(auth, provider)\n            .catch(setAuthProviderError).then(() => setAuthLoading(false));\n    }, []);\n\n    const anonymousLogin = useCallback(() => {\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        setAuthLoading(true);\n        signInAnonymously(auth)\n            .catch(setAuthProviderError)\n            .then(() => setAuthLoading(false));\n    }, []);\n\n    const phoneLogin = useCallback((phone: string, applicationVerifier: ApplicationVerifier) => {\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        setAuthLoading(true);\n        return signInWithPhoneNumber(auth, phone, applicationVerifier)\n            .catch(setAuthProviderError)\n            .then((res) => {\n                setAuthLoading(false);\n                setConfirmationResult(res ?? undefined);\n            });\n    }, []);\n\n    const appleLogin = useCallback(() => {\n        const provider = new OAuthProvider(\"apple.com\");\n        const options = getProviderOptions(\"apple.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const facebookLogin = useCallback(() => {\n        const provider = new FacebookAuthProvider();\n        const options = getProviderOptions(\"facebook.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const githubLogin = useCallback(() => {\n        const provider = new GithubAuthProvider();\n        const options = getProviderOptions(\"github.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const microsoftLogin = useCallback(() => {\n        const provider = new OAuthProvider(\"microsoft.com\");\n        const options = getProviderOptions(\"microsoft.com\");\n        if (options?.scopes)\n            options.scopes.forEach((scope) => provider.addScope(scope));\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const twitterLogin = useCallback(() => {\n        const provider = new TwitterAuthProvider();\n        const options = getProviderOptions(\"twitter.com\");\n        if (options?.customParameters)\n            provider.setCustomParameters(options.customParameters);\n        const auth = authRef.current;\n        if (!auth) throw Error(\"No auth\");\n        doOauthLogin(auth, provider);\n    }, [doOauthLogin, getProviderOptions]);\n\n    const skipLogin = useCallback(() => {\n        setLoginSkipped(true);\n        setLoggedUser(null);\n        setRoles(undefined);\n    }, []);\n\n    const firebaseUserWrapper = loggedUser\n        ? {\n            ...loggedUser,\n            roles,\n            firebaseUser: loggedUser\n        }\n        : null;\n\n    return {\n        user: firebaseUserWrapper,\n        roles,\n        setUser: updateUser,\n        setRoles,\n        authProviderError,\n        authLoading,\n        initialLoading: loading || initialLoading,\n        signOut: onSignOut,\n        getAuthToken,\n        googleLogin,\n        skipLogin,\n        loginSkipped,\n        emailPasswordLogin,\n        createUserWithEmailAndPassword,\n        fetchSignInMethodsForEmail,\n        anonymousLogin,\n        phoneLogin,\n        appleLogin,\n        facebookLogin,\n        githubLogin,\n        microsoftLogin,\n        twitterLogin,\n        confirmationResult,\n        extra,\n        setExtra\n    };\n};\n","import { FirebaseApp } from \"firebase/app\";\nimport { getDownloadURL, getMetadata, getStorage, ref, uploadBytes } from \"firebase/storage\";\nimport { DownloadConfig, DownloadMetadata, StorageSource, UploadFileProps } from \"@firecms/core\";\n\n/**\n * @group Firebase\n */\nexport interface FirebaseStorageSourceProps {\n    firebaseApp?: FirebaseApp\n    bucketUrl?: string\n}\n\n/**\n * Use this hook to build an {@link StorageSource} based on Firebase storage\n * @group Firebase\n */\nexport function useFirebaseStorageSource({ firebaseApp, bucketUrl }: FirebaseStorageSourceProps): StorageSource {\n    const urlsCache: Record<string, DownloadConfig> = {};\n    return {\n        uploadFile({ file, fileName, path, metadata, bucket }: UploadFileProps)\n            : Promise<any> {\n            if (!firebaseApp) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n            const storageBucketUrl = bucket ?? bucketUrl;\n            const storage = getStorage(firebaseApp, storageBucketUrl);\n            if (!storage) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n            const usedFilename = fileName ?? file.name;\n            console.debug(\"Uploading file\", usedFilename, file, path, metadata);\n            return uploadBytes(ref(storage, `${path}/${usedFilename}`), file, metadata).then(snapshot => ({\n                path: snapshot.ref.fullPath\n            }));\n        },\n\n        async getFile(path: string, bucket?: string): Promise<File | null> {\n            try {\n                if (!firebaseApp) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n                const storageBucketUrl = bucket ?? bucketUrl;\n                const storage = getStorage(firebaseApp, storageBucketUrl);\n                if (!storage) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n                const fileRef = ref(storage, path);\n                const url = await getDownloadURL(fileRef);\n                const response = await fetch(url);\n                const blob = await response.blob();\n                return new File([blob], path);\n            } catch (e: any) {\n                if (e?.code === \"storage/object-not-found\") return null;\n                throw e;\n            }\n        },\n\n        async getDownloadURL(storagePathOrUrl: string, bucket?: string): Promise<DownloadConfig> {\n            if (!firebaseApp) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n            const storageBucketUrl = bucket ?? bucketUrl;\n            const storage = getStorage(firebaseApp, storageBucketUrl);\n            if (!storage) throw Error(\"useFirebaseStorageSource Firebase not initialised\");\n            if (urlsCache[storagePathOrUrl])\n                return urlsCache[storagePathOrUrl];\n            try {\n                const fileRef = ref(storage, storagePathOrUrl);\n                const [url, metadata] = await Promise.all([getDownloadURL(fileRef), getMetadata(fileRef)]);\n                const result: DownloadConfig = {\n                    url,\n                    metadata: metadata as DownloadMetadata\n                }\n                urlsCache[storagePathOrUrl] = result;\n                return result;\n            } catch (e: any) {\n                if (e?.code === \"storage/object-not-found\") return { url: null, fileNotFound: true };\n                throw e;\n            }\n        }\n    };\n}\n","import { useCallback, useEffect, useState } from \"react\";\n\nimport { deleteApp, FirebaseApp, getApps, initializeApp } from \"firebase/app\";\n\n/**\n * @group Firebase\n */\nexport interface InitialiseFirebaseResult {\n    firebaseConfigLoading: boolean,\n    firebaseApp?: FirebaseApp;\n    configError?: string,\n    firebaseConfigError?: Error\n}\n\nconst hostingError = \"It seems like the provided Firebase config is not correct. If you \\n\" +\n    \"are using the credentials provided automatically by Firebase \\n\" +\n    \"Hosting, make sure you link your Firebase app to Firebase Hosting. \\n\";\n\n/**\n * Function used to initialise Firebase, either by using the provided config,\n * or by fetching it by Firebase Hosting, if not specified.\n *\n * It works as a hook that gives you the loading state and the used\n * configuration.\n *\n * You most likely only need to use this if you are developing a custom app\n * that is not using {@link FireCMSApp}. You can also not use this component\n * and initialise Firebase yourself.\n *\n * @param onFirebaseInit\n * @param firebaseConfig\n * @param fromUrl\n * @param name\n * @param authDomain\n * @group Firebase\n */\nexport function useInitialiseFirebase({\n                                          firebaseConfig,\n                                          fromUrl,\n                                          onFirebaseInit,\n                                          name,\n                                          authDomain\n                                      }: {\n    firebaseConfig?: Record<string, unknown>,\n    fromUrl?: string | undefined,\n    onFirebaseInit?: ((config: object, firebaseApp: FirebaseApp) => void) | undefined,\n    name?: string;\n    authDomain?: string;\n}): InitialiseFirebaseResult {\n\n    const [firebaseApp, setFirebaseApp] = useState<FirebaseApp | undefined>();\n    const [firebaseConfigLoading, setFirebaseConfigLoading] = useState<boolean>(false);\n    const [configError, setConfigError] = useState<string>();\n\n    const initFirebase = useCallback((config: Record<string, unknown>) => {\n        try {\n            const targetName = name ?? \"[DEFAULT]\";\n            const currentApps = getApps();\n            const existingApp = currentApps.find(app => app.name === targetName);\n            if (existingApp) {\n                deleteApp(existingApp);\n            }\n            const initialisedFirebaseApp = initializeApp(config, targetName);\n            setConfigError(undefined);\n            setFirebaseConfigLoading(false);\n            setFirebaseApp(initialisedFirebaseApp);\n        } catch (e: any) {\n            console.error(\"Error initialising Firebase\", e);\n            setConfigError(hostingError + \"\\n\" + (e.message ?? JSON.stringify(e)));\n        }\n    }, [name]);\n\n    useEffect(() => {\n        if (onFirebaseInit && firebaseConfig && firebaseApp) {\n            onFirebaseInit(firebaseConfig, firebaseApp);\n        }\n    }, [firebaseApp]);\n\n    useEffect(() => {\n\n        setFirebaseConfigLoading(true);\n\n        function fetchFromUrl(url: string) {\n            fetch(url)\n                .then(async response => {\n                    console.debug(\"Firebase init response\", response.status);\n                    if (response && response.status < 300) {\n                        const config = await response.json();\n                        if (authDomain) config.authDomain = authDomain;\n                        initFirebase(config);\n                    }\n                })\n                .catch(e => {\n                        setFirebaseConfigLoading(false);\n                        setConfigError(\n                            \"Could not load Firebase configuration from Firebase hosting. \" +\n                            \"If the app is not deployed in Firebase hosting, you need to specify the configuration manually\" +\n                            e.toString()\n                        );\n                    }\n                );\n        }\n\n        if (firebaseConfig) {\n            initFirebase(firebaseConfig);\n        } else {\n            if (fromUrl) {\n                fetchFromUrl(fromUrl);\n            } else if (process.env.NODE_ENV === \"production\") {\n                fetchFromUrl(\"/__/firebase/init.json\");\n            } else {\n                setFirebaseConfigLoading(false);\n                setConfigError(\n                    \"You need to deploy the app to Firebase hosting or specify a Firebase configuration object\"\n                );\n            }\n        }\n    }, []);\n\n    return {\n        firebaseApp,\n        firebaseConfigLoading,\n        configError\n    };\n}\n","import React, { useCallback, useEffect } from \"react\";\n\nimport { AppCheck, getToken, initializeAppCheck } from \"firebase/app-check\";\nimport { FirebaseApp } from \"firebase/app\";\nimport { AppCheckOptions } from \"../types\";\n\n/**\n * @group Firebase\n */\nexport interface InitializeAppCheckProps {\n    firebaseApp?: FirebaseApp;\n    options?: AppCheckOptions;\n}\n\nexport interface InitializeAppCheckResult {\n    loading: boolean;\n    appCheckVerified?: boolean;\n    error?: any;\n}\n\n/**\n * Function used to initialise Firebase App Check.\n *\n * @group Firebase\n */\nexport function useAppCheck({\n                                firebaseApp,\n                                options,\n                            }: InitializeAppCheckProps): InitializeAppCheckResult {\n    if (options?.debugToken) {\n        Object.assign(window, {\n            FIREBASE_APPCHECK_DEBUG_TOKEN: options?.debugToken\n        });\n    }\n\n    const [appCheckLoading, setAppCheckLoading] = React.useState<boolean>(false);\n    const [appCheckVerified, setAppCheckVerified] = React.useState<boolean | undefined>(undefined);\n    const [error, setError] = React.useState<any>();\n\n    const verifyToken = useCallback(async (appCheck: AppCheck) => {\n        try {\n            const token = await getToken(appCheck, options?.forceRefresh);\n            console.debug(\"App Check token:\", token);\n            if (!token) {\n                setError(\"App Check failed.\");\n                setAppCheckVerified(false);\n            } else {\n                setAppCheckVerified(true);\n                console.debug(\"App Check success.\");\n            }\n        } catch (e: any) {\n            console.error(e);\n            setError(e.message);\n        }\n    }, [options?.forceRefresh]);\n\n    useEffect(() => {\n        if (!options) return;\n        if (!firebaseApp) return;\n        if (appCheckVerified !== undefined) return;\n\n        setAppCheckLoading(true);\n\n        const {\n            provider,\n            isTokenAutoRefreshEnabled\n        } = options;\n        const appCheck = initializeAppCheck(firebaseApp, {\n            provider,\n            isTokenAutoRefreshEnabled\n        });\n\n        verifyToken(appCheck)\n            .then(() => {\n                setAppCheckLoading(false);\n            });\n\n    }, [appCheckVerified, firebaseApp, options, verifyToken]);\n\n    return {\n        loading: appCheckLoading,\n        appCheckVerified,\n        error\n    };\n}\n","import { deleteField, DocumentSnapshot } from \"firebase/firestore\";\nimport {\n    CMSType,\n    COLLECTION_PATH_SEPARATOR,\n    makePropertiesEditable,\n    PermissionsBuilder,\n    Properties,\n    PropertiesOrBuilders,\n    Property,\n    PropertyConfig,\n    removeFunctions,\n    removePropsIfExisting,\n    sortProperties,\n    stripCollectionPath\n} from \"@firecms/core\";\nimport { PersistedCollection } from \"@firecms/collection_editor\";\n\nexport function buildCollectionId(idOrPath: string, parentCollectionIds?: string[]): string {\n    if (!parentCollectionIds)\n        return stripCollectionPath(idOrPath);\n    return [...parentCollectionIds.map(stripCollectionPath), stripCollectionPath(idOrPath)].join(COLLECTION_PATH_SEPARATOR);\n}\n\nexport function setUndefinedToDelete(data: any): any {\n    if (Array.isArray(data)) {\n        return data.map(v => setUndefinedToDelete(v));\n    } else if (typeof data === \"object\") {\n        return Object.entries(data)\n            .map(([key, value]) => ({ [key]: setUndefinedToDelete(value) }))\n            .reduce((a, b) => ({ ...a, ...b }), {});\n    } else if (data === undefined) {\n        return deleteField();\n    }\n    return data;\n}\n\nexport const docsToCollectionTree = (docs: DocumentSnapshot[]): PersistedCollection[] => {\n\n    const collectionsMap = docs.map((doc) => {\n        const id: string = doc.id;\n        const collection = docToCollection(doc);\n        return { [id]: collection };\n    }).reduce((a, b) => ({ ...a, ...b }), {});\n\n    const orderedKeys = Object.keys(collectionsMap).sort((a, b) => b.split(COLLECTION_PATH_SEPARATOR).length - a.split(COLLECTION_PATH_SEPARATOR).length);\n\n    orderedKeys.forEach((id) => {\n        const collection = collectionsMap[id];\n        if (id.includes(COLLECTION_PATH_SEPARATOR)) {\n            const parentId = id.split(COLLECTION_PATH_SEPARATOR).slice(0, -1).join(COLLECTION_PATH_SEPARATOR);\n            const parentCollection = collectionsMap[parentId];\n            if (parentCollection)\n                parentCollection.subcollections = [...(parentCollection.subcollections ?? []), collection];\n            delete collectionsMap[id];\n        }\n    });\n\n    return Object.values(collectionsMap);\n}\n\nexport const docToCollection = (doc: DocumentSnapshot): PersistedCollection => {\n    const data = doc.data();\n    if (!data)\n        throw Error(\"Entity collection has not been persisted correctly\");\n    const propertiesOrder = data.propertiesOrder;\n    const properties = data.properties as Properties ?? {};\n    makePropertiesEditable(properties);\n    const sortedProperties = sortProperties(properties, propertiesOrder);\n    return {\n        ...data,\n        properties: sortedProperties,\n        id: data.id ?? data.alias ?? data.path\n    } as PersistedCollection;\n}\n\nexport function prepareCollectionForPersistence<M extends {\n    [Key: string]: CMSType\n}>(collection: Partial<PersistedCollection<M>>, propertyConfigs: Record<string, PropertyConfig>) {\n\n    const { properties: inputProperties, ...rest } = collection;\n    const cleanedProperties = inputProperties ? cleanPropertyConfigs(inputProperties, propertyConfigs) : undefined;\n    const properties = cleanedProperties ? setUndefinedToDelete(removeFunctions(cleanedProperties)) : undefined;\n    let newCollection: Partial<PersistedCollection> = {};\n    if (rest) {\n        newCollection = {\n            ...rest\n        };\n    }\n    if (properties) {\n        newCollection.properties = properties;\n    }\n    if (rest.propertiesOrder || properties) {\n        newCollection.propertiesOrder = removeDuplicates(rest.propertiesOrder ?? Object.keys(properties));\n    }\n\n    delete newCollection.permissions;\n    if (newCollection.entityViews) {\n        newCollection.entityViews = newCollection.entityViews.filter(view => typeof view === \"string\");\n    }\n    delete newCollection.editable;\n    delete newCollection.additionalFields;\n    delete newCollection.callbacks;\n    delete newCollection.Actions;\n    delete newCollection.entityActions;\n    delete newCollection.selectionController;\n    delete newCollection.subcollections;\n    delete newCollection.exportable;\n    return newCollection;\n}\n\nfunction cleanPropertyConfigs(properties: PropertiesOrBuilders<any>, propertyConfigs: Record<string, PropertyConfig>) {\n    const res: Record<string, Property> = {};\n    Object.entries(properties).forEach(([key, property]) => {\n        if (typeof property === \"object\") {\n\n            const config = property.propertyConfig ? propertyConfigs[property.propertyConfig] : undefined;\n\n            let cleanProperty: any;\n            if (config?.property) {\n                cleanProperty = removePropsIfExisting(property, config?.property);\n            } else {\n                cleanProperty = property;\n            }\n            res[key] = { ...cleanProperty };\n        }\n    });\n    return res;\n}\n\nfunction removeDuplicates<T>(array: T[]): T[] {\n    return [...new Set(array)];\n}\n","import { FirebaseApp } from \"firebase/app\";\nimport {\n    collection,\n    getDocs,\n    getFirestore,\n    limit as limitClause,\n    query,\n    QueryDocumentSnapshot\n} from \"firebase/firestore\";\n\nexport async function getFirestoreDataInPath(firebaseApp: FirebaseApp, path: string, parentPaths: string[], limit: number): Promise<object[]> {\n    console.debug(\"getFirestoreDataInPath\", path, limit)\n    const firestore = getFirestore(firebaseApp);\n    if (!parentPaths) {\n        const q = query(collection(firestore, path), limitClause(limit));\n        return getDocs(q).then((querySnapshot) => {\n            return querySnapshot.docs.map(doc => doc.data());\n        });\n    } else {\n        let currentDocs: QueryDocumentSnapshot[] | undefined = undefined;\n        let index = 0;\n        const allPaths = parentPaths;\n        allPaths.push(path);\n        let parentPath: string | undefined = allPaths[0];\n        while (parentPath) {\n            if (currentDocs) {\n                currentDocs = (await Promise.all(currentDocs.map(async (doc) => {\n                    const q = query(collection(firestore, doc.ref.path, parentPath as string), limitClause(5));\n                    return (await getDocs(q)).docs;\n                }))).flat();\n            } else {\n                const q = query(collection(firestore, parentPath), limitClause(5));\n                currentDocs = (await getDocs(q)).docs;\n            }\n            index++;\n            parentPath = index < allPaths.length ? allPaths[index] : undefined;\n        }\n        return currentDocs ? currentDocs.map(doc => doc.data()) : [];\n    }\n}\n","import { SearchIndex } from \"algoliasearch\";\nimport { FirestoreTextSearchController, FirestoreTextSearchControllerBuilder } from \"../types\";\nimport { EntityCollection, ResolvedEntityCollection } from \"@firecms/core\";\n\n/**\n * Utility function to perform a text search in an algolia index,\n * returning the ids of the entities.\n * @param index\n * @param query\n * @group Firebase\n */\nexport function performAlgoliaTextSearch(index: SearchIndex, query: string): Promise<readonly string[]> {\n\n    console.debug(\"Performing Algolia query\", index, query);\n    return index\n        .search(query)\n        .then(({ hits }: any) => {\n            return hits.map((hit: any) => hit.objectID as string);\n        })\n        .catch((err: any) => {\n            console.error(err);\n            return [];\n        });\n}\n\nexport function buildAlgoliaSearchController({\n                                                 isPathSupported,\n                                                 search\n                                             }: {\n    isPathSupported: (path: string) => boolean,\n    search: (props: {\n        searchString: string,\n        path: string\n    }) => Promise<readonly string[]> | undefined,\n}): FirestoreTextSearchControllerBuilder {\n    return (props): FirestoreTextSearchController => {\n\n        const init = (props: {\n            path: string,\n            collection?: EntityCollection | ResolvedEntityCollection\n        }) => {\n            // do nothing\n            return Promise.resolve(isPathSupported(props.path));\n        }\n\n        return {\n            init,\n            search\n        }\n    }\n\n}\n","import { User as FirebaseUser } from \"firebase/auth\";\nimport { FirestoreTextSearchController, FirestoreTextSearchControllerBuilder } from \"../types\";\nimport { EntityCollection, ResolvedEntityCollection } from \"@firecms/core\";\n\nconst DEFAULT_SERVER = \"https://api-drplyi3b6q-ey.a.run.app\";\n\n/**\n * Utility function to perform a text search in an algolia index,\n * returning the ids of the entities.\n * @param index\n * @param query\n * @group Firebase\n */\nexport async function performPineconeTextSearch({\n                                                   host = DEFAULT_SERVER,\n                                                   firebaseToken,\n                                                   projectId,\n                                                   collectionPath,\n                                                   query\n                                               }: {\n    host?: string,\n    firebaseToken: string,\n    collectionPath: string,\n    projectId: string,\n    query: string\n}): Promise<readonly string[]> {\n\n    console.debug(\"Performing Pinecone query\", collectionPath, query);\n    const response = await fetch((host ?? DEFAULT_SERVER) + `/projects/${projectId}/search/${collectionPath}`,\n        {\n            // mode: \"no-cors\",\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Basic ${firebaseToken}`,\n                // \"x-de-version\": version\n            },\n            body: JSON.stringify({\n                query\n            })\n        });\n\n    const promise = await response.json();\n    return promise.data.ids;\n\n}\n\nexport function buildPineconeSearchController({\n                                                 isPathSupported,\n                                                 search\n                                             }: {\n    isPathSupported: (path: string) => boolean,\n    search: (props: {\n        searchString: string,\n        path: string,\n        currentUser: FirebaseUser\n    }) => Promise<readonly string[]> | undefined,\n}): FirestoreTextSearchControllerBuilder {\n    return (props): FirestoreTextSearchController => {\n\n        const init = (props: {\n            path: string,\n            collection?: EntityCollection | ResolvedEntityCollection\n        }) => {\n            // do nothing\n            return Promise.resolve(isPathSupported(props.path));\n        }\n\n        return {\n            init,\n            search\n        }\n    }\n\n}\n","import { collection, getFirestore, onSnapshot, query } from \"firebase/firestore\";\nimport { FirestoreTextSearchController, FirestoreTextSearchControllerBuilder } from \"../types\";\n// @ts-ignore\nimport * as JsSearch from \"js-search\";\nimport { FirebaseApp } from \"firebase/app\";\nimport { EntityCollection, ResolvedEntityCollection } from \"@firecms/core\";\n\nconst MAX_SEARCH_RESULTS = 100;\n\nexport const localSearchControllerBuilder: FirestoreTextSearchControllerBuilder = ({\n                                                                                       firebaseApp,\n                                                                                   }: {\n\n    firebaseApp: FirebaseApp,\n}): FirestoreTextSearchController => {\n\n    let currentPath: string | undefined;\n    const indexes: Record<string, JsSearch.Search> = {};\n    const listeners: Record<string, () => void> = {};\n\n    const destroyListener = (path: string) => {\n        if (listeners[path]) {\n            listeners[path]();\n            delete listeners[path];\n        }\n    }\n\n    const init = ({\n                      path,\n                      collection: collectionProp\n                  }: {\n        path: string,\n        collection?: EntityCollection | ResolvedEntityCollection\n    }): Promise<boolean> => {\n\n        console.debug(\"Init local search controller\", path, collectionProp)\n\n        if (currentPath && path !== currentPath) {\n            destroyListener(currentPath)\n        }\n\n        currentPath = path;\n\n        return new Promise((resolve, reject) => {\n            if (!indexes[path] && collectionProp) {\n                console.debug(\"Init local search controller\", path);\n                indexes[path] = buildIndex(collectionProp);\n                const firestore = getFirestore(firebaseApp);\n                const col = collection(firestore, path);\n                console.log(\"Listening to collection\", path, col);\n                listeners[path] = onSnapshot(query(col),\n                    {\n                        next: (snapshot) => {\n                            const docs = snapshot.docs.map(doc => ({\n                                id: doc.id,\n                                ...doc.data()\n                            }));\n                            console.log(\"Added docs to index\", path, docs.length);\n                            indexes[path].addDocuments(docs);\n                            resolve(true);\n                        },\n                        error: (e) => {\n                            console.error(\"Error initializing local search controller\", path);\n                            console.error(e);\n                            reject(e);\n                        }\n                    }\n                );\n            }\n        });\n    }\n\n    const search = async ({ searchString, path }: {\n        searchString: string,\n        path: string\n    }) => {\n        const index = indexes[path];\n        if (!index) {\n            throw new Error(`Index not found for path ${path}`);\n        }\n        const searchResult = await index.search(searchString);\n        return searchResult.splice(0, MAX_SEARCH_RESULTS).map((e: any) => e.id);\n    };\n\n    return {\n        init,\n        search,\n    }\n}\n\nfunction buildIndex(collection: EntityCollection | ResolvedEntityCollection) {\n    const search = new JsSearch.Search(\"id\");\n    search.addIndex(\"id\");\n    Object.entries(collection.properties).forEach(([key, property]) => {\n        search.addIndex(key);\n    });\n    return search;\n}\n","import {\n    DataSource,\n    DataSourceDelegate,\n    DeleteEntityProps,\n    Entity,\n    EntityCollection,\n    EntityReference,\n    FetchCollectionDelegateProps,\n    FetchEntityProps,\n    FilterCombination,\n    FilterValues,\n    GeoPoint,\n    ListenCollectionDelegateProps,\n    ListenEntityProps,\n    ResolvedEntityCollection,\n    SaveEntityProps,\n    WhereFilterOp\n} from \"@firecms/core\";\nimport {\n    collection as collectionClause,\n    collectionGroup as collectionGroupClause,\n    CollectionReference,\n    deleteDoc,\n    deleteField,\n    doc,\n    DocumentReference,\n    DocumentSnapshot,\n    Firestore,\n    GeoPoint as FirestoreGeoPoint,\n    getCountFromServer,\n    getDoc,\n    getDocs,\n    getFirestore,\n    limit as limitClause,\n    onSnapshot,\n    orderBy as orderByClause,\n    Query,\n    query,\n    QueryConstraint,\n    serverTimestamp,\n    setDoc,\n    startAfter as startAfterClause,\n    Timestamp,\n    where as whereClause\n} from \"firebase/firestore\";\nimport { FirebaseApp } from \"firebase/app\";\nimport { FirestoreTextSearchController, FirestoreTextSearchControllerBuilder } from \"../types/text_search\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { localSearchControllerBuilder } from \"../utils\";\nimport { getAuth } from \"firebase/auth\";\n\n/**\n * @group Firebase\n */\nexport interface FirestoreDataSourceProps {\n    firebaseApp?: FirebaseApp,\n    /**\n     * You can use this controller to return a list of ids from a search index, given a\n     * `path` and a `searchString`.\n     */\n    textSearchControllerBuilder?: FirestoreTextSearchControllerBuilder,\n\n    /**\n     * Fallback to local text search if no text search controller is specified,\n     * or if the controller does not support the given path.\n     */\n    localTextSearchEnabled?: boolean,\n\n    /**\n     * Use this builder to indicate which indexes are available in your\n     * Firestore database. This is used to allow filtering and sorting\n     * for multiple fields in the CMS.\n     */\n    firestoreIndexesBuilder?: FirestoreIndexesBuilder;\n}\n\nexport type FirestoreIndexesBuilder = (params: {\n    path: string,\n    collection: EntityCollection<any>,\n}) => FilterCombination<string>[] | undefined\n\nexport type FirestoreDelegate = DataSourceDelegate & {\n\n    initTextSearchController: (props: {\n        path: string,\n        collection?: EntityCollection | ResolvedEntityCollection\n    }) => Promise<boolean>,\n}\n\n/**\n * Use this hook to build a {@link DataSource} based on Firestore\n * @param firebaseApp\n * @param textSearchControllerBuilder\n * @param collectionRegistry\n * @group Firebase\n */\nexport function useFirestoreDelegate({\n                                         firebaseApp,\n                                         textSearchControllerBuilder,\n                                         firestoreIndexesBuilder,\n                                         localTextSearchEnabled\n                                     }: FirestoreDataSourceProps): FirestoreDelegate {\n\n    const searchControllerRef = useRef<FirestoreTextSearchController>();\n\n    useEffect(() => {\n        if (!searchControllerRef.current && firebaseApp) {\n            if ((textSearchControllerBuilder || localTextSearchEnabled) && !searchControllerRef.current) {\n                searchControllerRef.current = buildTextSearchControllerWithLocalSearch({\n                    firebaseApp,\n                    textSearchControllerBuilder,\n                    localTextSearchEnabled: localTextSearchEnabled ?? false\n                });\n            }\n        }\n    }, [firebaseApp, localTextSearchEnabled, textSearchControllerBuilder]);\n\n    const buildQuery = useCallback(<M>(path: string,\n                                       filter: FilterValues<Extract<keyof M, string>> | undefined,\n                                       orderBy: string | undefined,\n                                       order: \"desc\" | \"asc\" | undefined,\n                                       startAfter: any[] | undefined,\n                                       limit: number | undefined,\n                                       collectionGroup = false) => {\n\n        if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n        const firestore = getFirestore(firebaseApp);\n        const collectionReference: Query = collectionGroup ? collectionGroupClause(firestore, path) : collectionClause(firestore, path);\n\n        const queryParams: QueryConstraint[] = [];\n        if (filter) {\n            Object.entries(filter)\n                .filter(([_, entry]) => !!entry)\n                .forEach(([key, filterParameter]) => {\n                    const [op, value] = filterParameter as [WhereFilterOp, any];\n                    queryParams.push(whereClause(key, op, cmsToFirestoreModel(value, firestore)));\n                });\n        }\n\n        if (orderBy && order) {\n            queryParams.push(orderByClause(orderBy, order));\n        }\n\n        if (startAfter) {\n            queryParams.push(startAfterClause(startAfter));\n        }\n\n        if (limit) {\n            queryParams.push(limitClause(limit));\n        }\n\n        return query(collectionReference, ...queryParams);\n    }, [firebaseApp]);\n\n    const getAndBuildEntity = useCallback(<M extends Record<string, any>>(path: string,\n                                                                          entityId: string\n    ): Promise<Entity<M> | undefined> => {\n        if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n        const firestore = getFirestore(firebaseApp);\n\n        return getDoc(doc(firestore, path, entityId))\n            .then((docSnapshot) => {\n                if (!docSnapshot.exists()) {\n                    return undefined;\n                }\n                return createEntityFromDocument(docSnapshot);\n            });\n    }, [firebaseApp]);\n\n    const listenEntity = useCallback(<M extends Record<string, any>>(\n        {\n            path,\n            entityId,\n            collection,\n            onUpdate,\n            onError\n        }: ListenEntityProps<M>): () => void => {\n        if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n        const firestore = getFirestore(firebaseApp);\n\n        return onSnapshot(\n            doc(firestore, path, entityId),\n            {\n                next: (docSnapshot) => {\n                    onUpdate(createEntityFromDocument(docSnapshot));\n                },\n                error: onError\n            }\n        );\n    }, [firebaseApp]);\n\n    const performTextSearch = useCallback(<M extends Record<string, any>>({\n                                                                              path,\n                                                                              searchString,\n                                                                              onUpdate\n                                                                          }: {\n        path: string,\n        searchString: string;\n        onUpdate: (entities: Entity<M>[]) => void\n    }): () => void => {\n\n        if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n        const textSearchController = searchControllerRef.current;\n        if (!textSearchController)\n            throw Error(\"Trying to make text search without specifying a FirestoreTextSearchController\");\n\n        let subscriptions: (() => void)[] = [];\n\n        const auth = getAuth(firebaseApp);\n        const currentUser = auth.currentUser;\n        if (!currentUser) throw Error(\"No current user\");\n\n        const search = textSearchController.search({\n            path,\n            searchString,\n            currentUser\n        });\n\n        if (!search) {\n            throw Error(\"The current path is not supported by the specified FirestoreTextSearchController\");\n        }\n\n        search.then((ids) => {\n            if (ids.length === 0) {\n                subscriptions = [];\n                onUpdate([]);\n            }\n\n            const entities: Entity<M>[] = [];\n            const addedEntitiesSet = new Set<string>();\n            subscriptions = ids\n                .map((entityId) => {\n                        return listenEntity({\n                            path,\n                            entityId,\n                            onUpdate: (entity: Entity<any>) => {\n                                if (entity.values) {\n                                    if (!addedEntitiesSet.has(entity.id)) {\n                                        addedEntitiesSet.add(entity.id);\n                                        entities.push(entity);\n                                        onUpdate(entities);\n                                    }\n                                } else {\n                                    addedEntitiesSet.delete(entity.id);\n                                    onUpdate([...entities.filter(e => e.id !== entityId)])\n                                }\n                            }\n                        })\n                    }\n                );\n        });\n\n        return () => {\n            subscriptions.forEach((p) => p());\n        }\n\n    }, [firebaseApp, listenEntity]);\n\n    return {\n        setDateToMidnight,\n        delegateToCMSModel: firestoreToCMSModel,\n        cmsToDelegateModel: (values) => {\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n            return cmsToFirestoreModel(values, getFirestore(firebaseApp));\n        },\n        currentTime,\n\n        initTextSearchController: useCallback(async (props: {\n            path: string,\n            collection?: EntityCollection | ResolvedEntityCollection\n        }) => {\n            if (!searchControllerRef.current) return false;\n            return searchControllerRef.current.init(props);\n        }, []),\n\n        /**\n         * Fetch entities in a Firestore path\n         * @param path\n         * @param collection\n         * @param filter\n         * @param limit\n         * @param startAfter\n         * @param searchString\n         * @param orderBy\n         * @param order\n         * @return Function to cancel subscription\n         * @see useCollectionFetch if you need this functionality implemented as a hook\n         * @group Firestore\n         */\n        fetchCollection: useCallback(async <M extends Record<string, any>>({\n                                                                               path,\n                                                                               filter,\n                                                                               limit,\n                                                                               startAfter,\n                                                                               searchString,\n                                                                               orderBy,\n                                                                               order,\n                                                                               isCollectionGroup\n                                                                           }: FetchCollectionDelegateProps<M>\n        ): Promise<Entity<M>[]> => {\n\n            // if (searchString) {\n            //     return performTextSearch(path, searchString,);\n            // }\n\n            console.debug(\"Fetching collection\", {\n                path,\n                limit,\n                filter,\n                startAfter,\n                orderBy,\n                order,\n                isCollectionGroup\n            });\n            const query = buildQuery(path, filter, orderBy, order, startAfter, limit, isCollectionGroup);\n\n            const snapshot = await getDocs(query);\n            return snapshot.docs.map((doc) => createEntityFromDocument(doc));\n        }, [buildQuery]),\n\n        /**\n         * Listen to a entities in a given path\n         * @param path\n         * @param collection\n         * @param onError\n         * @param filter\n         * @param limit\n         * @param startAfter\n         * @param searchString\n         * @param orderBy\n         * @param order\n         * @param onUpdate\n         * @return Function to cancel subscription\n         * @see useCollectionFetch if you need this functionality implemented as a hook\n         * @group Firestore\n         */\n        listenCollection: useCallback(<M extends Record<string, any>>(\n            {\n                path,\n                filter,\n                limit,\n                startAfter,\n                searchString,\n                orderBy,\n                order,\n                onUpdate,\n                onError,\n                isCollectionGroup,\n                collection\n            }: ListenCollectionDelegateProps<M>\n        ): () => void => {\n\n            console.debug(\"Listening collection\", {\n                path,\n                searchString,\n                isCollectionGroup,\n                limit,\n                filter,\n                startAfter,\n                orderBy,\n                order\n            });\n\n            if (!firebaseApp) {\n                throw Error(\"useFirestoreDelegate Firebase not initialised\");\n            }\n\n            const query = buildQuery(path, filter, orderBy, order, startAfter, limit, isCollectionGroup);\n\n            // const textSearchEnabled = collection?.textSearchEnabled === undefined || collection?.textSearchEnabled;\n            // if (searchControllerRef.current && textSearchEnabled) {\n            //     searchControllerRef.current.init({\n            //         path,\n            //         collection\n            //     });\n            // }\n\n            if (searchString) {\n                return performTextSearch<M>({\n                    path,\n                    searchString,\n                    onUpdate\n                });\n            }\n\n            return onSnapshot(query,\n                {\n                    next: (snapshot) => {\n                        if (!searchString)\n                            onUpdate(snapshot.docs.map((doc) => createEntityFromDocument(doc)));\n                    },\n                    error: onError\n                }\n            );\n\n        }, [buildQuery, firebaseApp, performTextSearch]),\n\n        /**\n         * Retrieve an entity given a path and a collection\n         * @param path\n         * @param entityId\n         * @param collection\n         * @group Firestore\n         */\n        fetchEntity: useCallback(<M extends Record<string, any>>({\n                                                                     path,\n                                                                     entityId\n                                                                 }: FetchEntityProps<M>\n        ): Promise<Entity<M> | undefined> => getAndBuildEntity(path, entityId), [getAndBuildEntity]),\n\n        /**\n         *\n         * @param path\n         * @param entityId\n         * @param collection\n         * @param onUpdate\n         * @param onError\n         * @return Function to cancel subscription\n         * @group Firestore\n         */\n        listenEntity,\n\n        /**\n         * Save entity to the specified path. Note that Firestore does not allow\n         * undefined values.\n         * @param path\n         * @param entityId\n         * @param values\n         * @param schemaId\n         * @param collection\n         * @param status\n         * @group Firestore\n         */\n        saveEntity: useCallback(<M extends Record<string, any>>(\n            {\n                path,\n                entityId,\n                values,\n                status\n            }: SaveEntityProps<M>): Promise<Entity<M>> => {\n\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            const collectionReference: CollectionReference = collectionClause(firestore, path);\n            // const cleanedValues = cmsToFirestoreModel(values, firestore);\n            console.debug(\"Saving entity\", {\n                path,\n                entityId,\n                values,\n                // cleanedValues\n            });\n\n            let documentReference: DocumentReference;\n            if (entityId)\n                documentReference = doc(collectionReference, entityId);\n            else\n                documentReference = doc(collectionReference);\n\n            return setDoc(documentReference, values, { merge: true })\n                .then(() => ({\n                    id: documentReference.id,\n                    path,\n                    values: values as M\n                }))\n                .catch((error) => {\n                    console.error(\"Error saving entity\", error);\n                    throw error;\n\n                });\n        }, [firebaseApp]),\n\n        /**\n         * Delete an entity\n         * @param entity\n         * @param collection\n         * @group Firestore\n         */\n        deleteEntity: useCallback(<M extends Record<string, any>>(\n            {\n                entity\n            }: DeleteEntityProps<M>\n        ): Promise<void> => {\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            return deleteDoc(doc(firestore, entity.path, entity.id));\n        }, [firebaseApp]),\n\n        /**\n         * Check if the given property is unique in the given collection\n         * @param path Collection path\n         * @param name of the property\n         * @param value\n         * @param property\n         * @param entityId\n         * @return `true` if there are no other fields besides the given entity\n         * @group Firestore\n         */\n        checkUniqueField: useCallback(async (\n            path: string,\n            name: string,\n            value: any,\n            entityId?: string\n        ): Promise<boolean> => {\n\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n            const firestore = getFirestore(firebaseApp);\n\n            console.debug(\"Check unique field entity\", path, name, value, entityId);\n\n            if (value === undefined || value === null) {\n                return Promise.resolve(true);\n            }\n            const q = query(collectionClause(firestore, path), whereClause(name, \"==\", cmsToFirestoreModel(value, firestore)));\n            const snapshot = await getDocs(q);\n            return snapshot.docs.filter(doc => doc.id !== entityId).length === 0;\n\n        }, [firebaseApp]),\n\n        generateEntityId: useCallback((path: string): string => {\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n            const firestore = getFirestore(firebaseApp);\n            return doc(collectionClause(firestore, path)).id;\n        }, [firebaseApp]),\n\n        countEntities: useCallback(async ({\n                                              path,\n                                              filter,\n                                              order,\n                                              orderBy,\n                                              isCollectionGroup\n                                          }: {\n            path: string,\n            filter?: FilterValues<Extract<keyof any, string>>,\n            orderBy?: string,\n            order?: \"desc\" | \"asc\",\n            isCollectionGroup?: boolean\n        }): Promise<number> => {\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n            const query = buildQuery(path, filter, orderBy, order, undefined, undefined, isCollectionGroup);\n            const snapshot = await getCountFromServer(query);\n            return snapshot.data().count;\n        }, [firebaseApp]),\n\n        isFilterCombinationValid: useCallback(({\n                                                   path,\n                                                   collection,\n                                                   filterValues,\n                                                   sortBy\n                                               }: {\n            path: string,\n            collection: EntityCollection<any>,\n            filterValues: FilterValues<any>,\n            sortBy?: [string, \"asc\" | \"desc\"]\n        }): boolean => {\n\n            if (!firebaseApp) throw Error(\"useFirestoreDelegate Firebase not initialised\");\n\n            // If no indexes are defined, we assume the query is valid.\n            // If there is no index in Firestore, and error message will be shown\n            if (firestoreIndexesBuilder === undefined) return true;\n\n            const indexes = firestoreIndexesBuilder?.({\n                path,\n                collection\n            });\n\n            const sortKey = sortBy ? sortBy[0] : undefined;\n            const sortDirection = sortBy ? sortBy[1] : undefined;\n\n            // Order by clause cannot contain a field with an equality filter\n            const values: [WhereFilterOp, any][] = Object.values(filterValues) as [WhereFilterOp, any][];\n\n            const filterKeys = Object.keys(filterValues);\n            const filtersCount = filterKeys.length;\n\n            if (!sortKey && values.every((v) => v[0] === \"==\")) {\n                return true;\n            }\n\n            if (filtersCount === 1 && (!sortKey || sortKey === filterKeys[0])) {\n                return true;\n            }\n\n            if (!indexes && filtersCount > 1) {\n                return false;\n            }\n\n            return !!indexes && indexes\n                .filter((compositeIndex) => !sortKey || sortKey in compositeIndex)\n                .find((compositeIndex) =>\n                    Object.entries(filterValues).every(([key, value]) => compositeIndex[key] !== undefined && (!sortDirection || compositeIndex[key] === sortDirection))\n                ) !== undefined;\n        }, [firebaseApp])\n\n    };\n\n}\n\nconst createEntityFromDocument = <M extends Record<string, any>>(\n    docSnap: DocumentSnapshot,\n): Entity<M> => {\n    const values = firestoreToCMSModel(docSnap.data());\n    return {\n        id: docSnap.id,\n        path: getCMSPathFromFirestorePath(docSnap.ref.path),\n        values\n    };\n};\n\n/**\n * Recursive function that converts Firestore data types into CMS or plain\n * JS types.\n * FireCMS uses Javascript dates internally instead of Firestore timestamps.\n * This makes it easier to interact with the rest of the libraries and\n * bindings.\n * Also, Firestore references are replaced with {@link EntityReference}\n * @param data\n * @group Firestore\n */\nexport function firestoreToCMSModel(data: any): any {\n    if (data === null || data === undefined) return null;\n    if (deleteField().isEqual(data)) {\n        return undefined;\n    }\n    if (serverTimestamp().isEqual(data)) {\n        return null;\n    }\n    if (data instanceof Timestamp || (typeof data.toDate === \"function\" && data.toDate() instanceof Date)) {\n        return data.toDate();\n    }\n    if (data instanceof Date) {\n        return data;\n    }\n    if (typeof data === \"object\" && \"__type__\" in data && data.__type__ === \"__vector__\") {\n        return undefined; // TODO: removing vector for now, since they break when being saved\n    }\n\n    if (data instanceof FirestoreGeoPoint) {\n        return new GeoPoint(data.latitude, data.longitude);\n    }\n    if (data instanceof DocumentReference) {\n        return new EntityReference(data.id, getCMSPathFromFirestorePath(data.path));\n    }\n    if (Array.isArray(data)) {\n        return data.map(firestoreToCMSModel).filter(v => v !== undefined);\n    }\n    if (typeof data === \"object\") {\n        const result: Record<string, any> = {};\n        for (const key of Object.keys(data)) {\n            const childValue = firestoreToCMSModel(data[key]);\n            if (childValue !== undefined)\n                result[key] = childValue;\n        }\n        return result;\n    }\n    return data;\n}\n\n/**\n * Remove id from Firestore path\n * @param fsPath\n */\nfunction getCMSPathFromFirestorePath(fsPath: string): string {\n    let to = fsPath.lastIndexOf(\"/\");\n    to = to === -1 ? fsPath.length : to;\n    return fsPath.substring(0, to);\n}\n\nfunction setDateToMidnight(input?: Timestamp): Timestamp | undefined {\n    if (!input) return input;\n    if (!(input instanceof Timestamp)) return input;\n    const date = input.toDate();\n    date.setHours(0, 0, 0, 0);\n    return Timestamp.fromDate(date);\n}\n\nexport function cmsToFirestoreModel(data: any, firestore: Firestore): any {\n    if (data === undefined) {\n        return deleteField();\n    } else if (data === null) {\n        return null;\n    } else if (Array.isArray(data)) {\n        return data.filter(v => v !== undefined).map(v => cmsToFirestoreModel(v, firestore));\n    } else if (data.isEntityReference && data.isEntityReference()) {\n        return doc(firestore, data.path, data.id);\n    } else if (data instanceof GeoPoint) {\n        return new FirestoreGeoPoint(data.latitude, data.longitude);\n    } else if (data instanceof Date) {\n        return Timestamp.fromDate(data);\n    } else if (data && typeof data === \"object\" && \"__type__\" in data && data.__type__ === \"__vector__\") {\n        return undefined; // TODO: removing vector for now, since they break when being saved\n    } else if (data && typeof data === \"object\") {\n        return Object.entries(data)\n            .map(([key, v]) => {\n                const firestoreModel = cmsToFirestoreModel(v, firestore);\n                if (firestoreModel !== undefined)\n                    return ({ [key]: firestoreModel });\n                else\n                    return {};\n            })\n            .reduce((a, b) => ({ ...a, ...b }), {});\n    }\n    return data;\n}\n\nfunction currentTime(): any {\n    return serverTimestamp();\n}\n\nfunction buildTextSearchControllerWithLocalSearch({\n                                                      textSearchControllerBuilder,\n                                                      firebaseApp,\n                                                      localTextSearchEnabled\n                                                  }: {\n    textSearchControllerBuilder?: FirestoreTextSearchControllerBuilder,\n    firebaseApp: FirebaseApp,\n    localTextSearchEnabled: boolean\n}): FirestoreTextSearchController | undefined {\n    if (!textSearchControllerBuilder && localTextSearchEnabled)\n        return localSearchControllerBuilder({ firebaseApp });\n\n    if (!localTextSearchEnabled && textSearchControllerBuilder)\n        return textSearchControllerBuilder({ firebaseApp });\n\n    if (!textSearchControllerBuilder && !localTextSearchEnabled) {\n        return undefined;\n    }\n\n    const localSearchController = localSearchControllerBuilder({ firebaseApp })\n    const textSearchController = textSearchControllerBuilder!({ firebaseApp });\n    return {\n        init: async (props: {\n            path: string,\n            collection?: EntityCollection | ResolvedEntityCollection\n        }) => {\n            const b = await textSearchController.init(props);\n            if (b) return true;\n            return localSearchController.init(props);\n        },\n        search: (props: {\n            searchString: string,\n            path: string,\n            currentUser: any\n        }) => {\n            return textSearchController.search(props) ?? localSearchController.search(props);\n        }\n    }\n}\n","import { FirebaseApp } from \"firebase/app\";\nimport {\n    Database,\n    get,\n    getDatabase,\n    limitToFirst,\n    onValue,\n    orderByChild,\n    orderByKey,\n    push,\n    query,\n    ref,\n    remove,\n    set,\n    startAt\n} from \"firebase/database\";\nimport { useCallback } from \"react\";\nimport {\n    DataSourceDelegate,\n    DeleteEntityProps,\n    Entity,\n    FetchCollectionDelegateProps,\n    FetchEntityProps,\n    ListenCollectionDelegateProps,\n    ListenEntityProps,\n    SaveEntityProps\n} from \"@firecms/core\";\n\nexport function useFirebaseRTDBDelegate({ firebaseApp }: { firebaseApp?: FirebaseApp }): DataSourceDelegate {\n\n    const fetchCollection = useCallback(async <M extends Record<string, any>>({\n                                                                                  path,\n                                                                                  filter,\n                                                                                  limit,\n                                                                                  startAfter,\n                                                                                  orderBy,\n                                                                                  order,\n                                                                                  searchString\n                                                                              }: FetchCollectionDelegateProps<M>): Promise<Entity<M>[]> => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        let dbQuery = query(ref(database, path));\n\n        // Example to apply \"limit\" and \"startAfter\"\n        if (startAfter !== undefined) {\n            dbQuery = query(dbQuery, orderByKey(), startAt(startAfter));\n        }\n        if (limit !== undefined) {\n            dbQuery = query(dbQuery, limitToFirst(limit));\n        }\n\n        const snapshot = await get(dbQuery);\n        if (snapshot.exists()) {\n            return Object.entries(snapshot.val()).map(([id, values]) => ({\n                id,\n                path,\n                values: values as M,\n            }));\n        }\n        return [];\n    }, [firebaseApp]);\n\n    const listenCollection = useCallback(<M extends Record<string, any>>({\n                                                                             path,\n                                                                             onUpdate,\n                                                                             // Realtime Database does not directly support onError in onValue\n                                                                         }: ListenCollectionDelegateProps<M>): () => void => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        const dbRef = ref(database, path);\n        const unsubscribe = onValue(dbRef, (snapshot) => {\n            if (snapshot.exists()) {\n                const result: Entity<M>[] = Object.entries(snapshot.val()).map(([id, values]) => ({\n                    id,\n                    path,\n                    values: values as M,\n                }));\n                onUpdate(result);\n            } else {\n                onUpdate([]);\n            }\n        });\n\n        return () => unsubscribe();\n    }, [firebaseApp]);\n\n    const fetchEntity = useCallback(async <M extends Record<string, any>>({\n                                                                              path,\n                                                                              entityId,\n                                                                          }: FetchEntityProps<M>): Promise<Entity<M> | undefined> => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        const snapshot = await get(ref(database, `${path}/${entityId}`));\n        if (snapshot.exists()) {\n            return {\n                id: entityId,\n                path,\n                values: snapshot.val() as M\n            };\n        }\n        return undefined;\n    }, [firebaseApp]);\n\n    const listenEntity = useCallback(<M extends Record<string, any>>({\n                                                                         path,\n                                                                         entityId,\n                                                                         onUpdate,\n                                                                         onError\n                                                                     }: ListenEntityProps<M>): () => void => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        const dbRef = ref(database, `${path}/${entityId}`);\n        const unsubscribe = onValue(dbRef, (snapshot) => {\n            if (snapshot.exists()) {\n                onUpdate({\n                    id: entityId,\n                    path,\n                    values: snapshot.val() as M\n                });\n            } else {\n                onError?.(new Error(\"Entity does not exist\"));\n            }\n        });\n\n        return () => unsubscribe();\n    }, [firebaseApp]);\n\n    const saveEntity = useCallback(async <M extends Record<string, any>>({\n                                                                             path,\n                                                                             entityId,\n                                                                             values,\n                                                                         }: SaveEntityProps<M>): Promise<Entity<M>> => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        // If entityId is not provided, a new entity will be created\n        const finalId = entityId ?? push(ref(database, path)).key;\n        if (!finalId) {\n            throw new Error(\"Could not generate a new id\");\n        }\n        await set(ref(database, `${path}/${finalId}`), values);\n        return {\n            id: finalId,\n            path,\n            values: values as M\n        };\n    }, [firebaseApp]);\n\n    const deleteEntity = useCallback(async <M extends Record<string, any>>({\n                                                                               entity,\n                                                                           }: DeleteEntityProps<M>): Promise<void> => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        await remove(ref(database, `${entity.path}/${entity.id}`));\n    }, [firebaseApp]);\n\n    // Implementing additional methods required by DataSourceDelegate\n    const checkUniqueField = useCallback(async (path: string, name: string, value: any, entityId?: string): Promise<boolean> => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        // Simplified example; the Realtime Database does not support querying with \"not equal\" conditions\n        const dbRef = query(ref(database, path), orderByChild(name), startAt(value), limitToFirst(1));\n        const snapshot = await get(dbRef);\n\n        if (!snapshot.exists()) {\n            return true;\n        }\n\n        // Check if the found entity is the same as the one being checked\n        const [key, entityValue] = Object.entries(snapshot.val())[0];\n        if (entityValue && typeof entityValue === \"object\" && (entityValue as any)[name] === value && key === entityId) {\n            return true;\n        }\n\n        return false;\n    }, [firebaseApp]);\n\n    const generateEntityId = useCallback((path: string): string => {\n        if (!firebaseApp) {\n            throw new Error(\"Firebase app not provided\");\n        }\n        const database = getDatabase(firebaseApp);\n\n        return push(ref(database, path)).key!;\n    }, [firebaseApp]);\n\n    const isFilterCombinationValid = useCallback(({\n                                                      path,\n                                                      filter,\n                                                      sortBy\n                                                  }: any): boolean => {\n        return false;\n    }, []);\n\n    return {\n        fetchCollection,\n        listenCollection,\n        fetchEntity,\n        listenEntity,\n        saveEntity,\n        deleteEntity,\n        checkUniqueField,\n        generateEntityId,\n        isFilterCombinationValid,\n        cmsToDelegateModel: (data: any) => {\n            if (!firebaseApp) {\n                throw new Error(\"Firebase app not provided\");\n            }\n            const database = getDatabase(firebaseApp);\n            return cmsToRTDBModel(data, database);\n        },\n        currentTime: () => new Date(),\n        delegateToCMSModel,\n        setDateToMidnight\n    };\n}\n\nfunction setDateToMidnight(date: Date): Date {\n    const newDate = new Date(date);\n    newDate.setHours(0, 0, 0, 0);\n    return newDate;\n}\n\nfunction delegateToCMSModel(data: any): any {\n    if (data === null || data === undefined) return null;\n\n    if (Array.isArray(data)) {\n        return data.map(delegateToCMSModel).filter(v => v !== undefined);\n    }\n\n    if (typeof data === \"object\") {\n        const result: Record<string, any> = {};\n        for (const key of Object.keys(data)) {\n            const childValue = delegateToCMSModel(data[key]);\n            if (childValue !== undefined)\n                result[key] = childValue;\n        }\n        return result;\n    }\n\n    return data;\n}\n\nexport function cmsToRTDBModel(data: any, database: Database): any {\n    if (data === undefined) {\n        return null;\n    } else if (data === null) {\n        return null;\n    } else if (Array.isArray(data)) {\n        return data.filter(v => v !== undefined).map(v => cmsToRTDBModel(v, database));\n    } else if (data.isEntityReference && data.isEntityReference()) {\n        return ref(database, `${data.path}/${data.id}`);\n    } else if (data instanceof Date) {\n        // For dates, convert to ISO string or timestamp.\n        return data.toISOString();\n    } else if (data && typeof data === \"object\") {\n        return Object.entries(data)\n            .map(([key, v]) => {\n                const rtdbModel = cmsToRTDBModel(v, database);\n                if (rtdbModel !== undefined)\n                    return ({ [key]: rtdbModel });\n                else\n                    return {};\n            })\n            .reduce((a, b) => ({ ...a, ...b }), {});\n    }\n    return data;\n}\n","import { useEffect } from \"react\";\nimport { getAuth, RecaptchaVerifier } from \"firebase/auth\";\n\ndeclare global {\n    interface Window {\n        recaptchaVerifier: RecaptchaVerifier;\n    }\n}\n\nexport const RECAPTCHA_CONTAINER_ID = \"recaptcha-container\" as const;\n\nexport function useRecaptcha() {\n    useEffect(() => {\n        if (!window || window?.recaptchaVerifier) return;\n\n        const auth = getAuth();\n\n        window.recaptchaVerifier = new RecaptchaVerifier(\n            auth,\n            RECAPTCHA_CONTAINER_ID,\n            {\n                size: \"invisible\"\n            }\n        );\n    }, []);\n\n    return null;\n}\n","export const googleIcon = (mode: \"light\" | \"dark\") => <>\n    <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        width={32}\n        height={32}\n    >\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJb\"\n            x1=\"29.401\"\n            x2=\"29.401\"\n            y1=\"4.064\"\n            y2=\"106.734\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#ff5840\"/>\n            <stop offset=\".007\" stopColor=\"#ff5840\"/>\n            <stop offset=\".989\" stopColor=\"#fa528c\"/>\n            <stop offset=\"1\" stopColor=\"#fa528c\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJb)\"\n            d=\"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z\"\n        />\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJc\"\n            x1=\"12.148\"\n            x2=\"12.148\"\n            y1=\".872\"\n            y2=\"47.812\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#feaa53\"/>\n            <stop offset=\".612\" stopColor=\"#ffcd49\"/>\n            <stop offset=\"1\" stopColor=\"#ffde44\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJc)\"\n            d=\"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z\"\n        />\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJd\"\n            x1=\"29.76\"\n            x2=\"29.76\"\n            y1=\"32.149\"\n            y2=\"-6.939\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#42d778\"/>\n            <stop offset=\".428\" stopColor=\"#3dca76\"/>\n            <stop offset=\"1\" stopColor=\"#34b171\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJd)\"\n            d=\"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z\"\n        />\n        <linearGradient\n            id=\"95yY7w43Oj6n2vH63j6HJe\"\n            x1=\"46\"\n            x2=\"46\"\n            y1=\"3.638\"\n            y2=\"35.593\"\n            gradientTransform=\"matrix(1 0 0 -1 0 66)\"\n            gradientUnits=\"userSpaceOnUse\"\n        >\n            <stop offset=\"0\" stopColor=\"#155cde\"/>\n            <stop offset=\".278\" stopColor=\"#1f7fe5\"/>\n            <stop offset=\".569\" stopColor=\"#279ceb\"/>\n            <stop offset=\".82\" stopColor=\"#2cafef\"/>\n            <stop offset=\"1\" stopColor=\"#2eb5f0\"/>\n        </linearGradient>\n        <path\n            fill=\"url(#95yY7w43Oj6n2vH63j6HJe)\"\n            d=\"M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15\n        c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z\"\n        />\n    </svg>\n</>;\n\nexport const appleIcon = (mode: \"light\" | \"dark\") => <svg width={32} height={32}\n                                                          viewBox=\"0 0 56 56\"\n                                                          style={{ transform: \"scale(2.8)\" }}\n                                                          version=\"1.1\"\n                                                          xmlns=\"http://www.w3.org/2000/svg\">\n    <g stroke={mode === \"light\" ? \"#424245\" : \"white\"} strokeWidth=\"0.5\"\n       fillRule=\"evenodd\">\n        <path\n            d=\"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z\"\n            fill={mode === \"light\" ? \"#424245\" : \"white\"} fillRule=\"nonzero\"/>\n    </g>\n</svg>;\n\nexport const githubIcon = (mode: \"light\" | \"dark\") => <svg\n    fill={mode === \"light\" ? \"#1c1e21\" : \"white\"}\n    role=\"img\"\n    viewBox=\"0 0 24 24\"\n    width={28}\n    height={28}\n    xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n        d=\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"/>\n</svg>;\n\n\nexport const facebookIcon = (mode: \"light\" | \"dark\") => <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width={28} height={28}\n    viewBox=\"0 0 90 90\">\n    <g>\n        <path\n            d=\"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z\"\n            fill={mode === \"light\" ? \"#39569c\" : \"white\"}/>\n    </g>\n</svg>;\n\nexport const microsoftIcon = (mode: \"light\" | \"dark\") => <svg\n    xmlns=\"http://www.w3.org/2000/svg\" width={28} height={28}\n    viewBox=\"0 0 480 480\">\n    <g>\n        <path\n            d=\"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z\"\n            fill={mode === \"light\" ? \"#00a2ed\" : \"white\"}/>\n    </g>\n</svg>;\n\nexport const twitterIcon = (mode: \"light\" | \"dark\") => <svg\n    xmlns=\"http://www.w3.org/2000/svg\" width={28} height={28}\n    viewBox=\"0 0 24 24\">\n    <path fill={mode === \"light\" ? \"#00acee\" : \"white\"}\n          d=\"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z\"/>\n</svg>;\n\n","import React, { ReactNode, useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { FirebaseApp, FirebaseError } from \"firebase/app\";\nimport { ErrorView, FireCMSLogo, useModeController, } from \"@firecms/core\";\nimport {\n    ArrowBackIcon,\n    Button,\n    CircularProgress,\n    EmailIcon,\n    IconButton,\n    PersonOutlineIcon,\n    PhoneIcon,\n    TextField,\n    Typography,\n} from \"@firecms/ui\";\nimport { appleIcon, facebookIcon, githubIcon, googleIcon, microsoftIcon, twitterIcon } from \"./social_icons\";\nimport {\n    getAuth,\n    getMultiFactorResolver,\n    PhoneAuthProvider,\n    PhoneMultiFactorGenerator,\n    RecaptchaVerifier\n} from \"firebase/auth\";\nimport {\n    FirebaseAuthController,\n    FirebaseSignInOption,\n    FirebaseSignInProvider,\n    RECAPTCHA_CONTAINER_ID,\n    useRecaptcha\n} from \"../index\";\n\n/**\n * @category Firebase\n */\nexport interface FirebaseLoginViewProps {\n\n    /**\n     * Firebase app this login view is accessing\n     */\n    firebaseApp: FirebaseApp;\n\n    /**\n     * Delegate holding the auth state\n     */\n    authController: FirebaseAuthController;\n\n    /**\n     * Path to the logo displayed in the login screen\n     */\n    logo?: string;\n\n    /**\n     * Enable the skip login button\n     */\n    allowSkipLogin?: boolean;\n\n    /**\n     * Each of the sign in options that get a custom button\n     */\n    signInOptions: Array<FirebaseSignInProvider | FirebaseSignInOption>;\n\n    /**\n     * Disable the login buttons\n     */\n    disabled?: boolean;\n\n    /**\n     * Prevent users from creating new users in when the `signInOptions` value\n     * is `password`. This does not apply to the rest of login providers.\n     */\n    disableSignupScreen?: boolean;\n\n    /**\n     * Display this component when no user is found a user tries to log in\n     * when the `signInOptions` value is `password`.\n     */\n    noUserComponent?: ReactNode;\n\n    /**\n     * Display this component bellow the sign-in buttons.\n     * Useful for adding checkboxes for privacy and terms and conditions.\n     * You may want to use it in conjunction with the `disabled` prop.\n     */\n    additionalComponent?: ReactNode;\n\n    notAllowedError?: any;\n\n}\n\n/**\n * Use this component to render a login view, that updates\n * the state of the {@link FirebaseAuthController} based on the result\n * @constructor\n * @category Firebase\n */\nexport function FirebaseLoginView({\n                                      allowSkipLogin,\n                                      logo,\n                                      signInOptions,\n                                      firebaseApp,\n                                      authController,\n                                      noUserComponent,\n                                      disableSignupScreen = false,\n                                      disabled = false,\n                                      additionalComponent,\n                                      notAllowedError\n                                  }: FirebaseLoginViewProps) {\n\n    const modeState = useModeController();\n\n    const [passwordLoginSelected, setPasswordLoginSelected] = useState(false);\n\n    const [phoneLoginSelected, setPhoneLoginSelected] = useState(false);\n\n    const resolvedSignInOptions: FirebaseSignInProvider[] = signInOptions.map((o) => {\n        if (typeof o === \"object\") {\n            return o.provider;\n        } else return o as FirebaseSignInProvider;\n    })\n\n    const sendMFASms = useCallback(() => {\n        const auth = getAuth(firebaseApp);\n        const recaptchaVerifier = new RecaptchaVerifier(auth, \"recaptcha\", { size: \"invisible\" });\n\n        const resolver = getMultiFactorResolver(auth, authController.authProviderError);\n\n        if (resolver.hints[0].factorId === PhoneMultiFactorGenerator.FACTOR_ID) {\n\n            const phoneInfoOptions = {\n                multiFactorHint: resolver.hints[0],\n                session: resolver.session\n            };\n            const phoneAuthProvider = new PhoneAuthProvider(auth);\n            // Send SMS verification code\n            phoneAuthProvider.verifyPhoneNumber(phoneInfoOptions, recaptchaVerifier)\n                .then(function (verificationId) {\n\n                    // Ask user for the SMS verification code. Then:\n                    const verificationCode = String(window.prompt(\"Please enter the verification \" + \"code that was sent to your mobile device.\"));\n                    const cred = PhoneAuthProvider.credential(verificationId, verificationCode);\n                    const multiFactorAssertion = PhoneMultiFactorGenerator.assertion(cred);\n                    // // Complete sign-in.\n                    return resolver.resolveSignIn(multiFactorAssertion);\n\n                })\n\n        } else {\n            // Unsupported second factor.\n            console.warn(\"Unsupported second factor.\");\n        }\n\n    }, [authController.authProviderError]);\n\n    function buildErrorView() {\n        let errorView: any;\n        if (authController.user != null) return errorView; // if the user is logged in via MFA\n        const ignoredCodes = [\"auth/popup-closed-by-user\", \"auth/cancelled-popup-request\"];\n        if (authController.authProviderError) {\n            if (authController.authProviderError.code === \"auth/operation-not-allowed\" ||\n                authController.authProviderError.code === \"auth/configuration-not-found\") {\n                errorView =\n                    <>\n                        <div className=\"p-4\">\n                            <ErrorView\n                                title={\"Firebase Auth not enabled\"}\n                                error={\"You need to enable Firebase Auth and the corresponding login provider in your Firebase project\"}/>\n                        </div>\n                        {firebaseApp &&\n                            <div className=\"p-4\">\n                                <a href={`https://console.firebase.google.com/project/${firebaseApp.options.projectId}/authentication/providers`}\n                                   rel=\"noopener noreferrer\"\n                                   target=\"_blank\">\n                                    <Button variant=\"text\"\n                                            color=\"error\">\n                                        Open Firebase configuration\n                                    </Button>\n                                </a>\n                            </div>}\n                    </>;\n            } else if (authController.authProviderError.code === \"auth/invalid-api-key\") {\n                errorView = <div className=\"p-4\">\n                    <ErrorView\n                        title={\"Invalid API key\"}\n                        error={\"auth/invalid-api-key: Check that your Firebase config is set correctly in your `firebase_config.ts` file\"}/>\n                </div>;\n            } else if (!ignoredCodes.includes(authController.authProviderError.code)) {\n                if (authController.authProviderError.code === \"auth/multi-factor-auth-required\") {\n                    sendMFASms();\n                }\n                errorView =\n                    <div className=\"p-4\">\n                        <ErrorView error={authController.authProviderError}/>\n                    </div>;\n            }\n        }\n        return errorView;\n    }\n\n    let logoComponent;\n    if (logo) {\n        logoComponent = <img src={logo}\n                             style={{\n                                 height: \"100%\",\n                                 width: \"100%\",\n                                 objectFit: \"contain\"\n                             }}\n                             alt={\"Logo\"}/>;\n    } else {\n        logoComponent = <FireCMSLogo/>;\n    }\n\n    let notAllowedMessage: string | undefined;\n    if (notAllowedError) {\n        if (typeof notAllowedError === \"string\") {\n            notAllowedMessage = notAllowedError;\n        } else if (notAllowedError instanceof Error) {\n            notAllowedMessage = notAllowedError.message;\n        } else {\n            notAllowedMessage = \"It looks like you don't have access to the CMS, based on the specified Authenticator configuration\";\n        }\n    }\n\n    return (\n\n        <div\n            className=\"flex flex-col items-center justify-center min-h-screen min-w-full p-4\">\n            <div id=\"recaptcha\"></div>\n            <div\n                className=\"flex flex-col items-center w-full max-w-[500px]\">\n\n                <div className=\"p-1 w-64 h-64 m-4\">\n                    {logoComponent}\n                </div>\n\n                {notAllowedMessage &&\n                    <div className=\"p-8\">\n                        <ErrorView error={notAllowedMessage}/>\n                    </div>}\n\n                {buildErrorView()}\n\n                {(!passwordLoginSelected && !phoneLoginSelected) && <div className={\"my-4 w-full\"}>\n\n                    {buildOauthLoginButtons(authController, resolvedSignInOptions, modeState.mode, disabled)}\n\n                    {resolvedSignInOptions.includes(\"password\") &&\n                        <LoginButton\n                            disabled={disabled}\n                            text={\"Email/password\"}\n                            icon={<EmailIcon size={28}/>}\n                            onClick={() => setPasswordLoginSelected(true)}/>}\n\n                    {resolvedSignInOptions.includes(\"phone\") &&\n                        <LoginButton\n                            disabled={disabled}\n                            text={\"Phone number\"}\n                            icon={<PhoneIcon size={28}/>}\n                            onClick={() => setPhoneLoginSelected(true)}/>}\n\n                    {resolvedSignInOptions.includes(\"anonymous\") &&\n                        <LoginButton\n                            disabled={disabled}\n                            text={\"Log in anonymously\"}\n                            icon={<PersonOutlineIcon\n                                size={28}/>}\n                            onClick={authController.anonymousLogin}/>}\n\n                    {allowSkipLogin &&\n                        <Button\n                            className={\"m-1 mb-4\"}\n                            variant={\"text\"}\n                            disabled={disabled}\n                            onClick={authController.skipLogin}>\n                            Skip login\n                        </Button>\n                    }\n\n                </div>}\n\n                {passwordLoginSelected && <LoginForm\n                    authController={authController}\n                    onClose={() => setPasswordLoginSelected(false)}\n                    mode={modeState.mode}\n                    noUserComponent={noUserComponent}\n                    disableSignupScreen={disableSignupScreen}\n                />}\n\n                {phoneLoginSelected && <PhoneLoginForm\n                    authController={authController}\n                    onClose={() => setPhoneLoginSelected(false)}\n                />}\n\n                {!passwordLoginSelected && !phoneLoginSelected && additionalComponent}\n\n            </div>\n        </div>\n    );\n}\n\nexport function LoginButton({\n                                icon,\n                                onClick,\n                                text,\n                                disabled\n                            }: {\n    icon: React.ReactNode,\n    onClick: () => void,\n    text: string,\n    disabled?: boolean\n}) {\n    return (\n        <div className=\"m-1 w-full\">\n            <Button\n                className=\"w-full\"\n                variant=\"outlined\"\n                disabled={disabled}\n                onClick={onClick}>\n                <div\n                    className=\"p-1 flex h-8 items-center justify-items-center\">\n                    <div\n                        className=\"flex flex-col w-8 items-center justify-items-center\">\n                        {icon}\n                    </div>\n                    <div className=\"flex-grow pl-2 text-center\">{text}</div>\n                </div>\n            </Button>\n        </div>\n    )\n}\n\nfunction PhoneLoginForm({\n                            onClose,\n                            authController\n                        }: {\n    onClose: () => void,\n    authController: FirebaseAuthController,\n}) {\n    useRecaptcha();\n\n    const [phone, setPhone] = useState<string>();\n    const [code, setCode] = useState<string>();\n    const [isInvalidCode, setIsInvalidCode] = useState(false);\n\n    const handleSubmit = async (event: any) => {\n        event.preventDefault();\n\n        if (code && authController.confirmationResult) {\n            setIsInvalidCode(false);\n\n            authController.confirmationResult.confirm(code).catch((e: FirebaseError) => {\n                if (e.code === \"auth/invalid-verification-code\") {\n                    setIsInvalidCode(true)\n                }\n            });\n        } else {\n            if (phone) {\n                authController.phoneLogin(phone, window.recaptchaVerifier);\n            }\n        }\n    }\n\n    return (\n        <form onSubmit={handleSubmit}>\n            {isInvalidCode &&\n                <div className=\"p-8\">\n                    <ErrorView error={\"Invalid confirmation code\"}/>\n                </div>}\n\n            <div id={RECAPTCHA_CONTAINER_ID}/>\n\n            <div className={\"flex flex-col gap-1\"}>\n                <IconButton\n                    onClick={onClose}>\n                    <ArrowBackIcon className=\"w-5 h-5\"/>\n                </IconButton>\n                <div className=\"p-1 flex\">\n                    <Typography align={\"center\"}\n                                variant={\"subtitle2\"}>{\"Please enter your phone number\"}</Typography>\n                </div>\n                <TextField placeholder=\"\"\n                           value={phone ?? \"\"}\n                           disabled={Boolean(phone && (authController.authLoading || authController.confirmationResult))}\n                           type=\"phone\"\n                           onChange={(event) => setPhone(event.target.value)}/>\n                {Boolean(phone && authController.confirmationResult) &&\n                    <>\n                        <div className=\"mt-2 p-1 flex\">\n                            <Typography align={\"center\"}\n                                        variant={\"subtitle2\"}>{\"Please enter the confirmation code\"}</Typography>\n                        </div>\n                        <TextField placeholder=\"\"\n                                   value={code ?? \"\"}\n                                   type=\"text\"\n                                   onChange={(event) => setCode(event.target.value)}/>\n                    </>\n                }\n\n                <div className=\"flex justify-end items-center w-full\">\n\n                    {authController.authLoading &&\n                        <CircularProgress className=\"p-1\" size={\"small\"}/>\n                    }\n\n                    <Button type=\"submit\">\n                        {\"Ok\"}\n                    </Button>\n                </div>\n\n            </div>\n        </form>\n    );\n}\n\ntype LoginFormMode = \"email\" | \"password\" | \"registration\";\n\nfunction LoginForm({\n                       onClose,\n                       authController,\n                       mode,\n                       noUserComponent,\n                       disableSignupScreen\n                   }: {\n    onClose: () => void,\n    authController: FirebaseAuthController,\n    mode: \"light\" | \"dark\",\n    noUserComponent?: ReactNode,\n    disableSignupScreen: boolean\n}) {\n\n    const passwordRef = useRef<HTMLInputElement | null>(null);\n\n    const [loginState, setLoginState] = useState<LoginFormMode>(\"email\"); // [\"email\", \"password\", \"registration\"]\n    const [email, setEmail] = useState<string>();\n    const [password, setPassword] = useState<string>();\n    const [previouslyUsedMethodsForUser, setPreviouslyUsedMethodsForUser] = useState<string[] | undefined>();\n\n    useEffect(() => {\n        if ((loginState === \"password\" || loginState === \"registration\") && passwordRef.current) {\n            passwordRef.current.focus()\n        }\n    }, [loginState]);\n\n    useEffect(() => {\n        if (!document) return;\n        const escFunction = (event: any) => {\n            if (event.keyCode === 27) {\n                onClose();\n            }\n        };\n        document.addEventListener(\"keydown\", escFunction, false);\n        return () => {\n            document.removeEventListener(\"keydown\", escFunction, false);\n        };\n    }, [onClose]);\n\n    function handleEnterEmail() {\n        if (email) {\n            authController.fetchSignInMethodsForEmail(email).then((availableProviders) => {\n                setPreviouslyUsedMethodsForUser(availableProviders.filter(p => p !== \"password\"));\n            });\n            setLoginState(\"password\");\n        }\n    }\n\n    function handleEnterPassword() {\n        if (email && password) {\n            authController.emailPasswordLogin(email, password);\n        }\n    }\n\n    function handleRegistration() {\n        if (email && password) {\n            authController.createUserWithEmailAndPassword(email, password);\n        }\n    }\n\n    const onBackPressed = () => {\n        if (loginState === \"email\") {\n            onClose();\n        } else if (loginState === \"password\" || loginState === \"registration\") {\n            setLoginState(\"email\");\n        } else {\n            setPreviouslyUsedMethodsForUser(undefined);\n        }\n    }\n\n    const handleSubmit = (event: any) => {\n        event.preventDefault();\n        if (loginState === \"email\") {\n            handleEnterEmail();\n        } else if (loginState === \"password\") {\n            handleEnterPassword();\n        } else if (loginState === \"registration\") {\n            handleRegistration();\n        }\n    }\n\n    const label = loginState === \"registration\"\n        ? \"Please enter your email and password to create an account\"\n        : (loginState === \"password\" ? \"Please enter your password\" : \"Please enter your email\");\n\n    return (\n        <form\n            className={\"w-full\"}\n            onSubmit={handleSubmit}>\n\n            <div className={\"max-w-[480px] w-full flex flex-col gap-4\"}>\n                <IconButton\n                    onClick={onBackPressed}>\n                    <ArrowBackIcon className=\"w-5 h-5\"/>\n                </IconButton>\n\n                <div>\n                    {loginState === \"registration\" && noUserComponent}\n                </div>\n\n                <Typography\n                    className={`${loginState === \"registration\" && disableSignupScreen ? \"hidden\" : \"flex\"}`}\n                    variant={\"subtitle2\"}>{label}</Typography>\n\n                {(loginState === \"email\" || loginState === \"registration\") && <TextField placeholder=\"Email\" autoFocus\n                                                                                         value={email ?? \"\"}\n                                                                                         disabled={authController.authLoading}\n                                                                                         type=\"email\"\n                                                                                         onChange={(event) => setEmail(event.target.value)}/>}\n\n                <div\n                    className={`${loginState === \"password\" || (loginState === \"registration\" && !disableSignupScreen) ? \"block\" : \"hidden\"}`}>\n                    <TextField placeholder=\"Password\"\n                               value={password ?? \"\"}\n                               disabled={authController.authLoading}\n                               inputRef={passwordRef}\n                               type=\"password\"\n                               onChange={(event) => setPassword(event.target.value)}/>\n                </div>\n\n                <div\n                    className={`${loginState === \"registration\" && disableSignupScreen ? \"hidden\" : \"flex\"} justify-end items-center w-full flex gap-2`}>\n\n                    {authController.authLoading &&\n                        <CircularProgress className=\"p-1\" size={\"small\"}/>\n                    }\n\n                    {loginState === \"email\" && <Button variant=\"outlined\" onClick={() => setLoginState(\"registration\")}>\n                        New user\n                    </Button>}\n\n                    <Button type=\"submit\">\n                        {loginState === \"registration\" ? \"Create account\" : (loginState === \"password\" ? \"Login\" : \"Login\")}\n                    </Button>\n                </div>\n\n                {previouslyUsedMethodsForUser && previouslyUsedMethodsForUser.length > 0 &&\n                    <div className={\"flex flex-col gap-4 p-4\"}>\n                        <div>\n                            <Typography variant={\"subtitle2\"}>\n                                You already have an account\n                            </Typography>\n                            <Typography variant={\"body2\"}>\n                                You can use one of these\n                                methods to login with {email}\n                            </Typography>\n                        </div>\n\n                        <div>\n                            {previouslyUsedMethodsForUser && buildOauthLoginButtons(authController, previouslyUsedMethodsForUser, mode, false)}\n                        </div>\n                    </div>\n                }\n            </div>\n        </form>\n    );\n\n}\n\nfunction buildOauthLoginButtons(authController: FirebaseAuthController, providers: string[], mode: \"light\" | \"dark\", disabled: boolean) {\n    return <>\n        {providers.includes(\"google.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Google\"}\n            icon={googleIcon(mode)}\n            onClick={authController.googleLogin}/>}\n\n        {providers.includes(\"microsoft.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Microsoft\"}\n            icon={microsoftIcon(mode)}\n            onClick={authController.microsoftLogin}/>}\n\n        {providers.includes(\"apple.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Apple\"}\n            icon={appleIcon(mode)}\n            onClick={authController.appleLogin}/>}\n\n        {providers.includes(\"github.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Github\"}\n            icon={githubIcon(mode)}\n            onClick={authController.githubLogin}/>}\n\n        {providers.includes(\"facebook.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Facebook\"}\n            icon={facebookIcon(mode)}\n            onClick={authController.facebookLogin}/>}\n\n        {providers.includes(\"twitter.com\") && <LoginButton\n            disabled={disabled}\n            text={\"Sign in with Twitter\"}\n            icon={twitterIcon(mode)}\n            onClick={authController.twitterLogin}/>}\n    </>\n}\n","import React from \"react\";\nimport { GoogleAuthProvider } from \"firebase/auth\";\n\nimport {\n    CircularProgressCenter,\n    FireCMS,\n    ModeControllerProvider,\n    NavigationRoutes,\n    PropertyConfig,\n    Scaffold,\n    SideDialogs,\n    SnackbarProvider,\n    useBrowserTitleAndIcon,\n    useBuildLocalConfigurationPersistence,\n    useBuildModeController,\n    useBuildNavigationController,\n    useValidateAuthenticator\n} from \"@firecms/core\";\n\nimport { FireCMSFirebaseAppProps } from \"./FireCMSFirebaseAppProps\";\nimport { FirebaseLoginView } from \"./FirebaseLoginView\";\nimport {\n    useAppCheck,\n    useFirebaseAuthController,\n    useFirebaseStorageSource,\n    useFirestoreDelegate,\n    useInitialiseFirebase,\n} from \"../hooks\";\nimport { CenteredView } from \"@firecms/ui\";\nimport { FirebaseAuthController } from \"../types\";\n\nconst DEFAULT_SIGN_IN_OPTIONS = [\n    GoogleAuthProvider.PROVIDER_ID\n];\n\n/**\n * This is the default implementation of a FireCMS app using the Firebase services\n * as a backend.\n * You can use this component as a full app, by specifying collections and\n * entity collections.\n *\n * This component is in charge of initialising Firebase, with the given\n * configuration object.\n *\n * If you are building a larger app and need finer control, you can use\n * {@link FireCMS}, {@link Scaffold}, {@link SideDialogs}\n * and {@link NavigationRoutes} instead.\n *\n * @param props\n * @constructor\n * @category Firebase\n */\nexport function FireCMSFirebaseApp({\n                                       name,\n                                       logo,\n                                       logoDark,\n                                       toolbarExtraWidget,\n                                       authenticator,\n                                       collections,\n                                       views,\n                                       adminViews,\n                                       textSearchControllerBuilder,\n                                       allowSkipLogin,\n                                       signInOptions = DEFAULT_SIGN_IN_OPTIONS,\n                                       firebaseConfig,\n                                       onFirebaseInit,\n                                       appCheckOptions,\n                                       dateTimeFormat,\n                                       locale,\n                                       basePath,\n                                       baseCollectionPath,\n                                       onAnalyticsEvent,\n                                       propertyConfigs: propertyConfigsProp,\n                                       plugins,\n                                       autoOpenDrawer,\n                                       firestoreIndexesBuilder,\n                                       components,\n                                       localTextSearchEnabled = false,\n                                   }: FireCMSFirebaseAppProps) {\n\n    /**\n     * Update the browser title and icon\n     */\n    useBrowserTitleAndIcon(name, logo);\n\n    const propertyConfigs: Record<string, PropertyConfig> = (propertyConfigsProp ?? [])\n        .map(pc => ({\n            [pc.key]: pc\n        }))\n        .reduce((a, b) => ({ ...a, ...b }), {});\n\n    const {\n        firebaseApp,\n        firebaseConfigLoading,\n        configError\n    } = useInitialiseFirebase({\n        onFirebaseInit,\n        firebaseConfig\n    });\n\n    /**\n     * Controller used to manage the dark or light color mode\n     */\n    const modeController = useBuildModeController();\n\n    const {\n        loading,\n        appCheckVerified,\n        error\n    } = useAppCheck({\n        firebaseApp,\n        options: appCheckOptions\n    });\n\n    /**\n     * Controller for managing authentication\n     */\n    const authController: FirebaseAuthController = useFirebaseAuthController({\n        firebaseApp,\n        signInOptions\n    });\n\n    /**\n     * Controller for saving some user preferences locally.\n     */\n    const userConfigPersistence = useBuildLocalConfigurationPersistence();\n\n    const firestoreDelegate = useFirestoreDelegate({\n        firebaseApp,\n        textSearchControllerBuilder: textSearchControllerBuilder,\n        firestoreIndexesBuilder: firestoreIndexesBuilder,\n        localTextSearchEnabled\n    })\n\n    /**\n     * Controller used for saving and fetching files in storage\n     */\n    const storageSource = useFirebaseStorageSource({\n        firebaseApp\n    });\n\n    /**\n     * Validate authenticator\n     */\n    const {\n        authLoading,\n        canAccessMainView,\n        notAllowedError\n    } = useValidateAuthenticator({\n        authController,\n        authenticator,\n        dataSourceDelegate: firestoreDelegate,\n        storageSource\n    });\n\n    const navigationController = useBuildNavigationController({\n        collections,\n        views,\n        basePath,\n        baseCollectionPath,\n        authController,\n        adminViews,\n        dataSourceDelegate: firestoreDelegate\n    });\n\n    if (firebaseConfigLoading || !firebaseApp || loading) {\n        return <>\n            <CircularProgressCenter/>\n        </>;\n    }\n\n    if (configError) {\n        return <CenteredView>{configError}</CenteredView>;\n    }\n\n    return (\n        <SnackbarProvider>\n            <ModeControllerProvider value={modeController}>\n\n                <FireCMS\n                    authController={authController}\n                    navigationController={navigationController}\n                    userConfigPersistence={userConfigPersistence}\n                    dateTimeFormat={dateTimeFormat}\n                    dataSourceDelegate={firestoreDelegate}\n                    storageSource={storageSource}\n                    entityLinkBuilder={({ entity }) => `https://console.firebase.google.com/project/${firebaseApp.options.projectId}/firestore/data/${entity.path}/${entity.id}`}\n                    locale={locale}\n                    onAnalyticsEvent={onAnalyticsEvent}\n                    plugins={plugins}\n                    propertyConfigs={propertyConfigs}>\n                    {({\n                          context,\n                          loading\n                      }) => {\n\n                        let component;\n                        if (loading || authLoading) {\n                            component = <CircularProgressCenter size={\"large\"}/>;\n                        } else {\n                            const usedLogo = modeController.mode === \"dark\" && logoDark ? logoDark : logo;\n                            if (!canAccessMainView) {\n                                const LoginViewUsed = components?.LoginView ?? FirebaseLoginView;\n                                component = (\n                                    <LoginViewUsed\n                                        logo={usedLogo}\n                                        allowSkipLogin={allowSkipLogin}\n                                        signInOptions={signInOptions ?? DEFAULT_SIGN_IN_OPTIONS}\n                                        firebaseApp={firebaseApp}\n                                        authController={authController}\n                                        notAllowedError={notAllowedError}/>\n                                );\n                            } else {\n                                component = (\n                                    <Scaffold\n                                        name={name}\n                                        logo={usedLogo}\n                                        fireCMSAppBarProps={{\n                                            endAdornment: toolbarExtraWidget\n                                        }}\n                                        autoOpenDrawer={autoOpenDrawer}>\n                                        <NavigationRoutes\n                                            HomePage={components?.HomePage}/>\n                                        <SideDialogs/>\n                                    </Scaffold>\n                                );\n                            }\n                        }\n\n                        return component;\n                    }}\n                </FireCMS>\n            </ModeControllerProvider>\n        </SnackbarProvider>\n    );\n}\n","import { collection, collectionGroup, DocumentSnapshot, Firestore, getDocs, limit, query } from \"firebase/firestore\";\n\nexport async function getDocuments(\n    firestore: Firestore,\n    collectionPath: string,\n    isCollectionGroup: boolean = false,\n    parentPathSegments?: string[],\n    limitCount = 100\n): Promise<DocumentSnapshot[]> {\n\n    if (parentPathSegments && (parentPathSegments ?? [])?.length > 0) {\n        const [thisSubPath, ...restSubpaths] = parentPathSegments;\n        const childDocs = await getDocs(query(collection(firestore, thisSubPath), limit(5)));\n        return Promise.all(childDocs.docs\n            .map((doc) => getDocuments(\n                firestore,\n                doc.ref.path + \"/\" + collectionPath,\n                isCollectionGroup,\n                restSubpaths,\n                Math.max(Math.ceil(limitCount / 5), 5)\n            )))\n            .then((res) => res.flat());\n    }\n\n    const q = query(\n        isCollectionGroup ? collectionGroup(firestore, collectionPath) : collection(firestore, collectionPath),\n        limit(limitCount));\n    const res = await getDocs(q);\n    console.debug(\"Got documents\", isCollectionGroup, q, res.docs);\n    return res.docs;\n}\n","import { buildEntityPropertiesFromData, buildPropertiesOrder } from \"@firecms/schema_inference\";\nimport { DocumentReference, Firestore, Timestamp } from \"firebase/firestore\";\nimport { DataType, EntityCollection, GeoPoint, removeInitialAndTrailingSlashes, unslugify } from \"@firecms/core\";\nimport { getDocuments } from \"./firestore\";\n\n/**\n * Build the guessed schema from a data collection\n * @param firestore\n * @param collectionPath\n * @param isCollectionGroup\n * @param parentPathSegments\n */\nexport async function getInferredEntityCollection(firestore: Firestore, collectionPath: string, isCollectionGroup: boolean, parentPathSegments?: string[]): Promise<Partial<EntityCollection>> {\n    console.debug(\"Building schema for collection\", collectionPath, parentPathSegments)\n    const cleanPath = removeInitialAndTrailingSlashes(collectionPath);\n    const docs = await getDocuments(firestore, cleanPath, isCollectionGroup, parentPathSegments);\n    const data = docs.map(doc => doc.data()).filter(Boolean) as object[];\n    return getInferredEntityCollectionFromData(collectionPath, data);\n}\n\nexport async function getInferredEntityCollectionFromData(collectionPath: string, data: object[]): Promise<Partial<EntityCollection>> {\n    const cleanPath = removeInitialAndTrailingSlashes(collectionPath);\n    const properties = await buildEntityPropertiesFromData(data, getType);\n    const propertiesOrder = buildPropertiesOrder(properties);\n    const lastPathSegment = cleanPath.includes(\"/\") ? cleanPath.split(\"/\").slice(-1)[0] : cleanPath;\n    return {\n        path: cleanPath,\n        name: unslugify(lastPathSegment),\n        properties,\n        propertiesOrder\n    };\n}\n\nexport async function getPropertiesFromData(data: object[]) {\n    return buildEntityPropertiesFromData(data, getType);\n}\n\nfunction getType(value: any): DataType {\n    if (typeof value === \"number\")\n        return \"number\";\n    else if (typeof value === \"string\")\n        return \"string\";\n    else if (typeof value === \"boolean\")\n        return \"boolean\";\n    else if (Array.isArray(value))\n        return \"array\";\n    else if (value instanceof Timestamp)\n        return \"date\";\n    else if (value instanceof GeoPoint)\n        return \"geopoint\";\n    else if (value instanceof DocumentReference)\n        return \"reference\";\n    return \"map\";\n}\n","import { FirebaseApp } from \"firebase/app\";\nimport { getInferredEntityCollection } from \"./schema_inference\";\nimport { CollectionInference } from \"@firecms/collection_editor\";\nimport { getFirestore } from \"firebase/firestore\";\n\nexport const buildCollectionInference = (dataFirebaseApp?: FirebaseApp): CollectionInference | undefined => {\n    if (!dataFirebaseApp) return undefined;\n    return (path: string, collectionGroup: boolean, parentPathSegments: string[]) => {\n        const firestore = getFirestore(dataFirebaseApp);\n        return getInferredEntityCollection(firestore, path, collectionGroup, parentPathSegments)\n    };\n}\n"],"names":["useFirebaseAuthController","loading","firebaseApp","signInOptions","onSignOutProp","defineRolesFor","loggedUser","setLoggedUser","useState","authError","setAuthError","authProviderError","setAuthProviderError","initialLoading","setInitialLoading","authLoading","setAuthLoading","loginSkipped","setLoginSkipped","confirmationResult","setConfirmationResult","roles","setRoles","extra","setExtra","authRef","useRef","getAuth","updateUser","useCallback","user","initialize","updateRoles","userRoles","equal","useEffect","auth","onAuthStateChanged","error","e","getProviderOptions","providerId","option","googleLogin","provider","GoogleAuthProvider","options","scope","signInWithPopup","getAuthToken","emailPasswordLogin","email","password","signInWithEmailAndPassword","createUserWithEmailAndPassword","createUserWithEmailAndPasswordFirebase","fetchSignInMethodsForEmail","fetchSignInMethodsForEmailFirebase","res","onSignOut","signOut","_","doOauthLogin","anonymousLogin","signInAnonymously","phoneLogin","phone","applicationVerifier","signInWithPhoneNumber","appleLogin","OAuthProvider","facebookLogin","FacebookAuthProvider","githubLogin","GithubAuthProvider","microsoftLogin","twitterLogin","TwitterAuthProvider","skipLogin","useFirebaseStorageSource","bucketUrl","urlsCache","file","fileName","path","metadata","bucket","storageBucketUrl","storage","getStorage","usedFilename","uploadBytes","ref","snapshot","fileRef","url","getDownloadURL","blob","storagePathOrUrl","getMetadata","result","hostingError","useInitialiseFirebase","firebaseConfig","fromUrl","onFirebaseInit","name","authDomain","setFirebaseApp","firebaseConfigLoading","setFirebaseConfigLoading","configError","setConfigError","initFirebase","config","targetName","existingApp","getApps","app","deleteApp","initialisedFirebaseApp","initializeApp","fetchFromUrl","response","useAppCheck","appCheckLoading","setAppCheckLoading","React","appCheckVerified","setAppCheckVerified","setError","verifyToken","appCheck","token","getToken","isTokenAutoRefreshEnabled","initializeAppCheck","buildCollectionId","idOrPath","parentCollectionIds","stripCollectionPath","COLLECTION_PATH_SEPARATOR","setUndefinedToDelete","data","v","key","value","a","b","deleteField","docsToCollectionTree","docs","collectionsMap","doc","id","collection","docToCollection","parentId","parentCollection","propertiesOrder","properties","makePropertiesEditable","sortedProperties","sortProperties","prepareCollectionForPersistence","propertyConfigs","inputProperties","rest","cleanedProperties","cleanPropertyConfigs","removeFunctions","newCollection","removeDuplicates","view","property","cleanProperty","removePropsIfExisting","array","getFirestoreDataInPath","parentPaths","limit","firestore","getFirestore","currentDocs","index","allPaths","parentPath","q","query","limitClause","getDocs","querySnapshot","performAlgoliaTextSearch","hits","hit","err","buildAlgoliaSearchController","isPathSupported","search","props","DEFAULT_SERVER","performPineconeTextSearch","host","firebaseToken","projectId","collectionPath","buildPineconeSearchController","MAX_SEARCH_RESULTS","localSearchControllerBuilder","currentPath","indexes","listeners","destroyListener","collectionProp","resolve","reject","buildIndex","col","onSnapshot","searchString","JsSearch","useFirestoreDelegate","textSearchControllerBuilder","firestoreIndexesBuilder","localTextSearchEnabled","searchControllerRef","buildTextSearchControllerWithLocalSearch","buildQuery","filter","orderBy","order","startAfter","collectionGroup","collectionReference","collectionGroupClause","collectionClause","queryParams","entry","filterParameter","op","whereClause","cmsToFirestoreModel","orderByClause","startAfterClause","getAndBuildEntity","entityId","getDoc","docSnapshot","createEntityFromDocument","listenEntity","onUpdate","onError","performTextSearch","textSearchController","subscriptions","currentUser","ids","entities","addedEntitiesSet","entity","p","setDateToMidnight","firestoreToCMSModel","values","currentTime","isCollectionGroup","status","documentReference","setDoc","deleteDoc","getCountFromServer","filterValues","sortBy","sortKey","sortDirection","filterKeys","filtersCount","compositeIndex","docSnap","getCMSPathFromFirestorePath","serverTimestamp","Timestamp","FirestoreGeoPoint","GeoPoint","DocumentReference","EntityReference","childValue","fsPath","to","input","date","firestoreModel","localSearchController","useFirebaseRTDBDelegate","fetchCollection","database","getDatabase","dbQuery","orderByKey","startAt","limitToFirst","get","listenCollection","dbRef","unsubscribe","onValue","fetchEntity","saveEntity","finalId","push","set","deleteEntity","remove","checkUniqueField","orderByChild","entityValue","generateEntityId","isFilterCombinationValid","cmsToRTDBModel","delegateToCMSModel","newDate","rtdbModel","RECAPTCHA_CONTAINER_ID","useRecaptcha","RecaptchaVerifier","googleIcon","mode","jsx","Fragment","jsxs","appleIcon","githubIcon","facebookIcon","microsoftIcon","twitterIcon","FirebaseLoginView","allowSkipLogin","logo","authController","noUserComponent","disableSignupScreen","disabled","additionalComponent","notAllowedError","modeState","useModeController","passwordLoginSelected","setPasswordLoginSelected","phoneLoginSelected","setPhoneLoginSelected","resolvedSignInOptions","o","sendMFASms","recaptchaVerifier","resolver","getMultiFactorResolver","PhoneMultiFactorGenerator","phoneInfoOptions","PhoneAuthProvider","verificationId","verificationCode","cred","multiFactorAssertion","buildErrorView","errorView","ignoredCodes","ErrorView","Button","logoComponent","FireCMSLogo","notAllowedMessage","buildOauthLoginButtons","LoginButton","EmailIcon","PhoneIcon","PersonOutlineIcon","LoginForm","PhoneLoginForm","icon","onClick","text","onClose","setPhone","code","setCode","isInvalidCode","setIsInvalidCode","handleSubmit","event","IconButton","ArrowBackIcon","Typography","TextField","CircularProgress","passwordRef","loginState","setLoginState","setEmail","setPassword","previouslyUsedMethodsForUser","setPreviouslyUsedMethodsForUser","escFunction","handleEnterEmail","availableProviders","handleEnterPassword","handleRegistration","onBackPressed","label","providers","DEFAULT_SIGN_IN_OPTIONS","FireCMSFirebaseApp","logoDark","toolbarExtraWidget","authenticator","collections","views","adminViews","appCheckOptions","dateTimeFormat","locale","basePath","baseCollectionPath","onAnalyticsEvent","propertyConfigsProp","plugins","autoOpenDrawer","components","useBrowserTitleAndIcon","pc","modeController","useBuildModeController","userConfigPersistence","useBuildLocalConfigurationPersistence","firestoreDelegate","storageSource","canAccessMainView","useValidateAuthenticator","navigationController","useBuildNavigationController","CircularProgressCenter","CenteredView","SnackbarProvider","ModeControllerProvider","FireCMS","context","component","usedLogo","Scaffold","NavigationRoutes","SideDialogs","LoginViewUsed","getDocuments","parentPathSegments","limitCount","thisSubPath","restSubpaths","childDocs","getInferredEntityCollection","cleanPath","removeInitialAndTrailingSlashes","getInferredEntityCollectionFromData","buildEntityPropertiesFromData","getType","buildPropertiesOrder","lastPathSegment","unslugify","getPropertiesFromData","buildCollectionInference","dataFirebaseApp"],"mappings":"2uCAuCaA,GAA4B,CAAY,CACI,QAAAC,EACA,YAAAC,EACA,cAAAC,EACA,UAAWC,EACX,eAAAC,CACJ,IAAsE,CAEvH,KAAM,CAACC,EAAYC,CAAa,EAAIC,EAAAA,SAA0C,MAAS,EACjF,CAACC,EAAWC,CAAY,EAAIF,EAAc,SAAA,EAC1C,CAACG,EAAmBC,CAAoB,EAAIJ,EAAc,SAAA,EAC1D,CAACK,EAAgBC,CAAiB,EAAIN,WAAkB,EAAI,EAC5D,CAACO,EAAaC,CAAc,EAAIR,WAAS,EAAI,EAC7C,CAACS,EAAcC,CAAe,EAAIV,WAAkB,EAAK,EACzD,CAACW,EAAoBC,CAAqB,EAAIZ,EAAyC,SAAA,EACvF,CAACa,EAAOC,CAAQ,EAAId,EAA6B,SAAA,EACjD,CAACe,EAAOC,CAAQ,EAAIhB,EAAc,SAAA,EAElCiB,EAAUC,EAAAA,OAAOxB,EAAcyB,EAAQ,QAAAzB,CAAW,EAAI,IAAI,EAE1D0B,EAAaC,EAAAA,YAAY,MAAOC,EAA2BC,IAAyB,CAC9E,QAAA,IAAI,gBAAiBD,CAAI,EAC7B,CAAA7B,IAKJM,EAAcuB,CAAI,EAClBd,EAAe,EAAK,EAChBe,GACAjB,EAAkB,EAAK,EAC3B,EACD,CAACb,CAAO,CAAC,EAEN+B,EAAcH,cAAY,MAAOC,GAA8B,CACjE,GAAIzB,GAAkByB,EAAM,CAClB,MAAAG,EAAY,MAAM5B,EAAeyB,CAAI,EACtCI,GAAMD,EAAWZ,CAAK,GACvBC,EAASW,CAAS,CAE1B,CAAA,EACD,CAAC5B,EAAgBgB,CAAK,CAAC,EAE1Bc,EAAAA,UAAU,IAAM,CACRH,GAAe1B,GACf0B,EAAY1B,CAAU,CAC1B,EACD,CAAC0B,EAAa1B,CAAU,CAAC,EAE5B6B,EAAAA,UAAU,IAAM,CACZ,GAAKjC,EACD,GAAA,CACM,MAAAkC,EAAOT,UAAQzB,CAAW,EAChC,OAAAuB,EAAQ,QAAUW,EAClB1B,EAAa,MAAS,EACXkB,EAAAQ,EAAK,YAAa,EAAK,EAC3BC,EAAA,mBACHD,EACA,MAAON,GAAS,CACJ,QAAA,IAAI,qBAAsBA,CAAI,EAChC,MAAAF,EAAWE,EAAM,EAAI,CAC/B,EACAQ,GAAS1B,EAAqB0B,CAAK,CAAA,QAElCC,EAAG,CACR,OAAA7B,EAAa6B,CAAC,EACdzB,EAAkB,EAAK,EAChB,IAAM,CAAA,CAEjB,CAAA,EACD,CAACZ,EAAa0B,CAAU,CAAC,EAE5BO,EAAAA,UAAU,IAAM,CACR,CAAClC,GAAWwB,EAAQ,SACTG,EAAAH,EAAQ,QAAQ,YAAa,EAAK,CACjD,EACD,CAACxB,EAAS2B,CAAU,CAAC,EAElB,MAAAY,EAAqBX,cAAaY,GAC7BtC,GAAe,KAAMuC,GAAW,CACnC,GAAIA,IAAW,KAAM,MAAM,MAAM,2BAA2B,EAC5D,GAAI,OAAOA,GAAW,UAAYA,EAAO,WAAaD,EAC3C,OAAAC,CACJ,CACV,EACF,CAACvC,CAAa,CAAC,EAEZwC,EAAcd,EAAAA,YAAY,IAAM,CAC5B,MAAAe,EAAW,IAAIC,EAAAA,mBACfC,EAAUN,EAAmB,YAAY,EAC3CM,GAAS,QACTA,EAAQ,OAAO,QAASC,GAAUH,EAAS,SAASG,CAAK,CAAC,EAC1DD,GAAS,iBACAF,EAAA,oBAAoBE,EAAQ,gBAAgB,EAErDF,EAAS,oBAAoB,CACzB,OAAQ,gBAAA,CACX,EAEL,MAAMR,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChCY,EAAAA,gBAAgBZ,EAAMQ,CAAQ,EAAE,MAAMhC,CAAoB,CAAA,EAC3D,CAAC4B,CAAkB,CAAC,EAEjBS,EAAepB,EAAAA,YAAY,SAA6B,CAC1D,GAAI,CAACvB,EACD,MAAM,MAAM,6BAA6B,EAC7C,OAAOA,EAAW,YAAW,EAC9B,CAACA,CAAU,CAAC,EAET4C,EAAqBrB,EAAAA,YAAY,CAACsB,EAAeC,IAAqB,CACxE,MAAMhB,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChCpB,EAAe,EAAI,EACQqC,EAAAA,2BAAAjB,EAAMe,EAAOC,CAAQ,EAC3C,MAAMxC,CAAoB,EAC1B,KAAK,IAAMI,EAAe,EAAK,CAAC,CACzC,EAAG,CAAE,CAAA,EAECsC,GAAiCzB,EAAAA,YAAY,CAACsB,EAAeC,IAAqB,CACpF,MAAMhB,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChCpB,EAAe,EAAI,EACoBuC,EAAAA,+BAAAnB,EAAMe,EAAOC,CAAQ,EACvD,MAAMxC,CAAoB,EAC1B,KAAK,IAAMI,EAAe,EAAK,CAAC,CACzC,EAAG,CAAE,CAAA,EAECwC,GAA6B3B,cAAasB,GAAqC,CACjF,MAAMf,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC,OAAApB,EAAe,EAAI,EACZyC,EAAAA,2BAAmCrB,EAAMe,CAAK,EAChD,KAAMO,IACH1C,EAAe,EAAK,EACb0C,EACV,CACT,EAAG,CAAE,CAAA,EAECC,GAAY9B,EAAAA,YAAY,IAAM,CAChC,MAAMO,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EACxBwB,EAAAA,QAAAxB,CAAI,EACP,KAAUyB,GAAA,CACPtD,EAAc,IAAI,EAClBe,EAAS,MAAS,EAClBV,EAAqB,IAAI,EACzBR,GAAiBA,EAAc,CAAA,CAClC,EACLc,EAAgB,EAAK,CAAA,EACtB,CAACd,CAAa,CAAC,EAEZ0D,EAAejC,EAAAA,YAAY,CAACO,EAAYQ,IAA8F,CACxI5B,EAAe,EAAI,EACHgC,EAAAA,gBAAAZ,EAAMQ,CAAQ,EACzB,MAAMhC,CAAoB,EAAE,KAAK,IAAMI,EAAe,EAAK,CAAC,CACrE,EAAG,CAAE,CAAA,EAEC+C,GAAiBlC,EAAAA,YAAY,IAAM,CACrC,MAAMO,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChCpB,EAAe,EAAI,EACDgD,oBAAA5B,CAAI,EACjB,MAAMxB,CAAoB,EAC1B,KAAK,IAAMI,EAAe,EAAK,CAAC,CACzC,EAAG,CAAE,CAAA,EAECiD,EAAapC,EAAAA,YAAY,CAACqC,EAAeC,IAA6C,CACxF,MAAM/B,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC,OAAApB,EAAe,EAAI,EACZoD,EAAA,sBAAsBhC,EAAM8B,EAAOC,CAAmB,EACxD,MAAMvD,CAAoB,EAC1B,KAAM8C,GAAQ,CACX1C,EAAe,EAAK,EACpBI,EAAsBsC,GAAO,MAAS,CAAA,CACzC,CACT,EAAG,CAAE,CAAA,EAECW,EAAaxC,EAAAA,YAAY,IAAM,CAC3B,MAAAe,EAAW,IAAI0B,gBAAc,WAAW,EACxCxB,EAAUN,EAAmB,WAAW,EAC1CM,GAAS,QACTA,EAAQ,OAAO,QAASC,GAAUH,EAAS,SAASG,CAAK,CAAC,EAC1DD,GAAS,kBACAF,EAAA,oBAAoBE,EAAQ,gBAAgB,EACzD,MAAMV,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC0B,EAAa1B,EAAMQ,CAAQ,CAAA,EAC5B,CAACkB,EAActB,CAAkB,CAAC,EAE/B+B,GAAgB1C,EAAAA,YAAY,IAAM,CAC9B,MAAAe,EAAW,IAAI4B,EAAAA,qBACf1B,EAAUN,EAAmB,cAAc,EAC7CM,GAAS,QACTA,EAAQ,OAAO,QAASC,GAAUH,EAAS,SAASG,CAAK,CAAC,EAC1DD,GAAS,kBACAF,EAAA,oBAAoBE,EAAQ,gBAAgB,EACzD,MAAMV,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC0B,EAAa1B,EAAMQ,CAAQ,CAAA,EAC5B,CAACkB,EAActB,CAAkB,CAAC,EAE/BiC,GAAc5C,EAAAA,YAAY,IAAM,CAC5B,MAAAe,EAAW,IAAI8B,EAAAA,mBACf5B,EAAUN,EAAmB,YAAY,EAC3CM,GAAS,QACTA,EAAQ,OAAO,QAASC,GAAUH,EAAS,SAASG,CAAK,CAAC,EAC1DD,GAAS,kBACAF,EAAA,oBAAoBE,EAAQ,gBAAgB,EACzD,MAAMV,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC0B,EAAa1B,EAAMQ,CAAQ,CAAA,EAC5B,CAACkB,EAActB,CAAkB,CAAC,EAE/BmC,GAAiB9C,EAAAA,YAAY,IAAM,CAC/B,MAAAe,EAAW,IAAI0B,gBAAc,eAAe,EAC5CxB,EAAUN,EAAmB,eAAe,EAC9CM,GAAS,QACTA,EAAQ,OAAO,QAASC,GAAUH,EAAS,SAASG,CAAK,CAAC,EAC1DD,GAAS,kBACAF,EAAA,oBAAoBE,EAAQ,gBAAgB,EACzD,MAAMV,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC0B,EAAa1B,EAAMQ,CAAQ,CAAA,EAC5B,CAACkB,EAActB,CAAkB,CAAC,EAE/BoC,GAAe/C,EAAAA,YAAY,IAAM,CAC7B,MAAAe,EAAW,IAAIiC,EAAAA,oBACf/B,EAAUN,EAAmB,aAAa,EAC5CM,GAAS,kBACAF,EAAA,oBAAoBE,EAAQ,gBAAgB,EACzD,MAAMV,EAAOX,EAAQ,QACrB,GAAI,CAACW,EAAM,MAAM,MAAM,SAAS,EAChC0B,EAAa1B,EAAMQ,CAAQ,CAAA,EAC5B,CAACkB,EAActB,CAAkB,CAAC,EAE/BsC,EAAYjD,EAAAA,YAAY,IAAM,CAChCX,EAAgB,EAAI,EACpBX,EAAc,IAAI,EAClBe,EAAS,MAAS,CACtB,EAAG,CAAE,CAAA,EAUE,MAAA,CACH,KATwBhB,EACtB,CACE,GAAGA,EACH,MAAAe,EACA,aAAcf,CAEhB,EAAA,KAIF,MAAAe,EACA,QAASO,EACT,SAAAN,EACA,kBAAAX,EACA,YAAAI,EACA,eAAgBd,GAAWY,EAC3B,QAAS8C,GACT,aAAAV,EACA,YAAAN,EACA,UAAAmC,EACA,aAAA7D,EACA,mBAAAiC,EACA,+BAAAI,GACA,2BAAAE,GACA,eAAAO,GACA,WAAAE,EACA,WAAAI,EACA,cAAAE,GACA,YAAAE,GACA,eAAAE,GACA,aAAAC,GACA,mBAAAzD,EACA,MAAAI,EACA,SAAAC,CAAA,CAER,EC7SO,SAASuD,GAAyB,CAAE,YAAA7E,EAAa,UAAA8E,GAAwD,CAC5G,MAAMC,EAA4C,CAAA,EAC3C,MAAA,CACH,WAAW,CAAE,KAAAC,EAAM,SAAAC,EAAU,KAAAC,EAAM,SAAAC,EAAU,OAAAC,GAC1B,CACf,GAAI,CAACpF,EAAa,MAAM,MAAM,mDAAmD,EACjF,MAAMqF,EAAmBD,GAAUN,EAC7BQ,EAAUC,EAAAA,WAAWvF,EAAaqF,CAAgB,EACxD,GAAI,CAACC,EAAS,MAAM,MAAM,mDAAmD,EACvE,MAAAE,EAAeP,GAAYD,EAAK,KACtC,eAAQ,MAAM,iBAAkBQ,EAAcR,EAAME,EAAMC,CAAQ,EAC3DM,EAAY,YAAAC,EAAA,IAAIJ,EAAS,GAAGJ,CAAI,IAAIM,CAAY,EAAE,EAAGR,EAAMG,CAAQ,EAAE,KAAkBQ,IAAA,CAC1F,KAAMA,EAAS,IAAI,QACrB,EAAA,CACN,EAEA,MAAM,QAAQT,EAAcE,EAAuC,CAC3D,GAAA,CACA,GAAI,CAACpF,EAAa,MAAM,MAAM,mDAAmD,EACjF,MAAMqF,EAAmBD,GAAUN,EAC7BQ,EAAUC,EAAAA,WAAWvF,EAAaqF,CAAgB,EACxD,GAAI,CAACC,EAAS,MAAM,MAAM,mDAAmD,EACvE,MAAAM,EAAUF,EAAAA,IAAIJ,EAASJ,CAAI,EAC3BW,EAAM,MAAMC,iBAAeF,CAAO,EAElCG,EAAO,MADI,MAAM,MAAMF,CAAG,GACJ,OAC5B,OAAO,IAAI,KAAK,CAACE,CAAI,EAAGb,CAAI,QACvB7C,EAAQ,CACb,GAAIA,GAAG,OAAS,2BAAmC,OAAA,KAC7C,MAAAA,CACV,CACJ,EAEA,MAAM,eAAe2D,EAA0BZ,EAA0C,CACrF,GAAI,CAACpF,EAAa,MAAM,MAAM,mDAAmD,EACjF,MAAMqF,EAAmBD,GAAUN,EAC7BQ,EAAUC,EAAAA,WAAWvF,EAAaqF,CAAgB,EACxD,GAAI,CAACC,EAAS,MAAM,MAAM,mDAAmD,EAC7E,GAAIP,EAAUiB,CAAgB,EAC1B,OAAOjB,EAAUiB,CAAgB,EACjC,GAAA,CACM,MAAAJ,EAAUF,EAAAA,IAAIJ,EAASU,CAAgB,EACvC,CAACH,EAAKV,CAAQ,EAAI,MAAM,QAAQ,IAAI,CAACW,EAAA,eAAeF,CAAO,EAAGK,EAAAA,YAAYL,CAAO,CAAC,CAAC,EACnFM,EAAyB,CAC3B,IAAAL,EACA,SAAAV,CAAA,EAEJ,OAAAJ,EAAUiB,CAAgB,EAAIE,EACvBA,QACF7D,EAAQ,CACb,GAAIA,GAAG,OAAS,2BAA4B,MAAO,CAAE,IAAK,KAAM,aAAc,EAAK,EAC7E,MAAAA,CACV,CACJ,CAAA,CAER,CCzDA,MAAM8D,GAAe;AAAA;AAAA;AAAA,EAsBd,SAASC,GAAsB,CACI,eAAAC,EACA,QAAAC,EACA,eAAAC,EACA,KAAAC,EACA,WAAAC,CACJ,EAMT,CAEzB,KAAM,CAACzG,EAAa0G,CAAc,EAAIpG,EAAkC,SAAA,EAClE,CAACqG,EAAuBC,CAAwB,EAAItG,WAAkB,EAAK,EAC3E,CAACuG,EAAaC,CAAc,EAAIxG,EAAiB,SAAA,EAEjDyG,EAAepF,cAAaqF,GAAoC,CAC9D,GAAA,CACA,MAAMC,EAAaT,GAAQ,YAErBU,EADcC,GAAAA,UACY,KAAYC,GAAAA,EAAI,OAASH,CAAU,EAC/DC,GACAG,GAAA,UAAUH,CAAW,EAEnB,MAAAI,EAAyBC,GAAAA,cAAcP,EAAQC,CAAU,EAC/DH,EAAe,MAAS,EACxBF,EAAyB,EAAK,EAC9BF,EAAeY,CAAsB,QAChCjF,EAAQ,CACL,QAAA,MAAM,8BAA+BA,CAAC,EAC9CyE,EAAeX,GAAe;AAAA,GAAQ9D,EAAE,SAAW,KAAK,UAAUA,CAAC,EAAE,CACzE,CAAA,EACD,CAACmE,CAAI,CAAC,EAETvE,OAAAA,EAAAA,UAAU,IAAM,CACRsE,GAAkBF,GAAkBrG,GACpCuG,EAAeF,EAAgBrG,CAAW,CAC9C,EACD,CAACA,CAAW,CAAC,EAEhBiC,EAAAA,UAAU,IAAM,CAEZ2E,EAAyB,EAAI,EAE7B,SAASY,EAAa3B,EAAa,CAC/B,MAAMA,CAAG,EACJ,KAAK,MAAM4B,GAAY,CAEhB,GADI,QAAA,MAAM,yBAA0BA,EAAS,MAAM,EACnDA,GAAYA,EAAS,OAAS,IAAK,CAC7B,MAAAT,EAAS,MAAMS,EAAS,OAC1BhB,IAAYO,EAAO,WAAaP,GACpCM,EAAaC,CAAM,CACvB,CACH,CAAA,EACA,MAAW3E,GAAA,CACJuE,EAAyB,EAAK,EAC9BE,EACI,8JAEAzE,EAAE,SAAS,CAAA,CAEnB,CAAA,CAEZ,CAEIgE,EACAU,EAAaV,CAAc,EAEvBC,EACAkB,EAAalB,CAAO,EACb,QAAQ,IAAI,WAAa,aAChCkB,EAAa,wBAAwB,GAErCZ,EAAyB,EAAK,EAC9BE,EACI,2FAAA,EAIhB,EAAG,CAAE,CAAA,EAEE,CACH,YAAA9G,EACA,sBAAA2G,EACA,YAAAE,CAAA,CAER,CCnGO,SAASa,GAAY,CACI,YAAA1H,EACA,QAAA4C,CACJ,EAAsD,CAC1EA,GAAS,YACT,OAAO,OAAO,OAAQ,CAClB,8BAA+BA,GAAS,UAAA,CAC3C,EAGL,KAAM,CAAC+E,EAAiBC,CAAkB,EAAIC,EAAM,SAAkB,EAAK,EACrE,CAACC,EAAkBC,CAAmB,EAAIF,EAAM,SAA8B,MAAS,EACvF,CAACzF,EAAO4F,CAAQ,EAAIH,EAAM,SAAc,EAExCI,EAActG,cAAY,MAAOuG,GAAuB,CACtD,GAAA,CACA,MAAMC,EAAQ,MAAMC,GAAS,SAAAF,EAAUtF,GAAS,YAAY,EACpD,QAAA,MAAM,mBAAoBuF,CAAK,EAClCA,GAIDJ,EAAoB,EAAI,EACxB,QAAQ,MAAM,oBAAoB,IAJlCC,EAAS,mBAAmB,EAC5BD,EAAoB,EAAK,SAKxB1F,EAAQ,CACb,QAAQ,MAAMA,CAAC,EACf2F,EAAS3F,EAAE,OAAO,CACtB,CAAA,EACD,CAACO,GAAS,YAAY,CAAC,EAE1BX,OAAAA,EAAAA,UAAU,IAAM,CAGZ,GAFI,CAACW,GACD,CAAC5C,GACD8H,IAAqB,OAAW,OAEpCF,EAAmB,EAAI,EAEjB,KAAA,CACF,SAAAlF,EACA,0BAAA2F,CACA,EAAAzF,EACEsF,EAAWI,sBAAmBtI,EAAa,CAC7C,SAAA0C,EACA,0BAAA2F,CAAA,CACH,EAEWJ,EAAAC,CAAQ,EACf,KAAK,IAAM,CACRN,EAAmB,EAAK,CAAA,CAC3B,GAEN,CAACE,EAAkB9H,EAAa4C,EAASqF,CAAW,CAAC,EAEjD,CACH,QAASN,EACT,iBAAAG,EACA,MAAA1F,CAAA,CAER,CCnEgB,SAAAmG,GAAkBC,EAAkBC,EAAwC,CACxF,OAAKA,EAEE,CAAC,GAAGA,EAAoB,IAAIC,qBAAmB,EAAGA,sBAAoBF,CAAQ,CAAC,EAAE,KAAKG,EAAAA,yBAAyB,EAD3GD,EAAAA,oBAAoBF,CAAQ,CAE3C,CAEO,SAASI,EAAqBC,EAAgB,CAC7C,OAAA,MAAM,QAAQA,CAAI,EACXA,EAAK,IAASC,GAAAF,EAAqBE,CAAC,CAAC,EACrC,OAAOD,GAAS,SAChB,OAAO,QAAQA,CAAI,EACrB,IAAI,CAAC,CAACE,EAAKC,CAAK,KAAO,CAAE,CAACD,CAAG,EAAGH,EAAqBI,CAAK,CAAA,EAAI,EAC9D,OAAO,CAACC,EAAGC,KAAO,CAAE,GAAGD,EAAG,GAAGC,IAAM,CAAE,CAAA,EACnCL,IAAS,OACTM,EAAY,YAAA,EAEhBN,CACX,CAEa,MAAAO,GAAwBC,GAAoD,CAErF,MAAMC,EAAiBD,EAAK,IAAKE,GAAQ,CACrC,MAAMC,EAAaD,EAAI,GACjBE,EAAaC,GAAgBH,CAAG,EACtC,MAAO,CAAE,CAACC,CAAE,EAAGC,EAClB,CAAA,EAAE,OAAO,CAACR,EAAGC,KAAO,CAAE,GAAGD,EAAG,GAAGC,CAAE,GAAI,CAAA,CAAE,EAI5B,OAFQ,OAAO,KAAKI,CAAc,EAAE,KAAK,CAACL,EAAGC,IAAMA,EAAE,MAAMP,EAAAA,yBAAyB,EAAE,OAASM,EAAE,MAAMN,EAAyB,yBAAA,EAAE,MAAM,EAExI,QAASa,GAAO,CAClB,MAAAC,EAAaH,EAAeE,CAAE,EAChC,GAAAA,EAAG,SAASb,EAAAA,yBAAyB,EAAG,CAClC,MAAAgB,EAAWH,EAAG,MAAMb,EAAyB,yBAAA,EAAE,MAAM,EAAG,EAAE,EAAE,KAAKA,EAAyB,yBAAA,EAC1FiB,EAAmBN,EAAeK,CAAQ,EAC5CC,IACAA,EAAiB,eAAiB,CAAC,GAAIA,EAAiB,gBAAkB,CAAA,EAAKH,CAAU,GAC7F,OAAOH,EAAeE,CAAE,CAC5B,CAAA,CACH,EAEM,OAAO,OAAOF,CAAc,CACvC,EAEaI,GAAmBH,GAA+C,CACrE,MAAAV,EAAOU,EAAI,OACjB,GAAI,CAACV,EACD,MAAM,MAAM,oDAAoD,EACpE,MAAMgB,EAAkBhB,EAAK,gBACvBiB,EAAajB,EAAK,YAA4B,GACpDkB,EAAA,uBAAuBD,CAAU,EAC3B,MAAAE,EAAmBC,EAAAA,eAAeH,EAAYD,CAAe,EAC5D,MAAA,CACH,GAAGhB,EACH,WAAYmB,EACZ,GAAInB,EAAK,IAAMA,EAAK,OAASA,EAAK,IAAA,CAE1C,EAEgB,SAAAqB,GAEbT,EAA6CU,EAAiD,CAE7F,KAAM,CAAE,WAAYC,EAAiB,GAAGC,GAASZ,EAC3Ca,EAAoBF,EAAkBG,GAAqBH,EAAiBD,CAAe,EAAI,OAC/FL,EAAaQ,EAAoB1B,EAAqB4B,EAAgB,gBAAAF,CAAiB,CAAC,EAAI,OAClG,IAAIG,EAA8C,CAAA,EAClD,OAAIJ,IACgBI,EAAA,CACZ,GAAGJ,CAAA,GAGPP,IACAW,EAAc,WAAaX,IAE3BO,EAAK,iBAAmBP,KACxBW,EAAc,gBAAkBC,GAAiBL,EAAK,iBAAmB,OAAO,KAAKP,CAAU,CAAC,GAGpG,OAAOW,EAAc,YACjBA,EAAc,cACdA,EAAc,YAAcA,EAAc,YAAY,OAAeE,GAAA,OAAOA,GAAS,QAAQ,GAEjG,OAAOF,EAAc,SACrB,OAAOA,EAAc,iBACrB,OAAOA,EAAc,UACrB,OAAOA,EAAc,QACrB,OAAOA,EAAc,cACrB,OAAOA,EAAc,oBACrB,OAAOA,EAAc,eACrB,OAAOA,EAAc,WACdA,CACX,CAEA,SAASF,GAAqBT,EAAuCK,EAAiD,CAClH,MAAM3G,EAAgC,CAAA,EAC/B,cAAA,QAAQsG,CAAU,EAAE,QAAQ,CAAC,CAACf,EAAK6B,CAAQ,IAAM,CAChD,GAAA,OAAOA,GAAa,SAAU,CAE9B,MAAM5D,EAAS4D,EAAS,eAAiBT,EAAgBS,EAAS,cAAc,EAAI,OAEhF,IAAAC,EACA7D,GAAQ,SACQ6D,EAAAC,EAAAA,sBAAsBF,EAAU5D,GAAQ,QAAQ,EAEhD6D,EAAAD,EAEpBpH,EAAIuF,CAAG,EAAI,CAAE,GAAG8B,CAAc,CAClC,CAAA,CACH,EACMrH,CACX,CAEA,SAASkH,GAAoBK,EAAiB,CAC1C,MAAO,CAAC,GAAG,IAAI,IAAIA,CAAK,CAAC,CAC7B,CCzHA,eAAsBC,GAAuBhL,EAA0BkF,EAAc+F,EAAuBC,EAAkC,CAClI,QAAA,MAAM,yBAA0BhG,EAAMgG,CAAK,EAC7C,MAAAC,EAAYC,eAAapL,CAAW,EAC1C,GAAKiL,EAKE,CACH,IAAII,EACAC,EAAQ,EACZ,MAAMC,EAAWN,EACjBM,EAAS,KAAKrG,CAAI,EACd,IAAAsG,EAAiCD,EAAS,CAAC,EAC/C,KAAOC,GAAY,CACf,GAAIH,EACAA,GAAe,MAAM,QAAQ,IAAIA,EAAY,IAAI,MAAO9B,GAAQ,CACtD,MAAAkC,EAAIC,EAAAA,MAAMjC,EAAA,WAAW0B,EAAW5B,EAAI,IAAI,KAAMiC,CAAoB,EAAGG,QAAY,CAAC,CAAC,EACjF,OAAA,MAAMC,EAAAA,QAAQH,CAAC,GAAG,IAAA,CAC7B,CAAC,GAAG,WACF,CACG,MAAAA,EAAIC,QAAMjC,aAAW0B,EAAWK,CAAU,EAAGG,EAAAA,MAAY,CAAC,CAAC,EAClDN,GAAA,MAAMO,EAAAA,QAAQH,CAAC,GAAG,IACrC,CACAH,IACAE,EAAaF,EAAQC,EAAS,OAASA,EAASD,CAAK,EAAI,MAC7D,CACO,OAAAD,EAAcA,EAAY,IAAI9B,GAAOA,EAAI,MAAM,EAAI,EAC9D,KAzBkB,CACR,MAAAkC,EAAIC,QAAMjC,aAAW0B,EAAWjG,CAAI,EAAGyG,EAAAA,MAAYT,CAAK,CAAC,EAC/D,OAAOU,EAAQ,QAAAH,CAAC,EAAE,KAAMI,GACbA,EAAc,KAAK,IAAWtC,GAAAA,EAAI,MAAM,CAClD,CAAA,CAsBT,CC5BgB,SAAAuC,GAAyBR,EAAoBI,EAA2C,CAE5F,eAAA,MAAM,2BAA4BJ,EAAOI,CAAK,EAC/CJ,EACF,OAAOI,CAAK,EACZ,KAAK,CAAC,CAAE,KAAAK,KACEA,EAAK,IAAKC,GAAaA,EAAI,QAAkB,CACvD,EACA,MAAOC,IACJ,QAAQ,MAAMA,CAAG,EACV,GACV,CACT,CAEO,SAASC,GAA6B,CACI,gBAAAC,EACA,OAAAC,CACJ,EAMJ,CACrC,OAAQC,IAUG,CACH,KATUA,GAKH,QAAQ,QAAQF,EAAgBE,EAAM,IAAI,CAAC,EAKlD,OAAAD,CAAA,EAIZ,CC/CA,MAAME,GAAiB,sCASvB,eAAsBC,GAA0B,CACG,KAAAC,EAAOF,GACP,cAAAG,EACA,UAAAC,EACA,eAAAC,EACA,MAAAjB,CACJ,EAMhB,CAEnB,eAAA,MAAM,4BAA6BiB,EAAgBjB,CAAK,GAehD,MAdC,MAAM,OAAOc,GAAQF,IAAkB,aAAaI,CAAS,WAAWC,CAAc,GACnG,CAEI,OAAQ,OACR,QAAS,CACL,eAAgB,mBAChB,cAAe,SAASF,CAAa,EAEzC,EACA,KAAM,KAAK,UAAU,CACjB,MAAAf,CAAA,CACH,CACL,CAAA,GAE2B,QAChB,KAAK,GAExB,CAEO,SAASkB,GAA8B,CACG,gBAAAT,EACA,OAAAC,CACJ,EAOJ,CACrC,OAAQC,IAUG,CACH,KATUA,GAKH,QAAQ,QAAQF,EAAgBE,EAAM,IAAI,CAAC,EAKlD,OAAAD,CAAA,EAIZ,CCnEA,MAAMS,GAAqB,IAEdC,GAAqE,CAAC,CACI,YAAA9M,CACJ,IAG9C,CAE7B,IAAA+M,EACJ,MAAMC,EAA2C,CAAA,EAC3CC,EAAwC,CAAA,EAExCC,EAAmBhI,GAAiB,CAClC+H,EAAU/H,CAAI,IACd+H,EAAU/H,CAAI,IACd,OAAO+H,EAAU/H,CAAI,EACzB,EA4DG,MAAA,CACH,KA1DS,CAAC,CACI,KAAAA,EACA,WAAYiI,CAAA,KAMlB,QAAA,MAAM,+BAAgCjI,EAAMiI,CAAc,EAE9DJ,GAAe7H,IAAS6H,GACxBG,EAAgBH,CAAW,EAGjBA,EAAA7H,EAEP,IAAI,QAAQ,CAACkI,EAASC,IAAW,CACpC,GAAI,CAACL,EAAQ9H,CAAI,GAAKiI,EAAgB,CAC1B,QAAA,MAAM,+BAAgCjI,CAAI,EAC1C8H,EAAA9H,CAAI,EAAIoI,GAAWH,CAAc,EACnC,MAAAhC,EAAYC,eAAapL,CAAW,EACpCuN,EAAM9D,EAAAA,WAAW0B,EAAWjG,CAAI,EAC9B,QAAA,IAAI,0BAA2BA,EAAMqI,CAAG,EAChDN,EAAU/H,CAAI,EAAIsI,EAAA,WAAW9B,EAAAA,MAAM6B,CAAG,EAClC,CACI,KAAO5H,GAAa,CAChB,MAAM0D,EAAO1D,EAAS,KAAK,IAAY4D,IAAA,CACnC,GAAIA,EAAI,GACR,GAAGA,EAAI,KAAK,CACd,EAAA,EACF,QAAQ,IAAI,sBAAuBrE,EAAMmE,EAAK,MAAM,EAC5C2D,EAAA9H,CAAI,EAAE,aAAamE,CAAI,EAC/B+D,EAAQ,EAAI,CAChB,EACA,MAAQ/K,GAAM,CACF,QAAA,MAAM,6CAA8C6C,CAAI,EAChE,QAAQ,MAAM7C,CAAC,EACfgL,EAAOhL,CAAC,CACZ,CACJ,CAAA,CAER,CAAA,CACH,GAiBD,OAdW,MAAO,CAAE,aAAAoL,EAAc,KAAAvI,KAGhC,CACI,MAAAoG,EAAQ0B,EAAQ9H,CAAI,EAC1B,GAAI,CAACoG,EACD,MAAM,IAAI,MAAM,4BAA4BpG,CAAI,EAAE,EAG/C,OADc,MAAMoG,EAAM,OAAOmC,CAAY,GAChC,OAAO,EAAGZ,EAAkB,EAAE,IAAKxK,GAAWA,EAAE,EAAE,CAAA,CAKtE,CAER,EAEA,SAASiL,GAAW7D,EAAyD,CACzE,MAAM2C,EAAS,IAAIsB,GAAS,OAAO,IAAI,EACvC,OAAAtB,EAAO,SAAS,IAAI,EACb,OAAA,QAAQ3C,EAAW,UAAU,EAAE,QAAQ,CAAC,CAACV,EAAK6B,CAAQ,IAAM,CAC/DwB,EAAO,SAASrD,CAAG,CAAA,CACtB,EACMqD,CACX,CCDO,SAASuB,GAAqB,CACI,YAAA3N,EACA,4BAAA4N,EACA,wBAAAC,EACA,uBAAAC,CACJ,EAAgD,CAEjF,MAAMC,EAAsBvM,EAAAA,SAE5BS,EAAAA,UAAU,IAAM,CACR,CAAC8L,EAAoB,SAAW/N,IAC3B4N,GAA+BE,IAA2B,CAACC,EAAoB,UAChFA,EAAoB,QAAUC,GAAyC,CACnE,YAAAhO,EACA,4BAAA4N,EACA,uBAAwBE,GAA0B,EAAA,CACrD,EAGV,EAAA,CAAC9N,EAAa8N,EAAwBF,CAA2B,CAAC,EAE/D,MAAAK,EAAatM,EAAAA,YAAY,CAAIuD,EACAgJ,EACAC,EACAC,EACAC,EACAnD,EACAoD,EAAkB,KAAU,CAE3D,GAAI,CAACtO,EAAa,MAAM,MAAM,+CAA+C,EAEvE,MAAAmL,EAAYC,eAAapL,CAAW,EACpCuO,EAA6BD,EAAkBE,EAAAA,gBAAsBrD,EAAWjG,CAAI,EAAIuJ,EAAA,WAAiBtD,EAAWjG,CAAI,EAExHwJ,EAAiC,CAAA,EACvC,OAAIR,GACA,OAAO,QAAQA,CAAM,EAChB,OAAO,CAAC,CAACvK,EAAGgL,CAAK,IAAM,CAAC,CAACA,CAAK,EAC9B,QAAQ,CAAC,CAAC5F,EAAK6F,CAAe,IAAM,CAC3B,KAAA,CAACC,EAAI7F,CAAK,EAAI4F,EACRF,EAAA,KAAKI,QAAY/F,EAAK8F,EAAIE,EAAoB/F,EAAOmC,CAAS,CAAC,CAAC,CAAA,CAC/E,EAGLgD,GAAWC,GACXM,EAAY,KAAKM,EAAAA,QAAcb,EAASC,CAAK,CAAC,EAG9CC,GACYK,EAAA,KAAKO,aAAiBZ,CAAU,CAAC,EAG7CnD,GACYwD,EAAA,KAAK/C,QAAYT,CAAK,CAAC,EAGhCQ,QAAM6C,EAAqB,GAAGG,CAAW,CAAA,EACjD,CAAC1O,CAAW,CAAC,EAEVkP,EAAoBvN,EAAAA,YAAY,CAAgCuD,EACAiK,IACjC,CACjC,GAAI,CAACnP,EAAa,MAAM,MAAM,+CAA+C,EAEvE,MAAAmL,EAAYC,eAAapL,CAAW,EAEnC,OAAAoP,EAAA,OAAO7F,MAAI4B,EAAWjG,EAAMiK,CAAQ,CAAC,EACvC,KAAME,GAAgB,CACf,GAACA,EAAY,SAGjB,OAAOC,EAAyBD,CAAW,CAAA,CAC9C,CAAA,EACN,CAACrP,CAAW,CAAC,EAEVuP,EAAe5N,EAAAA,YAAY,CAC7B,CACI,KAAAuD,EACA,SAAAiK,EACA,WAAA1F,EACA,SAAA+F,EACA,QAAAC,CAAA,IACoC,CACxC,GAAI,CAACzP,EAAa,MAAM,MAAM,+CAA+C,EAEvE,MAAAmL,EAAYC,eAAapL,CAAW,EAEnC,OAAAwN,EAAA,WACHjE,MAAI4B,EAAWjG,EAAMiK,CAAQ,EAC7B,CACI,KAAOE,GAAgB,CACVG,EAAAF,EAAyBD,CAAW,CAAC,CAClD,EACA,MAAOI,CACX,CAAA,CACJ,EACD,CAACzP,CAAW,CAAC,EAEV0P,EAAoB/N,EAAAA,YAAY,CAAgC,CACI,KAAAuD,EACA,aAAAuI,EACA,SAAA+B,CAAA,IAKxD,CAEd,GAAI,CAACxP,EAAa,MAAM,MAAM,+CAA+C,EAE7E,MAAM2P,EAAuB5B,EAAoB,QACjD,GAAI,CAAC4B,EACD,MAAM,MAAM,+EAA+E,EAE/F,IAAIC,EAAgC,CAAA,EAGpC,MAAMC,EADOpO,UAAQzB,CAAW,EACP,YACzB,GAAI,CAAC6P,EAAa,MAAM,MAAM,iBAAiB,EAEzC,MAAAzD,EAASuD,EAAqB,OAAO,CACvC,KAAAzK,EACA,aAAAuI,EACA,YAAAoC,CAAA,CACH,EAED,GAAI,CAACzD,EACD,MAAM,MAAM,kFAAkF,EAG3F,OAAAA,EAAA,KAAM0D,GAAQ,CACbA,EAAI,SAAW,IACfF,EAAgB,CAAA,EAChBJ,EAAS,CAAE,CAAA,GAGf,MAAMO,EAAwB,CAAA,EACxBC,MAAuB,IAC7BJ,EAAgBE,EACX,IAAKX,GACSI,EAAa,CAChB,KAAArK,EACA,SAAAiK,EACA,SAAWc,GAAwB,CAC3BA,EAAO,OACFD,EAAiB,IAAIC,EAAO,EAAE,IACdD,EAAA,IAAIC,EAAO,EAAE,EAC9BF,EAAS,KAAKE,CAAM,EACpBT,EAASO,CAAQ,IAGJC,EAAA,OAAOC,EAAO,EAAE,EACxBT,EAAA,CAAC,GAAGO,EAAS,UAAY1N,EAAE,KAAO8M,CAAQ,CAAC,CAAC,EAE7D,CAAA,CACH,CACL,CACJ,CACP,EAEM,IAAM,CACTS,EAAc,QAASM,GAAMA,EAAG,CAAA,CAAA,CACpC,EAED,CAAClQ,EAAauP,CAAY,CAAC,EAEvB,MAAA,CAAA,kBACHY,GACA,mBAAoBC,EACpB,mBAAqBC,GAAW,CAC5B,GAAI,CAACrQ,EAAa,MAAM,MAAM,+CAA+C,EAC7E,OAAO+O,EAAoBsB,EAAQjF,eAAapL,CAAW,CAAC,CAChE,EACA,YAAAsQ,GAEA,yBAA0B3O,EAAAA,YAAY,MAAO0K,GAIpC0B,EAAoB,QAClBA,EAAoB,QAAQ,KAAK1B,CAAK,EADJ,GAE1C,EAAE,EAgBL,gBAAiB1K,cAAY,MAAsC,CACI,KAAAuD,EACA,OAAAgJ,EACA,MAAAhD,EACA,WAAAmD,EACA,aAAAZ,EACA,QAAAU,EACA,MAAAC,EACA,kBAAAmC,CAAA,IAE5C,CAMvB,QAAQ,MAAM,sBAAuB,CACjC,KAAArL,EACA,MAAAgG,EACA,OAAAgD,EACA,WAAAG,EACA,QAAAF,EACA,MAAAC,EACA,kBAAAmC,CAAA,CACH,EACK7E,MAAAA,EAAQuC,EAAW/I,EAAMgJ,EAAQC,EAASC,EAAOC,EAAYnD,EAAOqF,CAAiB,EAG3F,OADiB,MAAM3E,UAAQF,CAAK,GACpB,KAAK,IAAKnC,GAAQ+F,EAAyB/F,CAAG,CAAC,CAAA,EAChE,CAAC0E,CAAU,CAAC,EAkBf,iBAAkBtM,cAAY,CAC1B,CACI,KAAAuD,EACA,OAAAgJ,EACA,MAAAhD,EACA,WAAAmD,EACA,aAAAZ,EACA,QAAAU,EACA,MAAAC,EACA,SAAAoB,EACA,QAAAC,EACA,kBAAAc,EACA,WAAA9G,CAAA,IAES,CAab,GAXA,QAAQ,MAAM,uBAAwB,CAClC,KAAAvE,EACA,aAAAuI,EACA,kBAAA8C,EACA,MAAArF,EACA,OAAAgD,EACA,WAAAG,EACA,QAAAF,EACA,MAAAC,CAAA,CACH,EAEG,CAACpO,EACD,MAAM,MAAM,+CAA+C,EAGzD0L,MAAAA,EAAQuC,EAAW/I,EAAMgJ,EAAQC,EAASC,EAAOC,EAAYnD,EAAOqF,CAAiB,EAU3F,OAAI9C,EACOiC,EAAqB,CACxB,KAAAxK,EACA,aAAAuI,EACA,SAAA+B,CAAA,CACH,EAGEhC,EAAA,WAAW9B,EACd,CACI,KAAO/F,GAAa,CACX8H,GACQ+B,EAAA7J,EAAS,KAAK,IAAK4D,GAAQ+F,EAAyB/F,CAAG,CAAC,CAAC,CAC1E,EACA,MAAOkG,CACX,CAAA,CAGL,EAAA,CAACxB,EAAYjO,EAAa0P,CAAiB,CAAC,EAS/C,YAAa/N,cAAY,CAAgC,CACI,KAAAuD,EACA,SAAAiK,KAExBD,EAAkBhK,EAAMiK,CAAQ,EAAG,CAACD,CAAiB,CAAC,EAY3F,aAAAK,EAaA,WAAY5N,cAAY,CACpB,CACI,KAAAuD,EACA,SAAAiK,EACA,OAAAkB,EACA,OAAAG,CAAA,IAC0C,CAE9C,GAAI,CAACxQ,EAAa,MAAM,MAAM,+CAA+C,EAEvE,MAAAmL,EAAYC,eAAapL,CAAW,EAEpCuO,EAA2CE,EAAAA,WAAiBtD,EAAWjG,CAAI,EAEjF,QAAQ,MAAM,gBAAiB,CAC3B,KAAAA,EACA,SAAAiK,EACA,OAAAkB,CAAA,CAEH,EAEG,IAAAI,EACA,OAAAtB,EACoBsB,EAAAlH,EAAA,IAAIgF,EAAqBY,CAAQ,EAErDsB,EAAoBlH,EAAAA,IAAIgF,CAAmB,EAExCmC,EAAA,OAAOD,EAAmBJ,EAAQ,CAAE,MAAO,EAAM,CAAA,EACnD,KAAK,KAAO,CACT,GAAII,EAAkB,GACtB,KAAAvL,EACA,OAAAmL,CAAA,EACF,EACD,MAAOjO,GAAU,CACN,cAAA,MAAM,sBAAuBA,CAAK,EACpCA,CAAA,CAET,CAAA,EACN,CAACpC,CAAW,CAAC,EAQhB,aAAc2B,cAAY,CACtB,CACI,OAAAsO,CAAA,IAEY,CAChB,GAAI,CAACjQ,EAAa,MAAM,MAAM,+CAA+C,EAEvE,MAAAmL,EAAYC,eAAapL,CAAW,EAE1C,OAAO2Q,YAAUpH,EAAI,IAAA4B,EAAW8E,EAAO,KAAMA,EAAO,EAAE,CAAC,CAAA,EACxD,CAACjQ,CAAW,CAAC,EAYhB,iBAAkB2B,EAAY,YAAA,MAC1BuD,EACAsB,EACAwC,EACAmG,IACmB,CAEnB,GAAI,CAACnP,EAAa,MAAM,MAAM,+CAA+C,EAEvE,MAAAmL,EAAYC,eAAapL,CAAW,EAItC,GAFJ,QAAQ,MAAM,4BAA6BkF,EAAMsB,EAAMwC,EAAOmG,CAAQ,EAE3CnG,GAAU,KAC1B,OAAA,QAAQ,QAAQ,EAAI,EAE/B,MAAMyC,EAAIC,EAAA,MAAM+C,EAAiB,WAAAtD,EAAWjG,CAAI,EAAG4J,EAAAA,MAAYtI,EAAM,KAAMuI,EAAoB/F,EAAOmC,CAAS,CAAC,CAAC,EAE1G,OADU,MAAMS,UAAQH,CAAC,GAChB,KAAK,OAAOlC,GAAOA,EAAI,KAAO4F,CAAQ,EAAE,SAAW,CAAA,EAEpE,CAACnP,CAAW,CAAC,EAEhB,iBAAkB2B,EAAAA,YAAauD,GAAyB,CACpD,GAAI,CAAClF,EAAa,MAAM,MAAM,+CAA+C,EACvE,MAAAmL,EAAYC,eAAapL,CAAW,EAC1C,OAAOuJ,EAAAA,IAAIkF,EAAAA,WAAiBtD,EAAWjG,CAAI,CAAC,EAAE,EAAA,EAC/C,CAAClF,CAAW,CAAC,EAEhB,cAAe2B,cAAY,MAAO,CACI,KAAAuD,EACA,OAAAgJ,EACA,MAAAE,EACA,QAAAD,EACA,kBAAAoC,CAAA,IAOf,CACnB,GAAI,CAACvQ,EAAa,MAAM,MAAM,+CAA+C,EACvE0L,MAAAA,EAAQuC,EAAW/I,EAAMgJ,EAAQC,EAASC,EAAO,OAAW,OAAWmC,CAAiB,EAEvF,OADU,MAAMK,qBAAmBlF,CAAK,GAC/B,KAAO,EAAA,KAAA,EACxB,CAAC1L,CAAW,CAAC,EAEhB,yBAA0B2B,cAAY,CAAC,CACI,KAAAuD,EACA,WAAAuE,EACA,aAAAoH,EACA,OAAAC,CAAA,IAM5B,CAEX,GAAI,CAAC9Q,EAAa,MAAM,MAAM,+CAA+C,EAI7E,GAAI6N,IAA4B,OAAkB,MAAA,GAElD,MAAMb,EAAUa,IAA0B,CACtC,KAAA3I,EACA,WAAAuE,CAAA,CACH,EAEKsH,EAAUD,EAASA,EAAO,CAAC,EAAI,OAC/BE,EAAgBF,EAASA,EAAO,CAAC,EAAI,OAGrCT,EAAiC,OAAO,OAAOQ,CAAY,EAE3DI,EAAa,OAAO,KAAKJ,CAAY,EACrCK,EAAeD,EAAW,OAMhC,MAJI,CAACF,GAAWV,EAAO,MAAOvH,GAAMA,EAAE,CAAC,IAAM,IAAI,GAI7CoI,IAAiB,IAAM,CAACH,GAAWA,IAAYE,EAAW,CAAC,GACpD,GAGP,CAACjE,GAAWkE,EAAe,EACpB,GAGJ,CAAC,CAAClE,GAAWA,EACf,OAAQmE,GAAmB,CAACJ,GAAWA,KAAWI,CAAc,EAChE,KAAMA,GACH,OAAO,QAAQN,CAAY,EAAE,MAAM,CAAC,CAAC9H,EAAKC,CAAK,IAAMmI,EAAepI,CAAG,IAAM,SAAc,CAACiI,GAAiBG,EAAepI,CAAG,IAAMiI,EAAc,CACjJ,IAAA,MAAA,EACX,CAAChR,CAAW,CAAC,CAAA,CAIxB,CAEA,MAAMsP,EACF8B,GACY,CACZ,MAAMf,EAASD,EAAoBgB,EAAQ,KAAM,CAAA,EAC1C,MAAA,CACH,GAAIA,EAAQ,GACZ,KAAMC,GAA4BD,EAAQ,IAAI,IAAI,EAClD,OAAAf,CAAA,CAER,EAYO,SAASD,EAAoBvH,EAAgB,CAC5C,GAAAA,GAAS,KAAmC,OAAA,KAChD,GAAIM,CAAAA,cAAY,EAAE,QAAQN,CAAI,EAG9B,IAAIyI,kBAAgB,EAAE,QAAQzI,CAAI,EACvB,OAAA,KAEP,GAAAA,aAAgB0I,aAAc,OAAO1I,EAAK,QAAW,YAAcA,EAAK,OAAO,YAAa,KAC5F,OAAOA,EAAK,SAEhB,GAAIA,aAAgB,KACT,OAAAA,EAEX,GAAI,SAAOA,GAAS,UAAY,aAAcA,GAAQA,EAAK,WAAa,cAIxE,IAAIA,aAAgB2I,EAAAA,SAChB,OAAO,IAAIC,EAAA,SAAS5I,EAAK,SAAUA,EAAK,SAAS,EAErD,GAAIA,aAAgB6I,EAAAA,kBAChB,OAAO,IAAIC,EAAgB,gBAAA9I,EAAK,GAAIwI,GAA4BxI,EAAK,IAAI,CAAC,EAE1E,GAAA,MAAM,QAAQA,CAAI,EAClB,OAAOA,EAAK,IAAIuH,CAAmB,EAAE,OAAOtH,GAAKA,IAAM,MAAS,EAEhE,GAAA,OAAOD,GAAS,SAAU,CAC1B,MAAM3C,EAA8B,CAAA,EACpC,UAAW6C,KAAO,OAAO,KAAKF,CAAI,EAAG,CACjC,MAAM+I,EAAaxB,EAAoBvH,EAAKE,CAAG,CAAC,EAC5C6I,IAAe,SACf1L,EAAO6C,CAAG,EAAI6I,EACtB,CACO,OAAA1L,CACX,CACO,OAAA2C,GACX,CAMA,SAASwI,GAA4BQ,EAAwB,CACrD,IAAAC,EAAKD,EAAO,YAAY,GAAG,EAC1B,OAAAC,EAAAA,IAAO,GAAKD,EAAO,OAASC,EAC1BD,EAAO,UAAU,EAAGC,CAAE,CACjC,CAEA,SAAS3B,GAAkB4B,EAA0C,CAEjE,GADI,CAACA,GACD,EAAEA,aAAiBR,aAAmB,OAAAQ,EACpC,MAAAC,EAAOD,EAAM,SACnB,OAAAC,EAAK,SAAS,EAAG,EAAG,EAAG,CAAC,EACjBT,EAAA,UAAU,SAASS,CAAI,CAClC,CAEgB,SAAAjD,EAAoBlG,EAAWsC,EAA2B,CACtE,OAAItC,IAAS,OACFM,EAAY,YAAA,EACZN,IAAS,KACT,KACA,MAAM,QAAQA,CAAI,EAClBA,EAAK,OAAOC,GAAKA,IAAM,MAAS,EAAE,IAASA,GAAAiG,EAAoBjG,EAAGqC,CAAS,CAAC,EAC5EtC,EAAK,mBAAqBA,EAAK,oBAC/BU,EAAAA,IAAI4B,EAAWtC,EAAK,KAAMA,EAAK,EAAE,EACjCA,aAAgB4I,WAChB,IAAID,EAAA,SAAkB3I,EAAK,SAAUA,EAAK,SAAS,EACnDA,aAAgB,KAChB0I,EAAA,UAAU,SAAS1I,CAAI,EACvBA,GAAQ,OAAOA,GAAS,UAAY,aAAcA,GAAQA,EAAK,WAAa,aAC5E,OACAA,GAAQ,OAAOA,GAAS,SACxB,OAAO,QAAQA,CAAI,EACrB,IAAI,CAAC,CAACE,EAAKD,CAAC,IAAM,CACT,MAAAmJ,EAAiBlD,EAAoBjG,EAAGqC,CAAS,EACvD,OAAI8G,IAAmB,OACX,CAAE,CAAClJ,CAAG,EAAGkJ,GAEV,EACd,CAAA,EACA,OAAO,CAAChJ,EAAGC,KAAO,CAAE,GAAGD,EAAG,GAAGC,CAAE,GAAI,CAAA,CAAE,EAEvCL,CACX,CAEA,SAASyH,IAAmB,CACxB,OAAOgB,EAAgB,gBAAA,CAC3B,CAEA,SAAStD,GAAyC,CACI,4BAAAJ,EACA,YAAA5N,EACA,uBAAA8N,CACJ,EAIJ,CAC1C,GAAI,CAACF,GAA+BE,EACzB,OAAAhB,GAA6B,CAAE,YAAA9M,CAAA,CAAa,EAEvD,GAAI,CAAC8N,GAA0BF,EACpB,OAAAA,EAA4B,CAAE,YAAA5N,CAAA,CAAa,EAElD,GAAA,CAAC4N,GAA+B,CAACE,EAC1B,OAGX,MAAMoE,EAAwBpF,GAA6B,CAAE,YAAA9M,CAAa,CAAA,EACpE2P,EAAuB/B,EAA6B,CAAE,YAAA5N,CAAa,CAAA,EAClE,MAAA,CACH,KAAM,MAAOqM,GAIC,MAAMsD,EAAqB,KAAKtD,CAAK,EACjC,GACP6F,EAAsB,KAAK7F,CAAK,EAE3C,OAASA,GAKEsD,EAAqB,OAAOtD,CAAK,GAAK6F,EAAsB,OAAO7F,CAAK,CACnF,CAER,CCxtBgB,SAAA8F,GAAwB,CAAE,YAAAnS,GAAkE,CAElG,MAAAoS,EAAkBzQ,EAAAA,YAAY,MAAsC,CACI,KAAAuD,EACA,OAAAgJ,EACA,MAAAhD,EACA,WAAAmD,EACA,QAAAF,EACA,MAAAC,EACA,aAAAX,CAAA,IACyD,CACnI,GAAI,CAACzN,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAExC,IAAIuS,EAAU7G,EAAAA,MAAMhG,EAAAA,IAAI2M,EAAUnN,CAAI,CAAC,EAGnCmJ,IAAe,SACfkE,EAAU7G,QAAM6G,EAASC,EAAAA,WAAc,EAAAC,EAAA,QAAQpE,CAAU,CAAC,GAE1DnD,IAAU,SACVqH,EAAU7G,EAAAA,MAAM6G,EAASG,EAAAA,aAAaxH,CAAK,CAAC,GAG1C,MAAAvF,EAAW,MAAMgN,MAAIJ,CAAO,EAC9B,OAAA5M,EAAS,SACF,OAAO,QAAQA,EAAS,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC6D,EAAI6G,CAAM,KAAO,CACzD,GAAA7G,EACA,KAAAtE,EACA,OAAAmL,CACF,EAAA,EAEC,EAAC,EACT,CAACrQ,CAAW,CAAC,EAEV4S,EAAmBjR,EAAAA,YAAY,CAAgC,CACI,KAAAuD,EACA,SAAAsK,CAAA,IAEgD,CACrH,GAAI,CAACxP,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAElC6S,EAAQnN,EAAAA,IAAI2M,EAAUnN,CAAI,EAC1B4N,EAAcC,EAAAA,QAAQF,EAAQlN,GAAa,CACzC,GAAAA,EAAS,SAAU,CACnB,MAAMO,EAAsB,OAAO,QAAQP,EAAS,KAAK,EAAE,IAAI,CAAC,CAAC6D,EAAI6G,CAAM,KAAO,CAC9E,GAAA7G,EACA,KAAAtE,EACA,OAAAmL,CACF,EAAA,EACFb,EAAStJ,CAAM,CAAA,MAEfsJ,EAAS,CAAE,CAAA,CACf,CACH,EAED,MAAO,IAAMsD,EAAY,CAAA,EAC1B,CAAC9S,CAAW,CAAC,EAEVgT,EAAcrR,EAAAA,YAAY,MAAsC,CACI,KAAAuD,EACA,SAAAiK,CAAA,IACuD,CAC7H,GAAI,CAACnP,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAElC2F,EAAW,MAAMgN,MAAIjN,EAAAA,IAAI2M,EAAU,GAAGnN,CAAI,IAAIiK,CAAQ,EAAE,CAAC,EAC3D,GAAAxJ,EAAS,SACF,MAAA,CACH,GAAIwJ,EACJ,KAAAjK,EACA,OAAQS,EAAS,IAAI,CAAA,CAGtB,EACR,CAAC3F,CAAW,CAAC,EAEVuP,EAAe5N,EAAAA,YAAY,CAAgC,CACI,KAAAuD,EACA,SAAAiK,EACA,SAAAK,EACA,QAAAC,CAAA,IACoC,CACrG,GAAI,CAACzP,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAElC6S,EAAQnN,EAAI,IAAA2M,EAAU,GAAGnN,CAAI,IAAIiK,CAAQ,EAAE,EAC3C2D,EAAcC,EAAAA,QAAQF,EAAQlN,GAAa,CACzCA,EAAS,SACA6J,EAAA,CACL,GAAIL,EACJ,KAAAjK,EACA,OAAQS,EAAS,IAAI,CAAA,CACxB,EAES8J,IAAA,IAAI,MAAM,uBAAuB,CAAC,CAChD,CACH,EAED,MAAO,IAAMqD,EAAY,CAAA,EAC1B,CAAC9S,CAAW,CAAC,EAEViT,EAAatR,EAAAA,YAAY,MAAsC,CACI,KAAAuD,EACA,SAAAiK,EACA,OAAAkB,CAAA,IAC0C,CAC/G,GAAI,CAACrQ,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAGlCkT,EAAU/D,GAAYgE,OAAKzN,EAAAA,IAAI2M,EAAUnN,CAAI,CAAC,EAAE,IACtD,GAAI,CAACgO,EACK,MAAA,IAAI,MAAM,6BAA6B,EAE3C,aAAAE,MAAI1N,EAAAA,IAAI2M,EAAU,GAAGnN,CAAI,IAAIgO,CAAO,EAAE,EAAG7C,CAAM,EAC9C,CACH,GAAI6C,EACJ,KAAAhO,EACA,OAAAmL,CAAA,CACJ,EACD,CAACrQ,CAAW,CAAC,EAEVqT,EAAe1R,EAAAA,YAAY,MAAsC,CACI,OAAAsO,CAAA,IACuC,CAC9G,GAAI,CAACjQ,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAElC,MAAAsT,SAAO5N,EAAAA,IAAI2M,EAAU,GAAGpC,EAAO,IAAI,IAAIA,EAAO,EAAE,EAAE,CAAC,CAAA,EAC1D,CAACjQ,CAAW,CAAC,EAGVuT,EAAmB5R,EAAAA,YAAY,MAAOuD,EAAcsB,EAAcwC,EAAYmG,IAAwC,CACxH,GAAI,CAACnP,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAGlC6S,EAAQnH,EAAA,MAAMhG,EAAI,IAAA2M,EAAUnN,CAAI,EAAGsO,EAAAA,aAAahN,CAAI,EAAGiM,EAAQ,QAAAzJ,CAAK,EAAG0J,EAAAA,aAAa,CAAC,CAAC,EACtF/M,EAAW,MAAMgN,MAAIE,CAAK,EAE5B,GAAA,CAAClN,EAAS,SACH,MAAA,GAIL,KAAA,CAACoD,EAAK0K,CAAW,EAAI,OAAO,QAAQ9N,EAAS,IAAA,CAAK,EAAE,CAAC,EACvD,MAAA,GAAA8N,GAAe,OAAOA,GAAgB,UAAaA,EAAoBjN,CAAI,IAAMwC,GAASD,IAAQoG,EAI/F,EACR,CAACnP,CAAW,CAAC,EAEV0T,EAAmB/R,cAAauD,GAAyB,CAC3D,GAAI,CAAClF,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EAExC,OAAOmT,EAAAA,KAAKzN,EAAAA,IAAI2M,EAAUnN,CAAI,CAAC,EAAE,GAAA,EAClC,CAAClF,CAAW,CAAC,EAEV2T,EAA2BhS,EAAAA,YAAY,CAAC,CACI,KAAAuD,EACA,OAAAgJ,EACA,OAAA4C,CAAA,IAEvC,GACR,CAAE,CAAA,EAEE,MAAA,CACH,gBAAAsB,EACA,iBAAAQ,EACA,YAAAI,EACA,aAAAzD,EACA,WAAA0D,EACA,aAAAI,EACA,iBAAAE,EACA,iBAAAG,EACA,yBAAAC,EACA,mBAAqB9K,GAAc,CAC/B,GAAI,CAAC7I,EACK,MAAA,IAAI,MAAM,2BAA2B,EAEzC,MAAAqS,EAAWC,cAAYtS,CAAW,EACjC,OAAA4T,EAAe/K,EAAMwJ,CAAQ,CACxC,EACA,YAAa,IAAM,IAAI,KACvB,mBAAAwB,GACA,kBAAA1D,EAAA,CAER,CAEA,SAASA,GAAkB6B,EAAkB,CACnC,MAAA8B,EAAU,IAAI,KAAK9B,CAAI,EAC7B,OAAA8B,EAAQ,SAAS,EAAG,EAAG,EAAG,CAAC,EACpBA,CACX,CAEA,SAASD,GAAmBhL,EAAgB,CACpC,GAAAA,GAAS,KAAmC,OAAA,KAE5C,GAAA,MAAM,QAAQA,CAAI,EAClB,OAAOA,EAAK,IAAIgL,EAAkB,EAAE,OAAO/K,GAAKA,IAAM,MAAS,EAG/D,GAAA,OAAOD,GAAS,SAAU,CAC1B,MAAM3C,EAA8B,CAAA,EACpC,UAAW6C,KAAO,OAAO,KAAKF,CAAI,EAAG,CACjC,MAAM+I,EAAaiC,GAAmBhL,EAAKE,CAAG,CAAC,EAC3C6I,IAAe,SACf1L,EAAO6C,CAAG,EAAI6I,EACtB,CACO,OAAA1L,CACX,CAEO,OAAA2C,CACX,CAEgB,SAAA+K,EAAe/K,EAAWwJ,EAAyB,CAC/D,OAAIxJ,IAAS,QAEFA,IAAS,KADT,KAGA,MAAM,QAAQA,CAAI,EAClBA,EAAK,OAAOC,GAAKA,IAAM,MAAS,EAAE,IAASA,GAAA8K,EAAe9K,EAAGuJ,CAAQ,CAAC,EACtExJ,EAAK,mBAAqBA,EAAK,oBAC/BnD,EAAA,IAAI2M,EAAU,GAAGxJ,EAAK,IAAI,IAAIA,EAAK,EAAE,EAAE,EACvCA,aAAgB,KAEhBA,EAAK,cACLA,GAAQ,OAAOA,GAAS,SACxB,OAAO,QAAQA,CAAI,EACrB,IAAI,CAAC,CAACE,EAAKD,CAAC,IAAM,CACT,MAAAiL,EAAYH,EAAe9K,EAAGuJ,CAAQ,EAC5C,OAAI0B,IAAc,OACN,CAAE,CAAChL,CAAG,EAAGgL,GAEV,EACd,CAAA,EACA,OAAO,CAAC9K,EAAGC,KAAO,CAAE,GAAGD,EAAG,GAAGC,CAAE,GAAI,CAAA,CAAE,EAEvCL,CACX,CCtRa,MAAAmL,GAAyB,sBAE/B,SAASC,IAAe,CAC3BhS,OAAAA,EAAAA,UAAU,IAAM,CACR,GAAA,CAAC,QAAU,QAAQ,kBAAmB,OAE1C,MAAMC,EAAOT,EAAAA,UAEb,OAAO,kBAAoB,IAAIyS,EAAA,kBAC3BhS,EACA8R,GACA,CACI,KAAM,WACV,CAAA,CAER,EAAG,CAAE,CAAA,EAEE,IACX,CC3Ba,MAAAG,GAAcC,GACvBC,EAAAA,IAAAC,EAAAA,SAAA,CAAA,SAAAC,EAAA,KAAC,MAAA,CACG,MAAM,6BACN,QAAQ,YACR,MAAO,GACP,OAAQ,GAER,SAAA,CAAAA,EAAA,KAAC,iBAAA,CACG,GAAG,yBACH,GAAG,SACH,GAAG,SACH,GAAG,QACH,GAAG,UACH,kBAAkB,wBAClB,cAAc,iBAEd,SAAA,CAAAF,EAAA,IAAC,OAAK,CAAA,OAAO,IAAI,UAAU,UAAS,EACnCA,EAAA,IAAA,OAAA,CAAK,OAAO,OAAO,UAAU,UAAS,EACtCA,EAAA,IAAA,OAAA,CAAK,OAAO,OAAO,UAAU,UAAS,EACtCA,EAAA,IAAA,OAAA,CAAK,OAAO,IAAI,UAAU,UAAS,CAAA,CAAA,CACxC,EACAA,EAAA,IAAC,OAAA,CACG,KAAK,+BACL,EAAE,sNAAA,CACN,EACAE,EAAA,KAAC,iBAAA,CACG,GAAG,yBACH,GAAG,SACH,GAAG,SACH,GAAG,OACH,GAAG,SACH,kBAAkB,wBAClB,cAAc,iBAEd,SAAA,CAAAF,EAAA,IAAC,OAAK,CAAA,OAAO,IAAI,UAAU,UAAS,EACnCA,EAAA,IAAA,OAAA,CAAK,OAAO,OAAO,UAAU,UAAS,EACtCA,EAAA,IAAA,OAAA,CAAK,OAAO,IAAI,UAAU,UAAS,CAAA,CAAA,CACxC,EACAA,EAAA,IAAC,OAAA,CACG,KAAK,+BACL,EAAE,sKAAA,CACN,EACAE,EAAA,KAAC,iBAAA,CACG,GAAG,yBACH,GAAG,QACH,GAAG,QACH,GAAG,SACH,GAAG,SACH,kBAAkB,wBAClB,cAAc,iBAEd,SAAA,CAAAF,EAAA,IAAC,OAAK,CAAA,OAAO,IAAI,UAAU,UAAS,EACnCA,EAAA,IAAA,OAAA,CAAK,OAAO,OAAO,UAAU,UAAS,EACtCA,EAAA,IAAA,OAAA,CAAK,OAAO,IAAI,UAAU,UAAS,CAAA,CAAA,CACxC,EACAA,EAAA,IAAC,OAAA,CACG,KAAK,+BACL,EAAE,mKAAA,CACN,EACAE,EAAA,KAAC,iBAAA,CACG,GAAG,yBACH,GAAG,KACH,GAAG,KACH,GAAG,QACH,GAAG,SACH,kBAAkB,wBAClB,cAAc,iBAEd,SAAA,CAAAF,EAAA,IAAC,OAAK,CAAA,OAAO,IAAI,UAAU,UAAS,EACnCA,EAAA,IAAA,OAAA,CAAK,OAAO,OAAO,UAAU,UAAS,EACtCA,EAAA,IAAA,OAAA,CAAK,OAAO,OAAO,UAAU,UAAS,EACtCA,EAAA,IAAA,OAAA,CAAK,OAAO,MAAM,UAAU,UAAS,EACrCA,EAAA,IAAA,OAAA,CAAK,OAAO,IAAI,UAAU,UAAS,CAAA,CAAA,CACxC,EACAA,EAAA,IAAC,OAAA,CACG,KAAK,+BACL,EAAE;AAAA,gHAAA,CAEN,CAAA,CAAA,CACJ,CACJ,CAAA,EAEaG,GAAaJ,GAA2BC,EAAA,IAAC,MAAA,CAAI,MAAO,GAAI,OAAQ,GACnB,QAAQ,YACR,MAAO,CAAE,UAAW,YAAa,EACjC,QAAQ,MACR,MAAM,6BAC5D,SAAAA,EAAA,IAAC,IAAA,CAAE,OAAQD,IAAS,QAAU,UAAY,QAAS,YAAY,MAC5D,SAAS,UACR,SAAAC,EAAA,IAAC,OAAA,CACG,EAAE,+sCACF,KAAMD,IAAS,QAAU,UAAY,QAAS,SAAS,SAAA,CAAS,CAAA,CACxE,CAAA,CACJ,EAEaK,GAAcL,GAA2BC,EAAA,IAAC,MAAA,CACnD,KAAMD,IAAS,QAAU,UAAY,QACrC,KAAK,MACL,QAAQ,YACR,MAAO,GACP,OAAQ,GACR,MAAM,6BACN,SAAAC,EAAA,IAAC,OAAA,CACG,EAAE,0sBAAA,CAA0sB,CAAA,CACptB,EAGaK,GAAgBN,GAA2BC,EAAA,IAAC,MAAA,CACrD,MAAM,6BACN,MAAO,GAAI,OAAQ,GACnB,QAAQ,YACR,eAAC,IACG,CAAA,SAAAA,EAAA,IAAC,OAAA,CACG,EAAE,6PACF,KAAMD,IAAS,QAAU,UAAY,OAAA,CAAA,EAC7C,CAAA,CACJ,EAEaO,GAAiBP,GAA2BC,EAAA,IAAC,MAAA,CACtD,MAAM,6BAA6B,MAAO,GAAI,OAAQ,GACtD,QAAQ,cACR,eAAC,IACG,CAAA,SAAAA,EAAA,IAAC,OAAA,CACG,EAAE,gNACF,KAAMD,IAAS,QAAU,UAAY,OAAA,CAAA,EAC7C,CAAA,CACJ,EAEaQ,GAAeR,GAA2BC,EAAA,IAAC,MAAA,CACpD,MAAM,6BAA6B,MAAO,GAAI,OAAQ,GACtD,QAAQ,YACR,SAAAA,EAAA,IAAC,OAAA,CAAK,KAAMD,IAAS,QAAU,UAAY,QACrC,EAAE,4fAAA,CAA4f,CAAA,CACxgB,ECtCO,SAASS,GAAkB,CACI,eAAAC,EACA,KAAAC,EACA,cAAA9U,EACA,YAAAD,EACA,eAAAgV,EACA,gBAAAC,EACA,oBAAAC,EAAsB,GACtB,SAAAC,EAAW,GACX,oBAAAC,EACA,gBAAAC,CACJ,EAA2B,CAEzD,MAAMC,EAAYC,EAAAA,oBAEZ,CAACC,EAAuBC,CAAwB,EAAInV,WAAS,EAAK,EAElE,CAACoV,EAAoBC,CAAqB,EAAIrV,WAAS,EAAK,EAE5DsV,EAAkD3V,EAAc,IAAK4V,GACnE,OAAOA,GAAM,SACNA,EAAE,SACCA,CACjB,EAEKC,EAAanU,EAAAA,YAAY,IAAM,CAC3B,MAAAO,EAAOT,UAAQzB,CAAW,EAC1B+V,EAAoB,IAAI7B,EAAAA,kBAAkBhS,EAAM,YAAa,CAAE,KAAM,YAAa,EAElF8T,EAAWC,EAAA,uBAAuB/T,EAAM8S,EAAe,iBAAiB,EAE9E,GAAIgB,EAAS,MAAM,CAAC,EAAE,WAAaE,4BAA0B,UAAW,CAEpE,MAAMC,EAAmB,CACrB,gBAAiBH,EAAS,MAAM,CAAC,EACjC,QAASA,EAAS,OAAA,EAEI,IAAII,oBAAkBlU,CAAI,EAElC,kBAAkBiU,EAAkBJ,CAAiB,EAClE,KAAK,SAAUM,EAAgB,CAG5B,MAAMC,EAAmB,OAAO,OAAO,OAAO,yEAA8E,CAAC,EACvHC,EAAOH,EAAA,kBAAkB,WAAWC,EAAgBC,CAAgB,EACpEE,EAAuBN,EAAAA,0BAA0B,UAAUK,CAAI,EAE9D,OAAAP,EAAS,cAAcQ,CAAoB,CAAA,CAErD,CAAA,MAIL,QAAQ,KAAK,4BAA4B,CAC7C,EAED,CAACxB,EAAe,iBAAiB,CAAC,EAErC,SAASyB,GAAiB,CAClB,IAAAC,EACJ,GAAI1B,EAAe,MAAQ,KAAa,OAAA0B,EAClC,MAAAC,EAAe,CAAC,4BAA6B,8BAA8B,EACjF,OAAI3B,EAAe,oBACXA,EAAe,kBAAkB,OAAS,8BAC1CA,EAAe,kBAAkB,OAAS,+BAC1C0B,EAEQnC,EAAA,KAAAD,WAAA,CAAA,SAAA,CAACD,EAAAA,IAAA,MAAA,CAAI,UAAU,MACX,SAAAA,EAAA,IAACuC,EAAA,UAAA,CACG,MAAO,4BACP,MAAO,gGAAA,CAAA,EACf,EACC5W,GACGqU,EAAA,IAAC,MAAI,CAAA,UAAU,MACX,SAAAA,EAAA,IAAC,IAAA,CAAE,KAAM,+CAA+CrU,EAAY,QAAQ,SAAS,4BAClF,IAAI,sBACJ,OAAO,SACN,SAAAqU,EAAA,IAACwC,EAAA,OAAA,CAAO,QAAQ,OACR,MAAM,QAAQ,SAAA,6BAAA,CAEtB,CAAA,CAAA,EAER,CACR,CAAA,CAAA,EACG7B,EAAe,kBAAkB,OAAS,uBACrC0B,EAAArC,EAAA,IAAC,MAAI,CAAA,UAAU,MACvB,SAAAA,EAAA,IAACuC,EAAA,UAAA,CACG,MAAO,kBACP,MAAO,0GAAA,CACf,CAAA,CAAA,EACQD,EAAa,SAAS3B,EAAe,kBAAkB,IAAI,IAC/DA,EAAe,kBAAkB,OAAS,mCAC/Bc,IAGXY,EAAArC,EAAAA,IAAC,OAAI,UAAU,MACX,eAACuC,EAAU,UAAA,CAAA,MAAO5B,EAAe,iBAAkB,CAAA,CACvD,CAAA,IAGL0B,CACX,CAEI,IAAAI,EACA/B,EACgB+B,EAAAzC,EAAA,IAAC,MAAA,CAAI,IAAKU,EACL,MAAO,CACH,OAAQ,OACR,MAAO,OACP,UAAW,SACf,EACA,IAAK,MAAA,CAAA,EAE1B+B,QAAiBC,cAAW,CAAA,CAAA,EAG5B,IAAAC,EACJ,OAAI3B,IACI,OAAOA,GAAoB,SACP2B,EAAA3B,EACbA,aAA2B,MAClC2B,EAAoB3B,EAAgB,QAEhB2B,EAAA,sGAMxBzC,EAAA,KAAC,MAAA,CACG,UAAU,wEACV,SAAA,CAACF,EAAAA,IAAA,MAAA,CAAI,GAAG,WAAY,CAAA,EACpBE,EAAA,KAAC,MAAA,CACG,UAAU,kDAEV,SAAA,CAACF,EAAA,IAAA,MAAA,CAAI,UAAU,oBACV,SACLyC,EAAA,EAECE,SACI,MAAI,CAAA,UAAU,MACX,SAAC3C,EAAA,IAAAuC,EAAA,UAAA,CAAU,MAAOI,CAAA,CAAkB,CACxC,CAAA,EAEHP,EAAe,EAEd,CAACjB,GAAyB,CAACE,GAAwBnB,EAAA,KAAA,MAAA,CAAI,UAAW,cAE/D,SAAA,CAAA0C,GAAuBjC,EAAgBY,EAAuBN,EAAU,KAAMH,CAAQ,EAEtFS,EAAsB,SAAS,UAAU,GACtCvB,EAAA,IAAC6C,EAAA,CACG,SAAA/B,EACA,KAAM,iBACN,KAAMd,EAAAA,IAAC8C,EAAAA,UAAU,CAAA,KAAM,EAAG,CAAA,EAC1B,QAAS,IAAM1B,EAAyB,EAAI,CAAA,CAAE,EAErDG,EAAsB,SAAS,OAAO,GACnCvB,EAAA,IAAC6C,EAAA,CACG,SAAA/B,EACA,KAAM,eACN,KAAMd,EAAAA,IAAC+C,EAAAA,UAAU,CAAA,KAAM,EAAG,CAAA,EAC1B,QAAS,IAAMzB,EAAsB,EAAI,CAAA,CAAE,EAElDC,EAAsB,SAAS,WAAW,GACvCvB,EAAA,IAAC6C,EAAA,CACG,SAAA/B,EACA,KAAM,qBACN,KAAMd,EAAA,IAACgD,EAAA,kBAAA,CACH,KAAM,EAAA,CAAG,EACb,QAASrC,EAAe,cAAA,CAAe,EAE9CF,GACGT,EAAA,IAACwC,EAAA,OAAA,CACG,UAAW,WACX,QAAS,OACT,SAAA1B,EACA,QAASH,EAAe,UAAW,SAAA,YAAA,CAEvC,CAAA,EAGR,EAECQ,GAAyBnB,EAAA,IAACiD,GAAA,CACvB,eAAAtC,EACA,QAAS,IAAMS,EAAyB,EAAK,EAC7C,KAAMH,EAAU,KAChB,gBAAAL,EACA,oBAAAC,CAAA,CACJ,EAECQ,GAAsBrB,EAAA,IAACkD,GAAA,CACpB,eAAAvC,EACA,QAAS,IAAMW,EAAsB,EAAK,CAAA,CAC9C,EAEC,CAACH,GAAyB,CAACE,GAAsBN,CAAA,CAAA,CAEtD,CAAA,CAAA,CAAA,CAGZ,CAEO,SAAS8B,EAAY,CACI,KAAAM,EACA,QAAAC,EACA,KAAAC,EACA,SAAAvC,CACJ,EAKzB,CAEK,OAAAd,EAAAA,IAAC,MAAI,CAAA,UAAU,aACX,SAAAA,EAAA,IAACwC,EAAA,OAAA,CACG,UAAU,SACV,QAAQ,WACR,SAAA1B,EACA,QAAAsC,EACA,SAAAlD,EAAA,KAAC,MAAA,CACG,UAAU,iDACV,SAAA,CAAAF,EAAA,IAAC,MAAA,CACG,UAAU,sDACT,SAAAmD,CAAA,CACL,EACCnD,EAAA,IAAA,MAAA,CAAI,UAAU,6BAA8B,SAAKqD,EAAA,CAAA,CAAA,CACtD,CAAA,CAER,CAAA,CAAA,CAER,CAEA,SAASH,GAAe,CACI,QAAAI,EACA,eAAA3C,CACJ,EAGrB,CACcf,KAEb,KAAM,CAACjQ,EAAO4T,CAAQ,EAAItX,EAAiB,SAAA,EACrC,CAACuX,EAAMC,CAAO,EAAIxX,EAAiB,SAAA,EACnC,CAACyX,EAAeC,CAAgB,EAAI1X,WAAS,EAAK,EAElD2X,EAAe,MAAOC,GAAe,CACvCA,EAAM,eAAe,EAEjBL,GAAQ7C,EAAe,oBACvBgD,EAAiB,EAAK,EAEtBhD,EAAe,mBAAmB,QAAQ6C,CAAI,EAAE,MAAOxV,GAAqB,CACpEA,EAAE,OAAS,kCACX2V,EAAiB,EAAI,CACzB,CACH,GAEGhU,GACegR,EAAA,WAAWhR,EAAO,OAAO,iBAAiB,CAEjE,EAIA,OAAAuQ,EAAA,KAAC,OAAK,CAAA,SAAU0D,EACX,SAAA,CACGF,GAAA1D,EAAAA,IAAC,OAAI,UAAU,MACX,eAACuC,EAAU,UAAA,CAAA,MAAO,4BAA4B,CAClD,CAAA,EAEJvC,EAAAA,IAAC,MAAI,CAAA,GAAIL,EAAuB,CAAA,EAEhCO,EAAAA,KAAC,MAAI,CAAA,UAAW,sBACZ,SAAA,CAAAF,EAAA,IAAC8D,EAAA,WAAA,CACG,QAASR,EACT,SAAAtD,EAAAA,IAAC+D,EAAAA,cAAc,CAAA,UAAU,SAAS,CAAA,CAAA,CACtC,EACA/D,EAAAA,IAAC,MAAI,CAAA,UAAU,WACX,SAAAA,EAAA,IAACgE,EAAA,WAAA,CAAW,MAAO,SACP,QAAS,YAAc,SAAA,gCAAA,CAAA,EACvC,EACAhE,EAAA,IAACiE,EAAA,UAAA,CAAU,YAAY,GACZ,MAAOtU,GAAS,GAChB,SAAU,GAAQA,IAAUgR,EAAe,aAAeA,EAAe,qBACzE,KAAK,QACL,SAAWkD,GAAUN,EAASM,EAAM,OAAO,KAAK,CAAA,CAAE,EAC5D,GAAQlU,GAASgR,EAAe,qBAEzBT,OAAAD,EAAAA,SAAA,CAAA,SAAA,CAACD,EAAAA,IAAA,MAAA,CAAI,UAAU,gBACX,SAAAA,EAAA,IAACgE,EAAA,WAAA,CAAW,MAAO,SACP,QAAS,YAAc,SAAA,oCAAA,CAAA,EACvC,EACAhE,EAAA,IAACiE,EAAA,UAAA,CAAU,YAAY,GACZ,MAAOT,GAAQ,GACf,KAAK,OACL,SAAWK,GAAUJ,EAAQI,EAAM,OAAO,KAAK,CAAA,CAAE,CAAA,EAChE,EAGJ3D,EAAAA,KAAC,MAAI,CAAA,UAAU,uCAEV,SAAA,CAAAS,EAAe,aACXX,EAAAA,IAAAkE,EAAA,iBAAA,CAAiB,UAAU,MAAM,KAAM,QAAQ,EAGnDlE,EAAA,IAAAwC,EAAA,OAAA,CAAO,KAAK,SACR,SACL,KAAA,CAAA,EACJ,CAAA,EAEJ,CACJ,CAAA,CAAA,CAER,CAIA,SAASS,GAAU,CACI,QAAAK,EACA,eAAA3C,EACA,KAAAZ,EACA,gBAAAa,EACA,oBAAAC,CACJ,EAMhB,CAEO,MAAAsD,EAAchX,SAAgC,IAAI,EAElD,CAACiX,EAAYC,CAAa,EAAIpY,WAAwB,OAAO,EAC7D,CAAC2C,EAAO0V,CAAQ,EAAIrY,EAAiB,SAAA,EACrC,CAAC4C,EAAU0V,CAAW,EAAItY,EAAiB,SAAA,EAC3C,CAACuY,EAA8BC,CAA+B,EAAIxY,EAA+B,SAAA,EAEvG2B,EAAAA,UAAU,IAAM,EACPwW,IAAe,YAAcA,IAAe,iBAAmBD,EAAY,SAC5EA,EAAY,QAAQ,OACxB,EACD,CAACC,CAAU,CAAC,EAEfxW,EAAAA,UAAU,IAAM,CACZ,GAAI,CAAC,SAAU,OACT,MAAA8W,EAAeb,GAAe,CAC5BA,EAAM,UAAY,IACVP,GACZ,EAEK,gBAAA,iBAAiB,UAAWoB,EAAa,EAAK,EAChD,IAAM,CACA,SAAA,oBAAoB,UAAWA,EAAa,EAAK,CAAA,CAC9D,EACD,CAACpB,CAAO,CAAC,EAEZ,SAASqB,GAAmB,CACpB/V,IACA+R,EAAe,2BAA2B/R,CAAK,EAAE,KAAMgW,GAAuB,CAC1EH,EAAgCG,EAAmB,OAAY/I,GAAAA,IAAM,UAAU,CAAC,CAAA,CACnF,EACDwI,EAAc,UAAU,EAEhC,CAEA,SAASQ,GAAsB,CACvBjW,GAASC,GACM8R,EAAA,mBAAmB/R,EAAOC,CAAQ,CAEzD,CAEA,SAASiW,GAAqB,CACtBlW,GAASC,GACM8R,EAAA,+BAA+B/R,EAAOC,CAAQ,CAErE,CAEA,MAAMkW,EAAgB,IAAM,CACpBX,IAAe,QACPd,IACDc,IAAe,YAAcA,IAAe,eACnDC,EAAc,OAAO,EAErBI,EAAgC,MAAS,CAC7C,EAGEb,EAAgBC,GAAe,CACjCA,EAAM,eAAe,EACjBO,IAAe,QACEO,IACVP,IAAe,WACFS,IACbT,IAAe,gBACHU,GACvB,EAGEE,EAAQZ,IAAe,eACvB,4DACCA,IAAe,WAAa,6BAA+B,0BAG9D,OAAApE,EAAA,IAAC,OAAA,CACG,UAAW,SACX,SAAU4D,EAEV,SAAA1D,EAAA,KAAC,MAAI,CAAA,UAAW,2CACZ,SAAA,CAAAF,EAAA,IAAC8D,EAAA,WAAA,CACG,QAASiB,EACT,SAAA/E,EAAAA,IAAC+D,EAAAA,cAAc,CAAA,UAAU,SAAS,CAAA,CAAA,CACtC,EAEC/D,EAAA,IAAA,MAAA,CACI,SAAeoE,IAAA,gBAAkBxD,EACtC,EAEAZ,EAAA,IAACgE,EAAA,WAAA,CACG,UAAW,GAAGI,IAAe,gBAAkBvD,EAAsB,SAAW,MAAM,GACtF,QAAS,YAAc,SAAAmE,CAAA,CAAM,GAE/BZ,IAAe,SAAWA,IAAe,iBAAmBpE,EAAA,IAACiE,EAAA,UAAA,CAAU,YAAY,QAAQ,UAAS,GAC7B,MAAOrV,GAAS,GAChB,SAAU+R,EAAe,YACzB,KAAK,QACL,SAAWkD,GAAUS,EAAST,EAAM,OAAO,KAAK,CAAA,CAAE,EAE3H7D,EAAA,IAAC,MAAA,CACG,UAAW,GAAGoE,IAAe,YAAeA,IAAe,gBAAkB,CAACvD,EAAuB,QAAU,QAAQ,GACvH,SAAAb,EAAA,IAACiE,EAAA,UAAA,CAAU,YAAY,WACZ,MAAOpV,GAAY,GACnB,SAAU8R,EAAe,YACzB,SAAUwD,EACV,KAAK,WACL,SAAWN,GAAUU,EAAYV,EAAM,OAAO,KAAK,CAAA,CAAE,CAAA,CACpE,EAEA3D,EAAA,KAAC,MAAA,CACG,UAAW,GAAGkE,IAAe,gBAAkBvD,EAAsB,SAAW,MAAM,8CAErF,SAAA,CAAAF,EAAe,aACXX,EAAAA,IAAAkE,EAAA,iBAAA,CAAiB,UAAU,MAAM,KAAM,QAAQ,EAGnDE,IAAe,SAAWpE,EAAAA,IAACwC,EAAO,OAAA,CAAA,QAAQ,WAAW,QAAS,IAAM6B,EAAc,cAAc,EAAG,SAEpG,UAAA,CAAA,EAEArE,EAAAA,IAACwC,EAAAA,OAAO,CAAA,KAAK,SACR,SAAA4B,IAAe,eAAiB,iBAAgD,OACrF,CAAA,CAAA,CAAA,CACJ,EAECI,GAAgCA,EAA6B,OAAS,GAClEtE,EAAAA,KAAA,MAAA,CAAI,UAAW,0BACZ,SAAA,CAAAA,OAAC,MACG,CAAA,SAAA,CAACF,EAAA,IAAAgE,EAAA,WAAA,CAAW,QAAS,YAAa,SAElC,8BAAA,EACA9D,EAAAA,KAAC8D,EAAAA,WAAW,CAAA,QAAS,QAAS,SAAA,CAAA,kDAEHpV,CAAA,EAC3B,CAAA,EACJ,EAEAoR,EAAAA,IAAC,OACI,SAAgCwE,GAAA5B,GAAuBjC,EAAgB6D,EAA8BzE,EAAM,EAAK,EACrH,CAAA,EACJ,CAAA,EAER,CAAA,CAAA,CAIZ,CAEA,SAAS6C,GAAuBjC,EAAwCsE,EAAqBlF,EAAwBe,EAAmB,CACpI,OACKZ,EAAA,KAAAD,WAAA,CAAA,SAAA,CAAUgF,EAAA,SAAS,YAAY,GAAKjF,EAAA,IAAC6C,EAAA,CAClC,SAAA/B,EACA,KAAM,sBACN,KAAMhB,GAAe,EACrB,QAASa,EAAe,WAAA,CAAY,EAEvCsE,EAAU,SAAS,eAAe,GAAKjF,EAAA,IAAC6C,EAAA,CACrC,SAAA/B,EACA,KAAM,yBACN,KAAMR,GAAcP,CAAI,EACxB,QAASY,EAAe,cAAA,CAAe,EAE1CsE,EAAU,SAAS,WAAW,GAAKjF,EAAA,IAAC6C,EAAA,CACjC,SAAA/B,EACA,KAAM,qBACN,KAAMX,GAAUJ,CAAI,EACpB,QAASY,EAAe,UAAA,CAAW,EAEtCsE,EAAU,SAAS,YAAY,GAAKjF,EAAA,IAAC6C,EAAA,CAClC,SAAA/B,EACA,KAAM,sBACN,KAAMV,GAAWL,CAAI,EACrB,QAASY,EAAe,WAAA,CAAY,EAEvCsE,EAAU,SAAS,cAAc,GAAKjF,EAAA,IAAC6C,EAAA,CACpC,SAAA/B,EACA,KAAM,wBACN,KAAMT,GAAaN,CAAI,EACvB,QAASY,EAAe,aAAA,CAAc,EAEzCsE,EAAU,SAAS,aAAa,GAAKjF,EAAA,IAAC6C,EAAA,CACnC,SAAA/B,EACA,KAAM,uBACN,KAAMP,GAAYR,CAAI,EACtB,QAASY,EAAe,YAAA,CAAa,CAC7C,CAAA,CAAA,CACJ,CCtkBA,MAAMuE,GAA0B,CAC5B5W,EAAAA,mBAAmB,WACvB,EAmBO,SAAS6W,GAAmB,CACI,KAAAhT,EACA,KAAAuO,EACA,SAAA0E,EACA,mBAAAC,EACA,cAAAC,EACA,YAAAC,EACA,MAAAC,EACA,WAAAC,EACA,4BAAAlM,EACA,eAAAkH,EACA,cAAA7U,EAAgBsZ,GAChB,eAAAlT,EACA,eAAAE,EACA,gBAAAwT,EACA,eAAAC,EACA,OAAAC,EACA,SAAAC,EACA,mBAAAC,EACA,iBAAAC,EACA,gBAAiBC,EACjB,QAAAC,EACA,eAAAC,EACA,wBAAA1M,EACA,WAAA2M,EACA,uBAAA1M,EAAyB,EAC7B,EAA4B,CAK3D2M,yBAAuBjU,EAAMuO,CAAI,EAEjC,MAAM5K,GAAmDkQ,GAAuB,CAAC,GAC5E,IAAWK,IAAA,CACR,CAACA,EAAG,GAAG,EAAGA,CACZ,EAAA,EACD,OAAO,CAACzR,EAAGC,KAAO,CAAE,GAAGD,EAAG,GAAGC,IAAM,CAAE,CAAA,EAEpC,CACF,YAAAlJ,EACA,sBAAA2G,EACA,YAAAE,GACAT,GAAsB,CACtB,eAAAG,EACA,eAAAF,CAAA,CACH,EAKKsU,EAAiBC,EAAAA,yBAEjB,CACF,QAAA7a,GACA,iBAAA+H,GACA,MAAA1F,IACAsF,GAAY,CACZ,YAAA1H,EACA,QAAS+Z,CAAA,CACZ,EAKK/E,EAAyClV,GAA0B,CACrE,YAAAE,EACA,cAAAC,CAAA,CACH,EAKK4a,GAAwBC,EAAAA,wCAExBC,EAAoBpN,GAAqB,CAC3C,YAAA3N,EACA,4BAAA4N,EACA,wBAAAC,EACA,uBAAAC,CAAA,CACH,EAKKkN,EAAgBnW,GAAyB,CAC3C,YAAA7E,CAAA,CACH,EAKK,CACF,YAAAa,GACA,kBAAAoa,GACA,gBAAA5F,IACA6F,2BAAyB,CACzB,eAAAlG,EACA,cAAA2E,EACA,mBAAoBoB,EACpB,cAAAC,CAAA,CACH,EAEKG,GAAuBC,EAAAA,6BAA6B,CACtD,YAAAxB,EACA,MAAAC,EACA,SAAAK,EACA,mBAAAC,EACA,eAAAnF,EACA,WAAA8E,EACA,mBAAoBiB,CAAA,CACvB,EAEG,OAAApU,GAAyB,CAAC3G,GAAeD,GAClCsU,EAAA,IAAAC,EAAA,SAAA,CACH,SAACD,EAAA,IAAAgH,yBAAA,CAAA,CAAsB,CAC3B,CAAA,EAGAxU,EACOwN,EAAA,IAACiH,gBAAc,SAAYzU,CAAA,CAAA,EAIjCwN,EAAA,IAAAkH,mBAAA,CACG,SAAClH,EAAAA,IAAAmH,EAAA,uBAAA,CAAuB,MAAOb,EAE3B,SAAAtG,EAAA,IAACoH,EAAA,QAAA,CACG,eAAAzG,EACA,qBAAAmG,GACA,sBAAAN,GACA,eAAAb,EACA,mBAAoBe,EACpB,cAAAC,EACA,kBAAmB,CAAC,CAAE,OAAA/K,CAAA,IAAa,+CAA+CjQ,EAAY,QAAQ,SAAS,mBAAmBiQ,EAAO,IAAI,IAAIA,EAAO,EAAE,GAC1J,OAAAgK,EACA,iBAAAG,EACA,QAAAE,EACA,gBAAAnQ,EACC,SAAC,CAAA,CACI,QAAAuR,EACA,QAAA3b,CAAA,IACE,CAEA,IAAA4b,EACJ,GAAI5b,GAAWc,GACC8a,EAAAtH,EAAA,IAACgH,EAAuB,uBAAA,CAAA,KAAM,OAAQ,CAAA,MAC/C,CACH,MAAMO,EAAWjB,EAAe,OAAS,QAAUlB,EAAWA,EAAW1E,EACzE,GAAKkG,GAaGU,EAAApH,EAAA,KAACsH,EAAA,SAAA,CACG,KAAArV,EACA,KAAMoV,EACN,mBAAoB,CAChB,aAAclC,CAClB,EACA,eAAAa,EACA,SAAA,CAAAlG,EAAA,IAACyH,EAAA,iBAAA,CACG,SAAUtB,GAAY,QAAA,CAAS,QAClCuB,EAAW,YAAA,EAAA,CAAA,CAAA,CAAA,MAtBA,CACd,MAAAC,EAAgBxB,GAAY,WAAa3F,GAE3C8G,EAAAtH,EAAA,IAAC2H,EAAA,CACG,KAAMJ,EACN,eAAA9G,EACA,cAAe7U,GAAiBsZ,GAChC,YAAAvZ,EACA,eAAAgV,EACA,gBAAAK,EAAA,CAAA,CAAiC,CAiBjD,CAEO,OAAAsG,CACX,CAAA,CAAA,CAER,CAAA,CACJ,CAAA,CAER,CCzOA,eAAsBM,GAClB9Q,EACAwB,EACA4D,EAA6B,GAC7B2L,EACAC,EAAa,IACc,CAE3B,GAAID,IAAuBA,GAAsB,CAAA,IAAK,OAAS,EAAG,CAC9D,KAAM,CAACE,EAAa,GAAGC,CAAY,EAAIH,EACjCI,EAAY,MAAM1Q,UAAQF,EAAAA,MAAMjC,EAAA,WAAW0B,EAAWiR,CAAW,EAAGlR,EAAAA,MAAM,CAAC,CAAC,CAAC,EACnF,OAAO,QAAQ,IAAIoR,EAAU,KACxB,IAAK/S,GAAQ0S,GACV9Q,EACA5B,EAAI,IAAI,KAAO,IAAMoD,EACrB4D,EACA8L,EACA,KAAK,IAAI,KAAK,KAAKF,EAAa,CAAC,EAAG,CAAC,CAAA,CACxC,CAAC,EACD,KAAM3Y,GAAQA,EAAI,MAAM,CACjC,CAEA,MAAMiI,EAAIC,EAAA,MACN6E,EAAoBjC,EAAgB,gBAAAnD,EAAWwB,CAAc,EAAIlD,EAAA,WAAW0B,EAAWwB,CAAc,EACrGzB,EAAAA,MAAMiR,CAAU,CAAA,EACd3Y,EAAM,MAAMoI,UAAQH,CAAC,EAC3B,eAAQ,MAAM,gBAAiB8E,EAAmB9E,EAAGjI,EAAI,IAAI,EACtDA,EAAI,IACf,CClBA,eAAsB+Y,GAA4BpR,EAAsBwB,EAAwB4D,EAA4B2L,EAAmE,CACnL,QAAA,MAAM,iCAAkCvP,EAAgBuP,CAAkB,EAC5E,MAAAM,EAAYC,kCAAgC9P,CAAc,EAE1D9D,GADO,MAAMoT,GAAa9Q,EAAWqR,EAAWjM,EAAmB2L,CAAkB,GACzE,IAAI3S,GAAOA,EAAI,MAAM,EAAE,OAAO,OAAO,EAChD,OAAAmT,GAAoC/P,EAAgB9D,CAAI,CACnE,CAEsB,eAAA6T,GAAoC/P,EAAwB9D,EAAoD,CAC5H,MAAA2T,EAAYC,kCAAgC9P,CAAc,EAC1D7C,EAAa,MAAM6S,GAAAA,8BAA8B9T,EAAM+T,EAAO,EAC9D/S,EAAkBgT,wBAAqB/S,CAAU,EACjDgT,EAAkBN,EAAU,SAAS,GAAG,EAAIA,EAAU,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,EAAIA,EAC/E,MAAA,CACH,KAAMA,EACN,KAAMO,YAAUD,CAAe,EAC/B,WAAAhT,EACA,gBAAAD,CAAA,CAER,CAEA,eAAsBmT,GAAsBnU,EAAgB,CACjD,OAAA8T,GAAA,8BAA8B9T,EAAM+T,EAAO,CACtD,CAEA,SAASA,GAAQ5T,EAAsB,CACnC,OAAI,OAAOA,GAAU,SACV,SACF,OAAOA,GAAU,SACf,SACF,OAAOA,GAAU,UACf,UACF,MAAM,QAAQA,CAAK,EACjB,QACFA,aAAiBuI,EAAA,UACf,OACFvI,aAAiByI,EAAA,SACf,WACFzI,aAAiB0I,EAAA,kBACf,YACJ,KACX,CChDa,MAAAuL,GAA4BC,GAAmE,CACxG,GAAKA,EACE,MAAA,CAAChY,EAAcoJ,EAA0B4N,IAAiC,CACvE,MAAA/Q,EAAYC,eAAa8R,CAAe,EAC9C,OAAOX,GAA4BpR,EAAWjG,EAAMoJ,EAAiB4N,CAAkB,CAAA,CAE/F"}