(function(c,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("@firecms/core"),require("firebase/firestore")):typeof define=="function"&&define.amd?define(["exports","@firecms/core","firebase/firestore"],l):(c=typeof globalThis<"u"?globalThis:c||self,l(c["FireCMS schema inference"]={},c.core,c.firestore))})(this,function(c,l,j){"use strict";function E(r){if(!r)return;function e(i){return typeof i=="string"?i:i instanceof j.DocumentReference?i.path:void 0}const s=r.values.map(i=>e(i)).filter(i=>!!i).find(i=>i.includes("/"));if(!s)return;const n=s.substr(0,s.lastIndexOf("/"));return r.values.filter(i=>{const a=e(i);return a?a.startsWith(n):!1}).length>r.values.length/3*2?n:void 0}function p(r){if(!Array.isArray(r))return[];const e=r.map(t=>typeof t=="string"?{id:t,label:l.unslugify(t)}:null).filter(Boolean);return e.sort((t,s)=>t.label.localeCompare(s.label)),e}const P=[".jpg",".png",".webp",".gif"],S=[".mp3",".ogg",".opus",".aac"],F=[".avi",".mp4"],C=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function I({totalDocsCount:r,valuesResult:e}){let t={dataType:"string"};if(e){const s=e.values.length,n=Array.from(e.valuesCount.keys()).length,o={},i=e.values.filter(f=>typeof f=="string"&&f.toString().startsWith("http")).length>r/3*2;i&&(o.url=!0);const a=e.values.filter(f=>typeof f=="string"&&C.test(f)).length>r/3*2;a&&(o.email=!0);const u=e.values.filter(f=>typeof f=="string"&&f.length===28&&!f.includes(" ")).length>r/3*2;if(u&&(o.readOnly=!0),!a&&!i&&!u&&!i&&n<s/3){const f=p(Array.from(e.valuesCount.keys()));Object.keys(f).length>1&&(o.enumValues=f)}if(!a&&!i&&!u&&!i&&!o.enumValues){const f=M(e,r);f&&(o.storage={acceptedFiles:[f],storagePath:E(e)??"/"})}Object.keys(o).length>0&&(t={...t,...o,editable:!0})}return t}function M(r,e){const t=r.values.filter(i=>typeof i=="string"&&P.some(a=>i.toString().endsWith(a))).length>e/3*2,s=r.values.filter(i=>typeof i=="string"&&S.some(a=>i.toString().endsWith(a))).length>e/3*2,n=r.values.filter(i=>typeof i=="string"&&F.some(a=>i.toString().endsWith(a))).length>e/3*2;return t?"image/*":s?"audio/*":n?"video/*":!1}function V({totalDocsCount:r,valuesResult:e}){if(e){const t=e.values.length;if(r===t)return{required:!0}}}function z({totalDocsCount:r,valuesResult:e}){return{dataType:"reference",path:E(e)??"!!!FIX_ME!!!",editable:!0}}async function _(r,e){const t={},s={};return r&&r.forEach(n=>{n&&Object.entries(n).forEach(([o,i])=>{A(t,o,i,e),h(s,o,i,e)})}),T(r.length,t,s)}function w(r,e,t){const s={},n={};r&&r.forEach(a=>{m(e.dataType,s,a,t),h(n,"inferred_prop",a,t)});const o="enumValues"in e?l.resolveEnumValues(e.enumValues):void 0;if(o){const a=p(Array.from(n.inferred_prop.valuesCount.keys()));return{...e,enumValues:[...a,...o]}}const i=y("inferred_prop",r.length,e.dataType,s,n.inferred_prop);return l.mergeDeep(i,e)}function Z(r){function e(s){const n=s.toLowerCase();return n==="title"||n==="name"?3:n.includes("title")||n.includes("name")?2:n.includes("image")||n.includes("picture")?1:0}const t=Object.keys(r);return t.sort(),t.sort((s,n)=>e(n)-e(s)),t}function m(r,e,t,s){if(r==="map"){if(t){let n=e[r];n||(n={},e[r]=n),Object.entries(t).forEach(([o,i])=>{A(n,o,i,s)})}}else if(r==="array"){let n=e[r];if(n||(n={},e[r]=n),t&&Array.isArray(t)&&t.length>0){const o=x(t,s);n[o]?n[o]++:n[o]=1}}else e[r]?e[r]++:e[r]=1}function A(r,e,t,s){let n=r[e];if(n||(n={},r[e]=n),t!=null){const o=s(t);m(o,n,t,s)}}function h(r,e,t,s){const n=s(t);let o=r[e];if(o||(o={values:[],valuesCount:new Map},r[e]=o),n==="map"){let i=o.map;i||(i={},o.map=i),t&&Object.entries(t).forEach(([a,u])=>h(i,a,u,s))}else n==="array"?Array.isArray(t)&&t.forEach(i=>{o.values.push(i),o.valuesCount.set(i,(o.valuesCount.get(i)??0)+1)}):t&&(o.values.push(t),o.valuesCount.set(t,(o.valuesCount.get(t)??0)+1))}function g(r){let e=0;return Object.entries(r).forEach(([t,s])=>{let n=0;t==="map"?n=O(s):t==="array"?n=g(s):n=s,n>e&&(e=n)}),e}function O(r){return Object.entries(r).map(([e,t])=>g(t)).reduce((e,t)=>Math.max(e,t),0)}function d(r){let e=-1,t="string";return Object.entries(r).forEach(([s,n])=>{let o;s==="map"?o=O(n):s==="array"?o=g(n):o=n,o>e&&(e=o,t=s)}),t}function y(r,e,t,s,n){let o;r&&(o=N(r.toLowerCase()));let i;if(t==="map"){W(s)&&(i={dataType:"map",name:o,keyValue:!0,properties:{}});const u=T(e,s.map,n?n.mapValues:void 0);i={dataType:"map",name:o,properties:u}}else if(t==="array"){const a=s.array,u=d(a),f=y(r,e,u,a,n);i={dataType:"array",name:o,of:f}}if(!i){const a={name:r,totalDocsCount:e,valuesResult:n};t==="string"?i=I(a):t==="reference"?i=z(a):i={dataType:t},o&&(i.name=o);const u=V(a);u&&(i.validation=u)}return{...i,editable:!0}}function T(r,e,t){const s={};return Object.entries(e).forEach(([n,o])=>{const i=d(o);s[n]=y(n,r,i,o,t?t[n]:void 0)}),s}function b(r){let e=0;return Object.entries(r).forEach(([t,s])=>{typeof s=="object"?e=Math.max(e,b(s)):e=Math.max(e,s)}),e}function x(r,e){let t={};return r.forEach(s=>{m(e(s),t,s,e)}),d(t)}function W(r){const e=b(r);let t=0;return Object.entries(r.map??{}).forEach(([s,n])=>{b(n)<e/3&&t++}),t/Object.entries(r.map??{}).length>.5}function N(r){return r.replace(/[_\-]+/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}function k(r){return typeof r=="string"?"string":typeof r=="number"?"number":typeof r=="boolean"?"boolean":Array.isArray(r)?"array":typeof r=="object"?"map":"string"}c.buildEntityPropertiesFromData=_,c.buildPropertiesOrder=Z,c.buildPropertyFromData=w,c.extractEnumFromValues=p,c.inferTypeFromValue=k,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
