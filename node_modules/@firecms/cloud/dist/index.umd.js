(function(h,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("react"),require("firebase/firestore"),require("firebase/storage"),require("@firecms/user_management"),require("react/jsx-runtime"),require("firebase/auth"),require("@firecms/core"),require("@firecms/ui"),require("@firecms/collection_editor"),require("react-router-dom"),require("@firecms/data_enhancement"),require("@firecms/firebase"),require("@firecms/data_import_export"),require("@firecms/collection_editor_firebase")):typeof define=="function"&&define.amd?define(["exports","react","firebase/firestore","firebase/storage","@firecms/user_management","react/jsx-runtime","firebase/auth","@firecms/core","@firecms/ui","@firecms/collection_editor","react-router-dom","@firecms/data_enhancement","@firecms/firebase","@firecms/data_import_export","@firecms/collection_editor_firebase"],a):(h=typeof globalThis<"u"?globalThis:h||self,a(h.FireCMS={},h.React,h.firestore,h.storage,h.user_management,h.jsxRuntime,h.auth,h.core,h.ui,h.collection_editor,h.reactRouterDom,h.data_enhancement,h.firebase,h.data_import_export,h.collection_editor_firebase))})(this,function(h,a,m,oe,X,e,V,S,s,ee,te,tr,q,sr,nr){"use strict";const ie=["Admin"];function be({user:r,userManagement:o,collection:t}){const n={createCollections:!1,editCollections:!1,deleteCollections:!1},i=r&&o.users.find(l=>l.uid===r.uid),c=i?X.getUserRoles(o.roles,i):void 0;return!i||!c?n:c.map(l=>({createCollections:l.isAdmin||l.config?.createCollections===!0,editCollections:l.isAdmin||l.config?.editCollections===!0||l.config?.editCollections==="own"&&t?.ownerId===i?.uid,deleteCollections:l.isAdmin||l.config?.deleteCollections===!0||l.config?.deleteCollections==="own"&&t?.ownerId===i?.uid})).reduce(ar,n)}const ar=(r,o)=>({createCollections:r.createCollections||o.createCollections,editCollections:r.editCollections||o.editCollections,deleteCollections:r.deleteCollections||o.deleteCollections}),lr=(r,o)=>r.length===o.length&&r.every(t=>o.includes(t)),ce=[{path:"users",name:"CMS Users",group:"Admin",icon:"face"},{path:"roles",name:"Roles",group:"Admin",icon:"gpp_good"},{path:"settings",name:"Project settings",group:"Admin",icon:"settings"}];function xe(r,o){if(!o)return;const t=ir(o),n=new Date(t.exp*1e3);localStorage.setItem(`auth_token::${r}`,JSON.stringify({token:o,expiry:n}))}function Pe(r){const o=localStorage.getItem(`auth_token::${r}`);if(o){const t=JSON.parse(o);if(t.expiry=new Date(t.expiry),t.expiry>new Date)return t.token}}function Ne(){for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);o?.startsWith("auth_token::")&&localStorage.removeItem(o)}}function ir(r){if(!r)throw new Error("No JWT token");const t=r.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(t).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}function se(r,o=10){if(!/^#([0-9A-Fa-f]{3}){1,2}$/.test(r))throw new Error("Invalid color format");let t=r.substring(1).split("");t.length===3&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]);let n=parseInt(t[0]+t[1],16),i=parseInt(t[2]+t[3],16),c=parseInt(t[4]+t[5],16);return n=Math.floor(n*(1-o/100)),i=Math.floor(i*(1-o/100)),c=Math.floor(c*(1-o/100)),"#"+(n<16?"0":"")+n.toString(16)+(i<16?"0":"")+i.toString(16)+(c<16?"0":"")+c.toString(16)}function de(r,o=10){if(!/^#([0-9A-Fa-f]{3}){1,2}$/.test(r))throw new Error("Invalid color format");let t=r.substring(1).split("");t.length===3&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]);const n=parseInt(t[0]+t[1],16),i=parseInt(t[2]+t[3],16),c=parseInt(t[4]+t[5],16),l=o/100;return`rgba(${n}, ${i}, ${c}, ${l})`}const Z="#0070F4",ne="#FF5B79";function Ee({backendFirebaseApp:r,projectId:o}){const[t,n]=a.useState(Z),[i,c]=a.useState(ne),l=o?`projects/${o}`:void 0,[g,C]=a.useState(),[f,u]=a.useState(),[N,w]=a.useState(!1),[d,y]=a.useState(),[v,p]=a.useState(),[_,U]=a.useState(),[b,E]=a.useState(),[k,D]=a.useState(!1),[A,O]=a.useState(),[B,$]=a.useState(),T=a.useRef(o),[j,P]=a.useState();a.useEffect(()=>{if(!r)throw Error("useBuildProjectConfig Firebase not initialised");const M=m.getFirestore(r);if(!(!M||!l))return m.onSnapshot(m.doc(M,l),{next:L=>{P(L.get("logo"))},error:L=>{console.error(L)}})},[l]),a.useEffect(()=>{t?(document.documentElement.style.setProperty("--fcms-primary",t),document.documentElement.style.setProperty("--fcms-primary-dark",se(t,10)),document.documentElement.style.setProperty("--fcms-primary-bg",de(t,10))):(document.documentElement.style.setProperty("--fcms-primary",se(Z,10)),document.documentElement.style.setProperty("--fcms-primary-dark",se(Z,10)),document.documentElement.style.setProperty("--fcms-primary-bg",de(Z,10))),i?document.documentElement.style.setProperty("--fcms-secondary",i):document.documentElement.style.setProperty("--fcms-secondary",ne)},[t,i]);const x=a.useCallback(async M=>{if(!r)throw Error("useBuildProjectConfig Firebase not initialised");const L=m.getFirestore(r);if(!L||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");const re=oe.getStorage(r);if(!re)throw Error("useFirestoreConfigurationPersistence Storage not initialised");const we=await cr(re,{file:M,path:`${l}/images`}),R=await oe.getDownloadURL(we);m.setDoc(m.doc(L,l),{logo:R},{merge:!0})},[l]),F=a.useCallback(async M=>{if(!r)throw Error("useBuildProjectConfig Firebase not initialised");const L=m.getFirestore(r);if(!L||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");return m.setDoc(m.doc(L,l),{name:M},{merge:!0})},[l]),I=a.useCallback(async M=>{if(!r)throw Error("useBuildProjectConfig Firebase not initialised");const L=m.getFirestore(r);if(!L||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");return m.setDoc(m.doc(L,l),{local_text_search_enabled:M},{merge:!0})},[l]);a.useEffect(()=>{if(!o||!r){w(!1);return}T.current!==o&&(w(!0),y(void 0),T.current=void 0);const M=m.getFirestore(r);return m.onSnapshot(m.doc(M,"projects",o),{next:L=>{console.log("Project config snapshot",L.data()),C(L.get("name"));const re=L.get("subscription_plan")??"free";u(re),D(L.get("local_text_search_enabled")??!1),re==="free"?(n(Z),c(ne)):(n(L.get("primary_color")??Z),c(L.get("secondary_color")??ne));const we=L.get("current_app_config_revision");O(we),$(L.get("creation_type"));const R=L.get("firebase_config");T.current=o,R==="loading"?(w(!0),y(void 0),p(!1)):typeof R=="object"?(y(R),w(!1),p(!1)):R===void 0&&(w(!1),p(!0)),E(void 0),U(!L.get("service_account"))},error:L=>{console.error(L),E(L),w(!1)}})},[r,o]);const z=f==="free"?3:void 0,or=f!=="free",J=f!=="free",le=f!=="free",Dr=f!=="free",Ir=a.useCallback(async M=>{if(!r)throw Error("useBuildProjectConfig Firebase not initialised");const L=m.getFirestore(r);if(!L||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");n(M),J&&m.setDoc(m.doc(L,l),{primary_color:M},{merge:!0})},[l,J]),Mr=a.useCallback(async M=>{if(!r)throw Error("useBuildProjectConfig Firebase not initialised");const L=m.getFirestore(r);if(!L||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");c(M),J&&m.setDoc(m.doc(L,l),{secondary_color:M},{merge:!0})},[l,J]);return{projectId:o,logo:J?j:void 0,uploadLogo:x,updateProjectName:F,projectName:g,subscriptionPlan:T.current!==o?void 0:f,customizationRevision:T.current!==o?void 0:A,configLoading:T.current!==o||N,configError:T.current!==o?void 0:b,clientFirebaseConfig:T.current!==o?void 0:d,clientFirebaseMissing:T.current!==o?void 0:v,serviceAccountMissing:T.current!==o?void 0:_,usersLimit:z,canEditRoles:or,canModifyTheme:J,canExport:le,canUseLocalTextSearch:Dr,localTextSearchEnabled:k,updateLocalTextSearchEnabled:I,primaryColor:t,secondaryColor:i,updatePrimaryColor:Ir,updateSecondaryColor:Mr}}const cr=(r,{file:o,fileName:t,path:n,metadata:i})=>{const c=t??o.name;return console.debug("Uploading file",c,o,n,i),oe.uploadBytes(oe.ref(r,`${n}/${c}`),o,i).then(l=>l.ref)},he=a.createContext({}),H=()=>a.useContext(he);function Te({children:r,config:o}){return e.jsx(he.Provider,{value:o,children:r})}function _e({projectsApi:r,firebaseApp:o,projectId:t,onUserChanged:n}){const[i,c]=a.useState(!1),[l,g]=a.useState(!1),[C,f]=a.useState(void 0),u=a.useCallback(async(N=!1)=>{if(console.debug("Checking delegated login",{skipCache:N,projectId:t}),o&&t){f(void 0),g(!0),c(!1);try{let w=!1,d=!N&&Pe(t);if(d)console.debug("Using cached token",t),w=!0;else try{console.debug("Delegating login",t),d=await r.doDelegatedLogin(t)}catch(v){console.error("Error delegating login",JSON.stringify(v)),f(v)}if(!d)return;const y=V.getAuth(o);V.signInWithCustomToken(y,d).then(async v=>{console.log("Delegated user signed in",v),n?.(v.user),c(!0);try{xe(t,d)}catch(p){console.error("Error caching token",p)}}).catch(async v=>{if(w)return await u(!0);console.error("Error signing in with delegated token",v),c(!1),f(v)}).finally(()=>g(!1))}catch(w){c(!1),f(w),g(!1)}}},[o,t]);return a.useEffect(()=>{u()},[u]),{loginSuccessful:i,delegatedLoginLoading:l,delegatedLoginError:C}}const ge=a.createContext({});function Fe({children:r,...o}){return e.jsx(ge.Provider,{value:o,children:r})}function W(){return a.useContext(ge)}const Le="subscriptions",fe="products",ue="customers",Ue="checkout_sessions";function pe({firebaseApp:r}){const{backendUid:o}=W(),t=a.useRef(),[n,i]=a.useState(),[c,l]=a.useState(!0),[g,C]=a.useState(),[f,u]=a.useState([]),[N,w]=a.useState(!0),[d,y]=a.useState();a.useEffect(()=>{r&&(t.current=m.getFirestore(r))},[r]),a.useEffect(()=>{const b=t.current;if(!b)return;const E=m.collection(b,fe);return m.onSnapshot(m.query(E,m.where("active","==",!0)),{next:async k=>{const D=await Promise.all(k.docs.map(async A=>{const O=m.collection(b,fe,A.id,"prices");return m.getDocs(m.query(O,m.where("active","==",!0))).then(async B=>{const $=B.docs.map(T=>({...T.data(),id:T.id}));return $.sort((T,j)=>(j.default?1:0)-(T.default?1:0)),{id:A.id,...A.data(),prices:$}})}));C(void 0),i(D),l(!1)},error:k=>{C(k)}})},[t]);function v(b){return m.getDoc(b).then(E=>{if(E.exists())return{id:E.id,...E.data()??{}}})}function p(b){return m.getDoc(b).then(E=>{if(E.exists())return{id:E.id,...E.data()??{}}})}return a.useEffect(()=>{const b=t.current;if(!b||!o)return;const E=m.collection(b,ue,o,Le);return m.onSnapshot(m.query(E,m.where("ended_at","==",null)),{next:async k=>{const D=(await Promise.all(k.docs.map(async A=>{const[O,B]=await Promise.all([v(A.data().price),p(A.data().product)]);if(!O){console.warn("Price not found for subscription",A.id);return}return{id:A.id,...A.data(),price:O,product:B}}))).filter(Boolean);w(!1),y(void 0),u(D)},error:k=>{y(k)}})},[t,o]),{products:n,subscribe:async(b,E,k,D)=>{const A=t.current;if(!A)throw new Error("Firestore not initialized");if(!o)throw new Error("User not logged in");if(!D)throw new Error("subscription type not provided. Make sure to assign the metadata.type field in the Stripe dashboard to a product.");const O={price:E.id};E.recurring?.usage_type!=="metered"&&(O.quantity=1);const B={automatic_tax:!0,tax_id_collection:!0,collect_shipping_address:!1,allow_promotion_codes:!0,line_items:[O],success_url:`${window.location.origin}${window.location.pathname}`,cancel_url:`${window.location.origin}${window.location.pathname}`,metadata:{projectId:b,type:D}};E.type==="one_time"&&(B.mode="payment",B.payment_method_types=["card","sepa_debit","sofort"]);const $=m.collection(A,ue,o,Ue),T=await m.addDoc($,B);return m.onSnapshot(T,j=>{const{error:P,url:x}=j.data();k(x,P)})},getSubscriptionsForProject:b=>f?.filter(E=>E.metadata.projectId===b),activeSubscriptions:f,productsLoading:c,productsLoadingError:g,activeSubscriptionsLoading:N,activeSubscriptionsLoadingError:d}}class ae extends Error{code;projectId;data;constructor(o,t,n,i){super(o),this.code=t,this.projectId=n,this.data=i}}async function Y(r,o){const t=await r.json();if(r.ok)return t.data;throw r.status===409?new ae(t.message??t.error??"This already exists.",t.code??"already-exists",o):new ae(t.message??t.error,t.code,o,t.data)}const ye={};function ke(r,o){async function t(d,y,v,p){const _=await o();return fetch(r+"/projects",{method:"POST",headers:G({firebaseAccessToken:_,googleAccessToken:y,serviceAccount:v}),body:JSON.stringify({projectId:d,creationType:p,serviceAccount:v??null})}).then(async U=>Y(U,d).then(b=>!0))}async function n(d){const y=await o();return fetch(r+`/projects/${d}/firebase_webapp`,{method:"POST",headers:G({firebaseAccessToken:y}),body:JSON.stringify({projectId:d})}).then(async v=>Y(v,d).then(p=>!0))}async function i(d,y,v){const p=await o();return fetch(r+`/projects/${d}/firestore_security_rules`,{method:"PATCH",headers:G({firebaseAccessToken:p,googleAccessToken:y,serviceAccount:v})}).then(async _=>Y(_,d).then(U=>!0))}async function c(d,y){const v=await o(),p={...y,roles:y.roles.map(_=>_.id),updated_on:new Date};return fetch(r+"/projects/"+d+"/users",{method:"POST",headers:G({firebaseAccessToken:v}),body:JSON.stringify(p)}).then(_=>Y(_,d))}async function l(d,y,v){const p=await o(),_={...v,roles:v.roles.map(U=>U.id),updated_on:new Date};return console.log("Updating user",_),fetch(r+"/projects/"+d+"/users/"+y,{method:"PATCH",headers:G({firebaseAccessToken:p}),body:JSON.stringify(_)}).then(U=>Y(U,d))}async function g(d,y){const v=await o();return fetch(r+"/projects/"+d+"/users/"+y,{method:"DELETE",headers:G({firebaseAccessToken:v})}).then(p=>Y(p,d))}async function C(d,y,v,p=10){if(ye[d])return ye[d];const _=await o();async function U(){return await new Promise(b=>setTimeout(b,5e3)),console.debug("Retrying getRootCollections",p),C(d,y,v,p-1)}return fetch(r+"/projects/"+d+"/firestore_root_collections",{method:"GET",headers:G({firebaseAccessToken:_,googleAccessToken:y,serviceAccount:v})}).then(async b=>{if(b.status>=300)return await U();const E=await Y(b,d);return ye[d]=E,E}).catch(async b=>{if(p>0)return await U();throw b})}async function f(d,y){const v=await o();return fetch(r+"/projects/"+y+"/service_accounts",{method:"POST",headers:G({firebaseAccessToken:v,googleAccessToken:d})}).then(async p=>{if(p.status===409)throw Error("The service account already exists for this project.");return(await p.json()).user})}async function u(d){const y=await o();return fetch(r+"/projects/"+d+"/delegated_login",{method:"POST",headers:G({firebaseAccessToken:y}),body:JSON.stringify({projectId:d})}).then(async v=>{const p=await v.json();if(!v.ok)throw new ae(p.message,p.code,d,p.data);return p.data})}async function N(d){const y=await o();return fetch(`${r}/customer/stripe_portal_link?return_url=${encodeURIComponent(window.location.href)}&project_id=${d}`,{method:"GET",headers:G({firebaseAccessToken:y})}).then(async v=>(await v.json()).url)}async function w(d,y){return`${r}/projects/${d}/app_config/${y}/${await o()}/remoteEntry.js`}return{createNewFireCMSProject:t,createFirebaseWebapp:n,addSecurityRules:i,createServiceAccount:f,createNewUser:c,updateUser:l,deleteUser:g,getRootCollections:C,doDelegatedLogin:u,getStripePortalLink:N,getRemoteConfigUrl:w}}function G({firebaseAccessToken:r,googleAccessToken:o,serviceAccount:t}){const n={"Content-Type":"application/json"};return r&&(n.Authorization=`Bearer ${r}`),o&&(n["x-admin-authorization"]=`Bearer ${o}`),t&&(n["x-admin-service-account"]=`Bearer ${btoa(JSON.stringify(t))}`),n}const Ae=["https://www.googleapis.com/auth/cloud-platform"];function je({backendApiHost:r,backendFirebaseApp:o,onUserChange:t}){const[n,i]=a.useState(void 0),[c,l]=a.useState(!0),[g,C]=a.useState(dr()),[f,u]=a.useState(),[N,w]=a.useState(!1),[d,y]=a.useState(),[v,p]=a.useState(!0),[_,U]=a.useState(!1),[b,E]=a.useState(),[k,D]=a.useState(),A=a.useRef(),O=a.useCallback(async x=>{t?.(x),i(x)},[]);a.useEffect(()=>{_&&d&&Promise.all(d.map(x=>j(x))).then(x=>{D(x.filter(Boolean))})},[d,_]),a.useEffect(()=>{o&&(A.current=m.getFirestore(o))},[o]),a.useEffect(()=>{if(!o)return;const x=V.getAuth(o);return O(x.currentUser),V.onAuthStateChanged(x,F=>{l(!1),O(F)},F=>u(F))},[o,O]),a.useEffect(()=>{const x=A.current;if(x){if(!n){y(void 0),p(!1),U(!1);return}return m.onSnapshot(m.doc(x,"users",n.uid),{next:F=>{const I=F.get("projects")??[];E(void 0),y(I),U(!0),p(!1)},error:F=>{E(F),p(!1)}})}},[n]);const B=a.useCallback(x=>{if(!o)throw Error("useBuildFireCMSBackend googleLogin error");const F=new V.GoogleAuthProvider;F.setCustomParameters({access_type:"offline"}),x&&Ae.forEach(z=>F.addScope(z));const I=V.getAuth(o);return V.signInWithPopup(I,F).then(z=>{if(x){const J=JSON.parse(z._tokenResponse.rawUserInfo).granted_scopes.split(" ");if(x&&!J.includes(Ae[0]))w(!0);else{const le=V.GoogleAuthProvider.credentialFromResult(z);C(le),me(le),w(!1)}}return z.user}).catch(z=>(u(z),null))},[o]),$=a.useCallback(()=>{const x=V.getAuth(o);Ne(),V.signOut(x).then(F=>{i(null),C(null),u(null),me(null)})},[o]),T=a.useCallback(()=>{if(!n)throw Error("Trying to get Firebase token ");return n.getIdToken()},[n]),j=a.useCallback(x=>{const F=A.current;if(!F)throw Error("useFireCMSProjectsRepository error");return m.getDoc(m.doc(F,"projects",x)).then(I=>I.exists()?{projectId:I.id,...I.data()}:null).catch(I=>(console.error("Error getting project:",I),null))},[]),P=ke(r,T);return{backendApiHost:r,user:n??null,signOut:$,googleLogin:B,getBackendAuthToken:T,googleCredential:g,availableProjectIds:d,availableProjectsLoaded:_,availableProjectsLoading:v,availableProjectsError:b,permissionsNotGrantedError:N,authLoading:c,authProviderError:f,backendFirebaseApp:o,backendUid:n?.uid,projectsApi:P,getProject:j,projects:k}}function me(r){if(!r){localStorage.removeItem("googleCredential");return}const o=JSON.stringify({created_on:new Date,credential:r.toJSON()});localStorage.setItem("googleCredential",o)}function dr(){try{const r=localStorage.getItem("googleCredential");if(!r)return null;const o=JSON.parse(r),t=V.OAuthCredential.fromJSON(o.credential),n=new Date(o.created_on);return new Date().getTime()-n.getTime()>1e3*60*60?(console.debug("Google credential expired credential expired"),me(null),null):t}catch(r){return console.error(r),null}}function Oe({backendFirebaseApp:r,projectId:o,projectsApi:t,usersLimit:n,canEditRoles:i,fireCMSBackend:c}){const l=o?`projects/${o}`:void 0,g=a.useRef(),[C,f]=a.useState(!0),[u,N]=a.useState(!0),[w,d]=a.useState([]),[y,v]=a.useState([]),p=y.map(P=>({...P,roles:w.filter(x=>P.roles.includes(x.id))})),[_,U]=a.useState(),[b,E]=a.useState();a.useEffect(()=>{r&&(g.current=m.getFirestore(r))},[r]),a.useEffect(()=>{const P=g.current;if(!(!P||!l))return m.onSnapshot(m.collection(P,l,"roles"),{next:x=>{U(void 0);try{const F=gr(x.docs);d(F)}catch(F){U(F)}f(!1)},error:x=>{U(x),f(!1)}})},[l]),a.useEffect(()=>{const P=g.current;if(!(!P||!l))return m.onSnapshot(m.collection(P,l,"users"),{next:x=>{E(void 0);try{const F=hr(x.docs);v(F)}catch(F){E(F)}N(!1)},error:x=>{E(x),N(!1)}})},[l]);const k=a.useCallback(async P=>{if(!g.current||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");console.debug("Persisting",P);const{uid:F,...I}=P;return F?t.updateUser(o,F,P):t.createNewUser(o,P)},[l,o]),D=a.useCallback(P=>{const x=g.current;if(!x||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");console.debug("Persisting",P);const{id:F,...I}=P,z=m.doc(x,l,"roles",F);return m.setDoc(z,I,{merge:!0})},[l]),A=a.useCallback(async P=>{if(!g.current||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");console.debug("Deleting",P);const{uid:F}=P;return t.deleteUser(o,F)},[l]),O=a.useCallback(P=>{const x=g.current;if(!x||!l)throw Error("useFirestoreConfigurationPersistence Firestore not initialised");console.debug("Deleting",P);const{id:F}=P,I=m.doc(x,l,"roles",F);return m.deleteDoc(I)},[l]),B=p.find(P=>P.email.toLowerCase()===c.user?.email?.toLowerCase()),$=a.useCallback(({collection:P})=>X.resolveUserRolePermissions({collection:P,user:B??null}),[B?.uid]),T=p.map(P=>P.uid),j=a.useCallback(P=>{if(!p)throw Error("Users not loaded");return p.find(F=>F.email?.toLowerCase()===P?.email?.toLowerCase())?.roles},[T]);return{allowDefaultRolesCreation:!1,includeCollectionConfigPermissions:!0,loading:C||u,roles:w,users:p,saveUser:k,saveRole:D,defineRolesFor:j,deleteUser:A,deleteRole:O,usersLimit:n,canEditRoles:i===void 0?!0:i,collectionPermissions:$}}const hr=r=>r.map(o=>({uid:o.id,...o.data(),created_on:o.data()?.created_on?.toDate(),updated_on:o.data()?.updated_on?.toDate()})),gr=r=>r.map(o=>({id:o.id,...o.data()}));function De({hovered:r,drawerOpen:o,closeDrawer:t}){const n=te.useNavigate(),i=S.useNavigationController(),c=ee.useCollectionEditorController(),{user:l}=S.useAuthController(),[g,C]=a.useState(!1),f=r&&!o&&!g;if(!i.topLevelNavigation)throw Error("Navigation not ready in Drawer");const{navigationEntries:u,groups:N}=i.topLevelNavigation,w=a.useCallback(d=>{if(!o)return e.jsx("div",{style:{height:16}});const y=d&&ie.includes(d),v=c.configPermissions({user:l}).createCollections&&!y;return e.jsxs("div",{className:"flex flex-row items-center pt-8 pl-8 pr-0 pb-2",children:[e.jsx(s.Typography,{variant:"caption",color:"secondary",className:"flex-grow font-medium",children:d?d.toUpperCase():"Views".toUpperCase()}),v&&e.jsx(s.Tooltip,{title:d?`Create new collection in ${d}`:"Create new collection",children:e.jsx(s.Button,{size:"small",variant:"text",onClick:()=>{c?.createCollection({initialValues:{group:d},parentCollectionIds:[],redirect:!0,sourceClick:"drawer_new_collection"})},children:e.jsx(s.AddIcon,{size:"small"})})})]})},[c,o]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-grow overflow-scroll no-scrollbar",children:N.map(d=>e.jsxs(a.Fragment,{children:[w(d),Object.values(u).filter(y=>y.group===d).map((y,v)=>e.jsx(S.DrawerNavigationItem,{icon:e.jsx(S.IconForView,{collectionOrView:y.collection??y.view}),tooltipsOpen:f,drawerOpen:o,url:y.url,name:y.name},`navigation_${v}`))]},`drawer_group_${d}`))}),e.jsx(s.Menu,{open:g,onOpenChange:C,trigger:e.jsxs(s.IconButton,{shape:"square",className:"m-4 text-gray-900 dark:text-white w-fit",children:[e.jsx(s.Tooltip,{title:"Admin",open:f,side:"right",sideOffset:28,children:e.jsx(s.MoreVertIcon,{})}),o&&e.jsx("div",{className:s.cn(o?"opacity-100":"opacity-0 hidden","mx-4 font-inherit text-inherit"),children:"ADMIN"})]}),children:ce.map((d,y)=>e.jsxs(s.MenuItem,{onClick:v=>{v.preventDefault(),n(d.path)},children:[e.jsx(S.IconForView,{collectionOrView:d}),d.name]},`navigation_${y}`))})]})}function Ie({projectId:r,context:o}){return e.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[e.jsx(s.Typography,{variant:"h6",children:"Subscription required"}),e.jsx(s.Typography,{children:"You have finished your free usage quota."}),e.jsx(s.Typography,{children:"Please upgrade plans to continue using this feature in this project"}),e.jsx(s.Button,{color:"primary",component:"a",rel:"noopener noreferrer",target:"_blank",href:`/p/${r}/settings`,children:"Upgrade plan"})]})}function Me({}){return e.jsxs(e.Fragment,{children:[e.jsx(s.Typography,{variant:"h4",children:"Security rules"}),e.jsxs(s.Typography,{children:["FireCMS uses Firebase security rules to restrict access to data. When creating a new user through FireCMS, the custom claim ",e.jsx(s.Typography,{className:"inline-block bg-white dark:bg-gray-950 px-1 rounded-md",component:"pre",children:"fireCMSUser"})," is added to the user in the client project. By adding the following security rules to your project, you ensure FireCMS users can access data through FireCMS."]}),e.jsx(s.Paper,{children:e.jsx(s.Typography,{component:"pre",className:"m-0 p-4 text-sm font-mono",children:`match /{document=**} {
    allow read, write: if request.auth.token.fireCMSUser;
}`})}),e.jsxs(s.Typography,{variant:"caption",children:["This rules restrict access to data to FireCMS users only, but does ",e.jsx("strong",{children:"not"})," enforce the permissions at the database level."]}),e.jsx(s.Typography,{variant:"caption",children:"The permissions are enforced in the frontend though, which will work fine for most users. If you need to enforce the permissions at the database level, you can modify these security rules yourself to suit your needs. The roles assigned to a user are set as a custom claim in the Firebase auth token, so you can use them in your security rules."})]})}function Be({error:r,fireCMSBackend:o,onFixed:t,onRetry:n}){const{code:i,message:c,projectId:l}=r;return i==="service-account-missing"&&l&&o?e.jsx(fr,{projectId:l,fireCMSBackend:o,onFixed:t}):i==="user-has-to-accept-googles-terms-of-service"&&l?e.jsx(ur,{projectId:l,onFixed:t}):i==="user-has-no-previous-firebase-projects"&&l?e.jsx(pr,{projectId:l,onFixed:t}):i==="firecms-user-not-found"?e.jsxs("div",{className:"flex flex-col items-center space-y-2 py-4",children:[e.jsx(s.Typography,{children:"The user trying to log in is not registered in the client project."}),e.jsxs(s.Typography,{children:["Make sure the user exists in the client project and try again. If the problem persists, reach us at ",e.jsx("a",{href:"mailto:hello@firecms.co?subject=FireCMS%20login%20error",rel:"noopener noreferrer",target:"_blank",children:"hello@firecms.co "}),", or in our ",e.jsx("a",{rel:"noopener noreferrer",target:"_blank",href:"https://discord.gg/fxy7xsQm3m",children:"Discord channel"}),"."]})]}):i==="service-account-missing-permissions"?e.jsx(yr,{missingPermissions:r.data?.missingPermissions}):e.jsxs("div",{className:"flex flex-col items-center space-y-2 py-4",children:[e.jsx(s.Typography,{className:"text-center text-red-300",children:c}),n&&e.jsx(s.Button,{variant:"outlined",color:"error",onClick:()=>n(),children:"Retry"})]})}function fr({fireCMSBackend:r,projectId:o,onFixed:t}){const{projectsApi:n}=W(),i=S.useSnackbarController(),[c,l]=a.useState(!1),[g,C]=a.useState(!1),f=async()=>{if(!r.googleCredential?.accessToken)throw new Error("SassMissingServiceAccountErrorView: No access token found");return l(!0),n.createServiceAccount(r.googleCredential.accessToken,o).finally(()=>l(!1))};a.useEffect(()=>{g&&r.googleCredential?.accessToken&&(f().then(()=>{i.open({type:"success",message:"Service account created successfully"}),t&&t()}).catch(N=>{i.open({type:"error",message:"Service account creation error: "+N.message})}),C(!1))},[g,r.googleCredential?.accessToken]);const u=async()=>{r.googleCredential?.accessToken?await f():(C(!0),r.googleLogin(!0))};return e.jsxs("div",{className:"flex flex-col items-center space-y-2 py-4",children:[e.jsx(s.Typography,{color:"error",children:"Service account missing"}),e.jsx(s.LoadingButton,{variant:"outlined",color:"error",onClick:u,loading:c,startIcon:e.jsx(s.BuildIcon,{}),children:"Fix"})]})}function ur({projectId:r,onFixed:o}){return e.jsxs("div",{className:"flex flex-col items-center space-y-2 py-4",children:[e.jsx(s.Typography,{color:"error",children:"You need to accept Google's terms of service before you can use this service."}),e.jsxs(s.Typography,{color:"error",children:["You can do so by visiting the following link:",e.jsx("a",{rel:"noopener noreferrer",target:"_blank",href:"https://console.cloud.google.com/welcome?project="+r,children:`https://console.cloud.google.com/welcome?project=${r}`})]}),e.jsx(s.Button,{variant:"outlined",color:"error",onClick:o,startIcon:e.jsx(s.BuildIcon,{}),children:"I have accepted the terms"})]})}function pr({projectId:r,onFixed:o}){return e.jsxs("div",{className:"flex flex-col items-center space-y-2 py-4",children:[e.jsx(s.Typography,{color:"error",children:"You need to accept Firebase's terms of service before you can use this service."}),e.jsxs(s.Typography,{color:"error",children:["You can do so by visiting the following link:",e.jsx("a",{rel:"noopener noreferrer",target:"_blank",href:"https://console.firebase.google.com/",children:"https://console.firebase.google.com/"})]}),e.jsx(s.Button,{variant:"outlined",color:"error",onClick:o,startIcon:e.jsx(s.BuildIcon,{}),children:"I have accepted the terms"})]})}function yr(r){return e.jsxs("div",{className:"flex flex-col space-y-2 py-4",children:[e.jsx(s.Typography,{color:"error",children:"Missing permissions"}),r.missingPermissions&&e.jsxs(e.Fragment,{children:[e.jsx(s.Typography,{variant:"body2",children:"This service account is missing the following permissions:"}),e.jsx(s.Typography,{variant:"caption",component:"ul",children:r.missingPermissions.map(o=>e.jsx("li",{children:e.jsx("code",{children:o})},o))})]})]})}function K(r){return r.currency==="usd"?new Intl.NumberFormat("en-US",{style:"currency",currency:r.currency}).format(r.unit_amount/100)+" user/"+r.interval:new Intl.NumberFormat("es-ES",{style:"currency",currency:r.currency}).format(r.unit_amount/100)+" user/"+r.interval}function $e(r){return r.status==="active"?"Active":r.status==="trialing"?"Trialing":r.status==="past_due"?"Past due":r.status==="canceled"?"Canceled":r.status==="unpaid"?"Unpaid":r.status==="incomplete"?"Incomplete":r.status==="incomplete_expired"?"Incomplete expired":"Unknown"}function Ve(r){switch(r){case"free":return"Free";case"cloud_plus":return"Plus";case"cloud_pro":return"Pro"}}function Ce({subscriptionPlan:r}){const o=Ve(r);return e.jsx(s.Chip,{className:"uppercase font-medium",colorScheme:"tealDarker",size:"small",children:o+" plan"})}function Se({product:r,includePriceSelect:o=!0,includePriceLabel:t=!0,largePriceLabel:n=!1,subscribe:i,projectId:c}){const[l,g]=a.useState(),[C,f]=a.useState(),u=r.prices;if(a.useEffect(()=>{u.length>0&&f(u[0])},[u]),r.metadata.type!=="cloud_pro"&&r.metadata.type!=="cloud_plus")throw new Error("Error: Unmapped product type in ProductView");const N=Ve(r.metadata.type),w=u?.length>1?e.jsx(e.Fragment,{children:e.jsx(s.Select,{size:"small",invisible:!0,padding:!1,onChange:p=>{f(u.find(_=>_.id===p.target.value))},position:"item-aligned",renderValue:p=>{const _=u.find(U=>U.id===p);return _?n?e.jsx("span",{className:"ml-4 mb-4 text-2xl font-bold text-primary text-center my-8",children:K(_)}):e.jsx(s.Chip,{children:_?K(_):""}):null},value:C?.id??"",children:u&&u.map(p=>e.jsx(s.SelectItem,{value:p.id,children:K(p)},p.id))})}):u?n?e.jsx("span",{className:"ml-4 mb-4 text-2xl font-bold text-primary text-center my-8",children:K(u[0])}):e.jsx(s.Chip,{size:"small",children:K(u[0])}):null,[d,y]=a.useState(!1),v=()=>{if(!(!c||C===void 0))return y(!0),i(c,C,(p,_)=>{!p&&!_||(_&&g(_),p&&typeof window<"u"&&window.open(p,"_blank"),y(!1))},r.metadata.type)};return e.jsxs(e.Fragment,{children:[o&&e.jsxs(e.Fragment,{children:[t&&e.jsxs("div",{className:"my-2 flex items-center gap-2",children:["You can upgrade your project for ",w]}),!t&&w]}),e.jsxs(s.LoadingButton,{variant:"filled",loading:d,onClick:v,startIcon:e.jsx(s.RocketLaunchIcon,{}),children:["Upgrade to ",N]}),l&&e.jsx(s.Alert,{color:"error",className:"my-4",children:l.message})]})}function ze({includePriceSelect:r,includePriceLabel:o,largePriceLabel:t}){const{backendFirebaseApp:n}=W(),{subscriptionPlan:i,projectId:c}=H();if(!i)throw new Error("No subscription plan");const{products:l,subscribe:g,getSubscriptionsForProject:C}=pe({firebaseApp:n}),f=l?.find(u=>u.metadata?.type==="cloud_plus");return f?e.jsx(Se,{includePriceSelect:r,includePriceLabel:o,largePriceLabel:t,product:f,projectId:c,subscribe:g}):e.jsx(s.LoadingButton,{variant:"filled",loading:!0,startIcon:e.jsx(s.RocketLaunchIcon,{}),children:"Upgrade to PLUS"})}function qe({open:r,onClose:o}){return S.useNavigationController(),te.useNavigate(),e.jsxs(s.Dialog,{fullScreen:!0,open:r,onOpenChange:t=>t?void 0:o(),children:[e.jsx(s.DialogContent,{fullHeight:!0,children:e.jsx(Ge,{})}),e.jsx(s.IconButton,{className:"absolute top-4 right-4",onClick:o,children:e.jsx(s.CloseIcon,{})})]})}function Ge(){const r=e.jsxs("div",{className:"h-full max-w-sm p-6 border border-solid border-gray-200 rounded-lg shadow dark:border-gray-700 flex flex-col",children:[e.jsx("h3",{className:"text-2xl md:text-4xl font-bold text-center text-gray-800 dark:text-gray-200 uppercase my-4",children:"Free"}),e.jsxs("div",{className:"grow",children:[e.jsx("p",{className:"text-lg mb-4 text-center font-semibold",children:"Try FireCMS and upgrade to a paid plan when you need more features."}),e.jsxs("ul",{children:[e.jsx("li",{className:"ml-8 list-disc",children:"Unlimited projects"}),e.jsx("li",{className:"ml-8 list-disc",children:"Unlimited collections"}),e.jsx("li",{className:"ml-8 list-disc",children:"All available form fields"}),e.jsx("li",{className:"ml-8 list-disc",children:"Schema editor and data inference"}),e.jsx("li",{className:"ml-8 list-disc",children:"Advanced data import and export"}),e.jsx("li",{className:"ml-8 list-disc",children:"Default roles"}),e.jsx("li",{className:"ml-8 list-disc",children:"3 users"})]})]}),e.jsx("div",{className:"text-center mt-4 text-gray-600 dark:text-gray-400 w-full",children:e.jsx("span",{className:"text-2xl font-bold ",children:"€0 user/month"})})]}),o=e.jsxs("div",{className:"h-full max-w-sm p-6 rounded-lg flex flex-col outline-none ring-2 ring-primary ring-opacity-75 ring-offset-2 ring-offset-transparent",children:[e.jsx("h3",{className:"text-2xl md:text-4xl font-bold text-center dark:text-primary text-primary uppercase my-4",children:"Plus"}),e.jsxs("div",{className:"grow",children:[e.jsx("p",{className:"text-lg mb-4 text-center font-semibold",children:"Perfect for startups"}),e.jsxs("ul",{children:[e.jsx("li",{className:"ml-8 list-disc",children:"Everything in the free tier"}),e.jsx("li",{className:"ml-8 list-disc",children:"Local text search"}),e.jsx("li",{className:"ml-8 list-disc",children:"Custom fields and custom views"}),e.jsx("li",{className:"ml-8 list-disc",children:"Unlimited users and roles"}),e.jsx("li",{className:"ml-8 list-disc",children:"Unlimited data export"}),e.jsx("li",{className:"ml-8 list-disc",children:"Theme and logo customization"}),e.jsx("li",{className:"ml-8 list-disc",children:"Custom user roles"}),e.jsx("li",{className:"ml-8 list-disc",children:"GPT-4 content generation"})]})]}),e.jsx("div",{className:"flex flex-col gap-4 items-center justify-center mt-8",children:e.jsx(ze,{includePriceSelect:!0,includePriceLabel:!1,largePriceLabel:!0})})]}),t=e.jsxs("div",{className:"h-full max-w-sm p-6 border border-solid border-gray-200 rounded-lg shadow dark:border-gray-700 flex flex-col",children:[e.jsx("h3",{className:"text-2xl md:text-4xl font-bold text-center text-gray-800 dark:text-gray-200 uppercase my-4",children:"Pro"}),e.jsxs("div",{className:"grow",children:[e.jsx("p",{className:"text-lg mb-4 text-center font-semibold",children:"Perfect for agencies and larger organizations"}),e.jsxs("ul",{children:[e.jsx("li",{className:"ml-8 list-disc",children:"Everything in PLUS"}),e.jsx("li",{className:"ml-8 list-disc",children:"Self-hosted"}),e.jsx("li",{className:"ml-8 list-disc",children:"SAML SSO"}),e.jsx("li",{className:"ml-8 list-disc",children:"Custom domain"}),e.jsx("li",{className:"ml-8 list-disc",children:"Full CMS components customization"}),e.jsx("li",{className:"ml-8 list-disc",children:"Priority support"}),e.jsx("li",{className:"ml-8 list-disc",children:"Roadmap prioritization"})]})]}),e.jsx("div",{className:"text-center mt-4 text-primary w-full",children:e.jsx(s.Button,{component:"a",size:"large",variant:"outlined",href:"https://firecms.co/pro",rel:"noopener noreferrer",target:"_blank",children:"More info"})})]});return e.jsx("div",{className:"overflow-auto my-auto",children:e.jsxs(s.Container,{className:"flex flex-col gap-4 p-8 m-auto",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold my-4 text-center",children:"Full no-code/low-code solution"}),e.jsxs("p",{children:[e.jsx("strong",{children:"FireCMS Cloud"})," offers a complete, end-to-end solution for businesses that require the highest level of support and security. With dedicated hosting, advanced features, and expert support, you will have everything you need to take your project to the next level."]}),e.jsxs("div",{className:"flex flex-col items-center lg:grid lg:grid-cols-3 gap-4 mt-8 w-full mx-auto",children:[r,o,t]})]})})}function He(){return e.jsxs(s.Typography,{variant:"caption",className:"mt-4",children:["You will be redirected to ",e.jsx("b",{children:"Stripe"})," to manage the subscription. You will be charged every month per the maximum concurrent of users. You can cancel your subscription at any time, and enjoy the benefits until the end of the current billing period."]})}function We({uid:r}){const{backendFirebaseApp:o}=W(),{subscriptionPlan:t,projectId:n}=H();if(!t)throw new Error("No subscription plan");S.useBrowserTitleAndIcon("Plans");const{products:i,subscribe:c,getSubscriptionsForProject:l}=pe({firebaseApp:o}),g=l(n),C=g===void 0||i===void 0,u=(i??[]).filter(w=>w.metadata?.type==="cloud_plus"||w.metadata?.type==="cloud_pro").find(w=>w.metadata?.type==="cloud_plus"),N=g.find(w=>w.product.metadata?.type==="cloud_plus");return e.jsxs("div",{className:"relative",children:[C&&e.jsx("div",{className:"absolute w-full h-full flex items-center justify-center",children:e.jsx(s.CircularProgress,{})}),e.jsxs("div",{className:s.cn("grid grid-cols-12 gap-4 items-center",C?"collapse":""),children:[e.jsxs("div",{className:"col-span-12 md:col-span-7 flex flex-col gap-2",children:[e.jsx(s.Typography,{variant:"h4",className:"mt-4 mb-2",children:"Subscription Plan"}),e.jsxs(s.Typography,{variant:"subtitle1",className:"my-2",children:["This project is on the ",e.jsx(Ce,{subscriptionPlan:t})]}),t!=="cloud_plus"&&u&&e.jsx(Se,{product:u,projectId:n,subscribe:c}),t==="cloud_plus"&&N&&e.jsx(mr,{subscription:N}),e.jsx(He,{})]}),e.jsx("div",{className:s.cn("col-span-12 md:col-span-5"),children:e.jsxs(s.Card,{className:"p-6 bg-amber-200 dark:bg-amber-700 border-amber-300 dark:border-amber-800 flex flex-col gap-4",children:[t==="free"&&e.jsxs("div",{children:["Upgrade to the ",e.jsx("b",{children:"PLUS"})," plan to enable the following features:"]}),t==="cloud_plus"&&e.jsxs("div",{children:["By being on the ",e.jsx("b",{children:"PLUS"})," plan you are enjoying the following features:"]}),e.jsxs("ul",{className:"px-2 text-base",children:[e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"Local text search"]}),e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"Unlimited users and roles"]}),e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"Theme and logo customization"]}),e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"Custom fields and custom views"]}),e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"Custom user roles"]}),e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"GPT-4 content generation"]}),e.jsxs("li",{className:"flex gap-4 items-center py-0.5",children:[e.jsx(s.AutoAwesomeIcon,{size:"small"}),"Unlimited data export"]})]})]})})]})]})}function mr({subscription:r}){const{getBackendAuthToken:o,projectsApi:t}=W(),n=$e(r),[i,c]=a.useState(void 0);return a.useEffect(()=>{i||t.getStripePortalLink(r.metadata.projectId).then(c)},[]),e.jsx("div",{className:"mt-2 mb-2",children:e.jsxs("div",{children:[e.jsxs(e.Fragment,{children:["The subscription is ",e.jsxs(s.Chip,{className:"inline",size:"tiny",colorScheme:n==="Active"?"greenDark":"orangeDark",children:[n," "]}),"."]}),r.current_period_end&&e.jsxs(e.Fragment,{children:[" The next payment is on ",r.current_period_end.toDate().toLocaleDateString(),". "]}),e.jsxs(e.Fragment,{children:["The current price is ",e.jsx(s.Chip,{size:"tiny",children:K(r.price)}),"per active user."]}),r.cancel_at&&e.jsxs(e.Fragment,{children:[" This subscription was ",e.jsx("b",{children:"cancelled"})," and will be active until ",r.cancel_at.toDate().toLocaleDateString(),". "]}),e.jsx("a",{className:" "+r.canceled_at?void 0:"text-text-secondary dark:text-text-secondary-dark",href:i,target:"_blank",rel:"noreferrer",children:r.canceled_at?" Renew subscription":" Cancel subscription"})]})},r.id)}function Q({message:r,showForPlans:o,includeCTA:t=!0}){const{subscriptionPlan:n}=H(),[i,c]=a.useState(!1);return!n||o&&!o.includes(n)?null:e.jsxs(e.Fragment,{children:[e.jsxs(s.Alert,{color:"info",className:"my-4",action:t&&e.jsx(s.Button,{className:"dark:!text-white dark:border-white dark:hover:bg-white dark:hover:!text-primary min-w-content",variant:"outlined",onClick:()=>c(!0),children:"More info"}),children:[e.jsxs("div",{children:["This project is currently in the ",e.jsx(Ce,{subscriptionPlan:n})]}),e.jsx("div",{children:r})]}),e.jsx(qe,{open:i,onClose:()=>c(!1)})]})}function Je({subscription:r}){const{projectsApi:o}=W(),t=$e(r),[n,i]=a.useState(void 0);return a.useEffect(()=>{n||o.getStripePortalLink(r.metadata.projectId).then(i)},[]),e.jsxs(s.Paper,{className:"mt-2 mb-2 p-4 -mx-2",children:[e.jsxs("div",{className:"flex",children:[e.jsx(s.Typography,{className:"flex-grow",variant:"h6",children:r.product.name}),e.jsx(s.Chip,{size:"small",colorScheme:t==="Active"?"greenDark":"orangeDark",children:t})]}),e.jsxs("div",{className:"flex mt-2 items-center",children:[e.jsxs("div",{className:"flex-grow flex flex-col items-start gap-2",children:[e.jsxs(s.Typography,{children:["Project: ",e.jsx("b",{children:r.metadata.projectId})]}),e.jsx(s.Chip,{size:"small",children:K(r.price)+" per active user"}),r.cancel_at&&e.jsxs(s.Typography,{variant:"caption",className:"text-secondary",children:["This subscription was ",e.jsx("b",{children:"cancelled"})," and will be active until ",r.cancel_at.toDate().toLocaleDateString()]})]}),e.jsx(s.Button,{component:"a",variant:"text",className:" "+r.canceled_at?void 0:"text-text-secondary dark:text-text-secondary-dark",size:"small",href:n,target:"_blank",rel:"noreferrer",children:r.canceled_at?"Renew":"Cancel"})]})]},r.id)}function Cr({activeSubscriptions:r}){return e.jsxs("div",{className:s.cn("my-8 border-t",s.defaultBorderMixin),children:[e.jsx(s.Typography,{className:"my-4 mt-8 font-medium",children:"Active Subscriptions".toUpperCase()}),r.map(o=>e.jsx(Je,{subscription:o},o.id))]})}function Ye(){const{backendUid:r}=W(),o=H();if(S.useBrowserTitleAndIcon("Project settings"),!r)throw new Error("No backendUid in ProjectSettings");return e.jsxs(s.CenteredView,{maxWidth:"6xl",className:"w-full flex flex-col gap-16 px-4 py-16",children:[e.jsx(We,{uid:r}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(s.Typography,{variant:"h4",className:"mt-4 mb-2",children:"Settings"}),e.jsx(Sr,{}),e.jsx("div",{className:"col-span-12",children:e.jsx(s.BooleanSwitchWithLabel,{position:"start",label:"Enable local text search",onValueChange:t=>o.updateLocalTextSearchEnabled(t),value:o.localTextSearchEnabled})}),e.jsx(br,{})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(Me,{})})]})}function Sr(){const r=H(),[o,t]=a.useState(r.projectName??""),n=a.useDeferredValue(o);return a.useEffect(()=>{n&&r.updateProjectName(n)},[n]),e.jsx(s.TextField,{value:o,label:"Project name",onChange:i=>t(i.target.value),onBlur:()=>{o&&r.updateProjectName(o)}})}function vr({onNoSubscriptionPlan:r}){const{logo:o,canModifyTheme:t,uploadLogo:n}=H(),i=S.useSnackbarController(),c=async g=>{if(!t){r();return}g.length&&n(g[0])},l=(g,C)=>{if(!t)r();else for(const f of g)for(const u of f.errors)i.open({type:"error",message:`Error uploading file: ${u.message}`})};return e.jsxs(s.FileUpload,{accept:{"*/image":[]},maxSize:2048*1024,onFilesAdded:c,onFilesRejected:l,uploadDescription:"Drag and drop your logo here",children:[o&&e.jsx("img",{className:"w-40 h-40 p-4",src:o}),!o&&e.jsx(S.FireCMSLogo,{className:"w-40 h-40 p-4"})]})}function wr(){const[r,o]=a.useState(!0);return e.jsxs("div",{className:"p-4 mt-4 flex flex-col items-center gap-2",children:[e.jsx(s.Typography,{variant:"label",children:"Sample theme components"}),e.jsxs("div",{className:"flex flex-row gap-4 items-center justify-center",children:[e.jsx(s.Button,{children:" Button "}),e.jsx(s.Button,{variant:"outlined",children:" Button "}),e.jsx(s.BooleanSwitch,{value:r,onValueChange:o}),e.jsx(s.Checkbox,{checked:r,onCheckedChange:o}),e.jsx(s.Checkbox,{color:"secondary",checked:r,onCheckedChange:o})]})]})}function br(){const[r,o]=a.useState(!1),t=H();return e.jsxs("div",{className:"flex flex-col gap-2 mt-4 mb-2",children:[e.jsx(s.Typography,{variant:"h4",className:"mt-4 mb-2",children:"Theme"}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-6",children:e.jsx(vr,{onNoSubscriptionPlan:()=>o(!0)})}),e.jsx("div",{className:"col-span-12 md:col-span-6",children:e.jsxs(s.Paper,{className:"flex flex-col gap-2 p-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 justify-center mt-4",children:[e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{type:"color",value:t.primaryColor,onChange:n=>(o(!0),t.updatePrimaryColor(n.target.value))}),e.jsx(s.Typography,{variant:"subtitle2",children:"Primary color"})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{type:"color",value:t.secondaryColor,onChange:n=>(o(!0),t.updateSecondaryColor(n.target.value))}),e.jsx(s.Typography,{variant:"subtitle2",children:"Secondary color"})]})]}),e.jsx(wr,{})]})})]}),r&&e.jsx(Q,{showForPlans:["free"],message:e.jsxs(e.Fragment,{children:["Upgrade to ",e.jsx("b",{children:"PLUS"})," to customise the logo and colors"]})})]})}const xr=()=>e.jsx(e.Fragment,{children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:32,height:32,children:[e.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJb",x1:"29.401",x2:"29.401",y1:"4.064",y2:"106.734",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#ff5840"}),e.jsx("stop",{offset:".007",stopColor:"#ff5840"}),e.jsx("stop",{offset:".989",stopColor:"#fa528c"}),e.jsx("stop",{offset:"1",stopColor:"#fa528c"})]}),e.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJb)",d:"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z"}),e.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJc",x1:"12.148",x2:"12.148",y1:".872",y2:"47.812",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#feaa53"}),e.jsx("stop",{offset:".612",stopColor:"#ffcd49"}),e.jsx("stop",{offset:"1",stopColor:"#ffde44"})]}),e.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJc)",d:"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z"}),e.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJd",x1:"29.76",x2:"29.76",y1:"32.149",y2:"-6.939",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#42d778"}),e.jsx("stop",{offset:".428",stopColor:"#3dca76"}),e.jsx("stop",{offset:"1",stopColor:"#34b171"})]}),e.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJd)",d:"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z"}),e.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJe",x1:"46",x2:"46",y1:"3.638",y2:"35.593",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#155cde"}),e.jsx("stop",{offset:".278",stopColor:"#1f7fe5"}),e.jsx("stop",{offset:".569",stopColor:"#279ceb"}),e.jsx("stop",{offset:".82",stopColor:"#2cafef"}),e.jsx("stop",{offset:"1",stopColor:"#2eb5f0"})]}),e.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJe)",d:`M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15
        c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z`})]})});function Ke({onClick:r,disabled:o}){return e.jsx("div",{className:"m-4 w-full",children:e.jsx(s.Button,{className:s.cn("w-full bg-white text-gray-900 dark:text-gray-900",o?"":"hover:text-white hover:dark:text-white"),style:{height:"40px",borderRadius:"4px",fontSize:"14px"},variant:"filled",disabled:o,onClick:r,children:e.jsxs("div",{className:s.cn("flex items-center justify-items-center "),children:[e.jsx("div",{className:"flex flex-col items-center justify-center w-4.5 h-4.5",children:xr()}),e.jsx("div",{className:s.cn("flex-grow pl-6 text-left"),children:"Sign in with Google"})]})})})}function Qe({fireCMSBackend:r,includeGoogleAdminScopes:o,includeLogo:t,includeGoogleDisclosure:n,includeTermsAndNewsLetter:i}){const[c,l]=a.useState(!1),[g,C]=a.useState(!1);function f(){let u;const N=["auth/popup-closed-by-user","auth/cancelled-popup-request"];return r.authProviderError&&!N.includes(r.authProviderError.code)&&(u=e.jsx("div",{className:"p-4",children:e.jsx(S.ErrorView,{error:r.authProviderError})})),u}return e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-full p-2",children:[t&&e.jsx("div",{className:"m-4",style:{width:"260px",height:"260px"},children:e.jsx(S.FireCMSLogo,{})}),t&&e.jsxs(s.Typography,{variant:"h4",color:"primary",className:"mb-4",children:["FireCMS ",e.jsx(s.Typography,{variant:"h4",component:"span",className:"text-blue-500",children:"CLOUD"})]}),f(),i&&e.jsxs(e.Fragment,{children:[e.jsx(s.BooleanSwitchWithLabel,{size:"small",invisible:!0,value:g,onValueChange:C,position:"start",label:e.jsx(s.Typography,{variant:"caption",color:"primary",children:"Join our newsletter. No spam, only important updates!"})}),e.jsx(s.BooleanSwitchWithLabel,{size:"small",invisible:!0,value:c,onValueChange:l,position:"start",label:e.jsxs(s.Typography,{variant:"caption",color:"primary",children:["By signing in you agree to our ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://firecms.co/policy/terms_conditions",children:"Terms and Conditions"})," and our ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://firecms.co/policy/privacy_policy",children:"Privacy policy"})]})})]}),e.jsx(Ke,{disabled:!c&&i,onClick:()=>{console.log("Google login"),r.googleLogin(o).then(u=>{g&&u?.email&&Pr(u.email)})}}),o&&r.permissionsNotGrantedError&&e.jsx(S.ErrorView,{error:"You need to grant additional permissions in order to manage your Google Cloud projects"}),n&&e.jsxs(s.Typography,{variant:"caption",children:["FireCMS Cloud use and transfer to any other app of information received from Google APIs will adhere to ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://developers.google.com/terms/api-services-user-data-policy#additional_requirements_for_specific_api_scopes",children:"Google API Services User Data Policy"}),", including the Limited Use requirements."]})]})}const Pr=r=>{fetch("https://api-drplyi3b6q-ey.a.run.app/notifications/newsletter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email_address:r,source:"saas"})}).then(t=>{console.log("newsletter response",t)})};function Nr(){const r=S.useNavigationController(),{plugins:o}=S.useCustomizationController(),t=[];return o&&t.push(...o.map((n,i)=>e.jsx(a.Fragment,{children:n.homePage?.additionalActions??null},n.key)).filter(Boolean)),e.jsx(S.DefaultHomePage,{additionalActions:e.jsxs(e.Fragment,{children:[" ",t," "]}),additionalChildrenStart:(r.collections??[]).length>0?e.jsx(Q,{showForPlans:["free"]}):void 0,additionalChildrenEnd:e.jsx(S.NavigationGroup,{group:"ADMIN",children:e.jsx("div",{className:"grid grid-cols-12 gap-2",children:ce.map(n=>e.jsx("div",{className:"col-span-12 sm:col-span-6 lg:col-span-4",children:e.jsx(S.SmallNavigationCard,{name:n.name,url:n.path,icon:e.jsx(S.IconForView,{collectionOrView:n,className:"text-gray-400 dark:text-gray-600"})})},`nav_${n.path}`))})})})}function Er({open:r,closeDialog:o,collection:t,collectionConfigController:n,parentCollectionIds:i,hasOwnTextSearchImplementation:c}){const l=S.useSnackbarController(),g=H(),[C,f]=a.useState(!1),[u,N]=a.useState(!1);function w(){return n.updateCollection({id:t.id,parentCollectionIds:i,collectionData:{textSearchEnabled:!0}})}return e.jsxs(s.Dialog,{maxWidth:"2xl",open:r,onOpenChange:d=>d?void 0:o(),children:[e.jsxs(s.DialogContent,{className:"flex flex-col gap-4",children:[e.jsxs(s.Typography,{variant:"h5",className:"flex flex-row gap-4 items-center",children:[e.jsx(s.SearchIcon,{}),"Enable text search"]}),e.jsx(Q,{includeCTA:!1,showForPlans:["free"],message:e.jsx(e.Fragment,{children:"Upgrade to PLUS to use text search"})}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2 my-2",children:[e.jsx(s.Alert,{color:"warning",children:"Local text search is not recommended for large collections."}),e.jsx(s.Typography,{variant:"caption",children:"Note that enabling local text search will need to fetch all documents from your collection and store them in the browser. This can be inefficient for large collections. It can also incur in additional costs."}),e.jsx(s.Typography,{variant:"caption",children:"For larger collections, you are encouraged to use an external search engine such as Algolia or Elastic Search, and assign a search delegate to your config."})]}),e.jsx(s.Typography,{children:"Local text search is the simplest way to enable text search in your collection. It loads all documents in the collection in the browser and performs the search locally. This is the recommended option for small collections."})]}),c&&e.jsx(e.Fragment,{children:e.jsx(s.Typography,{children:"You have implemented your own text search controller. You enable text search for your collection."})}),e.jsxs("div",{className:"flex items-end justify-end gap-4",children:[(c||g.localTextSearchEnabled)&&!t.textSearchEnabled&&g.canUseLocalTextSearch&&e.jsx(s.LoadingButton,{variant:"outlined",loading:u,size:"large",onClick:()=>{N(!0),w().then(()=>{l.open({message:"Local text search enabled",type:"success"}),o()}).finally(()=>N(!1))},disabled:!g.canUseLocalTextSearch,children:"Enable for this collection"}),!c&&!g.localTextSearchEnabled&&e.jsx(s.LoadingButton,{variant:"outlined",loading:C,size:"large",onClick:()=>{f(!0),g.updateLocalTextSearchEnabled(!0).then(async()=>{t.textSearchEnabled||await w(),l.open({message:"Local text search enabled",type:"success"}),o()}).finally(()=>f(!1))},disabled:!g.canUseLocalTextSearch,children:"Enable for project"}),!g.canUseLocalTextSearch&&e.jsx(ze,{includePriceSelect:!0,largePriceLabel:!1,includePriceLabel:!1})]})]}),e.jsx(s.IconButton,{className:"absolute top-4 right-4",onClick:o,children:e.jsx(s.CloseIcon,{})})]})}function Tr({introMode:r}){const o=S.useAuthController(),t=S.useNavigationController(),n=ee.useCollectionEditorController(),i=n.configPermissions?n.configPermissions({user:o.user}).createCollections:!0,[c,l]=a.useState(void 0);if(a.useEffect(()=>{n.getPathSuggestions?.("").then(l)},[n.getPathSuggestions]),!n.getPathSuggestions)return null;const g=(c??[]).length>3||(t.collections??[]).length===0&&(c??[]).length>0,C=r==="existing_project";return e.jsx(s.Collapse,{in:C||g,children:e.jsxs("div",{className:"flex flex-col gap-1 p-2 my-4",children:[!r&&e.jsxs(s.Typography,{variant:"body2",color:"secondary",children:["Create a collection ",e.jsx("b",{children:"automatically"})," from your data:"]}),r==="existing_project"&&e.jsxs(s.Typography,{children:["You will see your ",e.jsx("b",{children:"database collections"})," here, a few seconds after project creation"]}),e.jsxs("div",{className:"flex flex-row gap-1 overflow-scroll no-scrollbar ",children:[(c??[]).map(f=>e.jsx("div",{children:e.jsx(s.Chip,{icon:e.jsx(s.AddIcon,{size:"small"}),colorScheme:"cyanLighter",onClick:n&&i?()=>n.createCollection({initialValues:{path:f,name:S.unslugify(f)},parentCollectionIds:[],redirect:!0,sourceClick:"root_collection_suggestion"}):void 0,size:"small",children:f})},f)),c===void 0&&e.jsx(s.CircularProgress,{size:"small"}),c?.length===0&&e.jsx(s.Typography,{variant:"caption",children:"No suggestions"})]})]})})}function _r({projectConfig:r,firestoreDelegate:o,collectionConfigController:t,appConfig:n,introMode:i}){const c=!!n?.textSearchControllerBuilder;return{key:"saas",homePage:{additionalChildrenStart:i?e.jsx(Fr,{introMode:i}):void 0,additionalChildrenEnd:e.jsx(Tr,{introMode:i})},collectionView:{showTextSearchBar:({context:l,path:g,collection:C})=>C.textSearchEnabled!==!1,onTextSearchClick:({context:l,path:g,collection:C,parentCollectionIds:f})=>r.canUseLocalTextSearch&&r.localTextSearchEnabled&&C.textSearchEnabled?o.initTextSearchController({path:g,collection:C}):(f===void 0?console.warn("Enabling text search: Parent collection ids are undefined"):l.dialogsController.open({key:"text_search_info",Component:u=>e.jsx(Er,{...u,hasOwnTextSearchImplementation:c,collectionConfigController:t,parentCollectionIds:f,path:g,collection:C})}),Promise.resolve(!1))}}}function Fr({introMode:r}){if(!S.useNavigationController().topLevelNavigation)throw Error("Navigation not ready in FireCMSHomePage");return e.jsxs("div",{className:"mt-8 flex flex-col p-2",children:[e.jsx(s.Typography,{variant:"h4",className:"mb-4",children:"Welcome"}),e.jsx(s.Typography,{paragraph:!0,children:"Your admin panel is ready ✌️"}),e.jsx(s.Typography,{paragraph:!0,children:"FireCMS can be used as a standalone admin panel but it shines when you add your own custom functionality. Including your own custom components, fields, actions, views, and more."}),e.jsxs("div",{children:[e.jsx(s.Typography,{className:"inline",children:"Get started with:"}),e.jsx("div",{className:"ml-2 select-all font-mono bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-white p-2 px-3  border-gray-200 border-solid w-fit text-md font-bold inline-flex rounded-md",children:"yarn create firecms-app"}),e.jsxs(s.Typography,{className:"inline ml-2",children:["More info in the ",e.jsx("a",{href:"https://firecms.co/docs/customization_quickstart",rel:"noopener noreferrer",target:"_blank",children:"docs"})]})]})]})}const Xe=200;function Ze({projectId:r,appConfig:o,backendApiHost:t="https://api-drplyi3b6q-ey.a.run.app",onAnalyticsEvent:n,basePath:i,baseCollectionPath:c}){const l=S.useBuildModeController(),{firebaseApp:g,firebaseConfigLoading:C,configError:f,firebaseConfigError:u}=q.useInitialiseFirebase({name:"firecms-backend",fromUrl:t+"/config"}),N=je({backendApiHost:t,backendFirebaseApp:g});let w;return C||!g?w=e.jsx(ve,{projectId:r,text:"Backend loading"}):u?w=e.jsx(S.ErrorView,{error:u}):f?w=e.jsx(S.ErrorView,{error:f}):N.authLoading?w=e.jsx(ve,{projectId:r,text:"Auth loading"}):N.user?w=e.jsx(Re,{fireCMSBackend:N,projectId:r,modeController:l,appConfig:o,basePath:i,baseCollectionPath:c,onAnalyticsEvent:n}):w=e.jsx(s.CenteredView,{maxWidth:"lg",children:e.jsx(Qe,{fireCMSBackend:N,includeLogo:!0,includeGoogleAdminScopes:!1,includeTermsAndNewsLetter:!1,includeGoogleDisclosure:!1})}),e.jsx(te.BrowserRouter,{basename:i,children:w})}function ve(r){return e.jsx(S.Scaffold,{name:r.projectConfig?.projectName??"",logo:r.projectConfig?.logo,FireCMSAppBar:r.FireCMSAppBarComponent,includeDrawer:!1,children:e.jsx(S.CircularProgressCenter,{text:r.text})},"project_scaffold_"+r.projectId)}const Re=function({projectId:o,fireCMSBackend:t,...n}){const i=Ee({projectId:o,backendFirebaseApp:t.backendFirebaseApp}),c=Oe({backendFirebaseApp:t.backendFirebaseApp,projectId:o,projectsApi:t.projectsApi,usersLimit:i.usersLimit,canEditRoles:i.canEditRoles,fireCMSBackend:t});return c.loading||!i.clientFirebaseConfig&&!i.configError?e.jsx(ve,{projectId:o,projectConfig:i,FireCMSAppBarComponent:n.FireCMSAppBarComponent,text:"Client loading"}):e.jsx(er,{projectId:o,projectConfig:i,fireCMSBackend:t,customizationLoading:!1,userManagement:c,...n})};function Lr({configError:r,onLogout:o,fireCMSBackend:t}){const n="code"in r?e.jsx(Be,{error:r,fireCMSBackend:t}):e.jsxs(e.Fragment,{children:[e.jsx(s.Typography,{children:r.message}),e.jsxs(s.Typography,{children:["This error may be caused when a user has been deleted from the client project. Make sure a user exists in the client project with the same email as the one trying to log in. If the problem persists, reach us at ",e.jsx("a",{href:"mailto:hello@firecms.co?subject=FireCMS%20login%20error",rel:"noopener noreferrer",target:"_blank",children:" hello@firecms.co "}),", or in our ",e.jsx("a",{rel:"noopener noreferrer",target:"_blank",href:"https://discord.gg/fxy7xsQm3m",children:"Discord channel"}),"."]})]});return e.jsxs(s.CenteredView,{maxWidth:"2xl",className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(s.ErrorIcon,{color:"error"}),e.jsx(s.Typography,{variant:"h4",children:"Error logging in"})]}),n,e.jsx(s.Button,{variant:"outlined",onClick:o,children:"Sign out"})]})}function Ur(r){return e.jsxs(s.CenteredView,{maxWidth:"2xl",className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(s.ErrorIcon,{color:"error"}),e.jsx(s.Typography,{variant:"h4",children:"Error accessing project"})]}),e.jsx(s.Typography,{children:r.configError.message}),e.jsx(s.Typography,{children:"This error may be caused when trying to access with a user that is not registered in the project. You can ask the project owner to add you to the project."}),e.jsx(s.Button,{variant:"outlined",onClick:r.onLogout,children:"Sign out"})]})}function er({projectConfig:r,userManagement:o,projectId:t,fireCMSBackend:n,appConfig:i,customizationLoading:c,...l}){const[g,C]=a.useState(),{firebaseApp:f,firebaseConfigLoading:u,configError:N}=q.useInitialiseFirebase({onFirebaseInit:i?.onFirebaseInit,firebaseConfig:r.clientFirebaseConfig}),w=q.useAppCheck({firebaseApp:f,options:i?.appCheck}),d=q.useFirebaseAuthController({firebaseApp:f,onSignOut:n.signOut,defineRolesFor:o.defineRolesFor}),y=a.useMemo(()=>{if(o.loading||d.authLoading)return;const E=d.user;if(E)return o.users.find(k=>k.email.toLowerCase()===E?.email?.toLowerCase())},[d.authLoading,d.user,o.loading,o.users]),{delegatedLoginLoading:v,delegatedLoginError:p}=_e({projectsApi:n.projectsApi,firebaseApp:f,projectId:t,onUserChanged:E=>{d.setUser(E??null),d.setRoles(y?.roles??[])},onAnalyticsEvent:l.onAnalyticsEvent}),_=a.useCallback(({pathSegments:E,collection:k,user:D,entity:A})=>X.resolveUserRolePermissions({collection:k,user:D}),[]),U=nr.useFirestoreCollectionsConfigController({firebaseApp:n.backendFirebaseApp,configPath:`projects/${t}/collections`,permissions:_,propertyConfigs:i?.propertyConfigs});let b;return o.loading?b=e.jsx(S.CircularProgressCenter,{text:"Project loading"}):w.loading?b=e.jsx(S.CircularProgressCenter,{text:"AppCheck loading"}):p?(console.log("Delegated login error",p),b=e.jsx(Lr,{configError:p,fireCMSBackend:n,onLogout:n.signOut})):g?(console.warn("No user was found with email "+g.email),b=e.jsx(rr,{authController:d})):r.configError?b=e.jsx(Ur,{configError:r.configError,onLogout:n.signOut}):c?b=e.jsx(S.CircularProgressCenter,{text:"Project customization loading"}):u?b=e.jsx(S.CircularProgressCenter,{text:"Client config loading"}):N?b=e.jsx(s.CenteredView,{children:e.jsx(S.ErrorView,{error:N??"Error fetching client Firebase config"})}):v?b=e.jsx(S.CircularProgressCenter,{text:"Logging in to "+t}):d.user?y||(b=e.jsx(rr,{authController:d})):b=e.jsx(S.CircularProgressCenter,{text:"Auth loading"}),b?e.jsx(S.Scaffold,{name:r.projectName??"",logo:r.logo,includeDrawer:!1,FireCMSAppBar:l.FireCMSAppBarComponent,children:b},"project_scaffold_"+r.projectId):e.jsx(Ar,{fireCMSUser:y,fireCMSBackend:n,appConfig:i,authController:d,projectConfig:r,collectionConfigController:U,firebaseApp:f,userManagement:o,...l})}function rr({authController:r}){return e.jsxs(s.CenteredView,{maxWidth:"md",className:"gap-4",children:[e.jsx(S.ErrorView,{title:"You don't have access to this project",error:"You can request permission to the owner"}),e.jsx(s.Button,{variant:"text",onClick:r.signOut,children:"Sign out"})]})}function kr(r,o,t){const{collections:n}=t,i=(n??[]).map(C=>C.path.trim().toLowerCase()),[c,l]=a.useState();return a.useEffect(()=>{const C=r.googleCredential?.accessToken;r.projectsApi.getRootCollections(o.projectId,C).then(f=>{l(f.filter(u=>!i.includes(u.trim().toLowerCase())))})},[]),{getPathSuggestions:a.useCallback(C=>!C&&c?Promise.resolve(c):Promise.resolve([]),[c])}}function Ar({fireCMSUser:r,firebaseApp:o,projectConfig:t,userManagement:n,collectionConfigController:i,appConfig:c,authController:l,modeController:g,fireCMSBackend:C,FireCMSAppBarComponent:f,onAnalyticsEvent:u,basePath:N,baseCollectionPath:w}){if(!l.user)throw Error("You can only use FireCMSAppAuthenticated with an authenticated user");const d=a.useMemo(()=>jr(n.usersLimit),[n.usersLimit]),y=a.useCallback(({user:T,collection:j})=>be({user:r,userManagement:n,collection:j}),[n,r]),v=a.useMemo(()=>{const T={};return c?.propertyConfigs?.forEach(j=>{T[j.key]=j}),T},[c?.propertyConfigs]),p=sr.useImportExportPlugin({exportAllowed:a.useCallback(({collectionEntitiesCount:T})=>t.canExport||T<=Xe,[t.canExport]),onAnalyticsEvent:u,notAllowedView:e.jsx(Q,{showForPlans:["free"],message:`Upgrade to export more than ${Xe} entities`})}),_=tr.useDataEnhancementPlugin({SubscriptionMessage:Ie,host:C.backendApiHost});S.useBrowserTitleAndIcon(t.projectName??"",t.logo);const U=S.useBuildLocalConfigurationPersistence(),b=q.useFirestoreDelegate({firebaseApp:o,textSearchControllerBuilder:c?.textSearchControllerBuilder,firestoreIndexesBuilder:c?.firestoreIndexesBuilder,localTextSearchEnabled:t.localTextSearchEnabled}),E=q.useFirebaseStorageSource({firebaseApp:o}),k=S.useBuildNavigationController({basePath:N,baseCollectionPath:w,authController:l,collections:c?.collections,views:c?.views,userConfigPersistence:U,dataSourceDelegate:b,injectCollections:a.useCallback(T=>ee.mergeCollections(T,i.collections??[],c?.modifyCollection),[c?.modifyCollection,i.collections])}),D=k.initialised&&k.collections!==void 0&&k.collections.length===0,A=_r({projectConfig:t,firestoreDelegate:b,collectionConfigController:i,appConfig:c,introMode:D?t.creationType==="new"?"new_project":"existing_project":void 0}),{getPathSuggestions:O}=kr(C,t,k),B=ee.useCollectionEditorPlugin({collectionConfigController:i,configPermissions:y,reservedGroups:ie,getPathSuggestions:O,getUser:T=>n.users.find(j=>j.uid===T)??null,collectionInference:q.buildCollectionInference(o),getData:(T,j)=>q.getFirestoreDataInPath(o,T,j,400),onAnalyticsEvent:u}),$=[A,p,B,_];return e.jsx(Fe,{...C,children:e.jsx(Te,{config:t,children:e.jsx(X.UserManagementProvider,{userManagement:n,children:e.jsx(S.SnackbarProvider,{children:e.jsx(S.ModeControllerProvider,{value:g,children:e.jsx(S.FireCMS,{navigationController:k,dateTimeFormat:c?.dateTimeFormat,entityViews:c?.entityViews,locale:c?.locale,propertyConfigs:v,authController:l,userConfigPersistence:U,dataSourceDelegate:b,storageSource:E,entityLinkBuilder:({entity:T})=>`https://console.firebase.google.com/project/${o.options.projectId}/firestore/data/${T.path}/${T.id}`,onAnalyticsEvent:u,plugins:$,components:{missingReference:ee.MissingReferenceWidget},children:({context:T,loading:j})=>{let P;return j?P=e.jsx(S.Scaffold,{name:t.projectName??"",logo:t.logo,includeDrawer:!1,FireCMSAppBar:f,fireCMSAppBarProps:c?.fireCMSAppBarComponentProps,children:e.jsx(S.CircularProgressCenter,{text:"Almost there"})},"project_scaffold_"+t.projectId):P=e.jsxs(S.Scaffold,{name:t.projectName??"",logo:t.logo,Drawer:De,FireCMSAppBar:f,fireCMSAppBarProps:c?.fireCMSAppBarComponentProps,autoOpenDrawer:c?.autoOpenDrawer,children:[e.jsx(S.NavigationRoutes,{HomePage:c?.HomePage??Nr,customRoutes:d}),e.jsx(S.SideDialogs,{})]},"project_scaffold_"+t.projectId),P}})})})})})})}function jr(r){return[{path:"users",name:"CMS Users",group:"Admin",icon:"face",hideFromNavigation:!0,view:e.jsx(X.UsersView,{children:e.jsx(Q,{showForPlans:["free"],message:e.jsxs(e.Fragment,{children:["Upgrade to PLUS to remove the ",e.jsxs("b",{children:[r," users limit"]})]})})})},{path:"roles",name:"Roles",group:"Admin",icon:"gpp_good",hideFromNavigation:!0,view:e.jsx(X.RolesView,{children:e.jsx(Q,{showForPlans:["free"],message:e.jsxs(e.Fragment,{children:["Upgrade to PLUS to be able to customise ",e.jsx("b",{children:"roles"})]})})})},{path:"settings",name:"Project settings",group:"Admin",icon:"settings",hideFromNavigation:!0,view:e.jsx(Ye,{})}].map(({path:o,name:t,view:n})=>e.jsx(te.Route,{path:o,element:n},"navigation_admin_"+o))}function Or(r){return a.useEffect(()=>{console.warn("IMPORTANT! The FireCMSApp component is deprecated and will be removed in future versions. Please use FireCMSCloudApp instead.")},[]),e.jsx(Ze,{...r})}h.ADMIN_VIEWS_CONFIG=ce,h.ActiveSubscriptions=Cr,h.ApiError=ae,h.CHECKOUT_SESSION_COLLECTION=Ue,h.CUSTOMERS_COLLECTION=ue,h.CloudErrorView=Be,h.CurrentSubscriptionView=Je,h.FireCMSApp=Or,h.FireCMSBackEndProvider=Fe,h.FireCMSBackendContext=ge,h.FireCMSClient=Re,h.FireCMSClientWithController=er,h.FireCMSCloudApp=Ze,h.FireCMSCloudDrawer=De,h.FireCMSDataEnhancementSubscriptionMessage=Ie,h.FireCMSLoginView=Qe,h.GoogleLoginButton=Ke,h.PRODUCTS_COLLECTION=fe,h.PlanChip=Ce,h.PlansComparison=Ge,h.PlansComparisonDialog=qe,h.ProductView=Se,h.ProjectConfigContext=he,h.ProjectConfigProvider=Te,h.ProjectSettings=Ye,h.ProjectSubscriptionPlans=We,h.RESERVED_GROUPS=ie,h.SUBSCRIPTIONS_COLLECTION=Le,h.SecurityRulesInstructions=Me,h.StripeDisclaimer=He,h.SubscriptionPlanWidget=Q,h.areRolesEqual=lr,h.buildProjectsApi=ke,h.cacheDelegatedLoginToken=xe,h.clearDelegatedLoginTokensCache=Ne,h.darkenColor=se,h.getDelegatedLoginTokenFromCache=Pe,h.hexToRgbaWithOpacity=de,h.resolveCollectionConfigPermissions=be,h.useBuildCloudUserManagement=Oe,h.useBuildFireCMSBackend=je,h.useBuildProjectConfig=Ee,h.useDelegatedLogin=_e,h.useFireCMSBackend=W,h.useProjectConfig=H,h.useSubscriptionsForUserController=pe,Object.keys(S).forEach(r=>{r!=="default"&&!Object.prototype.hasOwnProperty.call(h,r)&&Object.defineProperty(h,r,{enumerable:!0,get:()=>S[r]})}),Object.keys(s).forEach(r=>{r!=="default"&&!Object.prototype.hasOwnProperty.call(h,r)&&Object.defineProperty(h,r,{enumerable:!0,get:()=>s[r]})}),Object.keys(q).forEach(r=>{r!=="default"&&!Object.prototype.hasOwnProperty.call(h,r)&&Object.defineProperty(h,r,{enumerable:!0,get:()=>q[r]})}),Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
