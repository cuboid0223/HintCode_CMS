(function(U,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("react/jsx-runtime"),require("@firecms/core"),require("react"),require("react-fast-compare"),require("@firecms/ui"),require("yup"),require("@firecms/formex"),require("@firecms/schema_inference"),require("@hello-pangea/dnd"),require("json5"),require("prism-react-renderer"),require("@firecms/data_import_export"),require("react-router")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","@firecms/core","react","react-fast-compare","@firecms/ui","yup","@firecms/formex","@firecms/schema_inference","@hello-pangea/dnd","json5","prism-react-renderer","@firecms/data_import_export","react-router"],e):(U=typeof globalThis<"u"?globalThis:U||self,e(U["FireCMS collection editor"]={},U.jsxRuntime,U.core,U.React,U.equal,U.ui,U.Yup,U.formex,U.schema_inference,U.dnd,U.JSON5,U.prismReactRenderer,U.data_import_export,U.reactRouter))})(this,function(U,e,i,P,te,t,ir,g,Ve,xe,dr,Ue,se,cr){"use strict";function Le(r){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const o in r)if(o!=="default"){const l=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(a,o,l.get?l:{enumerable:!0,get:()=>r[o]})}}return a.default=r,Object.freeze(a)}const ge=Le(P),ye=Le(ir),pr=ye.object().shape({id:ye.string().required("Required"),name:ye.string().required("Required"),path:ye.string().required("Required")});function hr({isNewCollection:r,reservedGroups:a,existingPaths:o,existingIds:l,groups:s,parentCollection:n}){const c=P.useRef(null),{values:p,setFieldValue:h,handleChange:u,touched:f,errors:d,setFieldTouched:v,isSubmitting:m,submitCount:N}=g.useFormex(),[C,w]=P.useState(!1),[b,T]=P.useState(!1),S=y=>{h("name",y),!g.getIn(f,"path")&&r&&y&&h("path",i.toSnakeCase(y)),!g.getIn(f,"id")&&r&&y&&h("id",i.toSnakeCase(y)),!g.getIn(f,"singularName")&&r&&y&&h("singularName",i.singular(y))};P.useEffect(()=>{d.id&&T(!0)},[d.id]);const k=e.jsx(i.IconForView,{collectionOrView:p}),I=s?.filter(y=>!a?.includes(y)),{inputFocused:V,autoCompleteOpen:F,setAutoCompleteOpen:E}=t.useAutoComplete({ref:c}),A=!!n;let x;typeof p.customId=="object"?x="code_defined":p.customId===!0?x="true":p.customId===!1?x="false":p.customId==="optional"&&(x="optional");const _=N>0;return e.jsx("div",{className:"overflow-auto my-auto",children:e.jsxs(t.Container,{maxWidth:"4xl",className:"flex flex-col gap-4 p-8 m-auto",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row py-2 pt-3 items-center",children:[e.jsx(t.Typography,{variant:r?"h4":"h5",className:"flex-grow",children:r?"New collection":`${p?.name} collection`}),e.jsx(t.Tooltip,{title:"Change icon",children:e.jsx(t.IconButton,{shape:"square",onClick:()=>w(!0),children:k})})]}),n&&e.jsx(t.Chip,{colorScheme:"tealDarker",children:e.jsxs(t.Typography,{variant:"caption",children:["This is a subcollection of ",e.jsx("b",{children:n.name})]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.TextField,{value:p.name??"",onChange:y=>S(y.target.value),label:"Name",required:!0,error:_&&!!d.name}),e.jsx(i.FieldCaption,{error:f.name&&!!d.name,children:f.name&&d.name?d.name:"Name of in this collection, usually a plural name (e.g. Products)"})]}),e.jsxs("div",{className:t.cn("col-span-12 ",A?"":"sm:col-span-8"),children:[e.jsx(g.Field,{name:"path",as:t.DebouncedTextField,label:"Path",disabled:!r,required:!0,error:_&&!!d.path}),e.jsx(i.FieldCaption,{error:f.path&&!!d.path,children:f.path&&d.path?d.path:A?"Relative path to the parent (no need to include the parent path)":"Path that this collection is stored in, in the database"})]}),!A&&e.jsxs("div",{className:"col-span-12 sm:col-span-4 relative",children:[e.jsx(t.TextField,{error:_&&!!d.group,disabled:m,value:p.group??"",autoComplete:"off",onChange:y=>h("group",y.target.value),name:"group",inputRef:c,label:"Group"}),e.jsx(t.Autocomplete,{open:F&&(I??[]).length>0,setOpen:E,children:I?.map((y,M)=>e.jsx(t.AutocompleteItem,{onClick:()=>{E(!1),h("group",y??null)},children:e.jsx("div",{className:"flex-grow",children:y})},M+"_"+y))}),e.jsx(i.FieldCaption,{children:_&&d.group?d.group:"Group of the collection"})]}),e.jsx("div",{className:"col-span-12",children:e.jsx(t.ExpandablePanel,{expanded:b,onExpandedChange:T,title:e.jsxs("div",{className:"flex flex-row text-gray-500",children:[e.jsx(t.SettingsIcon,{}),e.jsx(t.Typography,{variant:"subtitle2",className:"ml-2",children:"Advanced"})]}),initiallyExpanded:!1,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4",children:[e.jsxs("div",{className:"col-span-12",children:[e.jsx(g.Field,{name:"id",as:t.DebouncedTextField,disabled:!r,label:"Collection id",error:_&&!!d.id}),e.jsx(i.FieldCaption,{error:f.id&&!!d.id,children:f.id&&d.id?d.id:"This id identifies this collection. Typically the same as the path."})]}),e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.TextField,{error:_&&!!d.singularName,name:"singularName","aria-describedby":"singularName-helper",onChange:y=>(v("singularName",!0),u(y)),value:p.singularName??"",label:"Singular name"}),e.jsx(i.FieldCaption,{error:_&&!!d.singularName,children:_&&d.singularName?d.singularName:"Optionally define a singular name for your entities"})]}),e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.TextField,{error:_&&!!d.description,name:"description",value:p.description??"",onChange:u,multiline:!0,rows:2,"aria-describedby":"description-helper-text",label:"Description"}),e.jsx(i.FieldCaption,{error:_&&!!d.description,children:_&&d.description?d.description:"Description of the collection, you can use markdown"})]}),e.jsx("div",{className:"col-span-12",children:e.jsx(t.Select,{name:"defaultSize",label:"Default row size",position:"item-aligned",onChange:u,value:p.defaultSize??"",renderValue:y=>y.toUpperCase(),children:["xs","s","m","l","xl"].map(y=>e.jsx(t.SelectItem,{value:y,children:y.toUpperCase()},`size-select-${y}`))})}),e.jsx("div",{className:"col-span-12",children:e.jsxs(t.Select,{name:"customId",label:"Data IDs generation",position:"item-aligned",disabled:x==="code_defined",onValueChange:y=>{if(y==="code_defined")throw new Error("This should not happen");y==="true"?h("customId",!0):y==="false"?h("customId",!1):y==="optional"&&h("customId","optional")},value:x??"",renderValue:y=>y==="code_defined"?"Code defined":y==="true"?"Users must define an ID":y==="optional"?"Users can define an ID, but it is not required":"Document ID is generated automatically",children:[e.jsx(t.SelectItem,{value:"false",children:"Document ID is generated automatically"}),e.jsx(t.SelectItem,{value:"true",children:"Users must define an ID"}),e.jsx(t.SelectItem,{value:"optional",children:"Users can define an ID, but it is not required"})]})}),e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.BooleanSwitchWithLabel,{position:"start",label:"Collection group",onValueChange:y=>h("collectionGroup",y),value:p.collectionGroup??!1}),e.jsx(i.FieldCaption,{children:"A collection group consists of all collections with the same path. This allows you to query over multiple collections at once."})]}),e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.BooleanSwitchWithLabel,{position:"start",label:"Enable text search for this collection",onValueChange:y=>h("textSearchEnabled",y),value:p.textSearchEnabled??!1}),e.jsx(i.FieldCaption,{children:"Allow text search for this collection. If you have not specified a text search delegate, this will use the built-in local text search. This is not recommended for large collections, as it may incur in performance and cost issues."})]})]})})})]}),e.jsx("div",{style:{height:"52px"}}),e.jsx(t.Dialog,{open:C,onOpenChange:w,maxWidth:"xl",fullWidth:!0,children:e.jsx("div",{className:"p-4 overflow-auto min-h-[200px]",children:e.jsx(i.SearchIconsView,{selectedIcon:p.icon,onIconSelected:y=>{w(!1),h("icon",y)}})})})]})})}function J(r){return"properties."+r.replaceAll(".",".properties.")}function Ee(r){return r?"properties."+r.replaceAll(".",".properties.")+".properties":"properties"}function R(r){return r?"properties."+r.replaceAll(".",".properties.")+".propertiesOrder":"propertiesOrder"}function K(r,a){return a?`${a}.${r}`:r}function Be(r,a){const o=a?`${a}.${r}`:r;return J(o)}function fr({enumValues:r,onValuesChanged:a,onError:o,updateIds:l,disabled:s,allowDataInference:n,getData:c}){const p=g.useCreateFormex({initialValues:{enumValues:r},validateOnChange:!0,validation:f=>{const d={};f.enumValues&&f.enumValues.forEach((m,N)=>{m?.label||(d.enumValues=d.enumValues??[],d.enumValues[N]=d.enumValues[N]??{},d.enumValues[N].label="You must specify a label for this enum value entry"),m?.id||(d.enumValues=d.enumValues??[],d.enumValues[N]=d.enumValues[N]??{},d.enumValues[N].id="You must specify an ID for this enum value entry")});const v=!!(d?.enumValues&&Object.keys(d?.enumValues).length>0);return o?.(v),d}}),{values:h,errors:u}=p;return P.useEffect(()=>{a&&a(h.enumValues)},[h.enumValues]),e.jsx(g.Formex,{value:p,children:e.jsx(gr,{enumValuesPath:"enumValues",values:h,errors:u,shouldUpdateId:l,disabled:s,allowDataInference:n,getData:c})})}function gr({values:r,errors:a,disabled:o,enumValuesPath:l,shouldUpdateId:s,allowDataInference:n,getData:c}){const{setFieldValue:p}=g.useFormex(),[h,u]=P.useState(),[f,d]=P.useState(),[v,m]=P.useState(!1),C=P.useRef(new Set).current,w=(T,S)=>{const k=h===S,I=a?.enumValues&&a?.enumValues[T];return e.jsx(ur,{index:T,disabled:o,enumValuesPath:l,autoFocus:k,entryError:I,shouldUpdateId:s||k,onDialogOpen:()=>d(T),inferredEntry:C.has(r.enumValues[T]?.id)},`${S}`)},b=async()=>{c&&(m(!0),c?.().then(T=>{if(!T)return;const S=T.flat(),k=Array.from(new Set(S)),I=r.enumValues,F=Ve.extractEnumFromValues(k).filter(E=>!I?.some(A=>A.id===E.id));F.forEach(E=>{C.add(E.id)}),p(l,[...F,...I],!0)}).catch(T=>{console.error(T)}).finally(()=>m(!1)))};return e.jsxs("div",{className:"col-span-12",children:[e.jsxs("div",{className:"ml-3.5 flex flex-row items-center",children:[e.jsx(t.ListIcon,{}),e.jsx(t.Typography,{variant:"subtitle2",className:"ml-2 grow",children:"Values"}),n&&e.jsxs(t.Button,{loading:v,disabled:o||v,variant:"text",size:"small",onClick:b,children:[v?e.jsx(t.CircularProgress,{size:"small"}):e.jsx(t.AutoAwesomeIcon,{}),"Infer values from data"]})]}),e.jsxs(t.Paper,{className:"p-4 m-1",children:[e.jsx(i.ArrayContainer,{droppableId:l,addLabel:"Add enum value",value:r.enumValues,disabled:o,size:"small",buildEntry:w,onInternalIdAdded:u,includeAddButton:!0,onValueChange:T=>p(l,T),newDefaultEntry:{id:"",label:""}}),e.jsx(yr,{index:f,open:f!==void 0,enumValuesPath:l,onClose:()=>d(void 0)})]})]})}const ur=P.memo(function({index:a,shouldUpdateId:o,enumValuesPath:l,autoFocus:s,onDialogOpen:n,disabled:c,inferredEntry:p,entryError:h}){const{values:u,handleChange:f,errors:d,setFieldValue:v,touched:m}=g.useFormex(),N=P.useRef(!g.getIn(u,`${l}[${a}].id`)),C=o||N.current,w=g.getIn(u,`${l}[${a}].id`),b=g.getIn(u,`${l}[${a}].label`),T=P.useRef(b);return P.useEffect(()=>{(T.current===w||!w)&&C&&v(`${l}[${a}].id`,b),T.current=b},[b]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full align-center justify-center",children:[e.jsx(g.Field,{name:`${l}[${a}].label`,as:t.DebouncedTextField,className:"flex-grow",required:!0,disabled:c,size:"small",autoFocus:s,autoComplete:"off",endAdornment:p&&e.jsx(t.AutoAwesomeIcon,{size:"small"}),error:!!h?.label}),!c&&e.jsx(t.Badge,{color:"error",invisible:!h?.id,children:e.jsx(t.IconButton,{size:"small","aria-label":"edit",className:"m-1",onClick:()=>n(),children:e.jsx(t.SettingsIcon,{size:"small"})})})]}),h?.label&&e.jsx(t.Typography,{variant:"caption",className:"ml-3.5 text-red-500 dark:text-red-500",children:h?.label}),h?.id&&e.jsx(t.Typography,{variant:"caption",className:"ml-3.5 text-red-500 dark:text-red-500",children:h?.id})]})},function(a,o){return a.index===o.index&&a.enumValuesPath===o.enumValuesPath&&a.shouldUpdateId===o.shouldUpdateId&&a.inferredEntry===o.inferredEntry&&te(a.entryError,o.entryError)&&a.autoFocus===o.autoFocus});function yr({index:r,open:a,onClose:o,enumValuesPath:l}){const{errors:s}=g.useFormex(),n=r!==void 0?g.getIn(s,`${l}[${r}].id`):void 0;return e.jsxs(t.Dialog,{maxWidth:"md","aria-labelledby":"enum-edit-dialog",open:a,onOpenChange:c=>c?void 0:o(),children:[e.jsx(t.DialogContent,{children:r!==void 0&&e.jsxs("div",{children:[e.jsx(g.Field,{name:`${l}[${r}].id`,as:t.DebouncedTextField,required:!0,label:"ID",size:"small",autoComplete:"off",error:!!n}),e.jsx(i.FieldCaption,{error:!!n,children:n??"Value saved in the data source"})]})}),e.jsx(t.DialogActions,{children:e.jsx(t.Button,{autoFocus:!0,variant:"outlined",onClick:o,color:"primary",children:"Ok"})})]})}function Z({field:r,form:a,label:o,tooltip:l,disabled:s,size:n="small",allowIndeterminate:c}){const p=e.jsx(t.BooleanSwitchWithLabel,{label:o,size:n,position:"start",value:r.value,disabled:s,allowIndeterminate:c,onValueChange:h=>a.setFieldValue(r.name,h)});return l?e.jsx(t.Tooltip,{title:l,children:p}):p}function ie({disabled:r}){const{values:a,handleChange:o}=g.useFormex(),l="validation.required",s="validation.requiredMessage";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-6",children:e.jsx(g.Field,{name:l,type:"checkbox",children:({field:c,form:p})=>e.jsx(Z,{disabled:r,label:"Required",tooltip:"You won't be able to save this entity if this value is not set",form:p,field:c})})}),e.jsx("div",{className:"col-span-6",children:e.jsx(g.Field,{name:"validation.unique",type:"checkbox",children:({field:c,form:p})=>e.jsx(Z,{disabled:r,label:"Unique",tooltip:"There cannot be multiple entities with the same value",form:p,field:c})})}),g.getIn(a,l)&&e.jsx("div",{className:"col-span-12",children:e.jsx(t.DebouncedTextField,{disabled:r,value:g.getIn(a,s),label:"Required message",name:s,size:"small",onChange:o})})]})}function pe({length:r,lowercase:a,matches:o,max:l,min:s,trim:n,uppercase:c,disabled:p,showErrors:h}){const{values:u,handleChange:f,errors:d}=g.useFormex(),v="validation.length",m="validation.min",N="validation.max",C="validation.trim",w="validation.matches",b="validation.lowercase",T="validation.uppercase",S=g.getIn(d,w),k=g.getIn(u,w),I=typeof k=="string"?k:i.serializeRegExp(k);return e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx(ie,{disabled:p}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 col-span-12",children:[a&&e.jsx("div",{className:"col-span-4",children:e.jsx(g.Field,{name:b,type:"checkbox",children:({field:V,form:F})=>e.jsx(Z,{label:"Lowercase",disabled:p,form:F,field:V})})}),c&&e.jsx("div",{className:"col-span-4",children:e.jsx(g.Field,{name:T,type:"checkbox",children:({field:V,form:F})=>e.jsx(Z,{label:"Uppercase",disabled:p,form:F,field:V})})}),n&&e.jsx("div",{className:"col-span-4",children:e.jsx(g.Field,{name:C,type:"checkbox",children:({field:V,form:F})=>e.jsx(Z,{label:"Trim",disabled:p,form:F,field:V})})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 col-span-12",children:[r&&e.jsx("div",{className:"col-span-4",children:e.jsx(t.DebouncedTextField,{value:g.getIn(u,v),label:"Exact length",name:v,type:"number",size:"small",disabled:p,onChange:f})}),s&&e.jsx("div",{className:"col-span-4",children:e.jsx(t.DebouncedTextField,{value:g.getIn(u,m),label:"Min length",name:m,type:"number",size:"small",disabled:p,onChange:f})}),l&&e.jsx("div",{className:"col-span-4",children:e.jsx(t.DebouncedTextField,{value:g.getIn(u,N),label:"Max length",name:N,type:"number",size:"small",disabled:p,onChange:f})})]}),o&&e.jsxs("div",{className:"col-span-12",children:[e.jsx(g.Field,{name:w,as:t.DebouncedTextField,label:"Matches regex",size:"small",disabled:p,value:I,error:!!S}),e.jsx(i.FieldCaption,{error:!!S,children:S?"Not a valid regexp":"e.g. /^\\d+$/ for digits only"})]})]})}function _e({max:r=!0,min:a=!0,disabled:o}){const{values:l,handleChange:s}=g.useFormex(),n="validation.min",c="validation.max";return e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx(ie,{disabled:o}),a&&e.jsx("div",{className:"col-span-6",children:e.jsx(t.DebouncedTextField,{value:g.getIn(l,n),disabled:o,label:"Min length",name:n,type:"number",size:"small",onChange:s})}),r&&e.jsx("div",{className:"col-span-6",children:e.jsx(t.DebouncedTextField,{value:g.getIn(l,c),disabled:o,label:"Max length",name:c,type:"number",size:"small",onChange:s})})]})}function ae({children:r}){return e.jsx(t.ExpandablePanel,{initiallyExpanded:!1,asField:!0,className:"p-4",title:e.jsxs("div",{className:"flex flex-row text-gray-500",children:[e.jsx(t.RuleIcon,{}),e.jsx(t.Typography,{variant:"subtitle2",className:"ml-2",children:"Validation"})]}),children:r})}function qe({multiselect:r,updateIds:a,disabled:o,showErrors:l,allowDataInference:s,getData:n}){const{values:c,setFieldError:p,setFieldValue:h}=g.useFormex(),u=i.useSnackbarController(),f=r?"of.enumValues":"enumValues",d=g.getIn(c,"defaultValue"),v=g.getIn(c,f),m=P.useMemo(()=>!v||typeof v=="boolean"?[]:i.resolveEnumValues(v)??[],[v]),N=C=>{if(c&&(h(f,C),!r)){const w=C.filter(b=>!!b?.id).map(b=>b.id);d&&!w.includes(d)&&(h("defaultValue",void 0),u.open({type:"warning",message:"Default value was cleared"}))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12",children:e.jsx(fr,{enumValues:m,updateIds:a,disabled:o,allowDataInference:s,onError:C=>{p(f,C?"This enum property is missing some values":void 0)},getData:n?()=>n().then(C=>C.map(w=>c.id&&g.getIn(w,c.id)).filter(Boolean)):void 0,onValuesChanged:N})}),e.jsx("div",{className:"col-span-12",children:e.jsxs(ae,{children:[!r&&e.jsx(pe,{disabled:o,showErrors:l}),r&&e.jsx(_e,{disabled:o})]})}),!r&&e.jsx("div",{className:"col-span-12",children:e.jsx(t.Select,{disabled:o,position:"item-aligned",onValueChange:C=>{h("defaultValue",C)},label:"Default value",value:d??"",children:m.filter(C=>!!C?.id).map(C=>e.jsx(t.SelectItem,{value:C.id?.toString(),children:C.label},C.id))})})]})}const ve={"image/*":"Images","video/*":"Videos","audio/*":"Audio files","application/*":"Files (pdf, zip, csv, excel...)","text/*":"Text files"};function $e({multiple:r,existing:a,disabled:o}){const{values:l,setFieldValue:s}=g.useFormex(),n=r?"of.storage":"storage",c=`${n}.acceptedFiles`,p=`${n}.fileName`,h=`${n}.storagePath`,u=`${n}.storeUrl`,f=g.getIn(l,p)??"{rand}_{file}",d=g.getIn(l,h)??"/",v=g.getIn(l,c),m=Array.isArray(v)?v:void 0,N=!m||m.length===0,C=T=>{T?T.includes("all")||T.length>=Object.keys(ve).length?s(c,void 0):N?s(c,Object.keys(ve).filter(S=>!T.includes(S))):s(c,T):s(c,void 0)},w=typeof f=="function",b=typeof d=="function";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12",children:e.jsx(t.ExpandablePanel,{title:e.jsxs("div",{className:"flex flex-row text-gray-500",children:[e.jsx(t.FileUploadIcon,{}),e.jsx(t.Typography,{variant:"subtitle2",className:"ml-2",children:"File upload config"})]}),children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-4",children:[e.jsx("div",{className:"col-span-12",children:e.jsxs(t.MultiSelect,{disabled:o,name:c,value:m??[],onMultiValueChange:C,label:N?void 0:"Allowed file types",renderValues:T=>!T||T.length===0?"All file types allowed":T.map(S=>ve[S]).filter(S=>!!S).join(", "),children:[e.jsxs(t.MultiSelectItem,{value:"all",className:"flex items-center gap-2",children:[e.jsx(t.Checkbox,{checked:!m}),"All"]},"all"),Object.entries(ve).map(([T,S])=>e.jsxs(t.MultiSelectItem,{value:T,className:"flex items-center gap-2",children:[e.jsx(t.Checkbox,{checked:N||m.indexOf(T)>-1}),e.jsx("div",{className:"flex-grow",children:S}),e.jsx(t.Button,{size:"small",variant:"outlined",onClick:k=>(k.preventDefault(),k.stopPropagation(),s(c,[T])),children:"Only"})]},T))]})}),e.jsx("div",{className:"col-span-12",children:e.jsx(g.Field,{name:p,as:t.DebouncedTextField,label:"File name",size:"small",disabled:w||o,value:w?"-":f})}),e.jsxs("div",{className:"col-span-12",children:[e.jsx(g.Field,{name:h,as:t.DebouncedTextField,label:"Storage path",disabled:b||o,size:"small",value:b?"-":d}),e.jsxs(t.Typography,{variant:"caption",className:"ml-3.5 mt-1 mb-2",children:[e.jsx("p",{children:"You can use the following placeholders in the file name and storage path values:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"{file} - Full name of the uploaded file"}),e.jsx("li",{children:"{file.name} - Name of the uploaded file without extension"}),e.jsx("li",{children:"{file.ext} - Extension of the uploaded file"}),e.jsx("li",{children:"{entityId} - ID of the entity"}),e.jsx("li",{children:"{propertyKey} - ID of this field"}),e.jsx("li",{children:"{path} - Path of this entity"}),e.jsx("li",{children:"{rand} - Random value used to avoid name collisions"})]})]}),e.jsx(g.Field,{name:u,type:"checkbox",children:({field:T,form:S})=>e.jsx(Z,{label:"Save URL instead of storage path",disabled:a||o,form:S,field:T})}),e.jsx(t.Typography,{variant:"caption",className:"ml-3.5 mt-1 mb-2",children:"Turn this setting on, if you prefer to save the download URL of the uploaded file instead of the storage path. You can only change this prop upon creation."})]})]})})}),e.jsx("div",{className:"col-span-12",children:e.jsxs(ae,{children:[!r&&e.jsx("div",{className:"grid grid-cols-12 gap-2",children:e.jsx(ie,{disabled:o})}),r&&e.jsx("div",{className:"col-span-12",children:e.jsx(_e,{disabled:o})})]})})]})}function he(r){if(i.isPropertyBuilder(r)||i.isPropertyBuilder(r))return!1;{const a=r;return a.dataType==="array"&&typeof a.of=="function"||a.dataType==="array"&&Array.isArray(a.of)?!1:!!a.editable}}function je(r){return Object.entries(r).filter(([a,o])=>he(o)).map(([a,o])=>{const l=o;if(he(l))return l.dataType==="map"&&l.properties?{[a]:{...l,properties:je(l.properties)}}:{[a]:l}}).filter(a=>!!a).reduce((a,o)=>({...a,...o}),{})}function Ye({property:r,onClick:a,hasError:o,includeName:l,includeEditButton:s,selected:n}){const{propertyConfigs:c}=i.useCustomizationController(),p=i.getFieldConfig(r,c);he(r);const h=o?"border-red-500 dark:border-red-500 border-opacity-100 dark:border-opacity-100 ring-0 dark:ring-0":n?"border-primary":"border-transparent";return o&&console.log("PropertyFieldPreview",r),e.jsx(i.ErrorBoundary,{children:e.jsxs("div",{onClick:a,className:"flex flex-row w-full cursor-pointer",children:[e.jsx("div",{className:"m-4",children:e.jsx(i.PropertyConfigBadge,{propertyConfig:p})}),e.jsxs(t.Paper,{className:t.cn("border","pl-2 w-full flex flex-row gap-4 items-center",t.cardMixin,a?t.cardClickableMixin:"",n?t.cardSelectedMixin:"","flex-grow p-4 border transition-colors duration-200",h),children:[e.jsxs("div",{className:"w-full flex flex-col",children:[l&&e.jsx(i.ErrorBoundary,{children:e.jsx(t.Typography,{variant:"body1",component:"span",className:"flex-grow pr-2",children:r.name?r.name:" "})}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(i.ErrorBoundary,{children:e.jsx(t.Typography,{className:"flex-grow pr-2",variant:l?"body2":"subtitle1",component:"span",color:"secondary",children:p?.name})}),e.jsx(i.ErrorBoundary,{children:e.jsx(t.Typography,{variant:"body2",component:"span",color:"disabled",children:r.dataType})})]})]}),s&&e.jsx(t.Typography,{variant:"button",children:"EDIT"})]})]})})}function vr({name:r,selected:a,onClick:o,property:l}){const{propertyConfigs:s}=i.useCustomizationController(),n=!i.isPropertyBuilder(l)&&l?i.getFieldConfig(l,s):void 0;return e.jsxs("div",{onClick:o,className:"flex flex-row w-full cursor-pointer",children:[e.jsxs("div",{className:"relative m-4",children:[n&&e.jsx(i.PropertyConfigBadge,{propertyConfig:n}),!n&&e.jsx("div",{className:"h-8 w-8 p-1 rounded-full shadow text-white bg-gray-500",children:e.jsx(t.FunctionsIcon,{color:"inherit",size:"medium"})}),e.jsx(t.RemoveCircleIcon,{color:"disabled",size:"small",className:"absolute -right-2 -top-2"})]}),e.jsx(t.Paper,{className:t.cn("pl-2 w-full flex flex-row gap-4 items-center",t.cardMixin,o?t.cardClickableMixin:"",a?t.cardSelectedMixin:"","flex-grow p-4 border transition-colors duration-200",a?"border-primary":"border-transparent"),children:e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx(t.Typography,{variant:"body1",component:"span",className:"flex-grow pr-2",children:l?.name?l.name:r}),e.jsxs("div",{className:"flex flex-row items-center",children:[n&&e.jsx(t.Typography,{className:"flex-grow pr-2",variant:"body2",component:"span",color:"secondary",children:n?.name}),l&&!i.isPropertyBuilder(l)&&e.jsx(i.ErrorBoundary,{children:e.jsx(t.Typography,{variant:"body2",component:"span",color:"disabled",children:l.dataType})}),l&&i.isPropertyBuilder(l)&&e.jsx(i.ErrorBoundary,{children:e.jsx(t.Typography,{variant:"body2",component:"span",color:"disabled",children:"This property is defined as a property builder in code"})}),!l&&e.jsx(i.ErrorBoundary,{children:e.jsx(t.Typography,{variant:"body2",component:"span",color:"disabled",children:"This field is defined as an additional field in code"})})]})]})})]})}const me=P.memo(function({namespace:a,selectedPropertyKey:o,onPropertyClick:l,properties:s,propertiesOrder:n,additionalFields:c,errors:p,onPropertyMove:h,onPropertyRemove:u,className:f,inferredPropertyKeys:d,collectionEditable:v}){const m=n??Object.keys(s),N=P.useCallback(C=>{if(!C.destination)return;const w=C.source.index,b=C.destination.index,T=Array.from(m),[S]=T.splice(w,1);T.splice(b,0,S),h&&h(T,a)},[a,h,m]);return e.jsx(e.Fragment,{children:e.jsx(xe.DragDropContext,{onDragEnd:N,children:e.jsx(xe.Droppable,{droppableId:`droppable_${a}`,children:(C,w)=>e.jsxs("div",{...C.droppableProps,ref:C.innerRef,className:f,children:[m&&m.map((b,T)=>{const S=s[b],k=c?.find(I=>I.key===b);return!S&&!k?(console.warn(`Property ${b} not found in properties or additionalFields`),null):e.jsx(xe.Draggable,{draggableId:`array_field_${a}_${b}}`,index:T,children:(I,V)=>e.jsx(i.ErrorBoundary,{children:e.jsx(mr,{propertyKey:b,propertyOrBuilder:S,additionalField:k,provided:I,errors:p,namespace:a,inferredPropertyKeys:d,onPropertyMove:h,onPropertyRemove:u,onPropertyClick:V.isDragging?void 0:l,selectedPropertyKey:o,collectionEditable:v})})},`array_field_${a}_${b}}`)}).filter(Boolean),C.placeholder]})})})})},(r,a)=>{const o=a.selectedPropertyKey?.startsWith(a.namespace??""),l=r.selectedPropertyKey?.startsWith(r.namespace??"");return o||l?!1:te(r.properties,a.properties)&&r.propertiesOrder===a.propertiesOrder&&te(r.additionalFields,a.additionalFields)&&te(r.errors,a.errors)&&te(r.onPropertyClick,a.onPropertyClick)&&r.namespace===a.namespace&&r.collectionEditable===a.collectionEditable});function mr({propertyKey:r,namespace:a,propertyOrBuilder:o,additionalField:l,provided:s,selectedPropertyKey:n,errors:c,onPropertyClick:p,onPropertyMove:h,onPropertyRemove:u,inferredPropertyKeys:f,collectionEditable:d}){const v=f?.includes(a?`${a}.${r}`:r),m=K(r,a),C=Be(r,a)in c;let w;if(typeof o=="object"){const S=o;S.dataType==="map"&&S.properties&&(w=e.jsx(me,{selectedPropertyKey:n,namespace:m,properties:S.properties,propertiesOrder:S.propertiesOrder,errors:c,onPropertyClick:p,onPropertyMove:h,onPropertyRemove:u,collectionEditable:d}))}const b=n===m,T=o&&(d&&!i.isPropertyBuilder(o)||he(o));return e.jsxs("div",{ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,className:"relative -ml-8",children:[w&&e.jsx("div",{className:"absolute border-l "+t.defaultBorderMixin,style:{left:"32px",top:"64px",bottom:"16px"}}),!i.isPropertyBuilder(o)&&!l&&T?e.jsx(Ye,{property:o,onClick:p?()=>p(r,a):void 0,includeName:!0,selected:b,hasError:C}):e.jsx(vr,{name:r,property:o,onClick:p?()=>p(r,a):void 0,selected:b}),e.jsxs("div",{className:"absolute top-2 right-2 flex flex-row ",children:[v&&e.jsx(t.Tooltip,{title:"Inferred property",children:e.jsx(t.AutoAwesomeIcon,{size:"small",className:"p-2"})}),u&&e.jsx(t.Tooltip,{title:"Remove",children:e.jsx(t.IconButton,{size:"small",color:"inherit",onClick:()=>u(r,a),children:e.jsx(t.RemoveIcon,{size:"small"})})}),h&&e.jsx(t.Tooltip,{title:"Move",children:e.jsx(t.IconButton,{component:"span",size:"small",children:e.jsx(t.DragHandleIcon,{size:"small"})})})]}),w&&e.jsx("div",{className:"ml-16",children:w})]})}function br({disabled:r,getData:a,allowDataInference:o,propertyConfigs:l,collectionEditable:s}){const{values:n,setFieldValue:c}=g.useFormex(),[p,h]=P.useState(!1),[u,f]=P.useState(),[d,v]=P.useState(),m=n.propertiesOrder??Object.keys(n.properties??{}),N=({id:k,property:I})=>{if(!k)throw Error();c("properties",{...n.properties??{},[k]:I},!1);const V=n.propertiesOrder??Object.keys(n.properties??{}),F=V.includes(k)?V:[...V,k];c("propertiesOrder",F,!1),h(!1)},C=P.useCallback((k,I)=>{const V=k?K(k,I):void 0;if(!V)throw Error("collection editor miss config");const F=J(V),E=R(I),A=g.getIn(n,E)??Object.keys(g.getIn(n,Ee(I)));c(F,void 0,!1),c(E,A.filter(x=>x!==k),!1),h(!1),f(void 0),v(void 0)},[c,n]),w=u?K(u,d):void 0,b=w?g.getIn(n.properties,w.replaceAll(".",".properties.")):void 0,T=!m||m.length<1,S=P.useCallback((k,I)=>{c(R(I),k,!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-12",children:[e.jsxs("div",{className:"flex justify-between items-end my-4",children:[e.jsx(t.Typography,{variant:"subtitle2",children:"Properties in this group"}),e.jsxs(t.Button,{color:"primary",variant:"outlined",onClick:()=>h(!0),startIcon:e.jsx(t.AddIcon,{}),children:["Add property to ",n.name??"this group"]})]}),e.jsxs(t.Paper,{className:"p-2 pl-8",children:[e.jsx(me,{properties:n.properties??{},propertiesOrder:m,errors:{},collectionEditable:s,onPropertyClick:(k,I)=>{f(k),v(I),h(!0)},onPropertyMove:S}),T&&e.jsx(t.Typography,{variant:"label",className:"h-full flex items-center justify-center p-4",children:"Add the first property to this group"})]})]}),e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.BooleanSwitchWithLabel,{position:"start",size:"small",label:"Spread children as columns",onValueChange:k=>c("spreadChildren",k),value:n.spreadChildren??!1}),e.jsx(i.FieldCaption,{children:"Set this flag to true if you want to display the children of this group as individual columns."})]}),e.jsx(de,{inArray:!1,forceShowErrors:!1,open:p,allowDataInference:o,collectionEditable:s,onCancel:()=>{h(!1),f(void 0),v(void 0)},onOkClicked:()=>{h(!1),f(void 0),v(void 0)},getData:a,onDelete:C,propertyKey:u,propertyNamespace:d,property:b,existingProperty:!!u,autoUpdateId:!u,autoOpenTypeSelect:!u,onPropertyChanged:N,existingPropertyKeys:u?void 0:m,propertyConfigs:l})]})}function Cr({showErrors:r,existing:a,disabled:o,getData:l,allowDataInference:s,propertyConfigs:n,collectionEditable:c}){const{values:p,handleChange:h,errors:u,setFieldValue:f,touched:d}=g.useFormex(),[v,m]=P.useState(!1),N=g.getIn(p,"of"),C=g.getIn(d,"of")&&g.getIn(u,"of"),w=({id:T,property:S,namespace:k})=>{console.log("onPropertyChanged",T,S,k),f("of",S)},b=N&&i.getFieldConfig(N,n);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-12",children:[e.jsx(t.Typography,{variant:"subtitle2",children:"Repeat component"}),e.jsx(g.Field,{name:"of",value:N,children:({})=>e.jsxs(t.Paper,{className:"p-2 mt-4",children:[N&&e.jsx(Ye,{property:N,onClick:o?void 0:()=>m(!0),includeName:!1,includeEditButton:!0,selected:!1,hasError:!1}),!o&&!N&&e.jsxs(t.Button,{variant:"text",size:"large",color:C?"error":"primary",onClick:()=>m(!0),children:["Edit ",`${b?b.name:"repeat component"}`]}),e.jsx(de,{inArray:!0,open:v,existingProperty:a,getData:l,autoUpdateId:!a,autoOpenTypeSelect:!a,onOkClicked:()=>m(!1),allowDataInference:s,property:N,includeIdAndName:!1,onPropertyChanged:w,forceShowErrors:r,propertyConfigs:n,collectionEditable:c})]})})]}),e.jsx("div",{className:"col-span-12",children:e.jsx(ae,{children:e.jsx(_e,{disabled:o})})})]})}const Tr=P.forwardRef(function({showErrors:a,disabledId:o,disabled:l,autoUpdateId:s,isNewProperty:n},c){const{errors:p,values:h,setFieldValue:u,setFieldTouched:f,touched:d,validate:v}=g.useFormex(),m="name",N=a&&g.getIn(p,m),C="id",w=a&&g.getIn(p,C),b="description",T=a&&g.getIn(p,b);return e.jsxs("div",{className:"flex flex-col gap-2 col-span-12",children:[e.jsxs("div",{children:[e.jsx(g.Field,{name:m,inputRef:c,as:t.DebouncedTextField,value:h[m],onChange:S=>{const k=S.target.value;!g.getIn(d,C)&&s&&u(C,k?i.toSnakeCase(k):"",!1),u(m,k,!0),f(m,!0)},style:{fontSize:20},placeholder:"Field name",required:!0,disabled:l,error:!!N}),e.jsx(i.FieldCaption,{error:!!N,children:N})]}),e.jsxs("div",{children:[e.jsx(g.Field,{name:C,as:t.DebouncedTextField,label:"ID",value:h[C],onChange:S=>{const k=S.target.value;!g.getIn(d,m)&&s&&u(m,k?i.unslugify(k):""),u(C,k,!0),f(C,!0)},disabled:o||l,required:!0,size:"small",error:!!w}),e.jsx(i.FieldCaption,{error:!!w,children:w})]}),e.jsxs("div",{children:[e.jsx(g.Field,{name:b,as:t.DebouncedTextField,label:"Description",disabled:l,error:!!T}),e.jsx(i.FieldCaption,{error:!!T,children:T})]})]})});function Pr({widgetId:r,disabled:a,showErrors:o}){const{values:l,setFieldValue:s}=g.useFormex();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12",children:e.jsxs(ae,{children:[r==="text_field"&&e.jsx(pe,{disabled:a,length:!0,lowercase:!0,matches:!0,max:!0,min:!0,trim:!0,uppercase:!0,showErrors:o}),r==="multiline"&&e.jsx(pe,{disabled:a,length:!0,lowercase:!0,max:!0,min:!0,trim:!0,uppercase:!0,showErrors:o}),r==="markdown"&&e.jsx(pe,{disabled:a,length:!0,lowercase:!0,max:!0,min:!0,trim:!0,uppercase:!0,showErrors:o}),r==="email"&&e.jsx(pe,{disabled:a,max:!0,min:!0,trim:!0,showErrors:o})]})}),e.jsx("div",{className:"col-span-12",children:e.jsx(t.TextField,{name:"defaultValue",disabled:a,onChange:n=>{s("defaultValue",n.target.value===""?void 0:n.target.value)},label:"Default value",value:g.getIn(l,"defaultValue")??""})})]})}function Ir({disabled:r}){const{values:a}=g.useFormex(),o=g.getIn(a,"defaultValue");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12",children:e.jsx(ae,{children:e.jsx(ie,{disabled:r})})}),e.jsx("div",{className:"col-span-12",children:e.jsx(g.Field,{name:"defaultValue",children:({field:l,form:s})=>e.jsx(Z,{label:o==null?"Default value not set":"Default value is "+o.toString(),disabled:r,allowIndeterminate:!0,field:l,form:s})})})]})}function Fr({disabled:r,getData:a,allowDataInference:o,propertyConfigs:l,collectionEditable:s}){const{values:n,setFieldValue:c}=g.useFormex(),[p,h]=P.useState(!1),[u,f]=P.useState(),[d,v]=P.useState(),m=({id:S,property:k})=>{if(!S)throw Error();c("oneOf.properties",{...n.oneOf?.properties??{},[S]:k},!1);const I=n.oneOf?.propertiesOrder??Object.keys(n.oneOf?.properties??{}),V=I.includes(S)?I:[...I,S];c("oneOf.propertiesOrder",V,!1),h(!1)},N=u?K(u,d):void 0,C=N?g.getIn(n.oneOf?.properties,N.replaceAll(".",".properties.")):void 0,w=P.useCallback((S,k)=>{const I=S?K(S,k):void 0;if(!I)throw Error("collection editor miss config");c(`oneOf.${J(I)}`,void 0,!1);const V=`oneOf.${R(k)}`,F=g.getIn(n,V)??Object.keys(g.getIn(n,Ee(k)));c(V,F.filter(E=>E!==S),!1),h(!1),f(void 0),v(void 0)},[c,n]),b=e.jsxs(t.Button,{autoFocus:!0,color:"primary",onClick:()=>h(!0),startIcon:e.jsx(t.AddIcon,{}),children:["Add property to ",n.name??"this block"]}),T=P.useCallback((S,k)=>{c(`oneOf.${R(k)}`,S,!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-12",children:[e.jsxs("div",{className:"flex justify-between items-end mt-8 mb-4",children:[e.jsx(t.Typography,{variant:"subtitle2",children:"Properties in this block"}),b]}),e.jsxs(t.Paper,{className:"p-2 pl-8",children:[e.jsx(me,{properties:n.oneOf?.properties??{},propertiesOrder:n.oneOf?.propertiesOrder,errors:{},collectionEditable:s,onPropertyClick:r?void 0:(S,k)=>{f(S),v(k),h(!0)},onPropertyMove:r?void 0:T}),!r&&!n.oneOf?.propertiesOrder?.length&&e.jsx("div",{className:"h-full flex items-center justify-center p-4",children:"Add the first property to this block"})]})]}),!r&&e.jsx(de,{inArray:!1,forceShowErrors:!1,open:p,getData:a,allowDataInference:o,onCancel:()=>{h(!1),f(void 0),v(void 0)},onOkClicked:()=>{h(!1),f(void 0),v(void 0)},collectionEditable:s,onDelete:w,propertyKey:u,propertyNamespace:d,property:C,existingProperty:!!u,autoUpdateId:!u,autoOpenTypeSelect:!u,onPropertyChanged:m,existingPropertyKeys:u?void 0:n.oneOf?.propertiesOrder,propertyConfigs:l})]})}function Nr({disabled:r}){const{values:a,handleChange:o}=g.useFormex(),l="validation.min",s="validation.max",n="validation.lessThan",c="validation.moreThan";return e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx(ie,{disabled:r}),e.jsx("div",{className:"col-span-6",children:e.jsx(t.DebouncedTextField,{value:g.getIn(a,l),label:"Min value",name:l,type:"number",size:"small",disabled:r,onChange:o})}),e.jsx("div",{className:"col-span-6",children:e.jsx(t.DebouncedTextField,{value:g.getIn(a,s),label:"Max value",name:s,type:"number",size:"small",disabled:r,onChange:o})}),e.jsx("div",{className:"col-span-6",children:e.jsx(t.DebouncedTextField,{value:g.getIn(a,n),label:"Less than",name:n,type:"number",size:"small",disabled:r,onChange:o})}),e.jsx("div",{className:"col-span-6",children:e.jsx(t.DebouncedTextField,{value:g.getIn(a,c),label:"More than",name:c,type:"number",size:"small",disabled:r,onChange:o})}),e.jsx("div",{className:"col-span-4",children:e.jsx(g.Field,{name:"validation.positive",type:"checkbox",children:({field:f,form:d})=>e.jsx(Z,{label:"Positive value",disabled:r,form:d,field:f})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(g.Field,{name:"validation.negative",type:"checkbox",children:({field:f,form:d})=>e.jsx(Z,{label:"Negative value",disabled:r,form:d,field:f})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(g.Field,{name:"validation.integer",type:"checkbox",children:({field:f,form:d})=>e.jsx(Z,{label:"Integer value",disabled:r,form:d,field:f})})})]})}function wr({disabled:r}){const{values:a,setFieldValue:o}=g.useFormex();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12",children:e.jsx(ae,{children:e.jsx(Nr,{disabled:r})})}),e.jsx("div",{className:"col-span-12",children:e.jsx(t.TextField,{name:"defaultValue",disabled:r,type:"number",onChange:l=>{o("defaultValue",l.target.value===""?void 0:parseFloat(l.target.value))},label:"Default value",value:g.getIn(a,"defaultValue")??""})})]})}function He({existing:r,multiple:a,disabled:o,showErrors:l}){const{values:s,handleChange:n,errors:c}=g.useFormex();if(!i.useNavigationController())return e.jsx("div",{className:"col-span-12",children:e.jsx(t.CircularProgress,{})});const h=a?"of.path":"path",u=g.getIn(s,h),f=l&&g.getIn(c,h);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"col-span-12",children:e.jsx(g.Field,{name:h,pathPath:h,type:"select",disabled:r&&!!u||o,value:u,error:f,handleChange:n,as:kr})})})}function kr({disabled:r,pathPath:a,value:o,handleChange:l,error:s,...n}){const c=i.useNavigationController();if(!c)return e.jsx("div",{className:"col-span-12",children:e.jsx(t.CircularProgress,{})});const p=c?.collections??[],h=Array.from(new Set(Object.values(p).map(f=>f.group).filter(Boolean)).values()),u=p.filter(f=>!f.group);return e.jsxs(e.Fragment,{children:[e.jsxs(t.Select,{error:!!s,disabled:r,value:o??"",position:"item-aligned",name:a,onChange:l,label:"Target collection",renderValue:f=>{const d=p.find(v=>v.id===f||v.path===f);return d?e.jsxs("div",{className:"flex flex-row",children:[e.jsx(i.IconForView,{collectionOrView:d}),e.jsx(t.Typography,{variant:"subtitle2",className:"font-medium ml-4",children:d?.name.toUpperCase()})]}):null},...n,children:[h.flatMap(f=>e.jsx(t.SelectGroup,{label:f||"Views",children:p.filter(d=>d.group===f).map(d=>e.jsx(t.SelectItem,{value:d.id??d.path,children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx(i.IconForView,{collectionOrView:d}),e.jsx(t.Typography,{variant:"subtitle2",className:"font-medium ml-4",children:d?.name.toUpperCase()})]})},`${d.id??d.path}-${f}`))},`group_${f}`)),u&&e.jsx(t.SelectGroup,{label:"Views",children:u.map(f=>e.jsx(t.SelectItem,{value:f.id??f.path,children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx(i.IconForView,{collectionOrView:f}),e.jsx(t.Typography,{variant:"subtitle2",className:"font-medium ml-4",children:f?.name.toUpperCase()})]})},f.id??f.path))})]}),e.jsx(i.FieldCaption,{children:"You can only edit the reference collection upon field creation."})]})}function Sr({disabled:r}){const{values:a,errors:o,touched:l,setFieldValue:s}=g.useFormex(),n="mode",c=g.getIn(a,n),p=g.getIn(l,n)&&g.getIn(o,n),h="autoValue",u=g.getIn(a,h),f=g.getIn(l,h)&&g.getIn(o,h);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col col-span-12",children:[e.jsxs(t.Select,{name:n,value:c??"date",error:!!p,onValueChange:d=>s(n,d),label:"Mode",renderValue:d=>{switch(d){case"date_time":return"Date/Time";case"date":return"Date";default:return""}},disabled:r,children:[e.jsx(t.SelectItem,{value:"date_time",children:" Date/Time "}),e.jsx(t.SelectItem,{value:"date",children:" Date "})]}),e.jsx(i.FieldCaption,{error:!!p,children:p}),e.jsxs(t.Select,{name:h,disabled:r,value:u??"",onValueChange:d=>s(h,d==="none"?null:d),renderValue:d=>{switch(d){case"on_create":return"On create";case"on_update":return"On any update";default:return"None"}},error:!!f,label:"Automatic value",children:[e.jsx(t.SelectItem,{value:"none",children:" None "}),e.jsx(t.SelectItem,{value:"on_create",children:" On create "}),e.jsx(t.SelectItem,{value:"on_update",children:" On any update "})]}),e.jsx(i.FieldCaption,{error:!!f,children:f??"Update this field automatically when creating or updating the entity"})]}),e.jsx("div",{className:"col-span-12",children:e.jsx(ae,{children:e.jsx(ie,{disabled:r})})})]})}function Or({disabled:r}){return e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx("div",{className:"col-span-12",children:e.jsx(g.Field,{type:"checkbox",name:"hideFromCollection",children:({field:l,form:s})=>e.jsx(Z,{label:"Hide from collection",disabled:r,form:s,tooltip:"Hide this field from the collection view. It will still be visible in the form view",field:l})})}),e.jsx("div",{className:"col-span-12",children:e.jsx(g.Field,{name:"readOnly",type:"checkbox",children:({field:l,form:s})=>e.jsx(Z,{label:"Read only",disabled:r,tooltip:"Is this a read only field. Display only as a preview",form:s,field:l})})})]})}function Vr({disabled:r}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"col-span-12",children:e.jsx(ae,{children:e.jsx(ie,{disabled:r})})})})}function Ge(r,a,o){let l;return a==="text_field"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"text_field",editable:r.editable!==void 0?r.editable:!0,storage:void 0,multiline:void 0,markdown:void 0,email:void 0,url:void 0,enumValues:void 0}):a==="multiline"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"multiline",editable:r.editable!==void 0?r.editable:!0,multiline:!0,storage:void 0,markdown:void 0,email:void 0,url:void 0,enumValues:void 0}):a==="markdown"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"markdown",editable:r.editable!==void 0?r.editable:!0,storage:void 0,multiline:void 0,markdown:!0,email:void 0,url:void 0}):a==="url"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"url",editable:r.editable!==void 0?r.editable:!0,storage:void 0,multiline:void 0,markdown:void 0,email:void 0,url:!0,enumValues:void 0}):a==="email"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"email",editable:r.editable!==void 0?r.editable:!0,storage:void 0,multiline:void 0,markdown:void 0,email:!0,url:void 0,enumValues:void 0}):a==="select"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"select",editable:r.editable!==void 0?r.editable:!0,storage:void 0,multiline:void 0,markdown:void 0,email:void 0,url:void 0,enumValues:r.enumValues??[]}):a==="multi_select"?l=i.mergeDeep(r,{dataType:"array",propertyConfig:"multi_select",editable:r.editable!==void 0?r.editable:!0,of:{dataType:"string",enumValues:r.of?.enumValues??[]}}):a==="number_input"?l=i.mergeDeep(r,{dataType:"number",propertyConfig:"number_input",editable:r.editable!==void 0?r.editable:!0,enumValues:void 0}):a==="number_select"?l=i.mergeDeep(r,{dataType:"number",propertyConfig:"number_select",editable:r.editable!==void 0?r.editable:!0,enumValues:r.enumValues??[]}):a==="multi_number_select"?l=i.mergeDeep(r,{dataType:"array",propertyConfig:"multi_number_select",editable:r.editable!==void 0?r.editable:!0,of:{dataType:"number",enumValues:r.of?.enumValues??[]}}):a==="file_upload"?l=i.mergeDeep(r,{dataType:"string",propertyConfig:"file_upload",editable:r.editable!==void 0?r.editable:!0,storage:{storagePath:"/"}}):a==="multi_file_upload"?l=i.mergeDeep(r,{dataType:"array",propertyConfig:"multi_file_upload",editable:r.editable!==void 0?r.editable:!0,of:{dataType:"string",storage:r.of?.storage??{storagePath:"/"}}}):a==="group"?l=i.mergeDeep(r,{dataType:"map",propertyConfig:"group",editable:r.editable!==void 0?r.editable:!0,keyValue:!1,properties:r.properties??{}}):a==="key_value"?l=i.mergeDeep(r,{dataType:"map",propertyConfig:"key_value",editable:r.editable!==void 0?r.editable:!0,keyValue:!0,properties:void 0}):a==="reference"?l=i.mergeDeep(r,{dataType:"reference",propertyConfig:"reference",editable:r.editable!==void 0?r.editable:!0}):a==="multi_references"?l=i.mergeDeep(r,{dataType:"array",propertyConfig:"multi_references",editable:r.editable!==void 0?r.editable:!0,of:{dataType:"reference"}}):a==="switch"?l=i.mergeDeep(r,{dataType:"boolean",propertyConfig:"switch",editable:r.editable!==void 0?r.editable:!0}):a==="date_time"?l=i.mergeDeep(r,{dataType:"date",propertyConfig:"date_time",editable:r.editable!==void 0?r.editable:!0,mode:"date_time"}):a==="repeat"?l=i.mergeDeep(r,{dataType:"array",propertyConfig:"repeat",editable:r.editable!==void 0?r.editable:!0}):a==="block"?l=i.mergeDeep(r,{dataType:"array",propertyConfig:"block",editable:r.editable!==void 0?r.editable:!0,oneOf:{properties:{}}}):a&&o[a]&&(l={...o[a].property,propertyConfig:a}),l}function Ke({value:r,optionDisabled:a,propertyConfig:o,existing:l}){return e.jsx(t.SelectItem,{value:r,disabled:a,className:"flex flex-row items-center",children:e.jsxs("div",{className:t.cn("flex flex-row items-center text-base min-h-[52px]",a?"w-full":""),children:[e.jsx("div",{className:"mr-8",children:e.jsx(i.PropertyConfigBadge,{propertyConfig:o})}),e.jsxs("div",{children:[e.jsx("div",{children:o.name}),e.jsx(t.Typography,{variant:"caption",color:"disabled",className:"max-w-sm",children:l&&a?"You can only switch to widgets that use the same data type":o.description})]})]})})}function xr({disabled:r,showErrors:a}){const{values:o,setFieldValue:l}=g.useFormex(),s=g.getIn(o,"url");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12",children:e.jsxs(t.Select,{disabled:r,position:"item-aligned",onValueChange:n=>{n==="[NONE]"?l("url",!0):l("url",n)},label:"Preview type",renderValue:n=>{switch(n){case"image":return"Image";case"video":return"Video";case"audio":return"Audio";default:return"Display URL"}},value:s??"[NONE]",children:[e.jsx(t.SelectItem,{value:"[NONE]",children:"Display URL"}),e.jsx(t.SelectItem,{value:"image",children:"Image"}),e.jsx(t.SelectItem,{value:"video",children:"Video"}),e.jsx(t.SelectItem,{value:"audio",children:"Audio"})]})}),e.jsx("div",{className:"col-span-12",children:e.jsx(ae,{children:e.jsx(pe,{disabled:r,max:!0,min:!0,trim:!0,showErrors:a})})}),e.jsx("div",{className:"col-span-12",children:e.jsx(t.TextField,{name:"defaultValue",disabled:r,onChange:n=>{l("defaultValue",n.target.value===""?void 0:n.target.value)},label:"Default value",value:g.getIn(o,"defaultValue")??""})})]})}const Er=["text_field","multiline","markdown","url","email","select","multi_select","number_input","number_select","multi_number_select","file_upload","multi_file_upload","reference","multi_references","switch","date_time","group","key_value","repeat","block"],We=Object.entries(i.DEFAULT_FIELD_CONFIGS).filter(([r])=>Er.includes(r)).map(([r,a])=>({[r]:a})).reduce((r,a)=>({...r,...a}),{}),Ze=P.memo(function(a){const{includeIdAndName:o=!0,autoOpenTypeSelect:l,existingProperty:s,autoUpdateId:n,inArray:c,propertyKey:p,existingPropertyKeys:h,propertyNamespace:u,property:f,onPropertyChanged:d,onPropertyChangedImmediate:v=!0,onDelete:m,onError:N,initialErrors:C,forceShowErrors:w,allowDataInference:b,getController:T,getData:S,propertyConfigs:k,collectionEditable:I}=a,V={id:"",name:""},F=!!(f&&!he(f))&&!I,E=P.useRef(f?{id:p,previousId:p,property:f}:void 0),A=({id:_,property:y})=>{const M={id:_,previousId:E.current?.id,property:y,namespace:u};E.current=M,d?.(M)},x=g.useCreateFormex({initialValues:f?{id:p,...f}:V,initialErrors:C,validateOnChange:!0,validateOnInitialRender:!0,onSubmit:(_,y)=>{console.debug("onSubmit",_);const{id:M,...W}=_;A({id:M,property:{...W,editable:W.editable??!0}}),s||y.resetForm({values:V})},validation:_=>{const y={};if(o){if(!_.name)y.name="Required";else{const M=Ar(_.name);M&&(y.name=M)}if(!_.id)y.id="Required";else{const M=Dr(_.id,h);M&&(y.id=M)}}return _.dataType==="string"&&_.validation?.matches&&!i.isValidRegExp(_.validation?.matches.toString())&&(y.validation={matches:"Invalid regular expression"}),_.dataType==="reference"&&!_.path&&(y.path="You must specify a target collection for the field"),_.propertyConfig==="repeat"&&(_.of||(y.of="You need to specify a repeat field")),_.propertyConfig==="block"&&(_.oneOf||(y.oneOf="You need to specify the properties of this block")),y}});return P.useEffect(()=>{T?.(x)},[x,T]),e.jsx(g.Formex,{value:x,children:e.jsx(Br,{onPropertyChanged:v?A:void 0,onDelete:m,includeIdAndTitle:o,propertyNamespace:u,onError:N,showErrors:w||x.submitCount>0,existing:s,autoUpdateId:n,inArray:c,autoOpenTypeSelect:l,disabled:F,getData:S,allowDataInference:b,propertyConfigs:k,collectionEditable:I,...x})})},(r,a)=>r.getData===a.getData&&r.propertyKey===a.propertyKey&&r.propertyNamespace===a.propertyNamespace&&r.includeIdAndName===a.includeIdAndName&&r.autoOpenTypeSelect===a.autoOpenTypeSelect&&r.autoUpdateId===a.autoUpdateId&&r.existingProperty===a.existingProperty);function de({open:r,onCancel:a,onOkClicked:o,onPropertyChanged:l,getData:s,collectionEditable:n,...c}){const p=P.useRef(),h=u=>{p.current=u};return e.jsx(t.Dialog,{open:r??!1,maxWidth:"xl",fullWidth:!0,children:e.jsxs("form",{noValidate:!0,autoComplete:"off",onSubmit:u=>{u.preventDefault(),u.stopPropagation(),p.current?.handleSubmit(u)},children:[e.jsx(t.DialogContent,{children:e.jsx(Ze,{...c,onPropertyChanged:u=>{l?.(u),o?.()},collectionEditable:n,onPropertyChangedImmediate:!1,getController:h,getData:s})}),e.jsxs(t.DialogActions,{children:[a&&e.jsx(t.Button,{variant:"text",onClick:()=>{a(),p.current?.resetForm()},children:"Cancel"}),e.jsx(t.Button,{variant:"outlined",type:"submit",color:"primary",children:"Ok"})]})]})})}function Br({values:r,errors:a,setValues:o,existing:l,autoUpdateId:s=!1,autoOpenTypeSelect:n,includeIdAndTitle:c,onPropertyChanged:p,onDelete:h,propertyNamespace:u,onError:f,showErrors:d,disabled:v,inArray:m,getData:N,allowDataInference:C,propertyConfigs:w,collectionEditable:b}){const[T,S]=P.useState(n),[k,I]=P.useState(!1),[V,F]=P.useState(r?.dataType?i.getFieldId(r):void 0),E=Object.entries(We).concat(Object.entries(w)),A=m?E.filter(([Y,j])=>!i.isPropertyBuilder(j.property)&&j.property?.dataType!=="array"):E,x=P.useDeferredValue(r),_=P.useRef(null),y=P.useRef(r),M=d&&g.getIn(a,"selectedWidget");P.useEffect(()=>{if(p&&(!c||x.id)){const{id:Y,...j}=x;te(x,y.current)||(p({id:Y,property:j,namespace:u}),y.current=x)}},[x,c,p,u]),P.useEffect(()=>{r?.id&&f&&f(r?.id,u,a)},[a,f,u,r?.id]);const W=Y=>{F(Y),o(Ge(r,Y,w)),setTimeout(()=>{_.current?.focus()},0)};let q;return V==="text_field"||V==="multiline"||V==="markdown"||V==="email"?q=e.jsx(Pr,{widgetId:V,disabled:v,showErrors:d}):V==="url"?q=e.jsx(xr,{disabled:v,showErrors:d}):V==="select"||V==="number_select"?q=e.jsx(qe,{multiselect:!1,allowDataInference:C,updateIds:!l,disabled:v,getData:N,showErrors:d}):V==="multi_select"||V==="multi_number_select"?q=e.jsx(qe,{multiselect:!0,updateIds:!l,disabled:v,allowDataInference:C,getData:N,showErrors:d}):V==="file_upload"?q=e.jsx($e,{existing:l,multiple:!1,disabled:v}):V==="multi_file_upload"?q=e.jsx($e,{existing:l,multiple:!0,disabled:v}):V==="switch"?q=e.jsx(Ir,{disabled:v}):V==="number_input"?q=e.jsx(wr,{disabled:v}):V==="group"?q=e.jsx(br,{disabled:v,getData:N,allowDataInference:C,collectionEditable:b,propertyConfigs:w}):V==="block"?q=e.jsx(Fr,{disabled:v,getData:N,allowDataInference:C,collectionEditable:b,propertyConfigs:w}):V==="reference"?q=e.jsx(He,{showErrors:d,existing:l,multiple:!1,disabled:v}):V==="date_time"?q=e.jsx(Sr,{disabled:v}):V==="multi_references"?q=e.jsx(He,{showErrors:d,existing:l,multiple:!0,disabled:v}):V==="repeat"?q=e.jsx(Cr,{showErrors:d,existing:l,getData:N,allowDataInference:C,disabled:v,collectionEditable:b,propertyConfigs:w}):V==="key_value"?q=e.jsx(Vr,{disabled:v}):q=null,e.jsxs(e.Fragment,{children:[v&&e.jsxs(t.InfoLabel,{mode:"warn",children:[e.jsx(t.Typography,{children:"This property can't be edited"}),e.jsxs(t.Typography,{variant:"caption",children:["You may not have permission to edit it or it is defined in code with no ",e.jsx("code",{children:"editable"})," flag"]})]}),e.jsxs("div",{className:"flex mt-2 justify-between",children:[e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx(t.Select,{error:!!M,value:V??"",placeholder:"Select a property widget",open:T,onOpenChange:S,position:"item-aligned",disabled:v,renderValue:Y=>{if(!Y)return e.jsx("em",{children:"Select a property widget"});const j=Y,H=i.DEFAULT_FIELD_CONFIGS[j]??w[j],Q=H.property,fe=Q&&!i.isPropertyBuilder(Q)?i.getFieldConfig(Q,w):void 0,le=i.isPropertyBuilder(Q)||l&&Q.dataType!==r?.dataType,X=fe?i.mergeDeep(fe,H):H;return e.jsxs("div",{onClick:G=>{le&&(G.stopPropagation(),G.preventDefault())},className:t.cn("flex items-center",le?"w-full pointer-events-none opacity-50":""),children:[e.jsx("div",{className:"mr-8",children:e.jsx(i.PropertyConfigBadge,{propertyConfig:X})}),e.jsxs("div",{className:"flex flex-col items-start text-base text-left",children:[e.jsx("div",{children:X.name}),e.jsx(t.Typography,{variant:"caption",color:"disabled",children:le?"You can only switch to widgets that use the same data type":X.description})]})]})},onValueChange:Y=>{W(Y)},children:A.map(([Y,j])=>{const H=j.property,Q=l&&!i.isPropertyBuilder(H)&&H.dataType!==r?.dataType;return e.jsx(Ke,{value:Y,optionDisabled:Q,propertyConfig:j,existing:l},Y)})}),M&&e.jsx(t.Typography,{variant:"caption",className:"ml-3.5",color:"error",children:"Required"})]}),h&&r?.id&&e.jsx(t.IconButton,{variant:"ghost",className:"m-4",disabled:v,onClick:()=>I(!0),children:e.jsx(t.DeleteIcon,{})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-y-12 mt-8 mb-8",children:[c&&e.jsx(Tr,{showErrors:d,disabledId:l,isNewProperty:!l,disabled:v,autoUpdateId:s,ref:_}),q,e.jsx("div",{className:"col-span-12",children:e.jsx(Or,{disabled:v})})]}),h&&e.jsx(i.DeleteConfirmationDialog,{open:k,onAccept:()=>h(r?.id,u),onCancel:()=>I(!1),title:e.jsx("div",{children:"Delete this property?"}),body:e.jsxs("div",{children:[" This will ",e.jsx("b",{children:"not delete any data"}),", only modify the collection."]})})]})}const _r=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function Dr(r,a){let o;return r||(o="You must specify an id for the field"),r&&!r.match(_r)&&(o="The id can only contain letters, numbers and underscores (_), and not start with a number"),r&&a&&a.includes(r)&&(o="There is another field with this ID already"),o}function Ar(r){let a;return r||(a="You must specify a title for the field"),a}function Mr(r){return r?(r.slice(0,1).toLowerCase()+r.slice(1)).replace(/([-_ ]){1,}/g," ").split(/[-_ ]/).reduce((a,o)=>a+o[0].toUpperCase()+o.substring(1),""):""}function zr({collection:r,onOpenChange:a,open:o}){const l=i.useSnackbarController(),s=r?`import { EntityCollection } from "firecms";

const `+(r?.name?Mr(r.name):"my")+"Collection:EntityCollection = "+dr.stringify(Je(r),null,"	"):"No collection selected";return e.jsxs(t.Dialog,{open:o,onOpenChange:a,maxWidth:"4xl",children:[e.jsxs(t.DialogContent,{children:[e.jsxs(t.Typography,{variant:"h6",className:"my-4",children:["Code for ",r.name]}),e.jsxs(t.Typography,{variant:"body2",className:"my-4 mb-8",children:["If you want to customise the collection in code, you can add this collection code to your CMS app configuration. More info in the ",e.jsx("a",{rel:"noopener noreferrer",href:"https://firecms.co/docs/customization_quickstart",children:"docs"}),"."]}),e.jsx(Ue.Highlight,{theme:Ue.themes.vsDark,code:s,language:"typescript",children:({className:n,style:c,tokens:p,getLineProps:h,getTokenProps:u})=>e.jsx("pre",{style:c,className:"p-4 rounded text-sm",children:p.map((f,d)=>e.jsx("div",{...h({line:f}),children:f.map((v,m)=>e.jsx("span",{...u({token:v})},m))},d))})})]}),e.jsxs(t.DialogActions,{children:[e.jsxs(t.Button,{variant:"text",size:"small",onClick:n=>(n.stopPropagation(),n.preventDefault(),l.open({type:"success",message:"Copied"}),navigator.clipboard.writeText(s)),children:[e.jsx(t.ContentCopyIcon,{size:"small"}),"Copy to clipboard"]}),e.jsx(t.Button,{onClick:()=>a(!1),children:"Close"})]})]})}function Je(r){const a=o=>{const l={...o};return delete l.fromBuilder,delete l.resolved,delete l.propertiesOrder,delete l.editable,l.type==="map"?{...l,properties:l.properties.map(a)}:l};return{id:r.id,name:r.name,singularName:r.singularName,path:r.path,description:r.description,editable:!0,collectionGroup:r.collectionGroup,icon:r.icon,group:r.group,customId:r.customId,initialFilter:r.initialFilter,initialSort:r.initialSort,properties:Object.entries(r.properties??{}).map(([o,l])=>({[o]:a(l)})).reduce((o,l)=>({...o,...l}),{}),subcollections:(r.subcollections??[]).map(Je)}}function Ur({showErrors:r,isNewCollection:a,propertyErrorsRef:o,onPropertyError:l,setDirty:s,reservedGroups:n,extraIcon:c,getUser:p,getData:h,doCollectionInference:u,propertyConfigs:f,collectionEditable:d}){const{values:v,setFieldValue:m,setFieldError:N,setFieldTouched:C,errors:w,dirty:b}=g.useFormex(),T=i.useSnackbarController(),S=i.useLargeLayout(),k=!S,[I,V]=P.useState(),[F,E]=P.useState(),[A,x]=P.useState(),_=F?K(F,A):void 0,y=_?g.getIn(v.properties,_.replaceAll(".",".properties.")):void 0,[M,W]=P.useState(!1),[q,Y]=P.useState(!1),[j,H]=P.useState(!1),[Q,fe]=P.useState([]),le=P.useRef(v.propertiesOrder?{"":v.propertiesOrder}:{});P.useEffect(()=>{s&&s(b)},[b]);const X=u?()=>{u&&(Y(!0),u(v).then(D=>{if(D&&i.makePropertiesEditable(D.properties),!D){T.open({type:"error",message:"Could not infer properties from data"});return}const L=(D.properties?Object.keys(D.properties):[]).filter(z=>!v.properties[z]);if(L.length===0){T.open({type:"info",message:"No new properties found in existing data"});return}const O={...L.reduce((z,$)=>(z[$]=(D.properties??{})[$],z),{}),...v.properties},B=[...L,...v.propertiesOrder??[]];m("properties",O,!1),oe(B),fe(L)}).finally(()=>{Y(!1)}))}:void 0,G=P.useCallback(D=>D?le.current[D]??g.getIn(v,R(D)):le.current[""],[v]),oe=P.useCallback((D,L)=>{const O=R(L);m(O,D,!1),le.current[L??""]=D},[m]),ce=P.useCallback((D,L)=>{const O=D?K(D,L):void 0;if(!O)throw Error("collection editor miss config");m(J(O),void 0,!1);const z=G(L).filter($=>$!==D);oe(z,L),H(!1),V(void 0),E(void 0),x(void 0)},[G,m,oe]),Te=(D,L)=>{m(R(L),D,!1)},Ae=({id:D,property:L})=>{if(!D)throw Error("Need to include an ID when creating a new property");m("properties",{...v.properties??{},[D]:L},!1);const O=[...v.propertiesOrder??Object.keys(v.properties),D];oe(O),H(!1),S&&(V(O.indexOf(D)),E(D)),x(void 0)},re=({id:D,property:L,previousId:O,namespace:B})=>{const z=D?K(D,B):void 0,$=z?J(z):void 0;if(O&&O!==D){console.debug("onPropertyChanged, id change",{id:D,property:L,previousId:O,namespace:B});const ne=K(O,B),ke=J(ne),sr=G(B).map(Oe=>Oe===O?D:Oe).filter(Oe=>Oe!==void 0);oe(sr,B),D&&(V(sr.indexOf(D)),E(D)),m(ke,void 0,!1),C(ke,!1,!1)}console.debug("onPropertyChanged",{id:D,property:L,previousId:O,namespace:B,propertyPath:$}),$&&(m($,L,!1),C($,!0,!1))},Pe=P.useCallback((D,L,O)=>{const B=D?K(D,L):void 0;if(console.debug("onPropertyErrorInternal",{id:D,namespace:L,error:O,propertyPath:B}),B){const z=O&&Object.keys(O).length>0;l(D,L,z?O:void 0),N(J(B),z?"Property error":void 0)}},[]),Ie=()=>{V(void 0),E(void 0)},Fe=F&&o?.current?.properties?o.current.properties[F]:void 0,Ne=v?.propertiesOrder===void 0||v.propertiesOrder.length===0,ue=v.propertiesOrder?v.propertiesOrder:Object.keys(v.properties),we=P.useMemo(()=>v.ownerId&&p?p(v.ownerId):null,[p,v.ownerId]),Me=P.useCallback((D,L)=>{console.debug("CollectionEditor: onPropertyClick",{propertyKey:D,namespace:L}),V(ue.indexOf(D)),E(D),x(L)},[ue]),ze=e.jsxs("div",{className:"grid grid-cols-12 gap-2 h-full bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:t.cn("p-4 md:p-8 pb-20 md:pb-20","col-span-12 lg:col-span-5 h-full overflow-auto",!k&&"border-r "+t.defaultBorderMixin),children:[e.jsxs("div",{className:"flex my-2",children:[e.jsxs("div",{className:"flex-grow mb-4",children:[e.jsx(g.Field,{name:"name",as:t.DebouncedTextField,invisible:!0,className:"-ml-1",inputClassName:"text-2xl font-headers",placeholder:"Collection name",size:"small",required:!0,error:!!w?.name}),we&&e.jsxs(t.Typography,{variant:"body2",className:"ml-2",color:"secondary",children:["Created by ",we.displayName]})]}),c&&e.jsx("div",{className:"ml-4",children:c}),e.jsxs("div",{className:"ml-1 mt-2 flex flex-row gap-2",children:[e.jsx(t.Tooltip,{title:"Get the code for this collection",children:e.jsx(t.IconButton,{variant:"filled",disabled:q,onClick:()=>W(!0),children:e.jsx(t.CodeIcon,{})})}),X&&e.jsx(t.Tooltip,{title:"Add new properties based on data",children:e.jsx(t.IconButton,{variant:"filled",disabled:q,onClick:X,children:q?e.jsx(t.CircularProgress,{size:"small"}):e.jsx(t.AutoAwesomeIcon,{})})}),e.jsx(t.Tooltip,{title:"Add new property",children:e.jsx(t.Button,{variant:"outlined",onClick:()=>H(!0),children:e.jsx(t.AddIcon,{})})})]})]}),e.jsx(i.ErrorBoundary,{children:e.jsx(me,{className:"pl-8",inferredPropertyKeys:Q,selectedPropertyKey:F?K(F,A):void 0,properties:v.properties,additionalFields:v.additionalFields,propertiesOrder:ue,onPropertyClick:Me,onPropertyMove:Te,onPropertyRemove:a?ce:void 0,collectionEditable:d,errors:w})}),e.jsx(t.Button,{className:"mt-8 w-full",color:"primary",variant:"outlined",size:"large",onClick:()=>H(!0),startIcon:e.jsx(t.AddIcon,{}),children:"Add new property"})]}),!k&&e.jsx("div",{className:"col-span-12 lg:col-span-7 p-4 md:py-8 md:px-4 h-full overflow-auto pb-20 md:pb-20",children:e.jsxs(t.Paper,{className:"sticky top-8 p-4 min-h-full border border-transparent w-full flex flex-col justify-center ",children:[_&&y&&!i.isPropertyBuilder(y)&&e.jsx(Ze,{inArray:!1,existingProperty:!a,autoUpdateId:!1,allowDataInference:!a,autoOpenTypeSelect:!1,propertyKey:F,propertyNamespace:A,property:y,onPropertyChanged:re,onDelete:ce,onError:Pe,forceShowErrors:r,initialErrors:Fe,getData:h,propertyConfigs:f,collectionEditable:d},`edit_view_${I}`),!y&&e.jsxs("div",{className:"w-full flex flex-col items-center justify-center h-full gap-4",children:[e.jsx(t.Typography,{variant:"label",className:"",children:Ne?"Now you can add your first property":"Select a property to edit it"}),e.jsxs(t.Button,{variant:"outlined",onClick:()=>H(!0),children:[e.jsx(t.AddIcon,{}),"Add new property"]})]}),y&&i.isPropertyBuilder(y)&&e.jsx(t.Typography,{variant:"label",className:"flex items-center justify-center",children:"This property is defined as a property builder in code"})]})}),k&&e.jsx(de,{inArray:!1,open:I!==void 0,autoUpdateId:!y,allowDataInference:!a,existingProperty:!0,autoOpenTypeSelect:!1,propertyKey:F,propertyNamespace:A,property:y,onPropertyChanged:re,onDelete:ce,onError:Pe,forceShowErrors:r,initialErrors:Fe,getData:h,propertyConfigs:f,collectionEditable:d,onOkClicked:k?Ie:void 0},`edit_view_${I}`)]});return e.jsxs(e.Fragment,{children:[ze,e.jsx(de,{inArray:!1,existingProperty:!1,autoOpenTypeSelect:!0,autoUpdateId:!0,forceShowErrors:r,open:j,onCancel:()=>H(!1),onPropertyChanged:Ae,getData:h,allowDataInference:!a,propertyConfigs:f,collectionEditable:d,existingPropertyKeys:v.propertiesOrder}),e.jsx(i.ErrorBoundary,{children:e.jsx(zr,{collection:v,open:M,onOpenChange:W})})]})}function Lr({open:r,handleOk:a,handleCancel:o,body:l,title:s}){return e.jsxs(t.Dialog,{open:r,onOpenChange:n=>n?o():a(),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsxs(t.DialogContent,{children:[e.jsx(t.Typography,{variant:"h6",children:s??"Unsaved changes"}),l&&e.jsx(t.Typography,{children:l}),e.jsx(t.Typography,{children:"Are you sure?"})]}),e.jsxs(t.DialogActions,{children:[e.jsx(t.Button,{variant:"text",onClick:o,autoFocus:!0,children:" Cancel "}),e.jsx(t.Button,{onClick:a,children:" Ok "})]})]})}function qr({open:r,onClose:a}){const{entityViews:o}=i.useCustomizationController();return e.jsxs(t.Dialog,{maxWidth:"md",open:r,children:[e.jsxs(t.DialogContent,{className:"flex flex-col gap-4",children:[e.jsx(t.Typography,{variant:"h6",children:"Select view"}),o?.map(l=>e.jsxs(t.Button,{onClick:()=>a(l.key),fullWidth:!0,variant:"text",children:[l.name," (",l.key,")"]},l.key)),(o??[]).length===0&&e.jsx(t.Typography,{variant:"body2",children:"No custom views defined"})]}),e.jsx(t.DialogActions,{children:e.jsx(t.Button,{variant:"outlined",onClick:()=>a(),children:"Cancel"})})]})}function $r({collection:r,parentCollection:a,configController:o,collectionInference:l,getUser:s,parentCollectionIds:n}){const{entityViews:c}=i.useCustomizationController(),[p,h]=P.useState(),[u,f]=P.useState(!1),[d,v]=P.useState(),[m,N]=P.useState(),{values:C,setFieldValue:w}=g.useFormex(),b=r.subcollections??[],T=C.entityViews?.filter(I=>typeof I=="string").map(I=>i.resolveEntityView(I,c)).filter(Boolean)??[],S=r.entityViews?.filter(I=>typeof I!="string")??[],k=T.length+S.length;return e.jsxs("div",{className:"overflow-auto my-auto",children:[e.jsx(t.Container,{maxWidth:"2xl",className:"flex flex-col gap-4 p-8 m-auto",children:e.jsxs("div",{className:"flex  flex-col gap-16",children:[e.jsxs("div",{className:"flex-grow flex flex-col gap-4 items-start",children:[e.jsxs(t.Typography,{variant:"h5",children:["Subcollections of ",C.name]}),e.jsxs(t.Paper,{className:"flex flex-col gap-4 p-2 w-full",children:[b&&b.length>0&&e.jsx(t.Table,{children:e.jsx(t.TableBody,{children:b.map(I=>e.jsxs(t.TableRow,{onClick:()=>N({isNewCollection:!1,editedCollectionId:I.id}),children:[e.jsx(t.TableCell,{align:"left",children:e.jsx(t.Typography,{variant:"subtitle2",className:"flex-grow",children:I.name})}),e.jsx(t.TableCell,{align:"right",children:e.jsx(t.Tooltip,{title:"Remove",children:e.jsx(t.IconButton,{size:"small",onClick:V=>{V.preventDefault(),V.stopPropagation(),h(I.id)},color:"inherit",children:e.jsx(t.DeleteIcon,{size:"small"})})})})]},I.path))})}),e.jsx(t.Button,{onClick:()=>{N({isNewCollection:!0})},variant:"text",startIcon:e.jsx(t.AddIcon,{}),children:"Add subcollection"})]})]}),e.jsxs("div",{className:"flex-grow  flex flex-col gap-4 items-start",children:[e.jsx(t.Typography,{variant:"h5",children:"Custom views"}),k===0&&e.jsx(t.Alert,{action:e.jsx(t.Button,{variant:"text",size:"small",href:"https://firecms.co/docs/customization_quickstart",component:"a",rel:"noopener noreferrer",target:"_blank",children:"More info"}),children:"Define your own custom views by uploading them with the CLI."}),e.jsx(e.Fragment,{children:e.jsxs(t.Paper,{className:"flex flex-col gap-4 p-2 w-full",children:[e.jsx(t.Table,{children:e.jsxs(t.TableBody,{children:[T.map(I=>e.jsxs(t.TableRow,{children:[e.jsx(t.TableCell,{align:"left",children:e.jsx(t.Typography,{variant:"subtitle2",className:"flex-grow",children:I.name})}),e.jsx(t.TableCell,{align:"right",children:e.jsx(t.Tooltip,{title:"Remove",children:e.jsx(t.IconButton,{size:"small",onClick:V=>{V.preventDefault(),V.stopPropagation(),v(I.key)},color:"inherit",children:e.jsx(t.DeleteIcon,{size:"small"})})})})]},I.key)),S.map(I=>e.jsx(t.TableRow,{children:e.jsxs(t.TableCell,{align:"left",children:[e.jsx(t.Typography,{variant:"subtitle2",className:"flex-grow",children:I.name}),e.jsxs(t.Typography,{variant:"caption",className:"flex-grow",children:["This view is defined in code with key ",e.jsx("code",{children:I.key})]})]})},I.key))]})}),e.jsx(t.Button,{onClick:()=>{f(!0)},variant:"text",startIcon:e.jsx(t.AddIcon,{}),children:"Add custom entity view"})]})})]})]})}),e.jsx("div",{style:{height:"52px"}}),p&&e.jsx(i.DeleteConfirmationDialog,{open:!!p,onAccept:()=>{const I={id:p,parentCollectionIds:[...n??[],r.id]};console.debug("Deleting subcollection",I),o.deleteCollection(I),h(void 0)},onCancel:()=>h(void 0),title:e.jsx(e.Fragment,{children:"Delete this subcollection?"}),body:e.jsxs(e.Fragment,{children:[" This will ",e.jsx("b",{children:"not delete any data"}),", only the collection in the CMS"]})}),d&&e.jsx(i.DeleteConfirmationDialog,{open:!!d,onAccept:()=>{w("entityViews",C.entityViews?.filter(I=>I!==d)),v(void 0)},onCancel:()=>v(void 0),title:e.jsx(e.Fragment,{children:"Remove this view?"}),body:e.jsxs(e.Fragment,{children:["This will ",e.jsx("b",{children:"not delete any data"}),", only the view in the CMS"]})}),e.jsx(tr,{open:!!m,configController:o,parentCollection:r,collectionInference:l,parentCollectionIds:[...n??[],C.id],isNewCollection:!1,...m,getUser:s,handleClose:()=>{N(void 0)}}),e.jsx(qr,{open:u,onClose:I=>{I&&w("entityViews",[...C.entityViews??[],I]),f(!1)}})]})}const Qe={id:"products",path:"products",name:"Products",singularName:"Product",icon:"shopping_cart",description:"List of the products currently sold in your shop",properties:i.makePropertiesEditable({name:{dataType:"string",name:"Name",description:"Name of this product",validation:{required:!0}},brand:{dataType:"string",name:"Brand",validation:{required:!0}},description:{dataType:"string",name:"Description",description:"Description of this product, supports markdown",markdown:!0},main_image:{dataType:"string",name:"Image",storage:{storagePath:"images",acceptedFiles:["image/*"]},description:"Upload field for images"},available:{dataType:"boolean",name:"Available",columnWidth:100,description:"Is this product available in the website"},price:{dataType:"number",name:"Price",validation:{requiredMessage:"You must set a positive price",min:0}},images:{dataType:"array",name:"Images",hideFromCollection:!0,of:{dataType:"string",storage:{storagePath:"images",acceptedFiles:["image/*"]}}},related_products:{dataType:"array",name:"Related products",description:"Products related to this one",of:{dataType:"reference",path:"products"}},metadata:{name:"Metadata",description:"This is an example of a map property",dataType:"map",keyValue:!0},added_on:{dataType:"date",name:"Added on",autoValue:"on_create"}})},Xe={id:"blog",path:"blog",name:"Blog",singularName:"Blog entry",icon:"article",description:"A collection of blog entries",defaultSize:"l",properties:i.makePropertiesEditable({name:{name:"Name",validation:{required:!0},dataType:"string"},header_image:{name:"Header image",dataType:"string",storage:{storagePath:"images",acceptedFiles:["image/*"],metadata:{cacheControl:"max-age=1000000"}}},content:{name:"Content",description:"Content blocks for the blog entry",validation:{required:!0},dataType:"array",oneOf:{typeField:"type",valueField:"value",properties:{text:{dataType:"string",name:"Text",markdown:!0},quote:{dataType:"string",name:"Quote",multiline:!0},images:{name:"Images",dataType:"array",of:{dataType:"string",storage:{storagePath:"images",acceptedFiles:["image/*"],metadata:{cacheControl:"max-age=1000000"}}},description:"This fields allows uploading multiple images at once and reordering"},products:{name:"Products",dataType:"array",of:{dataType:"reference",path:"products",previewProperties:["name","main_image"]}}},propertiesOrder:["text","quote","images","products"]}},created_on:{name:"Created on",dataType:"date",autoValue:"on_create"},status:{name:"Status",validation:{required:!0},dataType:"string",enumValues:{published:{id:"published",label:"Published"},draft:"Draft"},defaultValue:"draft"},publish_date:{name:"Publish date",dataType:"date",clearable:!0},reviewed:{name:"Reviewed",dataType:"boolean"},tags:{name:"Tags",description:"Example of generic array",dataType:"array",of:{dataType:"string",previewAsTag:!0}}}),initialFilter:{status:["==","published"]}},Re={id:"users",path:"users",name:"Users",singularName:"User",description:"Registered users in the app/web",icon:"person",properties:i.makePropertiesEditable({displayName:{name:"Display name",dataType:"string"},email:{name:"Email",dataType:"string",email:!0},emailVerified:{name:"Email verified",dataType:"boolean"},phone:{name:"Phone",dataType:"string"},favourite_products:{name:"Favourite products",dataType:"array",of:{dataType:"reference",path:"products"}},photoURL:{name:"Photo URL",dataType:"string",url:"image"}})},er={id:"pages",path:"pages",name:"Pages",singularName:"Page",icon:"insert_drive_file",description:"List of website pages that can be edited here",properties:{title:{dataType:"string",name:"Page Title",validation:{required:!0}},slug:{dataType:"string",name:"URL Slug",validation:{required:!0,unique:!0,matches:/^[a-z0-9]+(?:-[a-z0-9]+)*$/,matchesMessage:"Must be lowercase, alphanumeric, and hyphenated"}},hero_section:{dataType:"map",name:"Hero Section",properties:{headline:{dataType:"string",name:"Headline",validation:{required:!0}},subhead:{dataType:"string",name:"Subheadline"},background_image:{dataType:"string",name:"Background Image",storage:{storagePath:"page_hero/images",acceptedFiles:["image/*"]}},call_to_action:{dataType:"string",name:"Call to Action"},call_to_action_link:{dataType:"string",name:"CTA Link",url:!0}}},content:{dataType:"array",name:"Content",oneOf:{properties:{section:{dataType:"map",name:"Section",properties:{title:{dataType:"string",name:"Section Title",validation:{required:!0}},content:{dataType:"string",name:"Section Content",markdown:!0},image:{dataType:"string",name:"Section Image",storage:{storagePath:"page_sections/images",acceptedFiles:["image/*"]}},link:{dataType:"string",name:"Section Link",url:!0}}},image:{dataType:"string",name:"Image",storage:{storagePath:"page_sections/images",acceptedFiles:["image/*"]}},slider:{dataType:"array",name:"Slider",of:{dataType:"map",properties:{title:{dataType:"string",name:"Title",validation:{required:!0}},image:{dataType:"string",storage:{storagePath:"page_sections/images",acceptedFiles:["image/*"]}}}}}}}},sidebar:{dataType:"map",name:"Sidebar",properties:{title:{dataType:"string",name:"Sidebar Title",validation:{required:!1}},content:{dataType:"string",name:"Sidebar Content",markdown:!0}}},seo_metadata:{dataType:"map",name:"SEO Metadata",properties:{meta_title:{dataType:"string",name:"Meta Title"},meta_description:{dataType:"string",name:"Meta Description"},focus_keywords:{dataType:"array",name:"Focus Keywords",of:{dataType:"string"}}}},footer_override:{dataType:"string",name:"Footer Override",markdown:!0},publish_date:{dataType:"date",name:"Publish Date",validation:{required:!0}},last_updated:{dataType:"date",name:"Last Updated",autoValue:"on_update"},is_published:{dataType:"boolean",name:"Is Published",columnWidth:100,description:"Should this page be live on the site?"},author_uid:{dataType:"reference",name:"Author",path:"users"}}};function jr({path:r,pathSuggestions:a,parentCollection:o,onContinue:l,existingCollectionPaths:s}){const[n,c]=P.useState(!1),[p,h]=P.useState();P.useEffect(()=>{a&&s&&(c(!0),a(r).then(m=>{const N=m.filter(C=>!(s??[]).find(w=>w.trim().toLowerCase()===C.trim().toLowerCase()));h(N)}).finally(()=>c(!1)))},[s,r,a]);const{values:u,setFieldValue:f,setValues:d,submitCount:v}=g.useFormex();return e.jsx("div",{className:"overflow-auto my-auto",children:e.jsxs(t.Container,{maxWidth:"4xl",className:"flex flex-col gap-4 p-8 m-auto",children:[e.jsx("div",{className:"flex flex-row py-2 pt-3 items-center",children:e.jsx(t.Typography,{variant:"h4",className:"flex-grow",children:"New collection"})}),o&&e.jsx(t.Chip,{colorScheme:"tealDarker",children:e.jsxs(t.Typography,{variant:"caption",children:["This is a subcollection of ",e.jsx("b",{children:o.name})]})}),e.jsxs("div",{className:"my-2",children:[e.jsx(t.Typography,{variant:"caption",color:"secondary",children:"● Use one of the existing paths in your database:"}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 gap-y-1 items-center my-2 min-h-7",children:[n&&!p&&e.jsx(t.CircularProgress,{size:"small"}),p?.map((m,N)=>e.jsx(t.Chip,{colorScheme:"cyanLighter",onClick:()=>{f("name",i.unslugify(m)),f("id",m),f("path",m),f("properties",void 0),l()},size:"small",children:m},m)),!n&&(p??[])?.length===0&&e.jsx(t.Typography,{variant:"caption",children:"No suggestions"})]})]}),e.jsxs("div",{className:"my-2",children:[e.jsx(t.Typography,{variant:"caption",color:"secondary",children:"● Select a template:"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(be,{title:"Products",subtitle:"A collection of products with images, prices and stock",icon:e.jsx(t.Icon,{size:"small",iconKey:Qe.icon}),onClick:()=>{d(Qe),l()}}),e.jsx(be,{title:"Users",subtitle:"A collection of users with emails, names and roles",icon:e.jsx(t.Icon,{size:"small",iconKey:Re.icon}),onClick:()=>{d(Re),l()}}),e.jsx(be,{title:"Blog posts",subtitle:"A collection of blog posts with images, authors and complex content",icon:e.jsx(t.Icon,{size:"small",iconKey:Xe.icon}),onClick:()=>{d(Xe),l()}}),e.jsx(be,{title:"Pages",subtitle:"A collection of pages with images, authors and complex content",icon:e.jsx(t.Icon,{size:"small",iconKey:er.icon}),onClick:()=>{d(er),l()}})]})]}),!o&&e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"caption",color:"secondary",className:"mb-2",children:"● Create a collection from a file (csv, json, xls, xslx...)"}),e.jsx(se.ImportFileUpload,{onDataAdded:(m,N)=>l(m,N)})]}),e.jsx("div",{children:e.jsx(t.Button,{variant:"text",onClick:()=>l(),className:"my-2",children:"Continue from scratch"})})]})})}function be({title:r,subtitle:a,icon:o,onClick:l}){return e.jsx(t.Tooltip,{title:a,children:e.jsxs(t.Card,{onClick:l,className:t.cn("my-2 rounded-md border mx-0 p-6 px-4 focus:outline-none transition ease-in-out duration-150 flex flex-row gap-4 items-center","text-gray-700 dark:text-slate-300","hover:border-primary-dark hover:text-primary-dark dark:hover:text-primary focus:ring-primary hover:ring-1 hover:ring-primary","border-gray-400 dark:border-gray-600 "),children:[o,e.jsx("div",{className:"flex flex-col items-start",children:e.jsx(t.Typography,{variant:"subtitle1",children:r})})]})})}function Yr({importConfig:r,propertyConfigs:a,collectionEditable:o}){const{setFieldValue:l,setFieldTouched:s,values:n}=g.useFormex(),[c,p]=P.useState(void 0),h=P.useRef(n.propertiesOrder?{"":n.propertiesOrder}:{}),u=c?c.id:void 0,f=c||void 0,d=({id:m,property:N,previousId:C,namespace:w})=>{const b=m?K(m,w):void 0,T=b?J(b):void 0,S=I=>I?h.current[I]??g.getIn(n,R(I)):h.current[""],k=(I,V)=>{const F=R(V);l(F,I,!1),h.current[V??""]=I};if(C&&C!==m){const I=K(C,w),V=J(I),E=S(w).map(x=>x===C?m:x).filter(x=>x!==void 0);k(E,w);const A={...r.headersMapping};Object.keys(A).forEach(x=>{A[x]===C&&(A[x]=m??"")}),r.setHeadersMapping(A),l(V,void 0,!1),s(V,!1,!1)}T&&(l(T,N,!1),s(T,!0,!1))},v=async({id:m,importKey:N,property:C,namespace:w})=>{const b=m?K(m,w):void 0,T=b?J(b):void 0,S=r.importData.map(I=>g.getIn(I,N)),k={...Ve.buildPropertyFromData(S,C,se.getInferenceType),editable:!0};T&&(k?l(T,k,!1):l(T,C,!1),s(T,!0,!1))};return e.jsxs("div",{className:"overflow-auto my-auto",children:[e.jsxs(t.Container,{maxWidth:"6xl",className:"flex flex-col gap-4 p-8 m-auto",children:[e.jsx(t.Typography,{variant:"h6",className:"my-4 ml-3.5",children:"Data property mapping"}),e.jsx(se.DataNewPropertiesMapping,{importConfig:r,destinationProperties:n.properties,buildPropertyView:({property:m,propertyKey:N,importKey:C,isIdColumn:w})=>w?e.jsx(t.Typography,{children:" This column will be used as ID"}):e.jsx(se.ImportNewPropertyFieldPreview,{property:m,propertyKey:N,onPropertyNameChanged:(b,T)=>l(`properties.${b}.name`,T,!1),onEditClick:()=>{!N||!m||p({...m,id:N,editable:!0})},propertyTypeView:e.jsx(Hr,{property:m,disabled:!1,onPropertyChanged:b=>v({...b,importKey:C}),propertyKey:N,propertyConfigs:a})})})]}),e.jsx(de,{open:c!==void 0,propertyKey:u,property:f,inArray:!1,autoUpdateId:!1,onPropertyChanged:d,allowDataInference:!1,collectionEditable:o,onOkClicked:()=>{p(void 0)},onCancel:()=>{p(void 0)},autoOpenTypeSelect:!1,existingProperty:!1,propertyConfigs:a}),e.jsx("div",{style:{height:"52px"}})]})}function Hr({property:r,onPropertyChanged:a,propertyKey:o,propertyConfigs:l,disabled:s}){const n=r?i.getFieldId(r):null,c=r?i.getFieldConfig(r,l):null,[p,h]=P.useState(!1);return e.jsx(t.Tooltip,{title:r&&c?`${c?.name} - ${r.dataType}`:void 0,open:p?!1:void 0,children:e.jsx(t.Select,{open:p,onOpenChange:h,invisible:!0,className:"w-full",disabled:s,error:!c,value:n??"",placeholder:"Select a property widget",position:"item-aligned",renderValue:u=>c?e.jsx(i.PropertyConfigBadge,{propertyConfig:c}):null,onValueChange:u=>{const f=Ge(r,u,l);o&&a({id:o,property:f,previousId:o,namespace:void 0})},children:Object.entries(We).map(([u,f])=>e.jsx(Ke,{value:u,optionDisabled:!1,propertyConfig:f,existing:!1},u))})})}function Gr({importConfig:r,properties:a,propertiesOrder:o}){const[l,s]=P.useState(!1);async function n(){const p=r.importData.map(h=>se.convertDataToEntity(h,r.idColumn,r.headersMapping,a,"TEMP_PATH",r.defaultValues));r.setEntities(p)}P.useEffect(()=>{n().finally(()=>s(!1))},[]);const c=i.useSelectionController();return l?e.jsx(i.CircularProgressCenter,{}):e.jsx(i.EntityCollectionTable,{title:e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"subtitle2",children:"Imported data preview"}),e.jsx(t.Typography,{variant:"caption",children:"Entities with the same id will be overwritten"})]}),tableController:{data:r.entities,dataLoading:!1,noMoreToLoad:!1},endAdornment:e.jsx("div",{className:"h-12"}),filterable:!1,sortable:!1,selectionController:c,displayedColumnIds:o.map(p=>({key:p,disabled:!1})),properties:a})}function rr(r,a=""){const o=Object.keys(r).reduce((n,c)=>{const p=r[c],h=i.slugify(c),u=a?`${a}.${h}`:h;if(p.dataType==="map"&&p.properties){const v=rr(p.properties,u);return{headersMapping:{...n.headersMapping,[c]:u},properties:{...n.properties,[h]:{...p,properties:v.properties,propertiesOrder:Object.keys(v.properties)}}}}const f={...n.properties,[h]:p};return{headersMapping:{...n.headersMapping,[c]:u},properties:f}},{headersMapping:{},properties:{}}),l=Object.keys(o.headersMapping)?.[0];let s;return(l?.includes("id")||l?.includes("key"))&&(s=l),{...o,idColumn:s}}function tr(r){const a=r.open,[o,l]=ge.useState(!1),[s,n]=ge.useState(!1),c=P.useCallback(()=>{o?n(!0):r.handleClose(void 0)},[o,r.handleClose]);return P.useEffect(()=>{a||(l(!1),n(!1))},[a]),e.jsxs(t.Dialog,{open:a,fullWidth:!0,fullHeight:!0,scrollable:!1,maxWidth:"7xl",onOpenChange:p=>p?void 0:c(),children:[a&&e.jsx(Kr,{...r,handleCancel:c,setFormDirty:l}),e.jsx(Lr,{open:s,handleOk:()=>r.handleClose(void 0),handleCancel:()=>n(!1),body:"There are unsaved changes in this collection"})]})}function Kr(r){const{propertyConfigs:a}=i.useCustomizationController(),o=i.useNavigationController(),l=i.useAuthController(),{topLevelNavigation:s,collections:n}=o,c=r.initialValues,p=!c?.path&&(r.parentCollectionIds??[]).length===0,h=(r.parentCollection?r.parentCollection.subcollections:n)??[],u=h.map(T=>T.path.trim().toLowerCase()),f=h.map(T=>T.id?.trim().toLowerCase()).filter(Boolean),[d,v]=ge.useState(),[m,N]=ge.useState(!1);if(P.useEffect(()=>{try{o.initialised&&(r.editedCollectionId?v(o.getCollectionFromPaths([...r.parentCollectionIds??[],r.editedCollectionId])):v(void 0),N(!0))}catch(T){console.error(T)}},[r.editedCollectionId,r.parentCollectionIds,o]),!s)throw Error("Internal: Navigation not ready in collection editor");const{groups:C}=s,w=d?{...d,id:d.id??d.path??i.randomString(16)}:void 0,b=w?Zr(w,a):{id:c?.path??i.randomString(16),path:c?.path??"",name:c?.name??"",group:c?.group??"",properties:{},propertiesOrder:[],icon:t.coolIconKeys[Math.floor(Math.random()*t.coolIconKeys.length)],ownerId:l.user?.uid??""};return m?!r.isNewCollection&&(!o.initialised||!m)?e.jsx(i.CircularProgressCenter,{}):e.jsx(Wr,{...r,initialValues:b,existingPaths:u,existingIds:f,includeTemplates:p,collection:d,setCollection:v,groups:C,propertyConfigs:a}):e.jsx(i.CircularProgressCenter,{})}function Wr({isNewCollection:r,configController:a,editedCollectionId:o,parentCollectionIds:l,fullPath:s,collectionInference:n,handleClose:c,reservedGroups:p,extraView:h,handleCancel:u,setFormDirty:f,pathSuggestions:d,getUser:v,parentCollection:m,getData:N,existingPaths:C,existingIds:w,includeTemplates:b,collection:T,setCollection:S,initialValues:k,propertyConfigs:I,groups:V}){const F=se.useImportConfig(),E=i.useNavigationController(),A=i.useSnackbarController(),x=P.useRef({}),_=r?b?"welcome":"details":"properties",[y,M]=P.useState(_),[W,q]=ge.useState(),Y=O=>{const B=O.id||O.path;return a.saveCollection({id:B,collectionData:O,previousId:o,parentCollectionIds:l}).then(()=>(q(void 0),!0)).catch(z=>(q(z),console.error(z),A.open({type:"error",message:"Error persisting collection: "+(z.message??"Details in the console")}),!1))},j=P.useCallback(()=>{y==="details"?F.inUse?M("import_data_saving"):M(h?"extra_view":"properties"):M(y==="welcome"?"details":y==="import_data_mapping"?"import_data_preview":y==="import_data_preview"?"details":y==="extra_view"?"properties":"details")},[y,F.inUse,h]),H=P.useCallback(O=>{if(n)return n?.(O.path,O.collectionGroup??!1,l??[])},[n,l]),Q=P.useCallback(async O=>{try{if(!H)return S(O),Promise.resolve(O);M("loading");const B=await H?.(O);if(!B)return S(O),Promise.resolve(O);const z={...O??{}};return Object.keys(B.properties??{}).length>0&&(z.properties=B.properties,z.propertiesOrder=B.propertiesOrder),z.propertiesOrder?(S(z),console.debug("Inferred collection",{newCollection:O??{},values:z}),z):(z.propertiesOrder=Object.keys(z.properties),z)}catch(B){return console.error(B),A.open({type:"error",message:"Error inferring collection: "+(B.message??"Details in the console")}),O}},[l,H]),fe=(O,B)=>{console.log("Submitting collection",O);try{if(!r){Y(O).then(()=>{B.resetForm({values:k}),c(O)});return}y==="welcome"?(j(),B.resetForm({values:O})):y==="details"?h||F.inUse?(B.resetForm({values:O}),j()):r?Q(O).then(z=>{B.resetForm({values:z??O,touched:{path:!0,name:!0}})}).finally(()=>{j()}):(B.resetForm({values:O}),j()):y==="extra_view"?(j(),B.resetForm({values:O})):y==="import_data_mapping"||y==="import_data_preview"?j():y==="properties"?Y(O).then(()=>{B.resetForm({values:k}),j(),c(O)}):(j(),B.resetForm({values:O}))}catch(z){A.open({type:"error",message:"Error persisting collection: "+(z.message??"Details in the console")}),console.error(z),B.resetForm({values:O})}},le=O=>{let B={};const z=(y==="properties"||y==="subcollections"||y==="details")&&pr;if(z)try{z.validateSync(O,{abortEarly:!1})}catch($){$.inner.forEach(ne=>{B[ne.path]=ne.message})}if(y==="properties"&&(B={...B,...x.current}),y==="details"){const $=lr(O.path,r,C,O.id);$&&(B.path=$);const ne=Jr(O.id,r,C,w);ne&&(B.id=ne)}return B},X=g.useCreateFormex({initialValues:k,onSubmit:fe,validation:le}),{values:G,setFieldValue:oe,isSubmitting:ce,dirty:Te,submitCount:Ae}=X,re=G.path,Pe=s?.includes("/")?s?.split("/").slice(0,-1).join("/")+"/"+re:re,Ie=lr(re,r,C,G.id),Fe=!Ie&&l?E.convertIdsToPaths(l):void 0,Ne=Ie?void 0:E.resolveAliasesFrom(Pe),ue=Ne&&N?()=>N(Ne,Fe??[]):void 0;P.useEffect(()=>{f(Te)},[Te]);function we(O,B){F.setInUse(!0),Ve.buildEntityPropertiesFromData(O,se.getInferenceType).then(z=>{const $=rr(z);F.setIdColumn($.idColumn),F.setImportData(O),F.setHeadersMapping($.headersMapping);const ne=(B??[]).filter(Se=>$.headersMapping[Se])??Object.keys($.properties);F.setHeadingsOrder(ne),F.setOriginProperties($.properties);const ke=(B??[]).map(Se=>$.headersMapping[Se]).filter(Boolean)??Object.keys($.properties);oe("properties",$.properties),oe("propertiesOrder",ke)})}const Me=!!G.name&&!!G.id,ze=()=>{const O={...G.properties};F.idColumn&&delete O[F.idColumn],oe("properties",O),j()},L=T?.editable===void 0||T?.editable===!0||r;return e.jsx(t.DialogContent,{fullHeight:!0,children:e.jsx(g.Formex,{value:X,children:e.jsxs(e.Fragment,{children:[!r&&e.jsxs(t.Tabs,{value:y,className:t.cn(t.defaultBorderMixin,"justify-end bg-gray-50 dark:bg-gray-950 border-b"),onValueChange:O=>M(O),children:[e.jsx(t.Tab,{value:"details",children:"Details"}),e.jsx(t.Tab,{value:"properties",children:"Properties"}),e.jsx(t.Tab,{value:"subcollections",children:"Additional views"})]}),e.jsxs("form",{noValidate:!0,onSubmit:X.handleSubmit,className:t.cn(r?"h-full":"h-[calc(100%-48px)]","flex-grow flex flex-col relative"),children:[y==="loading"&&e.jsx(i.CircularProgressCenter,{}),y==="extra_view"&&re&&h?.View&&e.jsx(h.View,{path:re}),y==="welcome"&&e.jsx(jr,{path:re,onContinue:(O,B)=>{O?(we(O,B),M("import_data_mapping")):M("details")},existingCollectionPaths:C,parentCollection:m,pathSuggestions:d}),y==="import_data_mapping"&&F&&e.jsx(Yr,{importConfig:F,collectionEditable:L,propertyConfigs:I}),y==="import_data_preview"&&F&&e.jsx(Gr,{importConfig:F,properties:G.properties,propertiesOrder:G.propertiesOrder}),y==="import_data_saving"&&F&&e.jsx(se.ImportSaveInProgress,{importConfig:F,collection:G,path:re,onImportSuccess:async O=>{A.open({type:"info",message:"Data imported successfully"}),await Y(G),c(O)}}),y==="details"&&e.jsx(hr,{existingPaths:C,existingIds:w,groups:V,parentCollectionIds:l,parentCollection:m,isNewCollection:r}),y==="subcollections"&&T&&e.jsx($r,{parentCollection:m,configController:a,getUser:v,collectionInference:n,parentCollectionIds:l,collection:T}),y==="properties"&&e.jsx(Ur,{showErrors:Ae>0,isNewCollection:r,reservedGroups:p,onPropertyError:(O,B,z)=>{const $=i.removeUndefined({...x.current,[Be(O,B)]:i.removeUndefined(z,!0)},!0);x.current=$,X.validate()},getUser:v,getData:ue,doCollectionInference:H,propertyConfigs:I,collectionEditable:L,extraIcon:h?.icon&&e.jsx(t.IconButton,{color:"primary",onClick:()=>M("extra_view"),children:h.icon})}),y!=="welcome"&&e.jsxs(t.DialogActions,{position:"absolute",children:[W&&e.jsx(i.ErrorView,{error:W}),r&&b&&y==="import_data_mapping"&&e.jsxs(t.Button,{variant:"text",type:"button",onClick:()=>(F.setInUse(!1),M("welcome")),children:[e.jsx(t.ArrowBackIcon,{}),"Back"]}),r&&b&&y==="import_data_preview"&&e.jsxs(t.Button,{variant:"text",type:"button",onClick:()=>{M("import_data_mapping")},children:[e.jsx(t.ArrowBackIcon,{}),"Back"]}),r&&b&&y==="details"&&e.jsxs(t.Button,{variant:"text",type:"button",onClick:()=>M("welcome"),children:[e.jsx(t.ArrowBackIcon,{}),"Back"]}),r&&y==="properties"&&e.jsxs(t.Button,{variant:"text",type:"button",onClick:()=>M("details"),children:[e.jsx(t.ArrowBackIcon,{}),"Back"]}),e.jsx(t.Button,{variant:"text",onClick:()=>{u()},children:"Cancel"}),r&&y==="import_data_mapping"&&e.jsx(t.Button,{variant:"filled",color:"primary",onClick:ze,children:"Next"}),r&&y==="import_data_preview"&&e.jsx(t.Button,{variant:"filled",color:"primary",onClick:()=>{j()},children:"Next"}),r&&(y==="details"||y==="properties")&&e.jsxs(t.LoadingButton,{variant:"filled",color:"primary",type:"submit",loading:ce,disabled:ce||y==="details"&&!Me,startIcon:y==="properties"?e.jsx(t.DoneIcon,{}):void 0,children:[y==="details"&&"Next",y==="properties"&&"Create collection"]}),!r&&e.jsx(t.LoadingButton,{variant:"filled",color:"primary",type:"submit",loading:ce,children:"Update collection"})]})]})]})})})}function Zr(r,a){const{properties:o,...l}=r,s={};return o&&Object.keys(o).forEach(n=>{s[n]=ar(o[n],a)}),{...l,properties:s}}function ar(r,a){let o=r;if(a&&typeof o=="object"&&o.propertyConfig){const l=a[o.propertyConfig];if(l&&i.isPropertyBuilder(l.property))o=l.property;else if(l&&(o=i.mergeDeep(l.property,o)),!i.isPropertyBuilder(o)&&o.dataType==="map"&&o.properties){const s={};Object.keys(o.properties).forEach(n=>{s[n]=ar(o.properties[n],a)}),o={...o,properties:s}}}return o}const lr=(r,a,o,l)=>{let s;return r||(s="You must specify a path in the database for this collection"),a&&o?.includes(r.trim().toLowerCase())&&!l&&(s="There is already a collection with the specified path. If you want to have multiple collections referring to the same database path, make sure the have different ids"),i.removeInitialAndTrailingSlashes(r).split("/").length%2===0&&(s=`Collection paths must have an odd number of segments: ${r}`),s},Jr=(r,a,o,l)=>{if(!r)return;let s;return a&&o?.includes(r.trim().toLowerCase())&&(s="There is already a collection that uses this value as a path"),a&&l?.includes(r.trim().toLowerCase())&&(s="There is already a collection which uses this id"),s},or=P.createContext({}),nr=P.createContext({}),Qr=P.memo(function({children:a,collectionConfigController:o,configPermissions:l,reservedGroups:s,collectionInference:n,extraView:c,getPathSuggestions:p,getUser:h,getData:u,onAnalyticsEvent:f}){const d=i.useNavigationController(),v=cr.useNavigate(),m=i.useSnackbarController(),{propertyConfigs:N}=i.useCustomizationController(),[C,w]=P.useState(),[b,T]=P.useState(),S=P.useCallback(()=>({createCollections:!0,editCollections:!0,deleteCollections:!0}),[]),k=P.useCallback(({id:F,fullPath:E,parentCollectionIds:A,parentCollection:x})=>{console.debug("Edit collection",F,E,A,x),f?.("edit_collection",{id:F,fullPath:E}),w({editedCollectionId:F,fullPath:E,parentCollectionIds:A,isNewCollection:!1,parentCollection:x,redirect:!1})},[]),I=P.useCallback(({propertyKey:F,property:E,editedCollectionId:A,currentPropertiesOrder:x,parentCollectionIds:_,collection:y})=>{console.debug("Edit property",F,E,A,x,_,y),f?.("edit_property",{propertyKey:F,editedCollectionId:A});const M=F&&F.includes(".")?F.substring(0,F.lastIndexOf(".")):void 0,W=F&&F.includes(".")?F.substring(F.lastIndexOf(".")+1):F;T({propertyKey:W,property:E,namespace:M,currentPropertiesOrder:x,editedCollectionId:A,parentCollectionIds:_,collectionEditable:y?.editable??!1})},[]),V=P.useCallback(({parentCollectionIds:F,parentCollection:E,initialValues:A,redirect:x,sourceClick:_})=>{console.debug("Create collection",{parentCollectionIds:F,parentCollection:E,initialValues:A,redirect:x,sourceClick:_}),f?.("create_collection",{parentCollectionIds:F,parentCollection:E,initialValues:A,redirect:x,sourceClick:_}),w({isNewCollection:!0,parentCollectionIds:F,parentCollection:E,initialValues:A,redirect:x})},[]);return e.jsx(or.Provider,{value:o,children:e.jsxs(nr.Provider,{value:{editCollection:k,createCollection:V,editProperty:I,configPermissions:l??S,getPathSuggestions:p},children:[a,e.jsx(tr,{open:!!C,configController:o,isNewCollection:!1,collectionInference:n,...C,getData:u,reservedGroups:s,extraView:c,pathSuggestions:p,getUser:h,handleClose:F=>{if(C?.redirect&&F&&C?.isNewCollection&&!C.parentCollectionIds.length){const E=d.buildUrlCollectionPath(F.id??F.path);v(E)}w(void 0)}}),e.jsx(de,{open:!!b,includeIdAndName:!0,existingProperty:!!b?.propertyKey,autoUpdateId:b?!b?.propertyKey:!1,autoOpenTypeSelect:b?!b?.propertyKey:!1,inArray:!1,collectionEditable:b?.collectionEditable??!1,getData:u&&b?.editedCollectionId?()=>{console.debug("get data for property",b?.editedCollectionId);const F=d.resolveAliasesFrom(b.editedCollectionId);return u(F,[])}:void 0,onPropertyChanged:({id:F,property:E})=>{if(!b||!F)return;const A=!b.propertyKey;return o.saveProperty({path:b?.editedCollectionId,property:E,propertyKey:F,newPropertiesOrder:A&&b.currentPropertiesOrder?[...b.currentPropertiesOrder,F]:void 0,namespace:b.namespace,parentCollectionIds:b.parentCollectionIds}).catch(x=>(console.error(x),m.open({type:"error",message:"Error persisting property: "+(x.message??"Details in the console")}),!1))},onPropertyChangedImmediate:!1,onDelete:()=>{if(!b?.propertyKey)return;const F=b?.currentPropertiesOrder?.filter(E=>E!==b?.propertyKey);return o.deleteProperty({path:b?.editedCollectionId,propertyKey:b?.propertyKey,namespace:b?.namespace,newPropertiesOrder:F,parentCollectionIds:b?.parentCollectionIds}).then(()=>{T(void 0)}).catch(E=>(console.error(E),m.open({type:"error",message:"Error deleting property: "+(E.message??"Details in the console")}),!1))},onError:()=>{},onOkClicked:()=>{T(void 0)},onCancel:()=>{T(void 0)},initialErrors:{},forceShowErrors:!1,existingPropertyKeys:[],allowDataInference:!0,propertyConfigs:N,property:b?.property,propertyKey:b?.propertyKey})]})})},te),ee=()=>P.useContext(nr);function Xr({path:r,parentCollectionIds:a,collection:o,tableController:l}){const s=i.useAuthController(),n=i.useNavigationController(),c=ee(),p=n.getCollectionFromIds(a),h=c.configPermissions?c.configPermissions({user:s.user,collection:o}).editCollections:!0,u=e.jsx(t.Tooltip,{title:h?"Edit collection":"You don't have permissions to edit this collection",children:e.jsx(t.IconButton,{color:"primary",disabled:!h,onClick:h?()=>c?.editCollection({id:o.id,fullPath:r,parentCollectionIds:a,parentCollection:p}):void 0,children:e.jsx(t.SettingsIcon,{})})});return e.jsx(e.Fragment,{children:u})}const De=()=>P.useContext(or);function Rr({path:r,collection:a}){const o=i.useSnackbarController(),l=i.useAuthController(),s=De(),n=ee(),c=n.configPermissions({user:l.user,collection:a}),p=P.useCallback(()=>{n?.editCollection({id:a.id,parentCollectionIds:[]})},[n,r]),[h,u]=P.useState(!1),f=P.useCallback(()=>{s?.deleteCollection({id:a.id}).then(()=>{u(!1),o.open({message:"Collection deleted",type:"success"})})},[r,s]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[c.deleteCollections&&e.jsx(t.Menu,{trigger:e.jsx(t.IconButton,{children:e.jsx(t.MoreVertIcon,{size:"small"})}),children:e.jsxs(t.MenuItem,{onClick:d=>{d.preventDefault(),d.stopPropagation(),u(!0)},children:[e.jsx(t.DeleteIcon,{}),"Delete"]})}),c.editCollections&&e.jsx(t.IconButton,{onClick:d=>{p()},children:e.jsx(t.SettingsIcon,{size:"small"})})]}),e.jsx(i.DeleteConfirmationDialog,{open:h,onAccept:f,onCancel:()=>u(!1),title:e.jsx(e.Fragment,{children:"Delete this collection?"}),body:e.jsxs(e.Fragment,{children:[" This will ",e.jsx("b",{children:"not delete any data"}),", only the collection in the CMS"]})})]})}function et({propertyKey:r,onHover:a,property:o,fullPath:l,parentCollectionIds:s,collection:n}){const c=ee();return e.jsx(t.Tooltip,{title:"Edit",children:e.jsx(t.IconButton,{className:a?"bg-white dark:bg-gray-950":"hidden",onClick:()=>{c.editProperty({propertyKey:r,property:o,editedCollectionId:n.id,parentCollectionIds:s,collection:n})},size:"small",children:e.jsx(t.SettingsIcon,{size:"small"})})})}function rt({fullPath:r,parentCollectionIds:a,collection:o}){const l=i.useAuthController(),s=ee(),n=s.configPermissions?s.configPermissions({user:l.user,collection:o}).editCollections:!0;return e.jsx(t.Tooltip,{title:n?"Add new property":"You don't have permission to add new properties",children:e.jsx("div",{className:"p-0.5 w-20 h-full flex items-center justify-center cursor-pointer bg-gray-100 bg-opacity-40 hover:bg-gray-100 dark:bg-gray-950 dark:bg-opacity-40 dark:hover:bg-gray-950",onClick:()=>{s.editProperty({editedCollectionId:o.id,parentCollectionIds:a,currentPropertiesOrder:i.getDefaultPropertiesOrder(o),collection:o})},children:e.jsx(t.AddIcon,{color:"inherit"})})})}function tt(){const r=ee();return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 min-w-fit rounded",children:e.jsxs(t.Button,{className:"min-w-fit",variant:"outlined",onClick:()=>r.createCollection({parentCollectionIds:[],redirect:!0,sourceClick:"new_collection_button"}),children:[e.jsx(t.AddIcon,{}),"New collection"]})})}function at({path:r,parentCollectionIds:a,collection:o,tableController:l}){const s=i.useAuthController(),n=ee(),c=De(),p=i.useSnackbarController(),h=n.configPermissions?n.configPermissions({user:s.user,collection:o}).editCollections:!0;let u=null;return(!te(Ce(l.filterValues),Ce(o.initialFilter))||!te(Ce(l.sortBy),Ce(o.initialSort)))&&(u=e.jsxs(e.Fragment,{children:[e.jsx(t.Tooltip,{title:l.sortBy||l.filterValues?"Save default filter and sort":"Clear default filter and sort",children:e.jsx(t.Button,{color:"primary",size:"small",variant:"outlined",onClick:()=>c?.saveCollection({id:o.id,parentCollectionIds:a,collectionData:i.mergeDeep(o,{initialFilter:l.filterValues??null,initialSort:l.sortBy??null})}).then(()=>{p.open({type:"success",message:"Default config saved"})}),children:e.jsx(t.SaveIcon,{})})}),(o.initialFilter||o.initialSort)&&e.jsx(t.Tooltip,{title:"Reset to default filter and sort",children:e.jsx(t.Button,{color:"primary",size:"small",variant:"text",onClick:()=>{l.clearFilter?.(),o?.initialFilter&&l.setFilterValues?.(o?.initialFilter),o?.initialSort&&l.setSortBy?.(o?.initialSort)},children:e.jsx(t.UndoIcon,{})})})]})),e.jsx(e.Fragment,{children:h&&u})}function Ce(r){return r&&Object.keys(r).length===0?r:r??null}function lt({group:r,context:a}){if(!a.navigation.topLevelNavigation)throw Error("Navigation not ready in FireCMSHomePage");const o=i.useAuthController(),l=ee(),s=l.configPermissions?l.configPermissions({user:o.user}).createCollections:!0;return e.jsx(t.Card,{className:t.cn("h-full p-4 min-h-[124px]"),onClick:l&&s?()=>l.createCollection({initialValues:r?{group:r}:void 0,parentCollectionIds:[],redirect:!0,sourceClick:"new_collection_card"}):void 0,children:e.jsxs("div",{className:"flex flex-col items-start h-full w-full items-center justify-center h-full w-full flex-grow flex-col",children:[e.jsx(t.AddIcon,{color:"primary",size:"large"}),e.jsx(t.Typography,{color:"primary",variant:"caption",className:"font-medium",children:"Add new collection".toUpperCase()}),!s&&e.jsx(t.Typography,{variant:"caption",children:"You don't have permissions to create collections"})]})})}function ot({collectionConfigController:r,configPermissions:a,reservedGroups:o,extraView:l,getPathSuggestions:s,getUser:n,collectionInference:c,getData:p,onAnalyticsEvent:h}){return{key:"collection_editor",loading:r.loading,provider:{Component:Qr,props:{collectionConfigController:r,configPermissions:a,collectionInference:c,reservedGroups:o,extraView:l,getPathSuggestions:s,getUser:n,getData:p,onAnalyticsEvent:h}},homePage:{additionalActions:e.jsx(tt,{}),additionalChildrenStart:e.jsx(nt,{}),CollectionActions:Rr,AdditionalCards:lt},collectionView:{CollectionActionsStart:at,CollectionActions:Xr,HeaderAction:et,AddColumnComponent:rt}}}function nt({}){const r=i.useNavigationController();if(!r.topLevelNavigation)throw Error("Navigation not ready in FireCMSHomePage");const a=i.useAuthController(),o=ee(),l=o.configPermissions?o.configPermissions({user:a.user}).createCollections:!0;return!r.initialised||r.collections===void 0||(r.collections??[]).length>0?null:e.jsxs(t.Paper,{className:"my-4 px-4 py-6 flex flex-col  bg-white dark:bg-slate-800 gap-2",children:[e.jsx(t.Typography,{variant:"subtitle2",className:"uppercase",children:"No collections found"}),e.jsx(t.Typography,{children:"Start building collections in FireCMS easily. Map them to your existing database data, import from files, or use our templates."}),l&&e.jsxs(t.Button,{onClick:o&&l?()=>o.createCollection({parentCollectionIds:[],redirect:!0,sourceClick:"new_collection_card"}):void 0,children:[e.jsx(t.AddIcon,{}),"Create your first collection"]}),e.jsx(t.Typography,{variant:"caption",color:"secondary",children:"You can also define collections programmatically."})]})}const st=(r,a,o)=>{const l=c=>{i.makePropertiesEditable(c.properties),c.subcollections?.forEach(l)},s=a??[];s.forEach(l),console.debug("Collections specified in code:",r),console.debug("Collections stored in the backend",s);const n=i.joinCollectionLists(r,s,[],o);return console.debug("Collections after joining:",n),n};function it({path:r}){const a=i.useNavigationController(),o=dt(r),l=a.getParentCollectionIds(r),s=ee();return e.jsxs("div",{className:"p-1 flex flex-col items-center",children:[e.jsx(i.ErrorView,{error:"No collection for path: "+o}),e.jsx(t.Button,{className:"mx-2",variant:"outlined",size:"small",onClick:()=>{s.createCollection({initialValues:{path:o,name:i.unslugify(o)},parentCollectionIds:l,redirect:!1,sourceClick:"missing_reference"})},children:"Create"})]})}function dt(r){const a=r.split("/");return a[a.length-1]}U.MissingReferenceWidget=it,U.editableProperty=he,U.getFullId=K,U.getFullIdPath=Be,U.idToPropertiesPath=J,U.mergeCollections=st,U.namespaceToPropertiesOrderPath=R,U.namespaceToPropertiesPath=Ee,U.removeNonEditableProperties=je,U.useCollectionEditorController=ee,U.useCollectionEditorPlugin=ot,U.useCollectionsConfigController=De,Object.defineProperty(U,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
